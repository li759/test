/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Og=Object.create;var ii=Object.defineProperty;var Gg=Object.getOwnPropertyDescriptor;var Ng=Object.getOwnPropertyNames;var Vg=Object.getPrototypeOf,_g=Object.prototype.hasOwnProperty;var Xg=(y,e,A)=>e in y?ii(y,e,{enumerable:!0,configurable:!0,writable:!0,value:A}):y[e]=A;var Wg=(y,e)=>()=>(e||y((e={exports:{}}).exports,e),e.exports),Jg=(y,e)=>{for(var A in e)ii(y,A,{get:e[A],enumerable:!0})},ho=(y,e,A,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ng(e))!_g.call(y,s)&&s!==A&&ii(y,s,{get:()=>e[s],enumerable:!(t=Gg(e,s))||t.enumerable});return y};var go=(y,e,A)=>(A=y!=null?Og(Vg(y)):{},ho(e||!y||!y.__esModule?ii(A,"default",{value:y,enumerable:!0}):A,y)),Yg=y=>ho(ii({},"__esModule",{value:!0}),y);var SA=(y,e,A)=>Xg(y,typeof e!="symbol"?e+"":e,A);var nn=Wg((sn,rn)=>{(function(y,e){typeof sn=="object"&&typeof rn!="undefined"?rn.exports=e():typeof define=="function"&&define.amd?define(e):(y=typeof globalThis!="undefined"?globalThis:y||self,y.html2canvas=e())})(sn,function(){"use strict";var y=function(r,i){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,n){a.__proto__=n}||function(a,n){for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&(a[h]=n[h])},y(r,i)};function e(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");y(r,i);function a(){this.constructor=r}r.prototype=i===null?Object.create(i):(a.prototype=i.prototype,new a)}var A=function(){return A=Object.assign||function(i){for(var a,n=1,h=arguments.length;n<h;n++){a=arguments[n];for(var p in a)Object.prototype.hasOwnProperty.call(a,p)&&(i[p]=a[p])}return i},A.apply(this,arguments)};function t(r,i,a,n){function h(p){return p instanceof a?p:new a(function(B){B(p)})}return new(a||(a=Promise))(function(p,B){function v(S){try{U(n.next(S))}catch(I){B(I)}}function C(S){try{U(n.throw(S))}catch(I){B(I)}}function U(S){S.done?p(S.value):h(S.value).then(v,C)}U((n=n.apply(r,i||[])).next())})}function s(r,i){var a={label:0,sent:function(){if(p[0]&1)throw p[1];return p[1]},trys:[],ops:[]},n,h,p,B;return B={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function v(U){return function(S){return C([U,S])}}function C(U){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,h&&(p=U[0]&2?h.return:U[0]?h.throw||((p=h.return)&&p.call(h),0):h.next)&&!(p=p.call(h,U[1])).done)return p;switch(h=0,p&&(U=[U[0]&2,p.value]),U[0]){case 0:case 1:p=U;break;case 4:return a.label++,{value:U[1],done:!1};case 5:a.label++,h=U[1],U=[0];continue;case 7:U=a.ops.pop(),a.trys.pop();continue;default:if(p=a.trys,!(p=p.length>0&&p[p.length-1])&&(U[0]===6||U[0]===2)){a=0;continue}if(U[0]===3&&(!p||U[1]>p[0]&&U[1]<p[3])){a.label=U[1];break}if(U[0]===6&&a.label<p[1]){a.label=p[1],p=U;break}if(p&&a.label<p[2]){a.label=p[2],a.ops.push(U);break}p[2]&&a.ops.pop(),a.trys.pop();continue}U=i.call(r,a)}catch(S){U=[6,S],h=0}finally{n=p=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}}function o(r,i,a){if(a||arguments.length===2)for(var n=0,h=i.length,p;n<h;n++)(p||!(n in i))&&(p||(p=Array.prototype.slice.call(i,0,n)),p[n]=i[n]);return r.concat(p||i)}for(var l=function(){function r(i,a,n,h){this.left=i,this.top=a,this.width=n,this.height=h}return r.prototype.add=function(i,a,n,h){return new r(this.left+i,this.top+a,this.width+n,this.height+h)},r.fromClientRect=function(i,a){return new r(a.left+i.windowBounds.left,a.top+i.windowBounds.top,a.width,a.height)},r.fromDOMRectList=function(i,a){var n=Array.from(a).find(function(h){return h.width!==0});return n?new r(n.left+i.windowBounds.left,n.top+i.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),c=function(r,i){return l.fromClientRect(r,i.getBoundingClientRect())},d=function(r){var i=r.body,a=r.documentElement;if(!i||!a)throw new Error("Unable to get document size");var n=Math.max(Math.max(i.scrollWidth,a.scrollWidth),Math.max(i.offsetWidth,a.offsetWidth),Math.max(i.clientWidth,a.clientWidth)),h=Math.max(Math.max(i.scrollHeight,a.scrollHeight),Math.max(i.offsetHeight,a.offsetHeight),Math.max(i.clientHeight,a.clientHeight));return new l(0,0,n,h)},g=function(r){for(var i=[],a=0,n=r.length;a<n;){var h=r.charCodeAt(a++);if(h>=55296&&h<=56319&&a<n){var p=r.charCodeAt(a++);(p&64512)===56320?i.push(((h&1023)<<10)+(p&1023)+65536):(i.push(h),a--)}else i.push(h)}return i},u=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var a=r.length;if(!a)return"";for(var n=[],h=-1,p="";++h<a;){var B=r[h];B<=65535?n.push(B):(B-=65536,n.push((B>>10)+55296,B%1024+56320)),(h+1===a||n.length>16384)&&(p+=String.fromCharCode.apply(String,n),n.length=0)}return p},m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),F=0;F<m.length;F++)w[m.charCodeAt(F)]=F;for(var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",E=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),H=0;H<Q.length;H++)E[Q.charCodeAt(H)]=H;for(var b=function(r){var i=r.length*.75,a=r.length,n,h=0,p,B,v,C;r[r.length-1]==="="&&(i--,r[r.length-2]==="="&&i--);var U=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(i):new Array(i),S=Array.isArray(U)?U:new Uint8Array(U);for(n=0;n<a;n+=4)p=E[r.charCodeAt(n)],B=E[r.charCodeAt(n+1)],v=E[r.charCodeAt(n+2)],C=E[r.charCodeAt(n+3)],S[h++]=p<<2|B>>4,S[h++]=(B&15)<<4|v>>2,S[h++]=(v&3)<<6|C&63;return U},K=function(r){for(var i=r.length,a=[],n=0;n<i;n+=2)a.push(r[n+1]<<8|r[n]);return a},M=function(r){for(var i=r.length,a=[],n=0;n<i;n+=4)a.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return a},D=5,N=11,W=2,sA=N-D,J=65536>>D,cA=1<<D,wA=cA-1,eA=1024>>D,Z=J+eA,TA=Z,vA=32,JA=TA+vA,ZA=65536>>N,YA=1<<sA,Ie=YA-1,Pe=function(r,i,a){return r.slice?r.slice(i,a):new Uint16Array(Array.prototype.slice.call(r,i,a))},HA=function(r,i,a){return r.slice?r.slice(i,a):new Uint32Array(Array.prototype.slice.call(r,i,a))},Ke=function(r,i){var a=b(r),n=Array.isArray(a)?M(a):new Uint32Array(a),h=Array.isArray(a)?K(a):new Uint16Array(a),p=24,B=Pe(h,p/2,n[4]/2),v=n[5]===2?Pe(h,(p+n[4])/2):HA(n,Math.ceil((p+n[4])/4));return new Re(n[0],n[1],n[2],n[3],B,v)},Re=function(){function r(i,a,n,h,p,B){this.initialValue=i,this.errorValue=a,this.highStart=n,this.highValueIndex=h,this.index=p,this.data=B}return r.prototype.get=function(i){var a;if(i>=0){if(i<55296||i>56319&&i<=65535)return a=this.index[i>>D],a=(a<<W)+(i&wA),this.data[a];if(i<=65535)return a=this.index[J+(i-55296>>D)],a=(a<<W)+(i&wA),this.data[a];if(i<this.highStart)return a=JA-ZA+(i>>N),a=this.index[a],a+=i>>D&Ie,a=this.index[a],a=(a<<W)+(i&wA),this.data[a];if(i<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),xA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ne=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),fA=0;fA<xA.length;fA++)ne[xA.charCodeAt(fA)]=fA;var KA="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",DA=50,zA=1,yA=2,RA=3,Dt=4,FA=5,me=7,bA=8,wn=9,ke=10,ir=11,Cn=12,sr=13,Ro=14,Pt=15,rr=16,wi=17,Kt=18,ko=19,vn=20,nr=21,Rt=22,ar=23,gt=24,ae=25,kt=26,Ot=27,ut=28,Oo=29,st=30,Go=31,Ci=32,vi=33,or=34,lr=35,cr=36,Gt=37,hr=38,Fi=39,yi=40,dr=41,Fn=42,No=43,Vo=[9001,65288],yn="!",rA="\xD7",Qi="\xF7",gr=Ke(KA),He=[st,cr],ur=[zA,yA,RA,FA],Qn=[ke,bA],En=[Ot,kt],_o=ur.concat(Qn),Un=[hr,Fi,yi,or,lr],Xo=[Pt,sr],Wo=function(r,i){i===void 0&&(i="strict");var a=[],n=[],h=[];return r.forEach(function(p,B){var v=gr.get(p);if(v>DA?(h.push(!0),v-=DA):h.push(!1),["normal","auto","loose"].indexOf(i)!==-1&&[8208,8211,12316,12448].indexOf(p)!==-1)return n.push(B),a.push(rr);if(v===Dt||v===ir){if(B===0)return n.push(B),a.push(st);var C=a[B-1];return _o.indexOf(C)===-1?(n.push(n[B-1]),a.push(C)):(n.push(B),a.push(st))}if(n.push(B),v===Go)return a.push(i==="strict"?nr:Gt);if(v===Fn||v===Oo)return a.push(st);if(v===No)return p>=131072&&p<=196605||p>=196608&&p<=262141?a.push(Gt):a.push(st);a.push(v)}),[n,a,h]},pr=function(r,i,a,n){var h=n[a];if(Array.isArray(r)?r.indexOf(h)!==-1:r===h)for(var p=a;p<=n.length;){p++;var B=n[p];if(B===i)return!0;if(B!==ke)break}if(h===ke)for(var p=a;p>0;){p--;var v=n[p];if(Array.isArray(r)?r.indexOf(v)!==-1:r===v)for(var C=a;C<=n.length;){C++;var B=n[C];if(B===i)return!0;if(B!==ke)break}if(v!==ke)break}return!1},Sn=function(r,i){for(var a=r;a>=0;){var n=i[a];if(n===ke)a--;else return n}return 0},Jo=function(r,i,a,n,h){if(a[n]===0)return rA;var p=n-1;if(Array.isArray(h)&&h[p]===!0)return rA;var B=p-1,v=p+1,C=i[p],U=B>=0?i[B]:0,S=i[v];if(C===yA&&S===RA)return rA;if(ur.indexOf(C)!==-1)return yn;if(ur.indexOf(S)!==-1||Qn.indexOf(S)!==-1)return rA;if(Sn(p,i)===bA)return Qi;if(gr.get(r[p])===ir||(C===Ci||C===vi)&&gr.get(r[v])===ir||C===me||S===me||C===wn||[ke,sr,Pt].indexOf(C)===-1&&S===wn||[wi,Kt,ko,gt,ut].indexOf(S)!==-1||Sn(p,i)===Rt||pr(ar,Rt,p,i)||pr([wi,Kt],nr,p,i)||pr(Cn,Cn,p,i))return rA;if(C===ke)return Qi;if(C===ar||S===ar)return rA;if(S===rr||C===rr)return Qi;if([sr,Pt,nr].indexOf(S)!==-1||C===Ro||U===cr&&Xo.indexOf(C)!==-1||C===ut&&S===cr||S===vn||He.indexOf(S)!==-1&&C===ae||He.indexOf(C)!==-1&&S===ae||C===Ot&&[Gt,Ci,vi].indexOf(S)!==-1||[Gt,Ci,vi].indexOf(C)!==-1&&S===kt||He.indexOf(C)!==-1&&En.indexOf(S)!==-1||En.indexOf(C)!==-1&&He.indexOf(S)!==-1||[Ot,kt].indexOf(C)!==-1&&(S===ae||[Rt,Pt].indexOf(S)!==-1&&i[v+1]===ae)||[Rt,Pt].indexOf(C)!==-1&&S===ae||C===ae&&[ae,ut,gt].indexOf(S)!==-1)return rA;if([ae,ut,gt,wi,Kt].indexOf(S)!==-1)for(var I=p;I>=0;){var x=i[I];if(x===ae)return rA;if([ut,gt].indexOf(x)!==-1)I--;else break}if([Ot,kt].indexOf(S)!==-1)for(var I=[wi,Kt].indexOf(C)!==-1?B:p;I>=0;){var x=i[I];if(x===ae)return rA;if([ut,gt].indexOf(x)!==-1)I--;else break}if(hr===C&&[hr,Fi,or,lr].indexOf(S)!==-1||[Fi,or].indexOf(C)!==-1&&[Fi,yi].indexOf(S)!==-1||[yi,lr].indexOf(C)!==-1&&S===yi||Un.indexOf(C)!==-1&&[vn,kt].indexOf(S)!==-1||Un.indexOf(S)!==-1&&C===Ot||He.indexOf(C)!==-1&&He.indexOf(S)!==-1||C===gt&&He.indexOf(S)!==-1||He.concat(ae).indexOf(C)!==-1&&S===Rt&&Vo.indexOf(r[v])===-1||He.concat(ae).indexOf(S)!==-1&&C===Kt)return rA;if(C===dr&&S===dr){for(var O=a[p],L=1;O>0&&(O--,i[O]===dr);)L++;if(L%2!==0)return rA}return C===Ci&&S===vi?rA:Qi},Yo=function(r,i){i||(i={lineBreak:"normal",wordBreak:"normal"});var a=Wo(r,i.lineBreak),n=a[0],h=a[1],p=a[2];(i.wordBreak==="break-all"||i.wordBreak==="break-word")&&(h=h.map(function(v){return[ae,st,Fn].indexOf(v)!==-1?Gt:v}));var B=i.wordBreak==="keep-all"?p.map(function(v,C){return v&&r[C]>=19968&&r[C]<=40959}):void 0;return[n,h,B]},$o=function(){function r(i,a,n,h){this.codePoints=i,this.required=a===yn,this.start=n,this.end=h}return r.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),qo=function(r,i){var a=g(r),n=Yo(a,i),h=n[0],p=n[1],B=n[2],v=a.length,C=0,U=0;return{next:function(){if(U>=v)return{done:!0,value:null};for(var S=rA;U<v&&(S=Jo(a,p,h,++U,B))===rA;);if(S!==rA||U===v){var I=new $o(a,S,C,U);return C=U,{value:I,done:!1}}return{done:!0,value:null}}}},Zo=1,zo=2,Nt=4,In=8,Ei=10,Hn=47,Vt=92,jo=9,Al=32,Ui=34,_t=61,el=35,tl=36,il=37,Si=39,Ii=40,Xt=41,sl=95,jA=45,rl=33,nl=60,al=62,ol=64,ll=91,cl=93,hl=61,dl=123,Hi=63,gl=125,xn=124,ul=126,pl=128,bn=65533,fr=42,rt=43,fl=44,ml=58,Bl=59,Wt=46,wl=0,Cl=8,vl=11,Fl=14,yl=31,Ql=127,Fe=-1,Mn=48,Ln=97,Tn=101,El=102,Ul=117,Sl=122,Dn=65,Pn=69,Kn=70,Il=85,Hl=90,_A=function(r){return r>=Mn&&r<=57},xl=function(r){return r>=55296&&r<=57343},pt=function(r){return _A(r)||r>=Dn&&r<=Kn||r>=Ln&&r<=El},bl=function(r){return r>=Ln&&r<=Sl},Ml=function(r){return r>=Dn&&r<=Hl},Ll=function(r){return bl(r)||Ml(r)},Tl=function(r){return r>=pl},xi=function(r){return r===Ei||r===jo||r===Al},bi=function(r){return Ll(r)||Tl(r)||r===sl},Rn=function(r){return bi(r)||_A(r)||r===jA},Dl=function(r){return r>=wl&&r<=Cl||r===vl||r>=Fl&&r<=yl||r===Ql},Oe=function(r,i){return r!==Vt?!1:i!==Ei},Mi=function(r,i,a){return r===jA?bi(i)||Oe(i,a):bi(r)?!0:!!(r===Vt&&Oe(r,i))},mr=function(r,i,a){return r===rt||r===jA?_A(i)?!0:i===Wt&&_A(a):_A(r===Wt?i:r)},Pl=function(r){var i=0,a=1;(r[i]===rt||r[i]===jA)&&(r[i]===jA&&(a=-1),i++);for(var n=[];_A(r[i]);)n.push(r[i++]);var h=n.length?parseInt(u.apply(void 0,n),10):0;r[i]===Wt&&i++;for(var p=[];_A(r[i]);)p.push(r[i++]);var B=p.length,v=B?parseInt(u.apply(void 0,p),10):0;(r[i]===Pn||r[i]===Tn)&&i++;var C=1;(r[i]===rt||r[i]===jA)&&(r[i]===jA&&(C=-1),i++);for(var U=[];_A(r[i]);)U.push(r[i++]);var S=U.length?parseInt(u.apply(void 0,U),10):0;return a*(h+v*Math.pow(10,-B))*Math.pow(10,C*S)},Kl={type:2},Rl={type:3},kl={type:4},Ol={type:13},Gl={type:8},Nl={type:21},Vl={type:9},_l={type:10},Xl={type:11},Wl={type:12},Jl={type:14},Li={type:23},Yl={type:1},$l={type:25},ql={type:24},Zl={type:26},zl={type:27},jl={type:28},Ac={type:29},ec={type:31},Br={type:32},kn=function(){function r(){this._value=[]}return r.prototype.write=function(i){this._value=this._value.concat(g(i))},r.prototype.read=function(){for(var i=[],a=this.consumeToken();a!==Br;)i.push(a),a=this.consumeToken();return i},r.prototype.consumeToken=function(){var i=this.consumeCodePoint();switch(i){case Ui:return this.consumeStringToken(Ui);case el:var a=this.peekCodePoint(0),n=this.peekCodePoint(1),h=this.peekCodePoint(2);if(Rn(a)||Oe(n,h)){var p=Mi(a,n,h)?zo:Zo,B=this.consumeName();return{type:5,value:B,flags:p}}break;case tl:if(this.peekCodePoint(0)===_t)return this.consumeCodePoint(),Ol;break;case Si:return this.consumeStringToken(Si);case Ii:return Kl;case Xt:return Rl;case fr:if(this.peekCodePoint(0)===_t)return this.consumeCodePoint(),Jl;break;case rt:if(mr(i,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(i),this.consumeNumericToken();break;case fl:return kl;case jA:var v=i,C=this.peekCodePoint(0),U=this.peekCodePoint(1);if(mr(v,C,U))return this.reconsumeCodePoint(i),this.consumeNumericToken();if(Mi(v,C,U))return this.reconsumeCodePoint(i),this.consumeIdentLikeToken();if(C===jA&&U===al)return this.consumeCodePoint(),this.consumeCodePoint(),ql;break;case Wt:if(mr(i,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(i),this.consumeNumericToken();break;case Hn:if(this.peekCodePoint(0)===fr)for(this.consumeCodePoint();;){var S=this.consumeCodePoint();if(S===fr&&(S=this.consumeCodePoint(),S===Hn))return this.consumeToken();if(S===Fe)return this.consumeToken()}break;case ml:return Zl;case Bl:return zl;case nl:if(this.peekCodePoint(0)===rl&&this.peekCodePoint(1)===jA&&this.peekCodePoint(2)===jA)return this.consumeCodePoint(),this.consumeCodePoint(),$l;break;case ol:var I=this.peekCodePoint(0),x=this.peekCodePoint(1),O=this.peekCodePoint(2);if(Mi(I,x,O)){var B=this.consumeName();return{type:7,value:B}}break;case ll:return jl;case Vt:if(Oe(i,this.peekCodePoint(0)))return this.reconsumeCodePoint(i),this.consumeIdentLikeToken();break;case cl:return Ac;case hl:if(this.peekCodePoint(0)===_t)return this.consumeCodePoint(),Gl;break;case dl:return Xl;case gl:return Wl;case Ul:case Il:var L=this.peekCodePoint(0),P=this.peekCodePoint(1);return L===rt&&(pt(P)||P===Hi)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(i),this.consumeIdentLikeToken();case xn:if(this.peekCodePoint(0)===_t)return this.consumeCodePoint(),Vl;if(this.peekCodePoint(0)===xn)return this.consumeCodePoint(),Nl;break;case ul:if(this.peekCodePoint(0)===_t)return this.consumeCodePoint(),_l;break;case Fe:return Br}return xi(i)?(this.consumeWhiteSpace(),ec):_A(i)?(this.reconsumeCodePoint(i),this.consumeNumericToken()):bi(i)?(this.reconsumeCodePoint(i),this.consumeIdentLikeToken()):{type:6,value:u(i)}},r.prototype.consumeCodePoint=function(){var i=this._value.shift();return typeof i=="undefined"?-1:i},r.prototype.reconsumeCodePoint=function(i){this._value.unshift(i)},r.prototype.peekCodePoint=function(i){return i>=this._value.length?-1:this._value[i]},r.prototype.consumeUnicodeRangeToken=function(){for(var i=[],a=this.consumeCodePoint();pt(a)&&i.length<6;)i.push(a),a=this.consumeCodePoint();for(var n=!1;a===Hi&&i.length<6;)i.push(a),a=this.consumeCodePoint(),n=!0;if(n){var h=parseInt(u.apply(void 0,i.map(function(C){return C===Hi?Mn:C})),16),p=parseInt(u.apply(void 0,i.map(function(C){return C===Hi?Kn:C})),16);return{type:30,start:h,end:p}}var B=parseInt(u.apply(void 0,i),16);if(this.peekCodePoint(0)===jA&&pt(this.peekCodePoint(1))){this.consumeCodePoint(),a=this.consumeCodePoint();for(var v=[];pt(a)&&v.length<6;)v.push(a),a=this.consumeCodePoint();var p=parseInt(u.apply(void 0,v),16);return{type:30,start:B,end:p}}else return{type:30,start:B,end:B}},r.prototype.consumeIdentLikeToken=function(){var i=this.consumeName();return i.toLowerCase()==="url"&&this.peekCodePoint(0)===Ii?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Ii?(this.consumeCodePoint(),{type:19,value:i}):{type:20,value:i}},r.prototype.consumeUrlToken=function(){var i=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Fe)return{type:22,value:""};var a=this.peekCodePoint(0);if(a===Si||a===Ui){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Fe||this.peekCodePoint(0)===Xt)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),Li)}for(;;){var h=this.consumeCodePoint();if(h===Fe||h===Xt)return{type:22,value:u.apply(void 0,i)};if(xi(h))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Fe||this.peekCodePoint(0)===Xt?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,i)}):(this.consumeBadUrlRemnants(),Li);if(h===Ui||h===Si||h===Ii||Dl(h))return this.consumeBadUrlRemnants(),Li;if(h===Vt)if(Oe(h,this.peekCodePoint(0)))i.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Li;else i.push(h)}},r.prototype.consumeWhiteSpace=function(){for(;xi(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var i=this.consumeCodePoint();if(i===Xt||i===Fe)return;Oe(i,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(i){for(var a=5e4,n="";i>0;){var h=Math.min(a,i);n+=u.apply(void 0,this._value.splice(0,h)),i-=h}return this._value.shift(),n},r.prototype.consumeStringToken=function(i){var a="",n=0;do{var h=this._value[n];if(h===Fe||h===void 0||h===i)return a+=this.consumeStringSlice(n),{type:0,value:a};if(h===Ei)return this._value.splice(0,n),Yl;if(h===Vt){var p=this._value[n+1];p!==Fe&&p!==void 0&&(p===Ei?(a+=this.consumeStringSlice(n),n=-1,this._value.shift()):Oe(h,p)&&(a+=this.consumeStringSlice(n),a+=u(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var i=[],a=Nt,n=this.peekCodePoint(0);for((n===rt||n===jA)&&i.push(this.consumeCodePoint());_A(this.peekCodePoint(0));)i.push(this.consumeCodePoint());n=this.peekCodePoint(0);var h=this.peekCodePoint(1);if(n===Wt&&_A(h))for(i.push(this.consumeCodePoint(),this.consumeCodePoint()),a=In;_A(this.peekCodePoint(0));)i.push(this.consumeCodePoint());n=this.peekCodePoint(0),h=this.peekCodePoint(1);var p=this.peekCodePoint(2);if((n===Pn||n===Tn)&&((h===rt||h===jA)&&_A(p)||_A(h)))for(i.push(this.consumeCodePoint(),this.consumeCodePoint()),a=In;_A(this.peekCodePoint(0));)i.push(this.consumeCodePoint());return[Pl(i),a]},r.prototype.consumeNumericToken=function(){var i=this.consumeNumber(),a=i[0],n=i[1],h=this.peekCodePoint(0),p=this.peekCodePoint(1),B=this.peekCodePoint(2);if(Mi(h,p,B)){var v=this.consumeName();return{type:15,number:a,flags:n,unit:v}}return h===il?(this.consumeCodePoint(),{type:16,number:a,flags:n}):{type:17,number:a,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var i=this.consumeCodePoint();if(pt(i)){for(var a=u(i);pt(this.peekCodePoint(0))&&a.length<6;)a+=u(this.consumeCodePoint());xi(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(a,16);return n===0||xl(n)||n>1114111?bn:n}return i===Fe?bn:i},r.prototype.consumeName=function(){for(var i="";;){var a=this.consumeCodePoint();if(Rn(a))i+=u(a);else if(Oe(a,this.peekCodePoint(0)))i+=u(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(a),i}},r}(),On=function(){function r(i){this._tokens=i}return r.create=function(i){var a=new kn;return a.write(i),new r(a.read())},r.parseValue=function(i){return r.create(i).parseComponentValue()},r.parseValues=function(i){return r.create(i).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var i=this.consumeToken();i.type===31;)i=this.consumeToken();if(i.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(i);var a=this.consumeComponentValue();do i=this.consumeToken();while(i.type===31);if(i.type===32)return a;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var i=[];;){var a=this.consumeComponentValue();if(a.type===32)return i;i.push(a),i.push()}},r.prototype.consumeComponentValue=function(){var i=this.consumeToken();switch(i.type){case 11:case 28:case 2:return this.consumeSimpleBlock(i.type);case 19:return this.consumeFunction(i)}return i},r.prototype.consumeSimpleBlock=function(i){for(var a={type:i,values:[]},n=this.consumeToken();;){if(n.type===32||ic(n,i))return a;this.reconsumeToken(n),a.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(i){for(var a={name:i.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return a;this.reconsumeToken(n),a.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var i=this._tokens.shift();return typeof i=="undefined"?Br:i},r.prototype.reconsumeToken=function(i){this._tokens.unshift(i)},r}(),Jt=function(r){return r.type===15},ft=function(r){return r.type===17},uA=function(r){return r.type===20},tc=function(r){return r.type===0},wr=function(r,i){return uA(r)&&r.value===i},Gn=function(r){return r.type!==31},mt=function(r){return r.type!==31&&r.type!==4},ye=function(r){var i=[],a=[];return r.forEach(function(n){if(n.type===4){if(a.length===0)throw new Error("Error parsing function args, zero tokens for arg");i.push(a),a=[];return}n.type!==31&&a.push(n)}),a.length&&i.push(a),i},ic=function(r,i){return i===11&&r.type===12||i===28&&r.type===29?!0:i===2&&r.type===3},Ge=function(r){return r.type===17||r.type===15},EA=function(r){return r.type===16||Ge(r)},Nn=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},kA={type:17,number:0,flags:Nt},Cr={type:16,number:50,flags:Nt},Ne={type:16,number:100,flags:Nt},Yt=function(r,i,a){var n=r[0],h=r[1];return[mA(n,i),mA(typeof h!="undefined"?h:n,a)]},mA=function(r,i){if(r.type===16)return r.number/100*i;if(Jt(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},Vn="deg",_n="grad",Xn="rad",Wn="turn",Ti={name:"angle",parse:function(r,i){if(i.type===15)switch(i.unit){case Vn:return Math.PI*i.number/180;case _n:return Math.PI/200*i.number;case Xn:return i.number;case Wn:return Math.PI*2*i.number}throw new Error("Unsupported angle type")}},Jn=function(r){return r.type===15&&(r.unit===Vn||r.unit===_n||r.unit===Xn||r.unit===Wn)},Yn=function(r){var i=r.filter(uA).map(function(a){return a.value}).join(" ");switch(i){case"to bottom right":case"to right bottom":case"left top":case"top left":return[kA,kA];case"to top":case"bottom":return ce(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[kA,Ne];case"to right":case"left":return ce(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Ne,Ne];case"to bottom":case"top":return ce(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Ne,kA];case"to left":case"right":return ce(270)}return 0},ce=function(r){return Math.PI*r/180},Ve={name:"color",parse:function(r,i){if(i.type===18){var a=sc[i.name];if(typeof a=="undefined")throw new Error('Attempting to parse an unsupported color function "'+i.name+'"');return a(r,i.values)}if(i.type===5){if(i.value.length===3){var n=i.value.substring(0,1),h=i.value.substring(1,2),p=i.value.substring(2,3);return Xe(parseInt(n+n,16),parseInt(h+h,16),parseInt(p+p,16),1)}if(i.value.length===4){var n=i.value.substring(0,1),h=i.value.substring(1,2),p=i.value.substring(2,3),B=i.value.substring(3,4);return Xe(parseInt(n+n,16),parseInt(h+h,16),parseInt(p+p,16),parseInt(B+B,16)/255)}if(i.value.length===6){var n=i.value.substring(0,2),h=i.value.substring(2,4),p=i.value.substring(4,6);return Xe(parseInt(n,16),parseInt(h,16),parseInt(p,16),1)}if(i.value.length===8){var n=i.value.substring(0,2),h=i.value.substring(2,4),p=i.value.substring(4,6),B=i.value.substring(6,8);return Xe(parseInt(n,16),parseInt(h,16),parseInt(p,16),parseInt(B,16)/255)}}if(i.type===20){var v=xe[i.value.toUpperCase()];if(typeof v!="undefined")return v}return xe.TRANSPARENT}},_e=function(r){return(255&r)===0},PA=function(r){var i=255&r,a=255&r>>8,n=255&r>>16,h=255&r>>24;return i<255?"rgba("+h+","+n+","+a+","+i/255+")":"rgb("+h+","+n+","+a+")"},Xe=function(r,i,a,n){return(r<<24|i<<16|a<<8|Math.round(n*255)<<0)>>>0},$n=function(r,i){if(r.type===17)return r.number;if(r.type===16){var a=i===3?1:255;return i===3?r.number/100*a:Math.round(r.number/100*a)}return 0},qn=function(r,i){var a=i.filter(mt);if(a.length===3){var n=a.map($n),h=n[0],p=n[1],B=n[2];return Xe(h,p,B,1)}if(a.length===4){var v=a.map($n),h=v[0],p=v[1],B=v[2],C=v[3];return Xe(h,p,B,C)}return 0};function vr(r,i,a){return a<0&&(a+=1),a>=1&&(a-=1),a<1/6?(i-r)*a*6+r:a<1/2?i:a<2/3?(i-r)*6*(2/3-a)+r:r}var Zn=function(r,i){var a=i.filter(mt),n=a[0],h=a[1],p=a[2],B=a[3],v=(n.type===17?ce(n.number):Ti.parse(r,n))/(Math.PI*2),C=EA(h)?h.number/100:0,U=EA(p)?p.number/100:0,S=typeof B!="undefined"&&EA(B)?mA(B,1):1;if(C===0)return Xe(U*255,U*255,U*255,1);var I=U<=.5?U*(C+1):U+C-U*C,x=U*2-I,O=vr(x,I,v+1/3),L=vr(x,I,v),P=vr(x,I,v-1/3);return Xe(O*255,L*255,P*255,S)},sc={hsl:Zn,hsla:Zn,rgb:qn,rgba:qn},$t=function(r,i){return Ve.parse(r,On.create(i).parseComponentValue())},xe={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},rc={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,i){return i.map(function(a){if(uA(a))switch(a.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},nc={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Di=function(r,i){var a=Ve.parse(r,i[0]),n=i[1];return n&&EA(n)?{color:a,stop:n}:{color:a,stop:null}},zn=function(r,i){var a=r[0],n=r[r.length-1];a.stop===null&&(a.stop=kA),n.stop===null&&(n.stop=Ne);for(var h=[],p=0,B=0;B<r.length;B++){var v=r[B].stop;if(v!==null){var C=mA(v,i);C>p?h.push(C):h.push(p),p=C}else h.push(null)}for(var U=null,B=0;B<h.length;B++){var S=h[B];if(S===null)U===null&&(U=B);else if(U!==null){for(var I=B-U,x=h[U-1],O=(S-x)/(I+1),L=1;L<=I;L++)h[U+L-1]=O*L;U=null}}return r.map(function(P,z){var _=P.color;return{color:_,stop:Math.max(Math.min(1,h[z]/i),0)}})},ac=function(r,i,a){var n=i/2,h=a/2,p=mA(r[0],i)-n,B=h-mA(r[1],a);return(Math.atan2(B,p)+Math.PI*2)%(Math.PI*2)},oc=function(r,i,a){var n=typeof r=="number"?r:ac(r,i,a),h=Math.abs(i*Math.sin(n))+Math.abs(a*Math.cos(n)),p=i/2,B=a/2,v=h/2,C=Math.sin(n-Math.PI/2)*v,U=Math.cos(n-Math.PI/2)*v;return[h,p-U,p+U,B-C,B+C]},Be=function(r,i){return Math.sqrt(r*r+i*i)},jn=function(r,i,a,n,h){var p=[[0,0],[0,i],[r,0],[r,i]];return p.reduce(function(B,v){var C=v[0],U=v[1],S=Be(a-C,n-U);return(h?S<B.optimumDistance:S>B.optimumDistance)?{optimumCorner:v,optimumDistance:S}:B},{optimumDistance:h?1/0:-1/0,optimumCorner:null}).optimumCorner},lc=function(r,i,a,n,h){var p=0,B=0;switch(r.size){case 0:r.shape===0?p=B=Math.min(Math.abs(i),Math.abs(i-n),Math.abs(a),Math.abs(a-h)):r.shape===1&&(p=Math.min(Math.abs(i),Math.abs(i-n)),B=Math.min(Math.abs(a),Math.abs(a-h)));break;case 2:if(r.shape===0)p=B=Math.min(Be(i,a),Be(i,a-h),Be(i-n,a),Be(i-n,a-h));else if(r.shape===1){var v=Math.min(Math.abs(a),Math.abs(a-h))/Math.min(Math.abs(i),Math.abs(i-n)),C=jn(n,h,i,a,!0),U=C[0],S=C[1];p=Be(U-i,(S-a)/v),B=v*p}break;case 1:r.shape===0?p=B=Math.max(Math.abs(i),Math.abs(i-n),Math.abs(a),Math.abs(a-h)):r.shape===1&&(p=Math.max(Math.abs(i),Math.abs(i-n)),B=Math.max(Math.abs(a),Math.abs(a-h)));break;case 3:if(r.shape===0)p=B=Math.max(Be(i,a),Be(i,a-h),Be(i-n,a),Be(i-n,a-h));else if(r.shape===1){var v=Math.max(Math.abs(a),Math.abs(a-h))/Math.max(Math.abs(i),Math.abs(i-n)),I=jn(n,h,i,a,!1),U=I[0],S=I[1];p=Be(U-i,(S-a)/v),B=v*p}break}return Array.isArray(r.size)&&(p=mA(r.size[0],n),B=r.size.length===2?mA(r.size[1],h):p),[p,B]},cc=function(r,i){var a=ce(180),n=[];return ye(i).forEach(function(h,p){if(p===0){var B=h[0];if(B.type===20&&B.value==="to"){a=Yn(h);return}else if(Jn(B)){a=Ti.parse(r,B);return}}var v=Di(r,h);n.push(v)}),{angle:a,stops:n,type:1}},Pi=function(r,i){var a=ce(180),n=[];return ye(i).forEach(function(h,p){if(p===0){var B=h[0];if(B.type===20&&["top","left","right","bottom"].indexOf(B.value)!==-1){a=Yn(h);return}else if(Jn(B)){a=(Ti.parse(r,B)+ce(270))%ce(360);return}}var v=Di(r,h);n.push(v)}),{angle:a,stops:n,type:1}},hc=function(r,i){var a=ce(180),n=[],h=1,p=0,B=3,v=[];return ye(i).forEach(function(C,U){var S=C[0];if(U===0){if(uA(S)&&S.value==="linear"){h=1;return}else if(uA(S)&&S.value==="radial"){h=2;return}}if(S.type===18){if(S.name==="from"){var I=Ve.parse(r,S.values[0]);n.push({stop:kA,color:I})}else if(S.name==="to"){var I=Ve.parse(r,S.values[0]);n.push({stop:Ne,color:I})}else if(S.name==="color-stop"){var x=S.values.filter(mt);if(x.length===2){var I=Ve.parse(r,x[1]),O=x[0];ft(O)&&n.push({stop:{type:16,number:O.number*100,flags:O.flags},color:I})}}}}),h===1?{angle:(a+ce(180))%ce(360),stops:n,type:h}:{size:B,shape:p,stops:n,position:v,type:h}},Aa="closest-side",ea="farthest-side",ta="closest-corner",ia="farthest-corner",sa="circle",ra="ellipse",na="cover",aa="contain",dc=function(r,i){var a=0,n=3,h=[],p=[];return ye(i).forEach(function(B,v){var C=!0;if(v===0){var U=!1;C=B.reduce(function(I,x){if(U)if(uA(x))switch(x.value){case"center":return p.push(Cr),I;case"top":case"left":return p.push(kA),I;case"right":case"bottom":return p.push(Ne),I}else(EA(x)||Ge(x))&&p.push(x);else if(uA(x))switch(x.value){case sa:return a=0,!1;case ra:return a=1,!1;case"at":return U=!0,!1;case Aa:return n=0,!1;case na:case ea:return n=1,!1;case aa:case ta:return n=2,!1;case ia:return n=3,!1}else if(Ge(x)||EA(x))return Array.isArray(n)||(n=[]),n.push(x),!1;return I},C)}if(C){var S=Di(r,B);h.push(S)}}),{size:n,shape:a,stops:h,position:p,type:2}},Ki=function(r,i){var a=0,n=3,h=[],p=[];return ye(i).forEach(function(B,v){var C=!0;if(v===0?C=B.reduce(function(S,I){if(uA(I))switch(I.value){case"center":return p.push(Cr),!1;case"top":case"left":return p.push(kA),!1;case"right":case"bottom":return p.push(Ne),!1}else if(EA(I)||Ge(I))return p.push(I),!1;return S},C):v===1&&(C=B.reduce(function(S,I){if(uA(I))switch(I.value){case sa:return a=0,!1;case ra:return a=1,!1;case aa:case Aa:return n=0,!1;case ea:return n=1,!1;case ta:return n=2,!1;case na:case ia:return n=3,!1}else if(Ge(I)||EA(I))return Array.isArray(n)||(n=[]),n.push(I),!1;return S},C)),C){var U=Di(r,B);h.push(U)}}),{size:n,shape:a,stops:h,position:p,type:2}},gc=function(r){return r.type===1},uc=function(r){return r.type===2},Fr={name:"image",parse:function(r,i){if(i.type===22){var a={url:i.value,type:0};return r.cache.addImage(i.value),a}if(i.type===18){var n=oa[i.name];if(typeof n=="undefined")throw new Error('Attempting to parse an unsupported image function "'+i.name+'"');return n(r,i.values)}throw new Error("Unsupported image type "+i.type)}};function pc(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!oa[r.name])}var oa={"linear-gradient":cc,"-moz-linear-gradient":Pi,"-ms-linear-gradient":Pi,"-o-linear-gradient":Pi,"-webkit-linear-gradient":Pi,"radial-gradient":dc,"-moz-radial-gradient":Ki,"-ms-radial-gradient":Ki,"-o-radial-gradient":Ki,"-webkit-radial-gradient":Ki,"-webkit-gradient":hc},fc={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,i){if(i.length===0)return[];var a=i[0];return a.type===20&&a.value==="none"?[]:i.filter(function(n){return mt(n)&&pc(n)}).map(function(n){return Fr.parse(r,n)})}},mc={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,i){return i.map(function(a){if(uA(a))switch(a.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Bc={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,i){return ye(i).map(function(a){return a.filter(EA)}).map(Nn)}},wc={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,i){return ye(i).map(function(a){return a.filter(uA).map(function(n){return n.value}).join(" ")}).map(Cc)}},Cc=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Bt;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Bt||(Bt={}));var vc={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,i){return ye(i).map(function(a){return a.filter(Fc)})}},Fc=function(r){return uA(r)||EA(r)},Ri=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},yc=Ri("top"),Qc=Ri("right"),Ec=Ri("bottom"),Uc=Ri("left"),ki=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(i,a){return Nn(a.filter(EA))}}},Sc=ki("top-left"),Ic=ki("top-right"),Hc=ki("bottom-right"),xc=ki("bottom-left"),Oi=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(i,a){switch(a){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},bc=Oi("top"),Mc=Oi("right"),Lc=Oi("bottom"),Tc=Oi("left"),Gi=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(i,a){return Jt(a)?a.number:0}}},Dc=Gi("top"),Pc=Gi("right"),Kc=Gi("bottom"),Rc=Gi("left"),kc={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Oc={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,i){switch(i){case"rtl":return 1;case"ltr":default:return 0}}},Gc={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,i){return i.filter(uA).reduce(function(a,n){return a|Nc(n.value)},0)}},Nc=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Vc={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,i){switch(i){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},_c={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,i){return i.type===20&&i.value==="normal"?0:i.type===17||i.type===15?i.number:0}},Ni;(function(r){r.NORMAL="normal",r.STRICT="strict"})(Ni||(Ni={}));var Xc={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,i){switch(i){case"strict":return Ni.STRICT;case"normal":default:return Ni.NORMAL}}},Wc={name:"line-height",initialValue:"normal",prefix:!1,type:4},la=function(r,i){return uA(r)&&r.value==="normal"?1.2*i:r.type===17?i*r.number:EA(r)?mA(r,i):i},Jc={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,i){return i.type===20&&i.value==="none"?null:Fr.parse(r,i)}},Yc={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,i){switch(i){case"inside":return 0;case"outside":default:return 1}}},yr={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,i){switch(i){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Vi=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},$c=Vi("top"),qc=Vi("right"),Zc=Vi("bottom"),zc=Vi("left"),jc={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,i){return i.filter(uA).map(function(a){switch(a.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Ah={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,i){switch(i){case"break-word":return"break-word";case"normal":default:return"normal"}}},_i=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},eh=_i("top"),th=_i("right"),ih=_i("bottom"),sh=_i("left"),rh={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,i){switch(i){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},nh={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,i){switch(i){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},ah={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,i){return i.length===1&&wr(i[0],"none")?[]:ye(i).map(function(a){for(var n={color:xe.TRANSPARENT,offsetX:kA,offsetY:kA,blur:kA},h=0,p=0;p<a.length;p++){var B=a[p];Ge(B)?(h===0?n.offsetX=B:h===1?n.offsetY=B:n.blur=B,h++):n.color=Ve.parse(r,B)}return n})}},oh={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,i){switch(i){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},lh={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,i){if(i.type===20&&i.value==="none")return null;if(i.type===18){var a=dh[i.name];if(typeof a=="undefined")throw new Error('Attempting to parse an unsupported transform function "'+i.name+'"');return a(i.values)}return null}},ch=function(r){var i=r.filter(function(a){return a.type===17}).map(function(a){return a.number});return i.length===6?i:null},hh=function(r){var i=r.filter(function(C){return C.type===17}).map(function(C){return C.number}),a=i[0],n=i[1];i[2],i[3];var h=i[4],p=i[5];i[6],i[7],i[8],i[9],i[10],i[11];var B=i[12],v=i[13];return i[14],i[15],i.length===16?[a,n,h,p,B,v]:null},dh={matrix:ch,matrix3d:hh},ca={type:16,number:50,flags:Nt},gh=[ca,ca],uh={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,i){var a=i.filter(EA);return a.length!==2?gh:[a[0],a[1]]}},ph={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,i){switch(i){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},qt;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(qt||(qt={}));for(var fh={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,i){switch(i){case"break-all":return qt.BREAK_ALL;case"keep-all":return qt.KEEP_ALL;case"normal":default:return qt.NORMAL}}},mh={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,i){if(i.type===20)return{auto:!0,order:0};if(ft(i))return{auto:!1,order:i.number};throw new Error("Invalid z-index number parsed")}},ha={name:"time",parse:function(r,i){if(i.type===15)switch(i.unit.toLowerCase()){case"s":return 1e3*i.number;case"ms":return i.number}throw new Error("Unsupported time type")}},Bh={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,i){return ft(i)?i.number:1}},wh={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ch={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,i){return i.filter(uA).map(function(a){switch(a.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(a){return a!==0})}},vh={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,i){var a=[],n=[];return i.forEach(function(h){switch(h.type){case 20:case 0:a.push(h.value);break;case 17:a.push(h.number.toString());break;case 4:n.push(a.join(" ")),a.length=0;break}}),a.length&&n.push(a.join(" ")),n.map(function(h){return h.indexOf(" ")===-1?h:"'"+h+"'"})}},Fh={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},yh={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,i){if(ft(i))return i.number;if(uA(i))switch(i.value){case"bold":return 700;case"normal":default:return 400}return 400}},Qh={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,i){return i.filter(uA).map(function(a){return a.value})}},Eh={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,i){switch(i){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},MA=function(r,i){return(r&i)!==0},Uh={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,i){if(i.length===0)return[];var a=i[0];return a.type===20&&a.value==="none"?[]:i}},Sh={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,i){if(i.length===0)return null;var a=i[0];if(a.type===20&&a.value==="none")return null;for(var n=[],h=i.filter(Gn),p=0;p<h.length;p++){var B=h[p],v=h[p+1];if(B.type===20){var C=v&&ft(v)?v.number:1;n.push({counter:B.value,increment:C})}}return n}},Ih={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,i){if(i.length===0)return[];for(var a=[],n=i.filter(Gn),h=0;h<n.length;h++){var p=n[h],B=n[h+1];if(uA(p)&&p.value!=="none"){var v=B&&ft(B)?B.number:0;a.push({counter:p.value,reset:v})}}return a}},Hh={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,i){return i.filter(Jt).map(function(a){return ha.parse(r,a)})}},xh={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,i){if(i.length===0)return null;var a=i[0];if(a.type===20&&a.value==="none")return null;var n=[],h=i.filter(tc);if(h.length%2!==0)return null;for(var p=0;p<h.length;p+=2){var B=h[p].value,v=h[p+1].value;n.push({open:B,close:v})}return n}},da=function(r,i,a){if(!r)return"";var n=r[Math.min(i,r.length-1)];return n?a?n.open:n.close:""},bh={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,i){return i.length===1&&wr(i[0],"none")?[]:ye(i).map(function(a){for(var n={color:255,offsetX:kA,offsetY:kA,blur:kA,spread:kA,inset:!1},h=0,p=0;p<a.length;p++){var B=a[p];wr(B,"inset")?n.inset=!0:Ge(B)?(h===0?n.offsetX=B:h===1?n.offsetY=B:h===2?n.blur=B:n.spread=B,h++):n.color=Ve.parse(r,B)}return n})}},Mh={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,i){var a=[0,1,2],n=[];return i.filter(uA).forEach(function(h){switch(h.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),a.forEach(function(h){n.indexOf(h)===-1&&n.push(h)}),n}},Lh={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Th={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,i){return Jt(i)?i.number:0}},Dh=function(){function r(i,a){var n,h;this.animationDuration=G(i,Hh,a.animationDuration),this.backgroundClip=G(i,rc,a.backgroundClip),this.backgroundColor=G(i,nc,a.backgroundColor),this.backgroundImage=G(i,fc,a.backgroundImage),this.backgroundOrigin=G(i,mc,a.backgroundOrigin),this.backgroundPosition=G(i,Bc,a.backgroundPosition),this.backgroundRepeat=G(i,wc,a.backgroundRepeat),this.backgroundSize=G(i,vc,a.backgroundSize),this.borderTopColor=G(i,yc,a.borderTopColor),this.borderRightColor=G(i,Qc,a.borderRightColor),this.borderBottomColor=G(i,Ec,a.borderBottomColor),this.borderLeftColor=G(i,Uc,a.borderLeftColor),this.borderTopLeftRadius=G(i,Sc,a.borderTopLeftRadius),this.borderTopRightRadius=G(i,Ic,a.borderTopRightRadius),this.borderBottomRightRadius=G(i,Hc,a.borderBottomRightRadius),this.borderBottomLeftRadius=G(i,xc,a.borderBottomLeftRadius),this.borderTopStyle=G(i,bc,a.borderTopStyle),this.borderRightStyle=G(i,Mc,a.borderRightStyle),this.borderBottomStyle=G(i,Lc,a.borderBottomStyle),this.borderLeftStyle=G(i,Tc,a.borderLeftStyle),this.borderTopWidth=G(i,Dc,a.borderTopWidth),this.borderRightWidth=G(i,Pc,a.borderRightWidth),this.borderBottomWidth=G(i,Kc,a.borderBottomWidth),this.borderLeftWidth=G(i,Rc,a.borderLeftWidth),this.boxShadow=G(i,bh,a.boxShadow),this.color=G(i,kc,a.color),this.direction=G(i,Oc,a.direction),this.display=G(i,Gc,a.display),this.float=G(i,Vc,a.cssFloat),this.fontFamily=G(i,vh,a.fontFamily),this.fontSize=G(i,Fh,a.fontSize),this.fontStyle=G(i,Eh,a.fontStyle),this.fontVariant=G(i,Qh,a.fontVariant),this.fontWeight=G(i,yh,a.fontWeight),this.letterSpacing=G(i,_c,a.letterSpacing),this.lineBreak=G(i,Xc,a.lineBreak),this.lineHeight=G(i,Wc,a.lineHeight),this.listStyleImage=G(i,Jc,a.listStyleImage),this.listStylePosition=G(i,Yc,a.listStylePosition),this.listStyleType=G(i,yr,a.listStyleType),this.marginTop=G(i,$c,a.marginTop),this.marginRight=G(i,qc,a.marginRight),this.marginBottom=G(i,Zc,a.marginBottom),this.marginLeft=G(i,zc,a.marginLeft),this.opacity=G(i,Bh,a.opacity);var p=G(i,jc,a.overflow);this.overflowX=p[0],this.overflowY=p[p.length>1?1:0],this.overflowWrap=G(i,Ah,a.overflowWrap),this.paddingTop=G(i,eh,a.paddingTop),this.paddingRight=G(i,th,a.paddingRight),this.paddingBottom=G(i,ih,a.paddingBottom),this.paddingLeft=G(i,sh,a.paddingLeft),this.paintOrder=G(i,Mh,a.paintOrder),this.position=G(i,nh,a.position),this.textAlign=G(i,rh,a.textAlign),this.textDecorationColor=G(i,wh,(n=a.textDecorationColor)!==null&&n!==void 0?n:a.color),this.textDecorationLine=G(i,Ch,(h=a.textDecorationLine)!==null&&h!==void 0?h:a.textDecoration),this.textShadow=G(i,ah,a.textShadow),this.textTransform=G(i,oh,a.textTransform),this.transform=G(i,lh,a.transform),this.transformOrigin=G(i,uh,a.transformOrigin),this.visibility=G(i,ph,a.visibility),this.webkitTextStrokeColor=G(i,Lh,a.webkitTextStrokeColor),this.webkitTextStrokeWidth=G(i,Th,a.webkitTextStrokeWidth),this.wordBreak=G(i,fh,a.wordBreak),this.zIndex=G(i,mh,a.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return _e(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return MA(this.display,4)||MA(this.display,33554432)||MA(this.display,268435456)||MA(this.display,536870912)||MA(this.display,67108864)||MA(this.display,134217728)},r}(),Ph=function(){function r(i,a){this.content=G(i,Uh,a.content),this.quotes=G(i,xh,a.quotes)}return r}(),ga=function(){function r(i,a){this.counterIncrement=G(i,Sh,a.counterIncrement),this.counterReset=G(i,Ih,a.counterReset)}return r}(),G=function(r,i,a){var n=new kn,h=a!==null&&typeof a!="undefined"?a.toString():i.initialValue;n.write(h);var p=new On(n.read());switch(i.type){case 2:var B=p.parseComponentValue();return i.parse(r,uA(B)?B.value:i.initialValue);case 0:return i.parse(r,p.parseComponentValue());case 1:return i.parse(r,p.parseComponentValues());case 4:return p.parseComponentValue();case 3:switch(i.format){case"angle":return Ti.parse(r,p.parseComponentValue());case"color":return Ve.parse(r,p.parseComponentValue());case"image":return Fr.parse(r,p.parseComponentValue());case"length":var v=p.parseComponentValue();return Ge(v)?v:kA;case"length-percentage":var C=p.parseComponentValue();return EA(C)?C:kA;case"time":return ha.parse(r,p.parseComponentValue())}break}},Kh="data-html2canvas-debug",Rh=function(r){var i=r.getAttribute(Kh);switch(i){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},Qr=function(r,i){var a=Rh(r);return a===1||i===a},Qe=function(){function r(i,a){if(this.context=i,this.textNodes=[],this.elements=[],this.flags=0,Qr(a,3))debugger;this.styles=new Dh(i,window.getComputedStyle(a,null)),Rr(a)&&(this.styles.animationDuration.some(function(n){return n>0})&&(a.style.animationDuration="0s"),this.styles.transform!==null&&(a.style.transform="none")),this.bounds=c(this.context,a),Qr(a,4)&&(this.flags|=16)}return r}(),kh="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",ua="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Zt=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),Xi=0;Xi<ua.length;Xi++)Zt[ua.charCodeAt(Xi)]=Xi;for(var Oh=function(r){var i=r.length*.75,a=r.length,n,h=0,p,B,v,C;r[r.length-1]==="="&&(i--,r[r.length-2]==="="&&i--);var U=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(i):new Array(i),S=Array.isArray(U)?U:new Uint8Array(U);for(n=0;n<a;n+=4)p=Zt[r.charCodeAt(n)],B=Zt[r.charCodeAt(n+1)],v=Zt[r.charCodeAt(n+2)],C=Zt[r.charCodeAt(n+3)],S[h++]=p<<2|B>>4,S[h++]=(B&15)<<4|v>>2,S[h++]=(v&3)<<6|C&63;return U},Gh=function(r){for(var i=r.length,a=[],n=0;n<i;n+=2)a.push(r[n+1]<<8|r[n]);return a},Nh=function(r){for(var i=r.length,a=[],n=0;n<i;n+=4)a.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return a},nt=5,Er=11,Ur=2,Vh=Er-nt,pa=65536>>nt,_h=1<<nt,Sr=_h-1,Xh=1024>>nt,Wh=pa+Xh,Jh=Wh,Yh=32,$h=Jh+Yh,qh=65536>>Er,Zh=1<<Vh,zh=Zh-1,fa=function(r,i,a){return r.slice?r.slice(i,a):new Uint16Array(Array.prototype.slice.call(r,i,a))},jh=function(r,i,a){return r.slice?r.slice(i,a):new Uint32Array(Array.prototype.slice.call(r,i,a))},Ad=function(r,i){var a=Oh(r),n=Array.isArray(a)?Nh(a):new Uint32Array(a),h=Array.isArray(a)?Gh(a):new Uint16Array(a),p=24,B=fa(h,p/2,n[4]/2),v=n[5]===2?fa(h,(p+n[4])/2):jh(n,Math.ceil((p+n[4])/4));return new ed(n[0],n[1],n[2],n[3],B,v)},ed=function(){function r(i,a,n,h,p,B){this.initialValue=i,this.errorValue=a,this.highStart=n,this.highValueIndex=h,this.index=p,this.data=B}return r.prototype.get=function(i){var a;if(i>=0){if(i<55296||i>56319&&i<=65535)return a=this.index[i>>nt],a=(a<<Ur)+(i&Sr),this.data[a];if(i<=65535)return a=this.index[pa+(i-55296>>nt)],a=(a<<Ur)+(i&Sr),this.data[a];if(i<this.highStart)return a=$h-qh+(i>>Er),a=this.index[a],a+=i>>nt&zh,a=this.index[a],a=(a<<Ur)+(i&Sr),this.data[a];if(i<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),ma="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",td=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),Wi=0;Wi<ma.length;Wi++)td[ma.charCodeAt(Wi)]=Wi;var id=1,Ir=2,Hr=3,Ba=4,wa=5,sd=7,Ca=8,xr=9,br=10,va=11,Fa=12,ya=13,Qa=14,Mr=15,rd=function(r){for(var i=[],a=0,n=r.length;a<n;){var h=r.charCodeAt(a++);if(h>=55296&&h<=56319&&a<n){var p=r.charCodeAt(a++);(p&64512)===56320?i.push(((h&1023)<<10)+(p&1023)+65536):(i.push(h),a--)}else i.push(h)}return i},nd=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var a=r.length;if(!a)return"";for(var n=[],h=-1,p="";++h<a;){var B=r[h];B<=65535?n.push(B):(B-=65536,n.push((B>>10)+55296,B%1024+56320)),(h+1===a||n.length>16384)&&(p+=String.fromCharCode.apply(String,n),n.length=0)}return p},ad=Ad(kh),he="\xD7",Lr="\xF7",od=function(r){return ad.get(r)},ld=function(r,i,a){var n=a-2,h=i[n],p=i[a-1],B=i[a];if(p===Ir&&B===Hr)return he;if(p===Ir||p===Hr||p===Ba||B===Ir||B===Hr||B===Ba)return Lr;if(p===Ca&&[Ca,xr,va,Fa].indexOf(B)!==-1||(p===va||p===xr)&&(B===xr||B===br)||(p===Fa||p===br)&&B===br||B===ya||B===wa||B===sd||p===id)return he;if(p===ya&&B===Qa){for(;h===wa;)h=i[--n];if(h===Qa)return he}if(p===Mr&&B===Mr){for(var v=0;h===Mr;)v++,h=i[--n];if(v%2===0)return he}return Lr},cd=function(r){var i=rd(r),a=i.length,n=0,h=0,p=i.map(od);return{next:function(){if(n>=a)return{done:!0,value:null};for(var B=he;n<a&&(B=ld(i,p,++n))===he;);if(B!==he||n===a){var v=nd.apply(null,i.slice(h,n));return h=n,{value:v,done:!1}}return{done:!0,value:null}}}},hd=function(r){for(var i=cd(r),a=[],n;!(n=i.next()).done;)n.value&&a.push(n.value.slice());return a},dd=function(r){var i=123;if(r.createRange){var a=r.createRange();if(a.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=i+"px",n.style.display="block",r.body.appendChild(n),a.selectNode(n);var h=a.getBoundingClientRect(),p=Math.round(h.height);if(r.body.removeChild(n),p===i)return!0}}return!1},gd=function(r){var i=r.createElement("boundtest");i.style.width="50px",i.style.display="block",i.style.fontSize="12px",i.style.letterSpacing="0px",i.style.wordSpacing="0px",r.body.appendChild(i);var a=r.createRange();i.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=i.firstChild,h=g(n.data).map(function(C){return u(C)}),p=0,B={},v=h.every(function(C,U){a.setStart(n,p),a.setEnd(n,p+C.length);var S=a.getBoundingClientRect();p+=C.length;var I=S.x>B.x||S.y>B.y;return B=S,U===0?!0:I});return r.body.removeChild(i),v},ud=function(){return typeof new Image().crossOrigin!="undefined"},pd=function(){return typeof new XMLHttpRequest().responseType=="string"},fd=function(r){var i=new Image,a=r.createElement("canvas"),n=a.getContext("2d");if(!n)return!1;i.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(i,0,0),a.toDataURL()}catch(h){return!1}return!0},Ea=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},md=function(r){var i=r.createElement("canvas"),a=100;i.width=a,i.height=a;var n=i.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,a,a);var h=new Image,p=i.toDataURL();h.src=p;var B=Tr(a,a,0,0,h);return n.fillStyle="red",n.fillRect(0,0,a,a),Ua(B).then(function(v){n.drawImage(v,0,0);var C=n.getImageData(0,0,a,a).data;n.fillStyle="red",n.fillRect(0,0,a,a);var U=r.createElement("div");return U.style.backgroundImage="url("+p+")",U.style.height=a+"px",Ea(C)?Ua(Tr(a,a,0,0,U)):Promise.reject(!1)}).then(function(v){return n.drawImage(v,0,0),Ea(n.getImageData(0,0,a,a).data)}).catch(function(){return!1})},Tr=function(r,i,a,n,h){var p="http://www.w3.org/2000/svg",B=document.createElementNS(p,"svg"),v=document.createElementNS(p,"foreignObject");return B.setAttributeNS(null,"width",r.toString()),B.setAttributeNS(null,"height",i.toString()),v.setAttributeNS(null,"width","100%"),v.setAttributeNS(null,"height","100%"),v.setAttributeNS(null,"x",a.toString()),v.setAttributeNS(null,"y",n.toString()),v.setAttributeNS(null,"externalResourcesRequired","true"),B.appendChild(v),v.appendChild(h),B},Ua=function(r){return new Promise(function(i,a){var n=new Image;n.onload=function(){return i(n)},n.onerror=a,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},OA={get SUPPORT_RANGE_BOUNDS(){var r=dd(document);return Object.defineProperty(OA,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=OA.SUPPORT_RANGE_BOUNDS&&gd(document);return Object.defineProperty(OA,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=fd(document);return Object.defineProperty(OA,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?md(document):Promise.resolve(!1);return Object.defineProperty(OA,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=ud();return Object.defineProperty(OA,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=pd();return Object.defineProperty(OA,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(OA,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl!="undefined"&&Intl.Segmenter);return Object.defineProperty(OA,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},zt=function(){function r(i,a){this.text=i,this.bounds=a}return r}(),Bd=function(r,i,a,n){var h=vd(i,a),p=[],B=0;return h.forEach(function(v){if(a.textDecorationLine.length||v.trim().length>0)if(OA.SUPPORT_RANGE_BOUNDS){var C=Sa(n,B,v.length).getClientRects();if(C.length>1){var U=Dr(v),S=0;U.forEach(function(x){p.push(new zt(x,l.fromDOMRectList(r,Sa(n,S+B,x.length).getClientRects()))),S+=x.length})}else p.push(new zt(v,l.fromDOMRectList(r,C)))}else{var I=n.splitText(v.length);p.push(new zt(v,wd(r,n))),n=I}else OA.SUPPORT_RANGE_BOUNDS||(n=n.splitText(v.length));B+=v.length}),p},wd=function(r,i){var a=i.ownerDocument;if(a){var n=a.createElement("html2canvaswrapper");n.appendChild(i.cloneNode(!0));var h=i.parentNode;if(h){h.replaceChild(n,i);var p=c(r,n);return n.firstChild&&h.replaceChild(n.firstChild,n),p}}return l.EMPTY},Sa=function(r,i,a){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var h=n.createRange();return h.setStart(r,i),h.setEnd(r,i+a),h},Dr=function(r){if(OA.SUPPORT_NATIVE_TEXT_SEGMENTATION){var i=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(i.segment(r)).map(function(a){return a.segment})}return hd(r)},Cd=function(r,i){if(OA.SUPPORT_NATIVE_TEXT_SEGMENTATION){var a=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(a.segment(r)).map(function(n){return n.segment})}return yd(r,i)},vd=function(r,i){return i.letterSpacing!==0?Dr(r):Cd(r,i)},Fd=[32,160,4961,65792,65793,4153,4241],yd=function(r,i){for(var a=qo(r,{lineBreak:i.lineBreak,wordBreak:i.overflowWrap==="break-word"?"break-word":i.wordBreak}),n=[],h,p=function(){if(h.value){var B=h.value.slice(),v=g(B),C="";v.forEach(function(U){Fd.indexOf(U)===-1?C+=u(U):(C.length&&n.push(C),n.push(u(U)),C="")}),C.length&&n.push(C)}};!(h=a.next()).done;)p();return n},Qd=function(){function r(i,a,n){this.text=Ed(a.data,n.textTransform),this.textBounds=Bd(i,this.text,n,a)}return r}(),Ed=function(r,i){switch(i){case 1:return r.toLowerCase();case 3:return r.replace(Ud,Sd);case 2:return r.toUpperCase();default:return r}},Ud=/(^|\s|:|-|\(|\))([a-z])/g,Sd=function(r,i,a){return r.length>0?i+a.toUpperCase():r},Ia=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h.src=n.currentSrc||n.src,h.intrinsicWidth=n.naturalWidth,h.intrinsicHeight=n.naturalHeight,h.context.cache.addImage(h.src),h}return i}(Qe),Ha=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h.canvas=n,h.intrinsicWidth=n.width,h.intrinsicHeight=n.height,h}return i}(Qe),xa=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this,p=new XMLSerializer,B=c(a,n);return n.setAttribute("width",B.width+"px"),n.setAttribute("height",B.height+"px"),h.svg="data:image/svg+xml,"+encodeURIComponent(p.serializeToString(n)),h.intrinsicWidth=n.width.baseVal.value,h.intrinsicHeight=n.height.baseVal.value,h.context.cache.addImage(h.svg),h}return i}(Qe),ba=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h.value=n.value,h}return i}(Qe),Pr=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h.start=n.start,h.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,h}return i}(Qe),Id=[{type:15,flags:0,unit:"px",number:3}],Hd=[{type:16,flags:0,number:50}],xd=function(r){return r.width>r.height?new l(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new l(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},bd=function(r){var i=r.type===Md?new Array(r.value.length+1).join("\u2022"):r.value;return i.length===0?r.placeholder||"":i},Ji="checkbox",Yi="radio",Md="password",Ma=707406591,Kr=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;switch(h.type=n.type.toLowerCase(),h.checked=n.checked,h.value=bd(n),(h.type===Ji||h.type===Yi)&&(h.styles.backgroundColor=3739148031,h.styles.borderTopColor=h.styles.borderRightColor=h.styles.borderBottomColor=h.styles.borderLeftColor=2779096575,h.styles.borderTopWidth=h.styles.borderRightWidth=h.styles.borderBottomWidth=h.styles.borderLeftWidth=1,h.styles.borderTopStyle=h.styles.borderRightStyle=h.styles.borderBottomStyle=h.styles.borderLeftStyle=1,h.styles.backgroundClip=[0],h.styles.backgroundOrigin=[0],h.bounds=xd(h.bounds)),h.type){case Ji:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=Id;break;case Yi:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=Hd;break}return h}return i}(Qe),La=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this,p=n.options[n.selectedIndex||0];return h.value=p&&p.text||"",h}return i}(Qe),Ta=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h.value=n.value,h}return i}(Qe),Da=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;h.src=n.src,h.width=parseInt(n.width,10)||0,h.height=parseInt(n.height,10)||0,h.backgroundColor=h.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){h.tree=Ka(a,n.contentWindow.document.documentElement);var p=n.contentWindow.document.documentElement?$t(a,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):xe.TRANSPARENT,B=n.contentWindow.document.body?$t(a,getComputedStyle(n.contentWindow.document.body).backgroundColor):xe.TRANSPARENT;h.backgroundColor=_e(p)?_e(B)?h.styles.backgroundColor:B:p}}catch(v){}return h}return i}(Qe),Ld=["OL","UL","MENU"],$i=function(r,i,a,n){for(var h=i.firstChild,p=void 0;h;h=p)if(p=h.nextSibling,Ra(h)&&h.data.trim().length>0)a.textNodes.push(new Qd(r,h,a.styles));else if(wt(h))if(_a(h)&&h.assignedNodes)h.assignedNodes().forEach(function(v){return $i(r,v,a,n)});else{var B=Pa(r,h);B.styles.isVisible()&&(Td(h,B,n)?B.flags|=4:Dd(B.styles)&&(B.flags|=2),Ld.indexOf(h.tagName)!==-1&&(B.flags|=8),a.elements.push(B),h.slot,h.shadowRoot?$i(r,h.shadowRoot,B,n):!Zi(h)&&!ka(h)&&!zi(h)&&$i(r,h,B,n))}},Pa=function(r,i){return Or(i)?new Ia(r,i):Oa(i)?new Ha(r,i):ka(i)?new xa(r,i):Pd(i)?new ba(r,i):Kd(i)?new Pr(r,i):Rd(i)?new Kr(r,i):zi(i)?new La(r,i):Zi(i)?new Ta(r,i):Na(i)?new Da(r,i):new Qe(r,i)},Ka=function(r,i){var a=Pa(r,i);return a.flags|=4,$i(r,i,a,a),a},Td=function(r,i,a){return i.styles.isPositionedWithZIndex()||i.styles.opacity<1||i.styles.isTransformed()||kr(r)&&a.styles.isTransparent()},Dd=function(r){return r.isPositioned()||r.isFloating()},Ra=function(r){return r.nodeType===Node.TEXT_NODE},wt=function(r){return r.nodeType===Node.ELEMENT_NODE},Rr=function(r){return wt(r)&&typeof r.style!="undefined"&&!qi(r)},qi=function(r){return typeof r.className=="object"},Pd=function(r){return r.tagName==="LI"},Kd=function(r){return r.tagName==="OL"},Rd=function(r){return r.tagName==="INPUT"},kd=function(r){return r.tagName==="HTML"},ka=function(r){return r.tagName==="svg"},kr=function(r){return r.tagName==="BODY"},Oa=function(r){return r.tagName==="CANVAS"},Ga=function(r){return r.tagName==="VIDEO"},Or=function(r){return r.tagName==="IMG"},Na=function(r){return r.tagName==="IFRAME"},Va=function(r){return r.tagName==="STYLE"},Od=function(r){return r.tagName==="SCRIPT"},Zi=function(r){return r.tagName==="TEXTAREA"},zi=function(r){return r.tagName==="SELECT"},_a=function(r){return r.tagName==="SLOT"},Xa=function(r){return r.tagName.indexOf("-")>0},Gd=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(i){var a=this.counters[i];return a&&a.length?a[a.length-1]:1},r.prototype.getCounterValues=function(i){var a=this.counters[i];return a||[]},r.prototype.pop=function(i){var a=this;i.forEach(function(n){return a.counters[n].pop()})},r.prototype.parse=function(i){var a=this,n=i.counterIncrement,h=i.counterReset,p=!0;n!==null&&n.forEach(function(v){var C=a.counters[v.counter];C&&v.increment!==0&&(p=!1,C.length||C.push(1),C[Math.max(0,C.length-1)]+=v.increment)});var B=[];return p&&h.forEach(function(v){var C=a.counters[v.counter];B.push(v.counter),C||(C=a.counters[v.counter]=[]),C.push(v.reset)}),B},r}(),Wa={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Ja={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054F","\u054E","\u054D","\u054C","\u054B","\u054A","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053F","\u053E","\u053D","\u053C","\u053B","\u053A","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},Nd={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05D9\u05F3","\u05D8\u05F3","\u05D7\u05F3","\u05D6\u05F3","\u05D5\u05F3","\u05D4\u05F3","\u05D3\u05F3","\u05D2\u05F3","\u05D1\u05F3","\u05D0\u05F3","\u05EA","\u05E9","\u05E8","\u05E7","\u05E6","\u05E4","\u05E2","\u05E1","\u05E0","\u05DE","\u05DC","\u05DB","\u05D9\u05D8","\u05D9\u05D7","\u05D9\u05D6","\u05D8\u05D6","\u05D8\u05D5","\u05D9","\u05D8","\u05D7","\u05D6","\u05D5","\u05D4","\u05D3","\u05D2","\u05D1","\u05D0"]},Vd={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10F5","\u10F0","\u10EF","\u10F4","\u10EE","\u10ED","\u10EC","\u10EB","\u10EA","\u10E9","\u10E8","\u10E7","\u10E6","\u10E5","\u10E4","\u10F3","\u10E2","\u10E1","\u10E0","\u10DF","\u10DE","\u10DD","\u10F2","\u10DC","\u10DB","\u10DA","\u10D9","\u10D8","\u10D7","\u10F1","\u10D6","\u10D5","\u10D4","\u10D3","\u10D2","\u10D1","\u10D0"]},Ct=function(r,i,a,n,h,p){return r<i||r>a?Ai(r,h,p.length>0):n.integers.reduce(function(B,v,C){for(;r>=v;)r-=v,B+=n.values[C];return B},"")+p},Ya=function(r,i,a,n){var h="";do a||r--,h=n(r)+h,r/=i;while(r*i>=i);return h},QA=function(r,i,a,n,h){var p=a-i+1;return(r<0?"-":"")+(Ya(Math.abs(r),p,n,function(B){return u(Math.floor(B%p)+i)})+h)},at=function(r,i,a){a===void 0&&(a=". ");var n=i.length;return Ya(Math.abs(r),n,!1,function(h){return i[Math.floor(h%n)]})+a},vt=1,We=2,Je=4,jt=8,be=function(r,i,a,n,h,p){if(r<-9999||r>9999)return Ai(r,4,h.length>0);var B=Math.abs(r),v=h;if(B===0)return i[0]+v;for(var C=0;B>0&&C<=4;C++){var U=B%10;U===0&&MA(p,vt)&&v!==""?v=i[U]+v:U>1||U===1&&C===0||U===1&&C===1&&MA(p,We)||U===1&&C===1&&MA(p,Je)&&r>100||U===1&&C>1&&MA(p,jt)?v=i[U]+(C>0?a[C-1]:"")+v:U===1&&C>0&&(v=a[C-1]+v),B=Math.floor(B/10)}return(r<0?n:"")+v},$a="\u5341\u767E\u5343\u842C",qa="\u62FE\u4F70\u4EDF\u842C",Za="\u30DE\u30A4\u30CA\u30B9",Gr="\uB9C8\uC774\uB108\uC2A4",Ai=function(r,i,a){var n=a?". ":"",h=a?"\u3001":"",p=a?", ":"",B=a?" ":"";switch(i){case 0:return"\u2022"+B;case 1:return"\u25E6"+B;case 2:return"\u25FE"+B;case 5:var v=QA(r,48,57,!0,n);return v.length<4?"0"+v:v;case 4:return at(r,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",h);case 6:return Ct(r,1,3999,Wa,3,n).toLowerCase();case 7:return Ct(r,1,3999,Wa,3,n);case 8:return QA(r,945,969,!1,n);case 9:return QA(r,97,122,!1,n);case 10:return QA(r,65,90,!1,n);case 11:return QA(r,1632,1641,!0,n);case 12:case 49:return Ct(r,1,9999,Ja,3,n);case 35:return Ct(r,1,9999,Ja,3,n).toLowerCase();case 13:return QA(r,2534,2543,!0,n);case 14:case 30:return QA(r,6112,6121,!0,n);case 15:return at(r,"\u5B50\u4E11\u5BC5\u536F\u8FB0\u5DF3\u5348\u672A\u7533\u9149\u620C\u4EA5",h);case 16:return at(r,"\u7532\u4E59\u4E19\u4E01\u620A\u5DF1\u5E9A\u8F9B\u58EC\u7678",h);case 17:case 48:return be(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",$a,"\u8CA0",h,We|Je|jt);case 47:return be(r,"\u96F6\u58F9\u8CB3\u53C3\u8086\u4F0D\u9678\u67D2\u634C\u7396",qa,"\u8CA0",h,vt|We|Je|jt);case 42:return be(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",$a,"\u8D1F",h,We|Je|jt);case 41:return be(r,"\u96F6\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396",qa,"\u8D1F",h,vt|We|Je|jt);case 26:return be(r,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u4E07",Za,h,0);case 25:return be(r,"\u96F6\u58F1\u5F10\u53C2\u56DB\u4F0D\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343\u4E07",Za,h,vt|We|Je);case 31:return be(r,"\uC601\uC77C\uC774\uC0BC\uC0AC\uC624\uC721\uCE60\uD314\uAD6C","\uC2ED\uBC31\uCC9C\uB9CC",Gr,p,vt|We|Je);case 33:return be(r,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u842C",Gr,p,0);case 32:return be(r,"\u96F6\u58F9\u8CB3\u53C3\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343",Gr,p,vt|We|Je);case 18:return QA(r,2406,2415,!0,n);case 20:return Ct(r,1,19999,Vd,3,n);case 21:return QA(r,2790,2799,!0,n);case 22:return QA(r,2662,2671,!0,n);case 22:return Ct(r,1,10999,Nd,3,n);case 23:return at(r,"\u3042\u3044\u3046\u3048\u304A\u304B\u304D\u304F\u3051\u3053\u3055\u3057\u3059\u305B\u305D\u305F\u3061\u3064\u3066\u3068\u306A\u306B\u306C\u306D\u306E\u306F\u3072\u3075\u3078\u307B\u307E\u307F\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308A\u308B\u308C\u308D\u308F\u3090\u3091\u3092\u3093");case 24:return at(r,"\u3044\u308D\u306F\u306B\u307B\u3078\u3068\u3061\u308A\u306C\u308B\u3092\u308F\u304B\u3088\u305F\u308C\u305D\u3064\u306D\u306A\u3089\u3080\u3046\u3090\u306E\u304A\u304F\u3084\u307E\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304D\u3086\u3081\u307F\u3057\u3091\u3072\u3082\u305B\u3059");case 27:return QA(r,3302,3311,!0,n);case 28:return at(r,"\u30A2\u30A4\u30A6\u30A8\u30AA\u30AB\u30AD\u30AF\u30B1\u30B3\u30B5\u30B7\u30B9\u30BB\u30BD\u30BF\u30C1\u30C4\u30C6\u30C8\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D2\u30D5\u30D8\u30DB\u30DE\u30DF\u30E0\u30E1\u30E2\u30E4\u30E6\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EF\u30F0\u30F1\u30F2\u30F3",h);case 29:return at(r,"\u30A4\u30ED\u30CF\u30CB\u30DB\u30D8\u30C8\u30C1\u30EA\u30CC\u30EB\u30F2\u30EF\u30AB\u30E8\u30BF\u30EC\u30BD\u30C4\u30CD\u30CA\u30E9\u30E0\u30A6\u30F0\u30CE\u30AA\u30AF\u30E4\u30DE\u30B1\u30D5\u30B3\u30A8\u30C6\u30A2\u30B5\u30AD\u30E6\u30E1\u30DF\u30B7\u30F1\u30D2\u30E2\u30BB\u30B9",h);case 34:return QA(r,3792,3801,!0,n);case 37:return QA(r,6160,6169,!0,n);case 38:return QA(r,4160,4169,!0,n);case 39:return QA(r,2918,2927,!0,n);case 40:return QA(r,1776,1785,!0,n);case 43:return QA(r,3046,3055,!0,n);case 44:return QA(r,3174,3183,!0,n);case 45:return QA(r,3664,3673,!0,n);case 46:return QA(r,3872,3881,!0,n);case 3:default:return QA(r,48,57,!0,n)}},za="data-html2canvas-ignore",ja=function(){function r(i,a,n){if(this.context=i,this.options=n,this.scrolledElements=[],this.referenceElement=a,this.counters=new Gd,this.quoteDepth=0,!a.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(a.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(i,a){var n=this,h=_d(i,a);if(!h.contentWindow)return Promise.reject("Unable to find iframe window");var p=i.defaultView.pageXOffset,B=i.defaultView.pageYOffset,v=h.contentWindow,C=v.document,U=Jd(h).then(function(){return t(n,void 0,void 0,function(){var S,I;return s(this,function(x){switch(x.label){case 0:return this.scrolledElements.forEach(Zd),v&&(v.scrollTo(a.left,a.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(v.scrollY!==a.top||v.scrollX!==a.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(v.scrollX-a.left,v.scrollY-a.top,0,0))),S=this.options.onclone,I=this.clonedReferenceElement,typeof I=="undefined"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:C.fonts&&C.fonts.ready?[4,C.fonts.ready]:[3,2];case 1:x.sent(),x.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Wd(C)]:[3,4];case 3:x.sent(),x.label=4;case 4:return typeof S=="function"?[2,Promise.resolve().then(function(){return S(C,I)}).then(function(){return h})]:[2,h]}})})});return C.open(),C.write($d(document.doctype)+"<html></html>"),qd(this.referenceElement.ownerDocument,p,B),C.replaceChild(C.adoptNode(this.documentElement),C.documentElement),C.close(),U},r.prototype.createElementClone=function(i){if(Qr(i,2))debugger;if(Oa(i))return this.createCanvasClone(i);if(Ga(i))return this.createVideoClone(i);if(Va(i))return this.createStyleClone(i);var a=i.cloneNode(!1);return Or(a)&&(Or(i)&&i.currentSrc&&i.currentSrc!==i.src&&(a.src=i.currentSrc,a.srcset=""),a.loading==="lazy"&&(a.loading="eager")),Xa(a)?this.createCustomElementClone(a):a},r.prototype.createCustomElementClone=function(i){var a=document.createElement("html2canvascustomelement");return Nr(i.style,a),a},r.prototype.createStyleClone=function(i){try{var a=i.sheet;if(a&&a.cssRules){var n=[].slice.call(a.cssRules,0).reduce(function(p,B){return B&&typeof B.cssText=="string"?p+B.cssText:p},""),h=i.cloneNode(!1);return h.textContent=n,h}}catch(p){if(this.context.logger.error("Unable to access cssRules property",p),p.name!=="SecurityError")throw p}return i.cloneNode(!1)},r.prototype.createCanvasClone=function(i){var a;if(this.options.inlineImages&&i.ownerDocument){var n=i.ownerDocument.createElement("img");try{return n.src=i.toDataURL(),n}catch(U){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",i)}}var h=i.cloneNode(!1);try{h.width=i.width,h.height=i.height;var p=i.getContext("2d"),B=h.getContext("2d");if(B)if(!this.options.allowTaint&&p)B.putImageData(p.getImageData(0,0,i.width,i.height),0,0);else{var v=(a=i.getContext("webgl2"))!==null&&a!==void 0?a:i.getContext("webgl");if(v){var C=v.getContextAttributes();(C==null?void 0:C.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",i)}B.drawImage(i,0,0)}return h}catch(U){this.context.logger.info("Unable to clone canvas as it is tainted",i)}return h},r.prototype.createVideoClone=function(i){var a=i.ownerDocument.createElement("canvas");a.width=i.offsetWidth,a.height=i.offsetHeight;var n=a.getContext("2d");try{return n&&(n.drawImage(i,0,0,a.width,a.height),this.options.allowTaint||n.getImageData(0,0,a.width,a.height)),a}catch(p){this.context.logger.info("Unable to clone video as it is tainted",i)}var h=i.ownerDocument.createElement("canvas");return h.width=i.offsetWidth,h.height=i.offsetHeight,h},r.prototype.appendChildNode=function(i,a,n){(!wt(a)||!Od(a)&&!a.hasAttribute(za)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(a)))&&(!this.options.copyStyles||!wt(a)||!Va(a))&&i.appendChild(this.cloneNode(a,n))},r.prototype.cloneChildNodes=function(i,a,n){for(var h=this,p=i.shadowRoot?i.shadowRoot.firstChild:i.firstChild;p;p=p.nextSibling)if(wt(p)&&_a(p)&&typeof p.assignedNodes=="function"){var B=p.assignedNodes();B.length&&B.forEach(function(v){return h.appendChildNode(a,v,n)})}else this.appendChildNode(a,p,n)},r.prototype.cloneNode=function(i,a){if(Ra(i))return document.createTextNode(i.data);if(!i.ownerDocument)return i.cloneNode(!1);var n=i.ownerDocument.defaultView;if(n&&wt(i)&&(Rr(i)||qi(i))){var h=this.createElementClone(i);h.style.transitionProperty="none";var p=n.getComputedStyle(i),B=n.getComputedStyle(i,":before"),v=n.getComputedStyle(i,":after");this.referenceElement===i&&Rr(h)&&(this.clonedReferenceElement=h),kr(h)&&Ag(h);var C=this.counters.parse(new ga(this.context,p)),U=this.resolvePseudoContent(i,h,B,ei.BEFORE);Xa(i)&&(a=!0),Ga(i)||this.cloneChildNodes(i,h,a),U&&h.insertBefore(U,h.firstChild);var S=this.resolvePseudoContent(i,h,v,ei.AFTER);return S&&h.appendChild(S),this.counters.pop(C),(p&&(this.options.copyStyles||qi(i))&&!Na(i)||a)&&Nr(p,h),(i.scrollTop!==0||i.scrollLeft!==0)&&this.scrolledElements.push([h,i.scrollLeft,i.scrollTop]),(Zi(i)||zi(i))&&(Zi(h)||zi(h))&&(h.value=i.value),h}return i.cloneNode(!1)},r.prototype.resolvePseudoContent=function(i,a,n,h){var p=this;if(n){var B=n.content,v=a.ownerDocument;if(!(!v||!B||B==="none"||B==="-moz-alt-content"||n.display==="none")){this.counters.parse(new ga(this.context,n));var C=new Ph(this.context,n),U=v.createElement("html2canvaspseudoelement");Nr(n,U),C.content.forEach(function(I){if(I.type===0)U.appendChild(v.createTextNode(I.value));else if(I.type===22){var x=v.createElement("img");x.src=I.value,x.style.opacity="1",U.appendChild(x)}else if(I.type===18){if(I.name==="attr"){var O=I.values.filter(uA);O.length&&U.appendChild(v.createTextNode(i.getAttribute(O[0].value)||""))}else if(I.name==="counter"){var L=I.values.filter(mt),P=L[0],z=L[1];if(P&&uA(P)){var _=p.counters.getCounterValue(P.value),V=z&&uA(z)?yr.parse(p.context,z.value):3;U.appendChild(v.createTextNode(Ai(_,V,!1)))}}else if(I.name==="counters"){var lA=I.values.filter(mt),P=lA[0],j=lA[1],z=lA[2];if(P&&uA(P)){var Y=p.counters.getCounterValues(P.value),k=z&&uA(z)?yr.parse(p.context,z.value):3,nA=j&&j.type===0?j.value:"",aA=Y.map(function(Ae){return Ai(Ae,k,!1)}).join(nA);U.appendChild(v.createTextNode(aA))}}}else if(I.type===20)switch(I.value){case"open-quote":U.appendChild(v.createTextNode(da(C.quotes,p.quoteDepth++,!0)));break;case"close-quote":U.appendChild(v.createTextNode(da(C.quotes,--p.quoteDepth,!1)));break;default:U.appendChild(v.createTextNode(I.value))}}),U.className=Vr+" "+_r;var S=h===ei.BEFORE?" "+Vr:" "+_r;return qi(a)?a.className.baseValue+=S:a.className+=S,U}}},r.destroy=function(i){return i.parentNode?(i.parentNode.removeChild(i),!0):!1},r}(),ei;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(ei||(ei={}));var _d=function(r,i){var a=r.createElement("iframe");return a.className="html2canvas-container",a.style.visibility="hidden",a.style.position="fixed",a.style.left="-10000px",a.style.top="0px",a.style.border="0",a.width=i.width.toString(),a.height=i.height.toString(),a.scrolling="no",a.setAttribute(za,"true"),r.body.appendChild(a),a},Xd=function(r){return new Promise(function(i){if(r.complete){i();return}if(!r.src){i();return}r.onload=i,r.onerror=i})},Wd=function(r){return Promise.all([].slice.call(r.images,0).map(Xd))},Jd=function(r){return new Promise(function(i,a){var n=r.contentWindow;if(!n)return a("No window assigned for iframe");var h=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var p=setInterval(function(){h.body.childNodes.length>0&&h.readyState==="complete"&&(clearInterval(p),i(r))},50)}})},Yd=["all","d","content"],Nr=function(r,i){for(var a=r.length-1;a>=0;a--){var n=r.item(a);Yd.indexOf(n)===-1&&i.style.setProperty(n,r.getPropertyValue(n))}return i},$d=function(r){var i="";return r&&(i+="<!DOCTYPE ",r.name&&(i+=r.name),r.internalSubset&&(i+=r.internalSubset),r.publicId&&(i+='"'+r.publicId+'"'),r.systemId&&(i+='"'+r.systemId+'"'),i+=">"),i},qd=function(r,i,a){r&&r.defaultView&&(i!==r.defaultView.pageXOffset||a!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(i,a)},Zd=function(r){var i=r[0],a=r[1],n=r[2];i.scrollLeft=a,i.scrollTop=n},zd=":before",jd=":after",Vr="___html2canvas___pseudoelement_before",_r="___html2canvas___pseudoelement_after",Ao=`{
    content: "" !important;
    display: none !important;
}`,Ag=function(r){eg(r,"."+Vr+zd+Ao+`
         .`+_r+jd+Ao)},eg=function(r,i){var a=r.ownerDocument;if(a){var n=a.createElement("style");n.textContent=i,r.appendChild(n)}},eo=function(){function r(){}return r.getOrigin=function(i){var a=r._link;return a?(a.href=i,a.href=a.href,a.protocol+a.hostname+a.port):"about:blank"},r.isSameOrigin=function(i){return r.getOrigin(i)===r._origin},r.setContext=function(i){r._link=i.document.createElement("a"),r._origin=r.getOrigin(i.location.href)},r._origin="about:blank",r}(),tg=function(){function r(i,a){this.context=i,this._options=a,this._cache={}}return r.prototype.addImage=function(i){var a=Promise.resolve();return this.has(i)||(Wr(i)||ng(i))&&(this._cache[i]=this.loadImage(i)).catch(function(){}),a},r.prototype.match=function(i){return this._cache[i]},r.prototype.loadImage=function(i){return t(this,void 0,void 0,function(){var a,n,h,p,B=this;return s(this,function(v){switch(v.label){case 0:return a=eo.isSameOrigin(i),n=!Xr(i)&&this._options.useCORS===!0&&OA.SUPPORT_CORS_IMAGES&&!a,h=!Xr(i)&&!a&&!Wr(i)&&typeof this._options.proxy=="string"&&OA.SUPPORT_CORS_XHR&&!n,!a&&this._options.allowTaint===!1&&!Xr(i)&&!Wr(i)&&!h&&!n?[2]:(p=i,h?[4,this.proxy(p)]:[3,2]);case 1:p=v.sent(),v.label=2;case 2:return this.context.logger.debug("Added image "+i.substring(0,256)),[4,new Promise(function(C,U){var S=new Image;S.onload=function(){return C(S)},S.onerror=U,(ag(p)||n)&&(S.crossOrigin="anonymous"),S.src=p,S.complete===!0&&setTimeout(function(){return C(S)},500),B._options.imageTimeout>0&&setTimeout(function(){return U("Timed out ("+B._options.imageTimeout+"ms) loading image")},B._options.imageTimeout)})];case 3:return[2,v.sent()]}})})},r.prototype.has=function(i){return typeof this._cache[i]!="undefined"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(i){var a=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var h=i.substring(0,256);return new Promise(function(p,B){var v=OA.SUPPORT_RESPONSE_TYPE?"blob":"text",C=new XMLHttpRequest;C.onload=function(){if(C.status===200)if(v==="text")p(C.response);else{var I=new FileReader;I.addEventListener("load",function(){return p(I.result)},!1),I.addEventListener("error",function(x){return B(x)},!1),I.readAsDataURL(C.response)}else B("Failed to proxy resource "+h+" with status code "+C.status)},C.onerror=B;var U=n.indexOf("?")>-1?"&":"?";if(C.open("GET",""+n+U+"url="+encodeURIComponent(i)+"&responseType="+v),v!=="text"&&C instanceof XMLHttpRequest&&(C.responseType=v),a._options.imageTimeout){var S=a._options.imageTimeout;C.timeout=S,C.ontimeout=function(){return B("Timed out ("+S+"ms) proxying "+h)}}C.send()})},r}(),ig=/^data:image\/svg\+xml/i,sg=/^data:image\/.*;base64,/i,rg=/^data:image\/.*/i,ng=function(r){return OA.SUPPORT_SVG_DRAWING||!og(r)},Xr=function(r){return rg.test(r)},ag=function(r){return sg.test(r)},Wr=function(r){return r.substr(0,4)==="blob"},og=function(r){return r.substr(-3).toLowerCase()==="svg"||ig.test(r)},R=function(){function r(i,a){this.type=0,this.x=i,this.y=a}return r.prototype.add=function(i,a){return new r(this.x+i,this.y+a)},r}(),Ft=function(r,i,a){return new R(r.x+(i.x-r.x)*a,r.y+(i.y-r.y)*a)},ji=function(){function r(i,a,n,h){this.type=1,this.start=i,this.startControl=a,this.endControl=n,this.end=h}return r.prototype.subdivide=function(i,a){var n=Ft(this.start,this.startControl,i),h=Ft(this.startControl,this.endControl,i),p=Ft(this.endControl,this.end,i),B=Ft(n,h,i),v=Ft(h,p,i),C=Ft(B,v,i);return a?new r(this.start,n,B,C):new r(C,v,p,this.end)},r.prototype.add=function(i,a){return new r(this.start.add(i,a),this.startControl.add(i,a),this.endControl.add(i,a),this.end.add(i,a))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),de=function(r){return r.type===1},lg=function(){function r(i){var a=i.styles,n=i.bounds,h=Yt(a.borderTopLeftRadius,n.width,n.height),p=h[0],B=h[1],v=Yt(a.borderTopRightRadius,n.width,n.height),C=v[0],U=v[1],S=Yt(a.borderBottomRightRadius,n.width,n.height),I=S[0],x=S[1],O=Yt(a.borderBottomLeftRadius,n.width,n.height),L=O[0],P=O[1],z=[];z.push((p+C)/n.width),z.push((L+I)/n.width),z.push((B+P)/n.height),z.push((U+x)/n.height);var _=Math.max.apply(Math,z);_>1&&(p/=_,B/=_,C/=_,U/=_,I/=_,x/=_,L/=_,P/=_);var V=n.width-C,lA=n.height-x,j=n.width-I,Y=n.height-P,k=a.borderTopWidth,nA=a.borderRightWidth,aA=a.borderBottomWidth,$=a.borderLeftWidth,UA=mA(a.paddingTop,i.bounds.width),Ae=mA(a.paddingRight,i.bounds.width),oe=mA(a.paddingBottom,i.bounds.width),pA=mA(a.paddingLeft,i.bounds.width);this.topLeftBorderDoubleOuterBox=p>0||B>0?CA(n.left+$/3,n.top+k/3,p-$/3,B-k/3,hA.TOP_LEFT):new R(n.left+$/3,n.top+k/3),this.topRightBorderDoubleOuterBox=p>0||B>0?CA(n.left+V,n.top+k/3,C-nA/3,U-k/3,hA.TOP_RIGHT):new R(n.left+n.width-nA/3,n.top+k/3),this.bottomRightBorderDoubleOuterBox=I>0||x>0?CA(n.left+j,n.top+lA,I-nA/3,x-aA/3,hA.BOTTOM_RIGHT):new R(n.left+n.width-nA/3,n.top+n.height-aA/3),this.bottomLeftBorderDoubleOuterBox=L>0||P>0?CA(n.left+$/3,n.top+Y,L-$/3,P-aA/3,hA.BOTTOM_LEFT):new R(n.left+$/3,n.top+n.height-aA/3),this.topLeftBorderDoubleInnerBox=p>0||B>0?CA(n.left+$*2/3,n.top+k*2/3,p-$*2/3,B-k*2/3,hA.TOP_LEFT):new R(n.left+$*2/3,n.top+k*2/3),this.topRightBorderDoubleInnerBox=p>0||B>0?CA(n.left+V,n.top+k*2/3,C-nA*2/3,U-k*2/3,hA.TOP_RIGHT):new R(n.left+n.width-nA*2/3,n.top+k*2/3),this.bottomRightBorderDoubleInnerBox=I>0||x>0?CA(n.left+j,n.top+lA,I-nA*2/3,x-aA*2/3,hA.BOTTOM_RIGHT):new R(n.left+n.width-nA*2/3,n.top+n.height-aA*2/3),this.bottomLeftBorderDoubleInnerBox=L>0||P>0?CA(n.left+$*2/3,n.top+Y,L-$*2/3,P-aA*2/3,hA.BOTTOM_LEFT):new R(n.left+$*2/3,n.top+n.height-aA*2/3),this.topLeftBorderStroke=p>0||B>0?CA(n.left+$/2,n.top+k/2,p-$/2,B-k/2,hA.TOP_LEFT):new R(n.left+$/2,n.top+k/2),this.topRightBorderStroke=p>0||B>0?CA(n.left+V,n.top+k/2,C-nA/2,U-k/2,hA.TOP_RIGHT):new R(n.left+n.width-nA/2,n.top+k/2),this.bottomRightBorderStroke=I>0||x>0?CA(n.left+j,n.top+lA,I-nA/2,x-aA/2,hA.BOTTOM_RIGHT):new R(n.left+n.width-nA/2,n.top+n.height-aA/2),this.bottomLeftBorderStroke=L>0||P>0?CA(n.left+$/2,n.top+Y,L-$/2,P-aA/2,hA.BOTTOM_LEFT):new R(n.left+$/2,n.top+n.height-aA/2),this.topLeftBorderBox=p>0||B>0?CA(n.left,n.top,p,B,hA.TOP_LEFT):new R(n.left,n.top),this.topRightBorderBox=C>0||U>0?CA(n.left+V,n.top,C,U,hA.TOP_RIGHT):new R(n.left+n.width,n.top),this.bottomRightBorderBox=I>0||x>0?CA(n.left+j,n.top+lA,I,x,hA.BOTTOM_RIGHT):new R(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=L>0||P>0?CA(n.left,n.top+Y,L,P,hA.BOTTOM_LEFT):new R(n.left,n.top+n.height),this.topLeftPaddingBox=p>0||B>0?CA(n.left+$,n.top+k,Math.max(0,p-$),Math.max(0,B-k),hA.TOP_LEFT):new R(n.left+$,n.top+k),this.topRightPaddingBox=C>0||U>0?CA(n.left+Math.min(V,n.width-nA),n.top+k,V>n.width+nA?0:Math.max(0,C-nA),Math.max(0,U-k),hA.TOP_RIGHT):new R(n.left+n.width-nA,n.top+k),this.bottomRightPaddingBox=I>0||x>0?CA(n.left+Math.min(j,n.width-$),n.top+Math.min(lA,n.height-aA),Math.max(0,I-nA),Math.max(0,x-aA),hA.BOTTOM_RIGHT):new R(n.left+n.width-nA,n.top+n.height-aA),this.bottomLeftPaddingBox=L>0||P>0?CA(n.left+$,n.top+Math.min(Y,n.height-aA),Math.max(0,L-$),Math.max(0,P-aA),hA.BOTTOM_LEFT):new R(n.left+$,n.top+n.height-aA),this.topLeftContentBox=p>0||B>0?CA(n.left+$+pA,n.top+k+UA,Math.max(0,p-($+pA)),Math.max(0,B-(k+UA)),hA.TOP_LEFT):new R(n.left+$+pA,n.top+k+UA),this.topRightContentBox=C>0||U>0?CA(n.left+Math.min(V,n.width+$+pA),n.top+k+UA,V>n.width+$+pA?0:C-$+pA,U-(k+UA),hA.TOP_RIGHT):new R(n.left+n.width-(nA+Ae),n.top+k+UA),this.bottomRightContentBox=I>0||x>0?CA(n.left+Math.min(j,n.width-($+pA)),n.top+Math.min(lA,n.height+k+UA),Math.max(0,I-(nA+Ae)),x-(aA+oe),hA.BOTTOM_RIGHT):new R(n.left+n.width-(nA+Ae),n.top+n.height-(aA+oe)),this.bottomLeftContentBox=L>0||P>0?CA(n.left+$+pA,n.top+Y,Math.max(0,L-($+pA)),P-(aA+oe),hA.BOTTOM_LEFT):new R(n.left+$+pA,n.top+n.height-(aA+oe))}return r}(),hA;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(hA||(hA={}));var CA=function(r,i,a,n,h){var p=4*((Math.sqrt(2)-1)/3),B=a*p,v=n*p,C=r+a,U=i+n;switch(h){case hA.TOP_LEFT:return new ji(new R(r,U),new R(r,U-v),new R(C-B,i),new R(C,i));case hA.TOP_RIGHT:return new ji(new R(r,i),new R(r+B,i),new R(C,U-v),new R(C,U));case hA.BOTTOM_RIGHT:return new ji(new R(C,i),new R(C,i+v),new R(r+B,U),new R(r,U));case hA.BOTTOM_LEFT:default:return new ji(new R(C,U),new R(C-B,U),new R(r,i+v),new R(r,i))}},As=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},cg=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},es=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},hg=function(){function r(i,a,n){this.offsetX=i,this.offsetY=a,this.matrix=n,this.type=0,this.target=6}return r}(),ts=function(){function r(i,a){this.path=i,this.target=a,this.type=1}return r}(),dg=function(){function r(i){this.opacity=i,this.type=2,this.target=6}return r}(),gg=function(r){return r.type===0},to=function(r){return r.type===1},ug=function(r){return r.type===2},io=function(r,i){return r.length===i.length?r.some(function(a,n){return a===i[n]}):!1},pg=function(r,i,a,n,h){return r.map(function(p,B){switch(B){case 0:return p.add(i,a);case 1:return p.add(i+n,a);case 2:return p.add(i+n,a+h);case 3:return p.add(i,a+h)}return p})},so=function(){function r(i){this.element=i,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),ro=function(){function r(i,a){if(this.container=i,this.parent=a,this.effects=[],this.curves=new lg(this.container),this.container.styles.opacity<1&&this.effects.push(new dg(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,h=this.container.bounds.top+this.container.styles.transformOrigin[1].number,p=this.container.styles.transform;this.effects.push(new hg(n,h,p))}if(this.container.styles.overflowX!==0){var B=As(this.curves),v=es(this.curves);io(B,v)?this.effects.push(new ts(B,6)):(this.effects.push(new ts(B,2)),this.effects.push(new ts(v,4)))}}return r.prototype.getEffects=function(i){for(var a=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,h=this.effects.slice(0);n;){var p=n.effects.filter(function(C){return!to(C)});if(a||n.container.styles.position!==0||!n.parent){if(h.unshift.apply(h,p),a=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var B=As(n.curves),v=es(n.curves);io(B,v)||h.unshift(new ts(v,6))}}else h.unshift.apply(h,p);n=n.parent}return h.filter(function(C){return MA(C.target,i)})},r}(),Jr=function(r,i,a,n){r.container.elements.forEach(function(h){var p=MA(h.flags,4),B=MA(h.flags,2),v=new ro(h,r);MA(h.styles.display,2048)&&n.push(v);var C=MA(h.flags,8)?[]:n;if(p||B){var U=p||h.styles.isPositioned()?a:i,S=new so(v);if(h.styles.isPositioned()||h.styles.opacity<1||h.styles.isTransformed()){var I=h.styles.zIndex.order;if(I<0){var x=0;U.negativeZIndex.some(function(L,P){return I>L.element.container.styles.zIndex.order?(x=P,!1):x>0}),U.negativeZIndex.splice(x,0,S)}else if(I>0){var O=0;U.positiveZIndex.some(function(L,P){return I>=L.element.container.styles.zIndex.order?(O=P+1,!1):O>0}),U.positiveZIndex.splice(O,0,S)}else U.zeroOrAutoZIndexOrTransformedOrOpacity.push(S)}else h.styles.isFloating()?U.nonPositionedFloats.push(S):U.nonPositionedInlineLevel.push(S);Jr(v,S,p?S:a,C)}else h.styles.isInlineLevel()?i.inlineLevel.push(v):i.nonInlineLevel.push(v),Jr(v,i,a,C);MA(h.flags,8)&&no(h,C)})},no=function(r,i){for(var a=r instanceof Pr?r.start:1,n=r instanceof Pr?r.reversed:!1,h=0;h<i.length;h++){var p=i[h];p.container instanceof ba&&typeof p.container.value=="number"&&p.container.value!==0&&(a=p.container.value),p.listValue=Ai(a,p.container.styles.listStyleType,!0),a+=n?-1:1}},fg=function(r){var i=new ro(r,null),a=new so(i),n=[];return Jr(i,a,a,n),no(i.container,n),a},ao=function(r,i){switch(i){case 0:return ge(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return ge(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return ge(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return ge(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},mg=function(r,i){switch(i){case 0:return ge(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return ge(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return ge(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return ge(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},Bg=function(r,i){switch(i){case 0:return ge(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return ge(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return ge(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return ge(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},wg=function(r,i){switch(i){case 0:return is(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return is(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return is(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return is(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},is=function(r,i){var a=[];return de(r)?a.push(r.subdivide(.5,!1)):a.push(r),de(i)?a.push(i.subdivide(.5,!0)):a.push(i),a},ge=function(r,i,a,n){var h=[];return de(r)?h.push(r.subdivide(.5,!1)):h.push(r),de(a)?h.push(a.subdivide(.5,!0)):h.push(a),de(n)?h.push(n.subdivide(.5,!0).reverse()):h.push(n),de(i)?h.push(i.subdivide(.5,!1).reverse()):h.push(i),h},oo=function(r){var i=r.bounds,a=r.styles;return i.add(a.borderLeftWidth,a.borderTopWidth,-(a.borderRightWidth+a.borderLeftWidth),-(a.borderTopWidth+a.borderBottomWidth))},ss=function(r){var i=r.styles,a=r.bounds,n=mA(i.paddingLeft,a.width),h=mA(i.paddingRight,a.width),p=mA(i.paddingTop,a.width),B=mA(i.paddingBottom,a.width);return a.add(n+i.borderLeftWidth,p+i.borderTopWidth,-(i.borderRightWidth+i.borderLeftWidth+n+h),-(i.borderTopWidth+i.borderBottomWidth+p+B))},Cg=function(r,i){return r===0?i.bounds:r===2?ss(i):oo(i)},vg=function(r,i){return r===0?i.bounds:r===2?ss(i):oo(i)},Yr=function(r,i,a){var n=Cg(Qt(r.styles.backgroundOrigin,i),r),h=vg(Qt(r.styles.backgroundClip,i),r),p=Fg(Qt(r.styles.backgroundSize,i),a,n),B=p[0],v=p[1],C=Yt(Qt(r.styles.backgroundPosition,i),n.width-B,n.height-v),U=yg(Qt(r.styles.backgroundRepeat,i),C,p,n,h),S=Math.round(n.left+C[0]),I=Math.round(n.top+C[1]);return[U,S,I,B,v]},yt=function(r){return uA(r)&&r.value===Bt.AUTO},rs=function(r){return typeof r=="number"},Fg=function(r,i,a){var n=i[0],h=i[1],p=i[2],B=r[0],v=r[1];if(!B)return[0,0];if(EA(B)&&v&&EA(v))return[mA(B,a.width),mA(v,a.height)];var C=rs(p);if(uA(B)&&(B.value===Bt.CONTAIN||B.value===Bt.COVER)){if(rs(p)){var U=a.width/a.height;return U<p!=(B.value===Bt.COVER)?[a.width,a.width/p]:[a.height*p,a.height]}return[a.width,a.height]}var S=rs(n),I=rs(h),x=S||I;if(yt(B)&&(!v||yt(v))){if(S&&I)return[n,h];if(!C&&!x)return[a.width,a.height];if(x&&C){var O=S?n:h*p,L=I?h:n/p;return[O,L]}var P=S?n:a.width,z=I?h:a.height;return[P,z]}if(C){var _=0,V=0;return EA(B)?_=mA(B,a.width):EA(v)&&(V=mA(v,a.height)),yt(B)?_=V*p:(!v||yt(v))&&(V=_/p),[_,V]}var lA=null,j=null;if(EA(B)?lA=mA(B,a.width):v&&EA(v)&&(j=mA(v,a.height)),lA!==null&&(!v||yt(v))&&(j=S&&I?lA/n*h:a.height),j!==null&&yt(B)&&(lA=S&&I?j/h*n:a.width),lA!==null&&j!==null)return[lA,j];throw new Error("Unable to calculate background-size for element")},Qt=function(r,i){var a=r[i];return typeof a=="undefined"?r[0]:a},yg=function(r,i,a,n,h){var p=i[0],B=i[1],v=a[0],C=a[1];switch(r){case 2:return[new R(Math.round(n.left),Math.round(n.top+B)),new R(Math.round(n.left+n.width),Math.round(n.top+B)),new R(Math.round(n.left+n.width),Math.round(C+n.top+B)),new R(Math.round(n.left),Math.round(C+n.top+B))];case 3:return[new R(Math.round(n.left+p),Math.round(n.top)),new R(Math.round(n.left+p+v),Math.round(n.top)),new R(Math.round(n.left+p+v),Math.round(n.height+n.top)),new R(Math.round(n.left+p),Math.round(n.height+n.top))];case 1:return[new R(Math.round(n.left+p),Math.round(n.top+B)),new R(Math.round(n.left+p+v),Math.round(n.top+B)),new R(Math.round(n.left+p+v),Math.round(n.top+B+C)),new R(Math.round(n.left+p),Math.round(n.top+B+C))];default:return[new R(Math.round(h.left),Math.round(h.top)),new R(Math.round(h.left+h.width),Math.round(h.top)),new R(Math.round(h.left+h.width),Math.round(h.height+h.top)),new R(Math.round(h.left),Math.round(h.height+h.top))]}},Qg="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",lo="Hidden Text",Eg=function(){function r(i){this._data={},this._document=i}return r.prototype.parseMetrics=function(i,a){var n=this._document.createElement("div"),h=this._document.createElement("img"),p=this._document.createElement("span"),B=this._document.body;n.style.visibility="hidden",n.style.fontFamily=i,n.style.fontSize=a,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",B.appendChild(n),h.src=Qg,h.width=1,h.height=1,h.style.margin="0",h.style.padding="0",h.style.verticalAlign="baseline",p.style.fontFamily=i,p.style.fontSize=a,p.style.margin="0",p.style.padding="0",p.appendChild(this._document.createTextNode(lo)),n.appendChild(p),n.appendChild(h);var v=h.offsetTop-p.offsetTop+2;n.removeChild(p),n.appendChild(this._document.createTextNode(lo)),n.style.lineHeight="normal",h.style.verticalAlign="super";var C=h.offsetTop-n.offsetTop+2;return B.removeChild(n),{baseline:v,middle:C}},r.prototype.getMetrics=function(i,a){var n=i+" "+a;return typeof this._data[n]=="undefined"&&(this._data[n]=this.parseMetrics(i,a)),this._data[n]},r}(),co=function(){function r(i,a){this.context=i,this.options=a}return r}(),Ug=1e4,Sg=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h._activeEffects=[],h.canvas=n.canvas?n.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),n.canvas||(h.canvas.width=Math.floor(n.width*n.scale),h.canvas.height=Math.floor(n.height*n.scale),h.canvas.style.width=n.width+"px",h.canvas.style.height=n.height+"px"),h.fontMetrics=new Eg(document),h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-n.x,-n.y),h.ctx.textBaseline="bottom",h._activeEffects=[],h.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),h}return i.prototype.applyEffects=function(a){for(var n=this;this._activeEffects.length;)this.popEffect();a.forEach(function(h){return n.applyEffect(h)})},i.prototype.applyEffect=function(a){this.ctx.save(),ug(a)&&(this.ctx.globalAlpha=a.opacity),gg(a)&&(this.ctx.translate(a.offsetX,a.offsetY),this.ctx.transform(a.matrix[0],a.matrix[1],a.matrix[2],a.matrix[3],a.matrix[4],a.matrix[5]),this.ctx.translate(-a.offsetX,-a.offsetY)),to(a)&&(this.path(a.path),this.ctx.clip()),this._activeEffects.push(a)},i.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},i.prototype.renderStack=function(a){return t(this,void 0,void 0,function(){var n;return s(this,function(h){switch(h.label){case 0:return n=a.element.container.styles,n.isVisible()?[4,this.renderStackContent(a)]:[3,2];case 1:h.sent(),h.label=2;case 2:return[2]}})})},i.prototype.renderNode=function(a){return t(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:if(MA(a.container.flags,16))debugger;return a.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(a)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(a)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},i.prototype.renderTextWithLetterSpacing=function(a,n,h){var p=this;if(n===0)this.ctx.fillText(a.text,a.bounds.left,a.bounds.top+h);else{var B=Dr(a.text);B.reduce(function(v,C){return p.ctx.fillText(C,v,a.bounds.top+h),v+p.ctx.measureText(C).width},a.bounds.left)}},i.prototype.createFontStyle=function(a){var n=a.fontVariant.filter(function(B){return B==="normal"||B==="small-caps"}).join(""),h=Mg(a.fontFamily).join(", "),p=Jt(a.fontSize)?""+a.fontSize.number+a.fontSize.unit:a.fontSize.number+"px";return[[a.fontStyle,n,a.fontWeight,p,h].join(" "),h,p]},i.prototype.renderTextNode=function(a,n){return t(this,void 0,void 0,function(){var h,p,B,v,C,U,S,I,x=this;return s(this,function(O){return h=this.createFontStyle(n),p=h[0],B=h[1],v=h[2],this.ctx.font=p,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",C=this.fontMetrics.getMetrics(B,v),U=C.baseline,S=C.middle,I=n.paintOrder,a.textBounds.forEach(function(L){I.forEach(function(P){switch(P){case 0:x.ctx.fillStyle=PA(n.color),x.renderTextWithLetterSpacing(L,n.letterSpacing,U);var z=n.textShadow;z.length&&L.text.trim().length&&(z.slice(0).reverse().forEach(function(_){x.ctx.shadowColor=PA(_.color),x.ctx.shadowOffsetX=_.offsetX.number*x.options.scale,x.ctx.shadowOffsetY=_.offsetY.number*x.options.scale,x.ctx.shadowBlur=_.blur.number,x.renderTextWithLetterSpacing(L,n.letterSpacing,U)}),x.ctx.shadowColor="",x.ctx.shadowOffsetX=0,x.ctx.shadowOffsetY=0,x.ctx.shadowBlur=0),n.textDecorationLine.length&&(x.ctx.fillStyle=PA(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(_){switch(_){case 1:x.ctx.fillRect(L.bounds.left,Math.round(L.bounds.top+U),L.bounds.width,1);break;case 2:x.ctx.fillRect(L.bounds.left,Math.round(L.bounds.top),L.bounds.width,1);break;case 3:x.ctx.fillRect(L.bounds.left,Math.ceil(L.bounds.top+S),L.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&L.text.trim().length&&(x.ctx.strokeStyle=PA(n.webkitTextStrokeColor),x.ctx.lineWidth=n.webkitTextStrokeWidth,x.ctx.lineJoin=window.chrome?"miter":"round",x.ctx.strokeText(L.text,L.bounds.left,L.bounds.top+U)),x.ctx.strokeStyle="",x.ctx.lineWidth=0,x.ctx.lineJoin="miter";break}})}),[2]})})},i.prototype.renderReplacedElement=function(a,n,h){if(h&&a.intrinsicWidth>0&&a.intrinsicHeight>0){var p=ss(a),B=es(n);this.path(B),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(h,0,0,a.intrinsicWidth,a.intrinsicHeight,p.left,p.top,p.width,p.height),this.ctx.restore()}},i.prototype.renderNodeContent=function(a){return t(this,void 0,void 0,function(){var n,h,p,B,v,C,V,V,U,S,I,x,j,O,L,Y,P,z,_,V,lA,j,Y;return s(this,function(k){switch(k.label){case 0:this.applyEffects(a.getEffects(4)),n=a.container,h=a.curves,p=n.styles,B=0,v=n.textNodes,k.label=1;case 1:return B<v.length?(C=v[B],[4,this.renderTextNode(C,p)]):[3,4];case 2:k.sent(),k.label=3;case 3:return B++,[3,1];case 4:if(!(n instanceof Ia))return[3,8];k.label=5;case 5:return k.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return V=k.sent(),this.renderReplacedElement(n,h,V),[3,8];case 7:return k.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof Ha&&this.renderReplacedElement(n,h,n.canvas),!(n instanceof xa))return[3,12];k.label=9;case 9:return k.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return V=k.sent(),this.renderReplacedElement(n,h,V),[3,12];case 11:return k.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof Da&&n.tree?(U=new i(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,U.render(n.tree)]):[3,14];case 13:S=k.sent(),n.width&&n.height&&this.ctx.drawImage(S,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),k.label=14;case 14:if(n instanceof Kr&&(I=Math.min(n.bounds.width,n.bounds.height),n.type===Ji?n.checked&&(this.ctx.save(),this.path([new R(n.bounds.left+I*.39363,n.bounds.top+I*.79),new R(n.bounds.left+I*.16,n.bounds.top+I*.5549),new R(n.bounds.left+I*.27347,n.bounds.top+I*.44071),new R(n.bounds.left+I*.39694,n.bounds.top+I*.5649),new R(n.bounds.left+I*.72983,n.bounds.top+I*.23),new R(n.bounds.left+I*.84,n.bounds.top+I*.34085),new R(n.bounds.left+I*.39363,n.bounds.top+I*.79)]),this.ctx.fillStyle=PA(Ma),this.ctx.fill(),this.ctx.restore()):n.type===Yi&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+I/2,n.bounds.top+I/2,I/4,0,Math.PI*2,!0),this.ctx.fillStyle=PA(Ma),this.ctx.fill(),this.ctx.restore())),Ig(n)&&n.value.length){switch(x=this.createFontStyle(p),j=x[0],O=x[1],L=this.fontMetrics.getMetrics(j,O).baseline,this.ctx.font=j,this.ctx.fillStyle=PA(p.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=xg(n.styles.textAlign),Y=ss(n),P=0,n.styles.textAlign){case 1:P+=Y.width/2;break;case 2:P+=Y.width;break}z=Y.add(P,0,0,-Y.height/2+1),this.ctx.save(),this.path([new R(Y.left,Y.top),new R(Y.left+Y.width,Y.top),new R(Y.left+Y.width,Y.top+Y.height),new R(Y.left,Y.top+Y.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new zt(n.value,z),p.letterSpacing,L),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!MA(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(_=n.styles.listStyleImage,_.type!==0)return[3,18];V=void 0,lA=_.url,k.label=15;case 15:return k.trys.push([15,17,,18]),[4,this.context.cache.match(lA)];case 16:return V=k.sent(),this.ctx.drawImage(V,n.bounds.left-(V.width+10),n.bounds.top),[3,18];case 17:return k.sent(),this.context.logger.error("Error loading list-style-image "+lA),[3,18];case 18:return[3,20];case 19:a.listValue&&n.styles.listStyleType!==-1&&(j=this.createFontStyle(p)[0],this.ctx.font=j,this.ctx.fillStyle=PA(p.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",Y=new l(n.bounds.left,n.bounds.top+mA(n.styles.paddingTop,n.bounds.width),n.bounds.width,la(p.lineHeight,p.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new zt(a.listValue,Y),p.letterSpacing,la(p.lineHeight,p.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),k.label=20;case 20:return[2]}})})},i.prototype.renderStackContent=function(a){return t(this,void 0,void 0,function(){var n,h,_,p,B,_,v,C,_,U,S,_,I,x,_,O,L,_,P,z,_;return s(this,function(V){switch(V.label){case 0:if(MA(a.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(a.element)];case 1:V.sent(),n=0,h=a.negativeZIndex,V.label=2;case 2:return n<h.length?(_=h[n],[4,this.renderStack(_)]):[3,5];case 3:V.sent(),V.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(a.element)];case 6:V.sent(),p=0,B=a.nonInlineLevel,V.label=7;case 7:return p<B.length?(_=B[p],[4,this.renderNode(_)]):[3,10];case 8:V.sent(),V.label=9;case 9:return p++,[3,7];case 10:v=0,C=a.nonPositionedFloats,V.label=11;case 11:return v<C.length?(_=C[v],[4,this.renderStack(_)]):[3,14];case 12:V.sent(),V.label=13;case 13:return v++,[3,11];case 14:U=0,S=a.nonPositionedInlineLevel,V.label=15;case 15:return U<S.length?(_=S[U],[4,this.renderStack(_)]):[3,18];case 16:V.sent(),V.label=17;case 17:return U++,[3,15];case 18:I=0,x=a.inlineLevel,V.label=19;case 19:return I<x.length?(_=x[I],[4,this.renderNode(_)]):[3,22];case 20:V.sent(),V.label=21;case 21:return I++,[3,19];case 22:O=0,L=a.zeroOrAutoZIndexOrTransformedOrOpacity,V.label=23;case 23:return O<L.length?(_=L[O],[4,this.renderStack(_)]):[3,26];case 24:V.sent(),V.label=25;case 25:return O++,[3,23];case 26:P=0,z=a.positiveZIndex,V.label=27;case 27:return P<z.length?(_=z[P],[4,this.renderStack(_)]):[3,30];case 28:V.sent(),V.label=29;case 29:return P++,[3,27];case 30:return[2]}})})},i.prototype.mask=function(a){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(a.slice(0).reverse()),this.ctx.closePath()},i.prototype.path=function(a){this.ctx.beginPath(),this.formatPath(a),this.ctx.closePath()},i.prototype.formatPath=function(a){var n=this;a.forEach(function(h,p){var B=de(h)?h.start:h;p===0?n.ctx.moveTo(B.x,B.y):n.ctx.lineTo(B.x,B.y),de(h)&&n.ctx.bezierCurveTo(h.startControl.x,h.startControl.y,h.endControl.x,h.endControl.y,h.end.x,h.end.y)})},i.prototype.renderRepeat=function(a,n,h,p){this.path(a),this.ctx.fillStyle=n,this.ctx.translate(h,p),this.ctx.fill(),this.ctx.translate(-h,-p)},i.prototype.resizeImage=function(a,n,h){var p;if(a.width===n&&a.height===h)return a;var B=(p=this.canvas.ownerDocument)!==null&&p!==void 0?p:document,v=B.createElement("canvas");v.width=Math.max(1,n),v.height=Math.max(1,h);var C=v.getContext("2d");return C.drawImage(a,0,0,a.width,a.height,0,0,n,h),v},i.prototype.renderBackgroundImage=function(a){return t(this,void 0,void 0,function(){var n,h,p,B,v,C;return s(this,function(U){switch(U.label){case 0:n=a.styles.backgroundImage.length-1,h=function(S){var I,x,O,UA,ee,te,pA,GA,aA,L,UA,ee,te,pA,GA,P,z,_,V,lA,j,Y,k,nA,aA,$,UA,Ae,oe,pA,GA,Ye,ee,te,ot,Ee,$e,lt,ct,Me,ht,Le;return s(this,function(Et){switch(Et.label){case 0:if(S.type!==0)return[3,5];I=void 0,x=S.url,Et.label=1;case 1:return Et.trys.push([1,3,,4]),[4,p.context.cache.match(x)];case 2:return I=Et.sent(),[3,4];case 3:return Et.sent(),p.context.logger.error("Error loading background-image "+x),[3,4];case 4:return I&&(O=Yr(a,n,[I.width,I.height,I.width/I.height]),UA=O[0],ee=O[1],te=O[2],pA=O[3],GA=O[4],aA=p.ctx.createPattern(p.resizeImage(I,pA,GA),"repeat"),p.renderRepeat(UA,aA,ee,te)),[3,6];case 5:gc(S)?(L=Yr(a,n,[null,null,null]),UA=L[0],ee=L[1],te=L[2],pA=L[3],GA=L[4],P=oc(S.angle,pA,GA),z=P[0],_=P[1],V=P[2],lA=P[3],j=P[4],Y=document.createElement("canvas"),Y.width=pA,Y.height=GA,k=Y.getContext("2d"),nA=k.createLinearGradient(_,lA,V,j),zn(S.stops,z).forEach(function(ti){return nA.addColorStop(ti.stop,PA(ti.color))}),k.fillStyle=nA,k.fillRect(0,0,pA,GA),pA>0&&GA>0&&(aA=p.ctx.createPattern(Y,"repeat"),p.renderRepeat(UA,aA,ee,te))):uc(S)&&($=Yr(a,n,[null,null,null]),UA=$[0],Ae=$[1],oe=$[2],pA=$[3],GA=$[4],Ye=S.position.length===0?[Cr]:S.position,ee=mA(Ye[0],pA),te=mA(Ye[Ye.length-1],GA),ot=lc(S,ee,te,pA,GA),Ee=ot[0],$e=ot[1],Ee>0&&$e>0&&(lt=p.ctx.createRadialGradient(Ae+ee,oe+te,0,Ae+ee,oe+te,Ee),zn(S.stops,Ee*2).forEach(function(ti){return lt.addColorStop(ti.stop,PA(ti.color))}),p.path(UA),p.ctx.fillStyle=lt,Ee!==$e?(ct=a.bounds.left+.5*a.bounds.width,Me=a.bounds.top+.5*a.bounds.height,ht=$e/Ee,Le=1/ht,p.ctx.save(),p.ctx.translate(ct,Me),p.ctx.transform(1,0,0,ht,0,0),p.ctx.translate(-ct,-Me),p.ctx.fillRect(Ae,Le*(oe-Me)+Me,pA,GA*Le),p.ctx.restore()):p.ctx.fill())),Et.label=6;case 6:return n--,[2]}})},p=this,B=0,v=a.styles.backgroundImage.slice(0).reverse(),U.label=1;case 1:return B<v.length?(C=v[B],[5,h(C)]):[3,4];case 2:U.sent(),U.label=3;case 3:return B++,[3,1];case 4:return[2]}})})},i.prototype.renderSolidBorder=function(a,n,h){return t(this,void 0,void 0,function(){return s(this,function(p){return this.path(ao(h,n)),this.ctx.fillStyle=PA(a),this.ctx.fill(),[2]})})},i.prototype.renderDoubleBorder=function(a,n,h,p){return t(this,void 0,void 0,function(){var B,v;return s(this,function(C){switch(C.label){case 0:return n<3?[4,this.renderSolidBorder(a,h,p)]:[3,2];case 1:return C.sent(),[2];case 2:return B=mg(p,h),this.path(B),this.ctx.fillStyle=PA(a),this.ctx.fill(),v=Bg(p,h),this.path(v),this.ctx.fill(),[2]}})})},i.prototype.renderNodeBackgroundAndBorders=function(a){return t(this,void 0,void 0,function(){var n,h,p,B,v,C,U,S,I=this;return s(this,function(x){switch(x.label){case 0:return this.applyEffects(a.getEffects(2)),n=a.container.styles,h=!_e(n.backgroundColor)||n.backgroundImage.length,p=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],B=Hg(Qt(n.backgroundClip,0),a.curves),h||n.boxShadow.length?(this.ctx.save(),this.path(B),this.ctx.clip(),_e(n.backgroundColor)||(this.ctx.fillStyle=PA(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(a.container)]):[3,2];case 1:x.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(O){I.ctx.save();var L=As(a.curves),P=O.inset?0:Ug,z=pg(L,-P+(O.inset?1:-1)*O.spread.number,(O.inset?1:-1)*O.spread.number,O.spread.number*(O.inset?-2:2),O.spread.number*(O.inset?-2:2));O.inset?(I.path(L),I.ctx.clip(),I.mask(z)):(I.mask(L),I.ctx.clip(),I.path(z)),I.ctx.shadowOffsetX=O.offsetX.number+P,I.ctx.shadowOffsetY=O.offsetY.number,I.ctx.shadowColor=PA(O.color),I.ctx.shadowBlur=O.blur.number,I.ctx.fillStyle=O.inset?PA(O.color):"rgba(0,0,0,1)",I.ctx.fill(),I.ctx.restore()}),x.label=2;case 2:v=0,C=0,U=p,x.label=3;case 3:return C<U.length?(S=U[C],S.style!==0&&!_e(S.color)&&S.width>0?S.style!==2?[3,5]:[4,this.renderDashedDottedBorder(S.color,S.width,v,a.curves,2)]:[3,11]):[3,13];case 4:return x.sent(),[3,11];case 5:return S.style!==3?[3,7]:[4,this.renderDashedDottedBorder(S.color,S.width,v,a.curves,3)];case 6:return x.sent(),[3,11];case 7:return S.style!==4?[3,9]:[4,this.renderDoubleBorder(S.color,S.width,v,a.curves)];case 8:return x.sent(),[3,11];case 9:return[4,this.renderSolidBorder(S.color,v,a.curves)];case 10:x.sent(),x.label=11;case 11:v++,x.label=12;case 12:return C++,[3,3];case 13:return[2]}})})},i.prototype.renderDashedDottedBorder=function(a,n,h,p,B){return t(this,void 0,void 0,function(){var v,C,U,S,I,x,O,L,P,z,_,V,lA,j,Y,k,Y,k;return s(this,function(nA){return this.ctx.save(),v=wg(p,h),C=ao(p,h),B===2&&(this.path(C),this.ctx.clip()),de(C[0])?(U=C[0].start.x,S=C[0].start.y):(U=C[0].x,S=C[0].y),de(C[1])?(I=C[1].end.x,x=C[1].end.y):(I=C[1].x,x=C[1].y),h===0||h===2?O=Math.abs(U-I):O=Math.abs(S-x),this.ctx.beginPath(),B===3?this.formatPath(v):this.formatPath(C.slice(0,2)),L=n<3?n*3:n*2,P=n<3?n*2:n,B===3&&(L=n,P=n),z=!0,O<=L*2?z=!1:O<=L*2+P?(_=O/(2*L+P),L*=_,P*=_):(V=Math.floor((O+P)/(L+P)),lA=(O-V*L)/(V-1),j=(O-(V+1)*L)/V,P=j<=0||Math.abs(P-lA)<Math.abs(P-j)?lA:j),z&&(B===3?this.ctx.setLineDash([0,L+P]):this.ctx.setLineDash([L,P])),B===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=PA(a),this.ctx.stroke(),this.ctx.setLineDash([]),B===2&&(de(C[0])&&(Y=C[3],k=C[0],this.ctx.beginPath(),this.formatPath([new R(Y.end.x,Y.end.y),new R(k.start.x,k.start.y)]),this.ctx.stroke()),de(C[1])&&(Y=C[1],k=C[2],this.ctx.beginPath(),this.formatPath([new R(Y.end.x,Y.end.y),new R(k.start.x,k.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},i.prototype.render=function(a){return t(this,void 0,void 0,function(){var n;return s(this,function(h){switch(h.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=PA(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=fg(a),[4,this.renderStack(n)];case 1:return h.sent(),this.applyEffects([]),[2,this.canvas]}})})},i}(co),Ig=function(r){return r instanceof Ta||r instanceof La?!0:r instanceof Kr&&r.type!==Yi&&r.type!==Ji},Hg=function(r,i){switch(r){case 0:return As(i);case 2:return cg(i);case 1:default:return es(i)}},xg=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},bg=["-apple-system","system-ui"],Mg=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(i){return bg.indexOf(i)===-1}):r},Lg=function(r){e(i,r);function i(a,n){var h=r.call(this,a,n)||this;return h.canvas=n.canvas?n.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),h.options=n,h.canvas.width=Math.floor(n.width*n.scale),h.canvas.height=Math.floor(n.height*n.scale),h.canvas.style.width=n.width+"px",h.canvas.style.height=n.height+"px",h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-n.x,-n.y),h.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),h}return i.prototype.render=function(a){return t(this,void 0,void 0,function(){var n,h;return s(this,function(p){switch(p.label){case 0:return n=Tr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,a),[4,Tg(n)];case 1:return h=p.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=PA(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(h,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},i}(co),Tg=function(r){return new Promise(function(i,a){var n=new Image;n.onload=function(){i(n)},n.onerror=a,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},Dg=function(){function r(i){var a=i.id,n=i.enabled;this.id=a,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,o([this.id,this.getTime()+"ms"],i)):this.info.apply(this,i))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];this.enabled&&typeof window!="undefined"&&window.console&&typeof console.info=="function"&&console.info.apply(console,o([this.id,this.getTime()+"ms"],i))},r.prototype.warn=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,o([this.id,this.getTime()+"ms"],i)):this.info.apply(this,i))},r.prototype.error=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.error=="function"?console.error.apply(console,o([this.id,this.getTime()+"ms"],i)):this.info.apply(this,i))},r.instances={},r}(),Pg=function(){function r(i,a){var n;this.windowBounds=a,this.instanceName="#"+r.instanceCount++,this.logger=new Dg({id:this.instanceName,enabled:i.logging}),this.cache=(n=i.cache)!==null&&n!==void 0?n:new tg(this,i)}return r.instanceCount=1,r}(),Kg=function(r,i){return i===void 0&&(i={}),Rg(r,i)};typeof window!="undefined"&&eo.setContext(window);var Rg=function(r,i){return t(void 0,void 0,void 0,function(){var a,n,h,p,B,v,C,U,S,I,x,O,L,P,z,_,V,lA,j,Y,nA,k,nA,aA,$,UA,Ae,oe,pA,GA,Ye,ee,te,ot,Ee,$e,lt,ct,Me,ht;return s(this,function(Le){switch(Le.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(a=r.ownerDocument,!a)throw new Error("Element is not attached to a Document");if(n=a.defaultView,!n)throw new Error("Document is not attached to a Window");return h={allowTaint:(aA=i.allowTaint)!==null&&aA!==void 0?aA:!1,imageTimeout:($=i.imageTimeout)!==null&&$!==void 0?$:15e3,proxy:i.proxy,useCORS:(UA=i.useCORS)!==null&&UA!==void 0?UA:!1},p=A({logging:(Ae=i.logging)!==null&&Ae!==void 0?Ae:!0,cache:i.cache},h),B={windowWidth:(oe=i.windowWidth)!==null&&oe!==void 0?oe:n.innerWidth,windowHeight:(pA=i.windowHeight)!==null&&pA!==void 0?pA:n.innerHeight,scrollX:(GA=i.scrollX)!==null&&GA!==void 0?GA:n.pageXOffset,scrollY:(Ye=i.scrollY)!==null&&Ye!==void 0?Ye:n.pageYOffset},v=new l(B.scrollX,B.scrollY,B.windowWidth,B.windowHeight),C=new Pg(p,v),U=(ee=i.foreignObjectRendering)!==null&&ee!==void 0?ee:!1,S={allowTaint:(te=i.allowTaint)!==null&&te!==void 0?te:!1,onclone:i.onclone,ignoreElements:i.ignoreElements,inlineImages:U,copyStyles:U},C.logger.debug("Starting document clone with size "+v.width+"x"+v.height+" scrolled to "+-v.left+","+-v.top),I=new ja(C,r,S),x=I.clonedReferenceElement,x?[4,I.toIFrame(a,v)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return O=Le.sent(),L=kr(x)||kd(x)?d(x.ownerDocument):c(C,x),P=L.width,z=L.height,_=L.left,V=L.top,lA=kg(C,x,i.backgroundColor),j={canvas:i.canvas,backgroundColor:lA,scale:(Ee=(ot=i.scale)!==null&&ot!==void 0?ot:n.devicePixelRatio)!==null&&Ee!==void 0?Ee:1,x:(($e=i.x)!==null&&$e!==void 0?$e:0)+_,y:((lt=i.y)!==null&&lt!==void 0?lt:0)+V,width:(ct=i.width)!==null&&ct!==void 0?ct:Math.ceil(P),height:(Me=i.height)!==null&&Me!==void 0?Me:Math.ceil(z)},U?(C.logger.debug("Document cloned, using foreign object rendering"),nA=new Lg(C,j),[4,nA.render(x)]):[3,3];case 2:return Y=Le.sent(),[3,5];case 3:return C.logger.debug("Document cloned, element located at "+_+","+V+" with size "+P+"x"+z+" using computed rendering"),C.logger.debug("Starting DOM parsing"),k=Ka(C,x),lA===k.styles.backgroundColor&&(k.styles.backgroundColor=xe.TRANSPARENT),C.logger.debug("Starting renderer for element at "+j.x+","+j.y+" with size "+j.width+"x"+j.height),nA=new Sg(C,j),[4,nA.render(k)];case 4:Y=Le.sent(),Le.label=5;case 5:return(!((ht=i.removeContainer)!==null&&ht!==void 0)||ht)&&(ja.destroy(O)||C.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),C.logger.debug("Finished rendering"),[2,Y]}})})},kg=function(r,i,a){var n=i.ownerDocument,h=n.documentElement?$t(r,getComputedStyle(n.documentElement).backgroundColor):xe.TRANSPARENT,p=n.body?$t(r,getComputedStyle(n.body).backgroundColor):xe.TRANSPARENT,B=typeof a=="string"?$t(r,a):a===null?xe.TRANSPARENT:4294967295;return i===n.documentElement?_e(h)?_e(p)?B:p:h:B};return Kg})});var Cu={};Jg(Cu,{default:()=>tr});module.exports=Yg(Cu);var Po=require("obsidian");var X=require("obsidian");var ns=class{constructor(e){this.vault=e}async parseCanvasFile(e){try{let A=await this.vault.read(e),t=JSON.parse(A),s=[];if(t&&t.nodes)for(let o of t.nodes)o.type==="file"&&o.file&&s.push(o.file);return s}catch(A){return console.error("\u89E3\u6790 Canvas \u6587\u4EF6\u5931\u8D25:",A),[]}}};var wo=require("obsidian");var gA={AGAIN:1,HARD:2,GOOD:3,EASY:4},$r={request_retention:.9,maximum_interval:36500,newCardsPerDay:20,reviewsPerDay:100,w:[.4872,1.4003,3.7145,13.8206,5.1618,1.2298,.8975,.031,1.6474,.1367,1.0461,2.1072,.0793,.3246,1.587,.2272,2.8755]};var mo=require("obsidian");var uo={"Ollama (Local)":"Ollama (local)",Model:"Model",Save:"Save",Cancel:"Cancel",Edit:"Edit",Delete:"Delete","Custom Model":"Custom model","Checking...":"Checking...","Select the AI service provider":"Select the AI service provider.","API Key":"API key","Please enter your API Key.":"Please enter your API key.","API Key is valid!":"API Key is valid!","API Key and model available.":"API Key and model available.","Invalid API Key or server error. Please verify your API Key.":"Invalid API Key or server error. Please verify your API Key.","Select a model or enter a custom one.":"Select a model or enter a custom one.","Provider URL":"Provider URL","Leave it blank, unless you are using a proxy.":"Leave it blank, unless you are using a proxy.","Please enter an API Key first":"Please enter an API Key first.","Custom model unavailable. Please check the model ID and your access permissions.":"Custom model unavailable. Please check the model ID and your access permissions.","OpenAI service":"OpenAI service","No models available. Please check your API Key.":"No models available. Please check your API Key.","Anthropic service":"Anthropic service","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"Model ID can only contain letters, numbers, underscores, dots and hyphens.","Unable to create model selection dropdown menu.":"Unable to create model selection dropdown menu.","Gemini service":"Gemini service","Deepseek service":"Deepseek service","Ollama service":"Ollama service","Ollama server URL (default: http://localhost:11434)":"Ollama server URL (default: http://localhost:11434)",Check:"Check","Server URL":"Server URL","Successfully connected to Ollama service":"Successfully connected to Ollama service.","No models found. Please download models using ollama":"No models found. Please download models using ollama.","Could not connect to Ollama service":"Could not connect to Ollama service","Failed to connect to Ollama service. Please check the server URL.":"Failed to connect to Ollama service. Please check the server URL.","Currently selected model (Test connection to see all available models)":"Currently selected model (Test connection to see all available models)","Select a Ollama model.":"Select a Ollama model.","No models available. Please load an available model first.":"No models available. Please load an available model first.","No models available":"No models available","Prompt settings":"Custom prompt","Add Prompt":"Add prompt","Input Prompt Name":"Input prompt name","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`Input prompt content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`,"Prompt added":"Prompt added","Prompt updated":"Prompt updated","Shift + Enter Wrap, Enter Save":"Shift + Enter Wrap, Enter Save","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI, Shift + Enter Wrap, Enter Save","Please enter AI instruction":"Please enter AI instruction","AI response generated":"AI response generated","AI generation failed":"AI generation failed","Delete comment":"Delete","Add Comment":"Add comment","Export as Image":"Export as image","Select Prompt":"Select prompt","Please add Prompt in the settings first":"Please add prompt in the settings first","AI comments have been added":"AI comments have been added","AI comments failed:":"AI comments failed:",Chat:"Chat","Failed to process dropped highlight:":"Failed to process dropped highlight:","highlighted notes":" highlighted notes","Input message...":"Input message...","Unable to access the Ollama model, please check the service.":"Unable to access the Ollama model, please check the service.","Unable to get Gemini model list, please check API Key and network connection.":"Unable to get Gemini model list, please check API key and network connection.",Download:"Download","Export successful!":"Export successful!","Export failed, please try again.":"Export failed, please try again.","Loading...":"Loading...","Search...":"Search...","No matching content found.":"No matching content found.","The current document has no highlighted content.":"The current document has no highlighted content.","No corresponding file found.":"No corresponding file found.","Export failed: Failed to load necessary components.":"Export failed: Failed to load necessary components.","All Highlight":"All highlight","Export as notes":"Export as notes","Add File Comment":"Add file comment","File Comment":"File comment","Successfully exported highlights to: ":"Successfully exported highlights to: ","Failed to export highlights: ":"Failed to export highlights: ","Default Template":"Default template","Modern minimalist knowledge card style":"Modern minimalist knowledge card style","Academic Template":"Academic template","Formal style suitable for academic citations":"Formal style suitable for academic citations","Social Template":"Social template","Modern style suitable for social media sharing":"Modern style suitable for social media sharing","Open AI chat window":"Open AI chat window","Open HiNote window":"Open HiNote window",General:"Highlight","Export Path":"Export path","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.",Exclusions:"Exclusions","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"Custom text extraction","Use Custom Pattern":"Use custom pattern","Enable to use a custom regular expression for extracting text.":"Enable to use a custom regular expression for extracting text.","Custom Pattern":"Custom pattern","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.","Default Color":"Default color","Set the default color for decorators when no color is specified. Leave empty to use system default.":"Set the default color for decorators when no color is specified. Leave empty to use system default.","Show Comment Widget":"Show comment widget","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.","Export template":"Export template","Clean orphaned data":"Clean orphaned data","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.","Flashcard learning":"Flashcard learning","New cards per day":"New cards per day","Maximum number of new cards to learn each day":"Maximum number of new cards to learn each day.","Reviews per day":"Reviews per day","Maximum number of cards to review each day":"Maximum number of cards to review each day.","Target retention":"Target retention","Target memory retention rate (0.8 = 80%)":"Target memory retention rate (0.8 = 80%).","Maximum interval":"Maximum interval","Maximum interval in days between reviews":"Maximum interval in days between reviews.","Reset daily stats":"Reset daily stats","Reset today's learning statistics":"Reset today's learning statistics.",Reset:"Reset","Daily statistics have been reset":"Daily statistics have been reset","No statistics to reset for today":"No statistics to reset for today",Advanced:"Advanced","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.","Reset algorithm parameters":"Reset algorithm parameters","Reset the FSRS algorithm parameters to default values":"Reset the FSRS algorithm parameters to default values.","Reset to Default":"Reset to default","FSRS parameters have been reset to default values":"FSRS parameters have been reset to default values.",days:"days","Activate HiCard":"Activate HiCard","Enter your license key to activate HiCard feature.":"Enter your license key to activate HiCard feature.","Enter license key":"Enter license key",Activate:"Activate","Please enter a license key":"Please enter a license key","HiCard activated successfully!":"HiCard activated successfully!","Invalid license key":"Invalid license key","Use global settings":"Use global settings","New cards per day:":"New cards per day:","Reviews per day:":"Reviews per day:","Create Group":"Create group",Create:"Create",Again:"Again",Hard:"Hard",Good:"Good",Easy:"Easy",Card:"Card",of:"of",Settings:"Settings","Are you sure you want to delete this group?":"Are you sure you want to delete this group?",Yes:"Yes",No:"No","You've completed All cards for today!":"You've completed All cards for today!","No cards available.":"No cards available.","Return to First Card":"Return to First Card","Edit Group":"Edit group","Create New Group":"Create new group","Please fill in all fields":"Please fill in all fields","Saving...":"Saving...","Creating...":"Creating...","Group updated successfully":"Group updated successfully","Failed to update group":"Failed to update group","Group created successfully":"Group created successfully","Failed to create or update group":"Failed to create or update group",Retention:"Retention","Limits:":"Limits:","Learning completed!":"Learning completed!","Group deleted":"Group deleted","search-prefix-all":"match all file highlights","search-prefix-hicard":"match flashcards only","search-prefix-comment":"match with comments only","search-prefix-path":"match path of the file","Open (DoubleClick)":"Open (double-click)"};var po={"Ollama (Local)":"Ollama (\u672C\u5730)",Model:"\u6A21\u578B",Save:"\u4FDD\u5B58",Cancel:"\u53D6\u6D88",Edit:"\u7F16\u8F91",Delete:"\u5220\u9664","Custom Model":"\u81EA\u5B9A\u4E49\u6A21\u578B","Checking...":"\u68C0\u67E5\u4E2D...","Select the AI service provider":"\u9009\u62E9 AI \u670D\u52A1\u63D0\u4F9B\u5546\u3002","API Key":"API \u5BC6\u94A5","Please enter your API Key.":"\u8BF7\u8F93\u5165\u60A8\u7684 API \u5BC6\u94A5\u3002","API Key is valid!":"API \u5BC6\u94A5\u6709\u6548\uFF01","API Key and model available.":"API \u5BC6\u94A5\u548C\u6A21\u578B\u53EF\u7528\uFF01","Invalid API Key or server error. Please verify your API Key.":"API\u5BC6\u94A5\u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u5BC6\u94A5\u3002","Select a model or enter a custom one.":"\u9009\u62E9\u6A21\u578B\u6216\u8F93\u5165\u81EA\u5B9A\u4E49\u6A21\u578B\u3002","Provider URL":"\u670D\u52A1\u5730\u5740","Leave it blank, unless you are using a proxy.":"\u7559\u7A7A\uFF0C\u9664\u975E\u60A8\u4F7F\u7528\u4EE3\u7406\u3002","Please enter an API Key first":"\u8BF7\u5148\u8F93\u5165 API \u5BC6\u94A5\u3002","Custom model unavailable. Please check the model ID and your access permissions.":"\u81EA\u5B9A\u4E49\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u6A21\u578B ID \u548C\u60A8\u7684\u8BBF\u95EE\u6743\u9650\u3002","OpenAI service":"OpenAI \u670D\u52A1","No models available. Please check your API Key.":"\u6CA1\u6709\u53EF\u7528\u7684\u6A21\u578B\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u5BC6\u94A5\u3002","Anthropic service":"Anthropic \u670D\u52A1","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"\u6A21\u578B ID \u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001\u70B9\u548C\u8FDE\u5B57\u7B26","Unable to create model selection dropdown menu.":"\u65E0\u6CD5\u521B\u5EFA\u6A21\u578B\u9009\u62E9\u4E0B\u62C9\u83DC\u5355\u3002","Gemini service":"Gemini \u670D\u52A1","Deepseek service":"Deepseek \u670D\u52A1","Ollama service":"Ollama \u670D\u52A1","Ollama server URL (default: http://localhost:11434)":"Ollama server URL\uFF08\u9ED8\u8BA4\uFF1Ahttp://localhost:11434\uFF09",Check:"\u9A8C\u8BC1","Server URL":"\u670D\u52A1\u5668 URL","Successfully connected to Ollama service":"\u6210\u529F\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","No models found. Please download models using ollama":"\u672A\u627E\u5230\u6A21\u578B\u3002\u8BF7\u4F7F\u7528 ollama \u4E0B\u8F7D\u6A21\u578B","Could not connect to Ollama service":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","Failed to connect to Ollama service. Please check the server URL.":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1\uFF0C\u8BF7\u68C0\u67E5 server URL\u3002","Currently selected model (Test connection to see all available models)":"\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\uFF08\u6D4B\u8BD5\u8FDE\u63A5\u4EE5\u67E5\u770B\u53EF\u7528\u6A21\u578B\uFF09","Select a Ollama model.":"\u9009\u62E9\u4E00\u4E2A Ollama \u6A21\u578B","No models available. Please load an available model first.":"\u65E0\u53EF\u7528\u6A21\u578B\uFF0C\u8BF7\u5148\u52A0\u8F7D\u53EF\u7528\u6A21\u578B\u3002","No models available":"\u65E0\u53EF\u7528\u6A21\u578B","Prompt settings":"\u81EA\u5B9A\u4E49 Prompt","Add Prompt":"\u6DFB\u52A0 Prompt","Input Prompt Name":"\u8F93\u5165 Prompt \u540D\u79F0","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`\u8F93\u5165 Prompt \u5185\u5BB9
\u53EF\u7528\u53C2\u6570:
{{highlight}} - \u5F53\u524D\u9AD8\u4EAE\u6587\u672C
{{comment}} - \u5DF2\u5B58\u5728\u7684\u6CE8\u91CA`,"Prompt added":"Prompt \u5DF2\u6DFB\u52A0","Prompt updated":"Prompt \u5DF2\u66F4\u65B0","Shift + Enter Wrap, Enter Save":"Shift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI\uFF0CShift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Please enter AI instruction":"\u8BF7\u8F93\u5165AI\u6307\u4EE4","AI response generated":"AI\u54CD\u5E94\u5DF2\u751F\u6210","AI generation failed":"AI\u751F\u6210\u5931\u8D25","Delete comment":"\u5220\u9664\u8BC4\u8BBA","Add Comment":"\u6DFB\u52A0\u8BC4\u8BBA","Export as Image":"\u5BFC\u51FA\u4E3A\u56FE\u7247","Select Prompt":"\u9009\u62E9 Prompt","Please add Prompt in the settings first":"\u8BF7\u5148\u5728\u8BBE\u7F6E\u4E2D\u6DFB\u52A0 Prompt","AI comments added ":"AI \u8BC4\u8BBA\u5DF2\u6DFB\u52A0","AI comments failed:":"AI \u8BC4\u8BBA\u5931\u8D25\uFF1A",Chat:"\u5BF9\u8BDD","Failed to process dropped highlight:":"\u65E0\u6CD5\u5904\u7406\u5220\u9664\u7684\u9AD8\u4EAE\uFF1A","highlighted notes":" \u6761\u9AD8\u4EAE\u7B14\u8BB0","Input message...":"\u8F93\u5165\u6D88\u606F...","Unable to access the Ollama model, please check the service.":"\u65E0\u6CD5\u8BBF\u95EE Ollama \u6A21\u578B\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u662F\u5426\u6B63\u5E38\u8FD0\u884C","Unable to get Gemini model list, please check API Key and network connection.":"\u65E0\u6CD5\u83B7\u53D6 Gemini \u6A21\u578B\u5217\u8868\uFF0C\u8BF7\u68C0\u67E5 API Key \u548C\u7F51\u7EDC\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Export successful!":"\u5BFC\u51FA\u6210\u529F\uFF01","Export failed, please try again.":"\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5","Loading...":"\u52A0\u8F7D\u4E2D...","Search...":"\u641C\u7D22\u9AD8\u4EAE\u6216\u8BC4\u8BBA...","No matching content found.":"\u672A\u627E\u5230\u5339\u914D\u7684\u5185\u5BB9\u3002","The current document has no highlighted content.":"\u5F53\u524D\u6587\u6863\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u3002","No corresponding file found.":"\u672A\u627E\u5230\u76F8\u5E94\u7684\u6587\u4EF6\u3002","Export failed: Failed to load necessary components.":"\u5BFC\u51FA\u5931\u8D25\uFF1A\u52A0\u8F7D\u5FC5\u8981\u7EC4\u4EF6\u5931\u8D25\u3002","All Highlight":"\u5168\u90E8\u9AD8\u4EAE","Export as notes":"\u5BFC\u51FA\u4E3A\u7B14\u8BB0","Add File Comment":"\u6DFB\u52A0\u6587\u4EF6\u8BC4\u8BBA","File Comment":"\u6587\u4EF6\u8BC4\u8BBA","Successfully exported highlights to: ":"\u6210\u529F\u5BFC\u51FA\u9AD8\u4EAE\u5230\uFF1A","Failed to export highlights: ":"\u65E0\u6CD5\u5BFC\u51FA\u9AD8\u4EAE\uFF1A","Default Template":"\u9ED8\u8BA4\u6A21\u677F","Modern minimalist knowledge card style":"\u73B0\u4EE3\u6781\u7B80\u77E5\u8BC6\u5361\u7247\u98CE\u683C","Academic Template":"\u5B66\u672F\u6A21\u677F","Formal style suitable for academic citations":"\u9002\u7528\u4E8E\u5B66\u672F\u5F15\u7528\u7684\u6B63\u5F0F\u98CE\u683C","Social Template":"\u793E\u4EA4\u6A21\u677F","Modern style suitable for social media sharing":"\u9002\u7528\u4E8E\u793E\u4EA4\u5A92\u4F53\u5206\u4EAB\u7684\u73B0\u4EE3\u98CE\u683C","Open AI chat window":"\u6253\u5F00 AI \u5BF9\u8BDD\u7A97\u53E3","Open HiNote window":"\u6253\u5F00 HiNote \u7A97\u53E3","General Settings":"\u901A\u7528\u8BBE\u7F6E","Export Path":"\u5BFC\u51FA\u8DEF\u5F84","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"\u8BBE\u7F6E\u9AD8\u4EAE\u7B14\u8BB0\u7684\u5BFC\u51FA\u8DEF\u5F84\u3002\u7559\u7A7A\u5219\u4F7F\u7528 vault \u6839\u76EE\u5F55\u3002\u8DEF\u5F84\u5E94\u76F8\u5BF9\u4E8E vault \u6839\u76EE\u5F55\u3002",Exclusions:"\u6392\u9664","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"\u9017\u53F7\u5206\u9694\u7684\u8DEF\u5F84\uFF0C\u6807\u7B7E\uFF0C\u7B14\u8BB0\u6807\u9898\u6216\u6587\u4EF6\u6269\u5C55\u540D\uFF0C\u5C06\u4ECE\u9AD8\u4EAE\u4E2D\u6392\u9664\u3002\u4F8B\u5982\uFF1Afolder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"\u81EA\u5B9A\u4E49\u6587\u672C\u63D0\u53D6","Use Custom Pattern":"\u4F7F\u7528\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enable to use a custom regular expression for extracting text.":"\u542F\u7528\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002","Custom Pattern":"\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"\u8F93\u5165\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002\u4F7F\u7528\u6355\u83B7\u7EC4 () \u6307\u5B9A\u8981\u63D0\u53D6\u7684\u6587\u672C\u3002\u7B2C\u4E00\u4E2A\u975E\u7A7A\u6355\u83B7\u7EC4\u5C06\u7528\u4F5C\u63D0\u53D6\u7684\u6587\u672C\u3002","Default Color":"\u9ED8\u8BA4\u989C\u8272","Set the default color for decorators when no color is specified. Leave empty to use system default.":"\u8BBE\u7F6E\u5F53\u672A\u6307\u5B9A\u989C\u8272\u65F6\u7684\u88C5\u9970\u5668\u7684\u9ED8\u8BA4\u989C\u8272\u3002\u7559\u7A7A\u4EE5\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4\u989C\u8272\u3002","Show Comment Widget":"\u663E\u793A\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"\u663E\u793A\u6216\u9690\u85CF\u9AD8\u4EAE\u65C1\u8FB9\u7684\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6\u3002\u7981\u7528\u6B64\u9009\u9879\u53EF\u4EE5\u51CF\u5C11\u9605\u8BFB\u65F6\u7684\u89C6\u89C9\u5E72\u6270\u3002","Export template":"\u5BFC\u51FA\u6A21\u677F","Clean orphaned data":"\u6E05\u7406\u5B64\u7ACB\u6570\u636E","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"\u5220\u9664\u4E0D\u518D\u5B58\u5728\u4E8E\u60A8\u7684\u6587\u6863\u4E2D\u7684\u9AD8\u4EAE\u548C\u6CE8\u91CA\u3002\u8FD9\u5728\u60A8\u5220\u9664\u9AD8\u4EAE\u4F46\u6CE8\u91CA\u4ECD\u7136\u5B58\u50A8\u5728\u6570\u636E\u6587\u4EF6\u4E2D\u65F6\u5F88\u6709\u7528\u3002","Flashcard learning":"\u95EA\u5361\u5B66\u4E60\u8BBE\u7F6E","New cards per day":"\u6BCF\u65E5\u65B0\u5361\u7247\u6570\u91CF","Maximum number of new cards to learn each day":"\u6BCF\u5929\u5B66\u4E60\u7684\u65B0\u5361\u7247\u6700\u5927\u6570\u91CF","Reviews per day":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF","Maximum number of cards to review each day":"\u6BCF\u5929\u590D\u4E60\u7684\u5361\u7247\u6700\u5927\u6570\u91CF","Target retention":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387","Target memory retention rate (0.8 = 80%)":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387\uFF080.8 = 80%\uFF09","Maximum interval":"\u6700\u5927\u95F4\u9694","Maximum interval in days between reviews":"\u590D\u4E60\u4E4B\u95F4\u7684\u6700\u5927\u95F4\u9694\u5929\u6570","Reset daily stats":"\u91CD\u7F6E\u4ECA\u65E5\u7EDF\u8BA1","Reset today's learning statistics":"\u91CD\u7F6E\u4ECA\u5929\u7684\u5B66\u4E60\u7EDF\u8BA1\u6570\u636E",Reset:"\u91CD\u7F6E","Daily statistics have been reset":"\u4ECA\u65E5\u7EDF\u8BA1\u5DF2\u91CD\u7F6E","No statistics to reset for today":"\u4ECA\u5929\u6CA1\u6709\u53EF\u91CD\u7F6E\u7684\u7EDF\u8BA1\u6570\u636E",Advanced:"\u9AD8\u7EA7\u8BBE\u7F6E","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"\u8FD9\u4E9B\u8BBE\u7F6E\u63A7\u5236FSRS\u7B97\u6CD5\u53C2\u6570\u3002\u4EC5\u5728\u7406\u89E3\u7B97\u6CD5\u7684\u60C5\u51B5\u4E0B\u66F4\u6539\u5B83\u4EEC\u3002","Reset algorithm parameters":"\u91CD\u7F6E\u7B97\u6CD5\u53C2\u6570","Reset the FSRS algorithm parameters to default values":"\u5C06FSRS\u7B97\u6CD5\u53C2\u6570\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","Reset to default":"\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","FSRS parameters have been reset to default values":"FSRS\u53C2\u6570\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",days:"\u5929","FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation.":"\u7B97\u6CD5\u6743\u91CD\u53C2\u6570\u3002\u9ED8\u8BA4\u503C\u4E3A\u8F83\u5C0F\u6837\u672C\u83B7\u5F97\uFF0C\u5982\u679C\u9700\u8981\u8C03\u6574\u8BF7\u4F7F\u7528 FSRS \u4F18\u5316\u5668\u8BA1\u7B97","FSRS parameters":"FSRS \u53C2\u6570","Edit the 17 FSRS algorithm weights. Format: JSON array of numbers.":"\u7F16\u8F91 17 \u4E2A FSRS \u7B97\u6CD5\u6743\u91CD\u3002\u683C\u5F0F\uFF1A\u6570\u5B57\u6570\u7EC4\u7684 JSON \u683C\u5F0F\u3002","FSRS parameters updated successfully":"FSRS \u53C2\u6570\u66F4\u65B0\u6210\u529F","Activate HiCard":"\u6FC0\u6D3B HiCard","Enter your license key to activate HiCard feature.":"\u8F93\u5165\u60A8\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5\u4EE5\u6FC0\u6D3B HiCard \u529F\u80FD\u3002","Enter license key":"\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5",Activate:"\u6FC0\u6D3B","Please enter a license key":"\u8BF7\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5","HiCard activated successfully!":"HiCard \u6FC0\u6D3B\u6210\u529F\uFF01","Invalid license key":"\u65E0\u6548\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5","Use global settings":"\u4F7F\u7528\u5168\u5C40\u8BBE\u7F6E","New cards per day:":"\u6BCF\u65E5\u65B0\u5361\u6570\u91CF:","Reviews per day:":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF:","Create group":"\u521B\u5EFA\u5206\u7EC4",Create:"\u521B\u5EFA",Again:"\u91CD\u6765",Hard:"\u56F0\u96BE",Good:"\u826F\u597D",Easy:"\u7B80\u5355",Card:"\u5361\u7247",of:"\u5171",Settings:"\u8BBE\u7F6E","Are you sure you want to delete this group?":"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5206\u7EC4\u5417\uFF1F",Yes:"\u662F",No:"\u5426","You've completed All cards for today!":"\u60A8\u4ECA\u5929\u5DF2\u5B8C\u6210\u6240\u6709\u5361\u7247\uFF01","No cards available.":"\u6CA1\u6709\u53EF\u7528\u7684\u5361\u7247\u3002","Return to First Card":"\u8FD4\u56DE\u7B2C\u4E00\u5F20\u5361\u7247","Edit Group":"\u7F16\u8F91\u5206\u7EC4","Create New Group":"\u521B\u5EFA\u65B0\u5206\u7EC4","Please fill in all fields":"\u8BF7\u586B\u5199\u6240\u6709\u5B57\u6BB5","Saving...":"\u4FDD\u5B58\u4E2D...","Creating...":"\u521B\u5EFA\u4E2D...","Group updated successfully":"\u5206\u7EC4\u66F4\u65B0\u6210\u529F","Failed to update group":"\u5206\u7EC4\u66F4\u65B0\u5931\u8D25","Group created successfully":"\u5206\u7EC4\u521B\u5EFA\u6210\u529F","Failed to create or update group":"\u521B\u5EFA\u6216\u66F4\u65B0\u5206\u7EC4\u5931\u8D25",Retention:"\u4FDD\u7559\u7387","Limits:":"\u9650\u5236\uFF1A","Learning completed!":"\u5B66\u4E60\u5B8C\u6210\uFF01","Group deleted":"\u5206\u7EC4\u5DF2\u5220\u9664","search-prefix-all":"\u8DE8\u6587\u4EF6\u641C\u7D22\u6240\u6709\u9AD8\u4EAE","search-prefix-hicard":"\u53EA\u641C\u7D22\u95EA\u5361\u9AD8\u4EAE","search-prefix-comment":"\u53EA\u641C\u7D22\u5E26\u6279\u6CE8\u7684\u9AD8\u4EAE","search-prefix-path":"\u6309\u6587\u4EF6\u8DEF\u5F84\u641C\u7D22\u9AD8\u4EAE","Open (double-click)":"\u53CC\u51FB\u6253\u5F00"};var fo={en:uo,zh:po};function f(y){let t=(mo.moment.locale().startsWith("zh")?fo.zh:fo.en)[y];return t||y}var BA=require("obsidian");var as=class{constructor(e,A){this.containerEl=e,this.fsrsManager=A}render(){this.containerEl.empty(),this.containerEl.addClass("flashcard-stats-panel"),this.renderStatsArea(),this.renderHeatmap()}renderStatsArea(){let e=this.containerEl.createDiv("flashcard-stats-area"),A=this.fsrsManager.getProgress();this.createStatItem(e,A.newCards.toString(),"New","flashcard-stat-new"),this.createStatItem(e,A.learned.toString(),"Learning","flashcard-stat-learning"),this.createStatItem(e,A.due.toString(),"Review","flashcard-stat-due")}createStatItem(e,A,t,s){let o=e.createDiv(`flashcard-stat-item ${s}`),l=o.createDiv("flashcard-stat-value");l.textContent=A;let c=o.createDiv("flashcard-stat-label");c.textContent=t}renderHeatmap(){var e;this.createHeatmap(this.containerEl,((e=this.fsrsManager.storage)==null?void 0:e.dailyStats)||[])}createHeatmap(e,A){let t=e.createDiv("flashcard-heatmap-grid"),s=new Date;new Date(s).setDate(s.getDate()-83);let l=new Map,c=new Date(s);c.setHours(0,0,0,0);let d=c.getTime(),g=`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`,u=!1;[...A].forEach(D=>{let N=new Date(D.date),W=N.getFullYear(),sA=N.getMonth()+1,J=N.getDate(),cA=`${W}-${sA}-${J}`;cA===g&&(u=!0),l.set(cA,D)}),u||l.set(g,{date:d,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0});let w=7,F=12;t.style.display="grid",t.style.gridTemplateRows=`repeat(${w}, 1fr)`,t.style.gridTemplateColumns=`repeat(${F}, 1fr)`;let Q=s.getDay(),E=Q===0?6:Q-1,H=new Date(s);H.setDate(s.getDate()-((Q===0?7:Q)-1));let b=new Date(H);b.setDate(b.getDate()-11*7);let K=[],M=[];for(let D=0;D<F;D++){let N=new Date(b);N.setDate(N.getDate()+D*7),M.push(N)}for(let D=0;D<F;D++){let N=[];for(let W=0;W<w;W++){let sA=new Date(M[D]);sA.setDate(sA.getDate()+W),N.push(sA)}K.push(N)}for(let D=0;D<w;D++)for(let N=0;N<F;N++){let W=K[N][D],sA=W.getFullYear(),J=W.getMonth()+1,cA=W.getDate(),wA=`${sA}-${J}-${cA}`,eA=l.get(wA),Z=t.createDiv("flashcard-heatmap-cell"),TA=wA===g;if(eA){let vA=eA.newCardsLearned*1.5+eA.cardsReviewed;if(eA.reviewCount>0){let YA=(eA.againCount*1.5+eA.hardCount*1.2+eA.goodCount+eA.easyCount*.8)/eA.reviewCount;vA=vA*(YA+.5)}vA=Math.min(vA,20);let JA=Math.ceil(vA/4);Z.addClass(`flashcard-heatmap-level-${JA}`);let ZA=`${W.toLocaleDateString()}: Learned ${eA.newCardsLearned} new cards, reviewed ${eA.cardsReviewed} cards`;eA.reviewCount>0&&(ZA+=`
Rating distribution: Again(${eA.againCount}), Hard(${eA.hardCount}), Good(${eA.goodCount}), Easy(${eA.easyCount})`),Z.setAttribute("title",ZA)}else TA||W>s,Z.addClass("flashcard-heatmap-level-0")}}addZoomControl(e,A){}};var os=class{constructor(e){this.isMobileView=!1;this.isSmallScreen=!1;this.showingSidebar=!0;this.isInFlashcardMode=!1;this.component=e,this.isMobileView=BA.Platform.isMobile,this.isSmallScreen=window.innerWidth<768,this.showingSidebar=this.isMobileView,this.isInFlashcardMode=!0}renderActivation(){let e=this.component.getContainer();e.empty(),e.addClass("flashcard-mode");let A=e.createEl("div",{cls:"flashcard-activation-container"}),t=A.createEl("div",{cls:"flashcard-activation-header",text:f("Activate HiCard")}),s=A.createEl("div",{cls:"flashcard-activation-description",text:f("Enter your license key to activate HiCard feature.")}),o=A.createEl("div",{cls:"flashcard-activation-input-container"}),l=o.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:f("Enter license key")});o.createEl("button",{cls:"flashcard-activation-button",text:f("Activate")}).addEventListener("click",async()=>{let d=l.value.trim();if(!d){new BA.Notice(f("Please enter a license key"));return}await this.component.getLicenseManager().activateLicense(d)?(new BA.Notice(f("HiCard activated successfully!")),this.render()):new BA.Notice(f("Invalid license key"))})}toggleSidebar(){this.showingSidebar=!this.showingSidebar,this.render()}isShowingSidebar(){return this.showingSidebar}showSidebar(){this.showingSidebar=!0;let e=this.component.getContainer();this.isMobileView&&this.isSmallScreen&&(e.addClass("show-sidebar"),e.removeClass("show-content")),this.render()}goBack(){this.isMobileView&&this.isSmallScreen&&(this.showingSidebar?this.component&&this.component.commentView&&(this.component.commentView.isFlashcardMode=!1,this.component.commentView.isShowingFileList=!0,this.component.commentView.updateViewLayout()):(this.showingSidebar=!0,this.render()))}render(){let e=this.component.getContainer();if(e.empty(),e.addClass("flashcard-mode"),this.isMobileView&&(e.addClass("is-mobile"),this.isSmallScreen&&e.addClass("is-small-screen"),this.showingSidebar?e.addClass("show-sidebar"):e.addClass("show-content")),!this.isMobileView||this.isMobileView&&!this.showingSidebar){let M=e.createEl("div",{cls:"flashcard-progress-container"});this.component.setProgressContainer(M),this.component.updateProgress()}let A=e.createEl("div",{cls:"flashcard-main-container"}),t=A.createEl("div",{cls:"flashcard-sidebar"}),s=t.createEl("div",{cls:"flashcard-stats-container"});new as(s,this.component.getFsrsManager()).render();let l=t.createEl("div",{cls:"flashcard-groups"}),d=l.createEl("div",{cls:"flashcard-groups-header"}).createEl("div",{cls:"flashcard-add-group",attr:{"aria-label":f("Add Group")}});(0,BA.setIcon)(d,"plus"),d.addEventListener("click",()=>this.component.getGroupManager().showCreateGroupModal());let g=l.createEl("div",{cls:"flashcard-group-list"});(this.component.getFsrsManager().getCardGroups()||[]).forEach(M=>{let D=g.createEl("div",{cls:`flashcard-group-item ${M.name===this.component.getCurrentGroupName()?"active":""}`}),N=D.createEl("div",{cls:"flashcard-group-item-header"}),W=N.createEl("div",{cls:"flashcard-group-title"}),sA=W.createEl("span",{cls:"flashcard-group-icon"});(0,BA.setIcon)(sA,M.filter.startsWith("#")?"hash":"gallery-horizontal-end"),W.createEl("span",{cls:"flashcard-group-name",text:M.name});let J=N.createEl("div",{cls:"flashcard-group-actions"}),cA=J.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":f("Edit Group")}});(0,BA.setIcon)(cA,"edit"),cA.addEventListener("click",Z=>{Z.stopPropagation(),this.component.getGroupManager().showEditGroupModal(M)});let wA=J.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":f("Delete Group")}});(0,BA.setIcon)(wA,"trash"),wA.addEventListener("click",async Z=>{if(Z.stopPropagation(),confirm(f('Are you sure you want to delete group "')+M.name+f('"?')))try{if(await this.component.getFsrsManager().deleteCardGroup(M.id)){if(this.component.getCurrentGroupName()===M.name){let vA=this.component.getFsrsManager().getCardGroups()||[];vA.length>0?this.component.setCurrentGroupName(vA[0].name):this.component.setCurrentGroupName("")}new BA.Notice(f("Group deleted")),this.render()}else new BA.Notice(f("Delete group failed"))}catch(TA){console.error("Delete group failed:",TA),new BA.Notice(f("Delete group failed"))}});let eA=this.component.getFsrsManager().getGroupProgress(M.id);if(eA){let Z=D.createEl("div",{cls:"flashcard-group-stats"}),TA=Z.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":f("Due Today")}}),vA=TA.createEl("span",{cls:"flashcard-stat-icon"});(0,BA.setIcon)(vA,"calendar-clock"),TA.createEl("span",{text:eA.due.toString()});let JA=Z.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":f("New Cards")}}),ZA=JA.createEl("span",{cls:"flashcard-stat-icon"});(0,BA.setIcon)(ZA,"sparkle"),JA.createEl("span",{text:eA.newCards.toString()});let YA=Z.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":f("Learned")}}),Ie=YA.createEl("span",{cls:"flashcard-stat-icon"});(0,BA.setIcon)(Ie,"check-small"),YA.createEl("span",{text:eA.learned.toString()})}D.addEventListener("click",()=>{this.component.setGroupCompletionMessage(this.component.getCurrentGroupName(),this.component.getCompletionMessage());let Z={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()};this.component.setCurrentGroupName(M.name),e.querySelectorAll(".flashcard-group-item").forEach(JA=>JA.classList.remove("active")),D.classList.add("active"),this.component.setCompletionMessage(this.component.getGroupCompletionMessage(M.name)||null),this.component.refreshCardList();let vA=this.component.getGroupProgress(M.name);vA&&!this.component.getCompletionMessage()?(this.component.setCurrentIndex(vA.currentIndex),this.component.setCardFlipped(vA.isFlipped)):(this.component.setCurrentIndex(0),this.component.setCardFlipped(!1)),this.isMobileView&&(this.showingSidebar=!1),this.component.saveState(),this.render()})});let w=A.createEl("div",{cls:"flashcard-content-area"}).createEl("div",{cls:"flashcard-container"}),F=this.component.getCards(),Q=this.component.getCurrentIndex(),E=F.length>0&&Q<F.length?F[Q]:null,H=this.component.getCurrentGroupName(),b=this.component.getGroupCompletionMessage(H),K=this.component.getFsrsManager().getCardGroups().length>0;if(!K||F.length===0){let M=this.component.getFsrsManager().getCardGroups().find(N=>N.name===H),D=M&&M.cardIds.length===0;if(K)if(D){let N=w.createEl("div",{cls:"flashcard-completion-message flashcard-empty-group"}),W=N.createEl("div",{cls:"completion-icon"});(0,BA.setIcon)(W,"circle-slash-2"),N.createEl("h3",{text:f("No Cards in This Group")}),N.createEl("p",{text:f("This group doesn't contain any flashcards yet. Add some flashcards to this group to start learning.")})}else{let N=w.createEl("div",{cls:"flashcard-completion-message"}),W=N.createEl("div",{cls:"completion-icon"});(0,BA.setIcon)(W,"check-circle"),N.createEl("h3",{text:f("Learning Completed!")});let sA=b;sA||(M?sA=f("Group completed: ")+M.name+f(". All cards have been reviewed."):sA=f("All flashcards completed for today!"),this.component.setGroupCompletionMessage(H,sA)),N.createEl("p",{text:sA})}else{let N=w.createEl("div",{cls:"flashcard-completion-message flashcard-no-group"}),W=N.createEl("div",{cls:"completion-icon"});(0,BA.setIcon)(W,"folder-plus"),N.createEl("h3",{text:f("No Flashcard Groups")}),N.createEl("p",{text:f("You haven't created any flashcard groups yet. Create a group to get started with your flashcards.")}),N.createEl("button",{cls:"mod-cta",text:f("Create Flashcard Group")}).addEventListener("click",()=>{this.component&&this.component.groupManager?this.component.groupManager.showCreateGroupModal():console.error("Group manager is not available")})}return}if(E){let M=["flashcard"];this.component.isCardFlipped()&&M.push("is-flipped");let D=w.createEl("div",{cls:M.join(" ")}),sA=this.component.getFsrsManager().getCardGroups().filter(xA=>this.component.getFsrsManager().getCardsInGroup(xA).some(fA=>fA.id===(E==null?void 0:E.id))).some(xA=>xA.isReversed),J=sA?E.answer:E.text,cA=sA?E.text:E.answer,eA=D.createEl("div",{cls:"flashcard-side flashcard-front"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(eA,J,E.filePath);let TA=D.createEl("div",{cls:"flashcard-side flashcard-back"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(TA,cA,E.filePath),D.addEventListener("click",()=>this.component.flipCard());let vA=w.createEl("div",{cls:"flashcard-rating"}),JA=E?this.component.getFsrsManager().getCardPredictions(E.id):null;this.component.getRatingButtons().forEach(xA=>{let ne=vA.createEl("button",{cls:"flashcard-rating-button",attr:{"data-rating":xA.ratingText,title:`${xA.label} (${xA.key})`}});if(ne.createSpan({text:xA.label}),JA&&JA[xA.rating]){let fA=new Date(JA[xA.rating].nextReview),KA=new Date,DA=fA.getTime()-KA.getTime(),zA=ne.createSpan({cls:"prediction-info"}),yA="";if(DA<60*60*1e3)yA=`${Math.max(1,Math.round(DA/6e4))}m`;else if(DA<24*60*60*1e3)yA=`${Math.round(DA/36e5)}h`;else{let RA=Math.round(DA/864e5);RA<1?yA=`${Math.round(RA*24)}h`:RA<30?yA=`${Math.round(RA)}d`:RA<365?yA=`${Math.round(RA/30)}mo`:yA=`${Math.round(RA/365)}y`}zA.createSpan({text:yA,cls:"days"})}else{let fA=0,KA=(E==null?void 0:E.reviews)===0,DA=(E==null?void 0:E.lapses)>0;switch(xA.rating){case gA.AGAIN:fA=KA?.25:DA?.5:1;break;case gA.HARD:fA=KA?24:DA?36:48;break;case gA.GOOD:fA=KA?24*3:DA?24*5:24*7;break;case gA.EASY:fA=KA?24*5:DA?24*9:24*14;break}let zA=fA/24,yA="";fA<1?yA=`${Math.round(fA*60)}m`:fA<24?yA=`${Math.round(fA)}h`:zA<1?yA=`${Math.round(zA*24)}h`:zA<30?yA=`${Math.round(zA)}d`:zA<365?yA=`${Math.round(zA/30)}mo`:yA=`${Math.round(zA/365)}y`,ne.createSpan({text:yA,cls:"days"})}ne.addEventListener("click",fA=>{fA.stopPropagation(),this.component.rateCard(xA.rating)})}),this.component.isCardFlipped()&&D.classList.add("is-flipped");let ZA=this.component.getCurrentGroupId(),YA=F.length,Ie=this.component.getFsrsManager(),HA=(ZA?Ie.getCardsForStudy(ZA):[]).length,Ke=Math.max(HA,YA),Re=Ke-YA+1;if(w.createEl("div",{cls:"flashcard-counter",text:`${Re}/${Ke}`}),E.filePath){let ne=w.createEl("div",{cls:"flashcard-source"}).createEl("span",{text:E.filePath.split("/").pop()||""});this.component.getUtils().addPagePreview(ne,E.filePath),ne.addEventListener("click",fA=>{fA.stopPropagation();let KA=this.component.getApp().vault.getAbstractFileByPath(E.filePath);KA&&KA instanceof BA.TFile&&this.component.getApp().workspace.getLeaf().openFile(KA)})}}else w.createEl("div",{cls:"flashcard-empty-state",text:f("No cards available")})}async renderMarkdownContent(e,A,t){for(;e.firstChild;)e.removeChild(e.firstChild);if(!A){console.warn("renderMarkdownContent: content is empty or undefined"),e.textContent="Add answer";return}let s=e.closest(".flashcard-front")!==null,o=A;s?o=A.replace(/\{\{([^{}]+)\}\}/g,(l,c)=>{let g=c.split("").reduce((m,w)=>{let F=/[\u4e00-\u9fa5]/.test(w);return m+(F?3:1)},0);return c.length>5&&(g=Math.floor(g*1.2)),"_".repeat(Math.max(8,g))}):o=A.replace(/\{\{([^{}]+)\}\}/g,"$1");try{await BA.MarkdownRenderer.render(this.component.getApp(),o,e,t||"",new BA.Component),e.querySelectorAll("ul, ol").forEach(c=>{c.addClass("flashcard-markdown-list")}),s&&e.querySelectorAll("p").forEach(d=>{d.textContent&&d.textContent.includes("______")&&d.addClass("flashcard-cloze")})}catch(l){console.error("Error rendering markdown in flashcard:",l),e.textContent=o}}};var ls=class{constructor(e){this.component=e}flipCard(){let e=!this.component.isCardFlipped();this.component.setCardFlipped(e);let A=document.querySelector(".flashcard");A&&(e?A.classList.add("is-flipped"):A.classList.remove("is-flipped")),this.component.saveState()}nextCard(){let e=this.component.getCards();if(e.length===0)return;let A=this.component.getCurrentIndex()+1;A>=e.length&&(A=0),this.component.setCurrentIndex(A),this.component.setCardFlipped(!1),this.component.saveState(),this.component.getRenderer().render()}rateCard(e){let A=this.component.getCards(),t=this.component.getCurrentIndex();if(A.length===0||t>=A.length)return;let s=A[t];if(s){if(this.component.getFsrsManager().trackStudyProgress(s.id,e),A.splice(t,1),A.length===0){let o=this.component.getCurrentGroupName(),l=f("No cards due for review");if(o){let c=this.component.getFsrsManager().getCardGroups().find(d=>d.name===o);c&&(l=f("Group completed: ")+c.name+f(". Add more cards in Settings, but remember: more cards = more reviews."))}else l=f("All flashcards completed for today!");this.component.setGroupCompletionMessage(o,l),this.component.updateProgress(),this.component.getRenderer().render();return}t>=A.length&&this.component.setCurrentIndex(0),this.component.setCardFlipped(!1),this.component.saveState(),this.component.updateProgress(),this.component.getRenderer().render()}}refreshCardList(){let e=this.component.getCurrentGroupName(),A=this.component.getFsrsManager(),t=this.component.getCards(),s=this.component.getCurrentGroupName();if(t.length>0&&s&&s!==e){let w=this.component.getCards(),F=this.component.getCurrentIndex(),Q=w.length>0&&F<w.length?w[F].id:void 0,E={currentIndex:F,isFlipped:this.component.isCardFlipped(),currentCardId:Q},H=A.getUIState();H.groupProgress||(H.groupProgress={}),H.groupProgress[s]=E,A.updateUIState(H)}let o=A.getCardGroups().find(w=>w.name===e);if(!o){console.error(`\u672A\u627E\u5230\u540D\u79F0\u4E3A ${e} \u7684\u5206\u7EC4`);return}let l=A.getCardsByGroupId(o.id),c=A.fsrsService,d=l.filter(w=>!!(w.reviews===0&&w.lastReview===0||c.isDue(w)));if(d.length===0){let w=f("No cards due for review");e?w=f("Group completed: ")+o.name+f(". Add more cards in Settings, but remember: more cards = more reviews."):w=f("All flashcards completed for today!"),this.component.setGroupCompletionMessage(e,w),this.component.setCards([]),this.component.updateProgress();let F=A.getUIState();F.groupProgress||(F.groupProgress={}),F.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:null,completionMessage:w},A.updateUIState(F),this.component.getRenderer().render(),this.component.saveState();return}let g=d,u=this.component.getGroupProgress(e),m=A.getUIState();if(m.groupProgress||(m.groupProgress={}),m.groupProgress[e]?m.groupProgress[e].completionMessage=void 0:m.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0},A.updateUIState(m),this.component.setCards(g),g.length>0)if(u){let w=0;if(u.currentCardId){let F=g.findIndex(Q=>Q.id===u.currentCardId);F!==-1?w=F:w=Math.min(u.currentIndex,g.length-1)}else w=Math.min(u.currentIndex,g.length-1);this.component.setCurrentIndex(w),this.component.setCardFlipped(u.isFlipped)}else this.component.setCurrentIndex(0),this.component.setCardFlipped(!1);else{let w=f("No cards due for review");if(e){let F=A.getCardGroups().find(Q=>Q.name===e);F&&(w=f("Group completed: ")+F.name+f(". Add more cards in Settings, but remember: more cards = more reviews."))}else w=f("All flashcards completed for today!");this.component.setGroupCompletionMessage(e,w)}this.component.saveState()}};var si=require("obsidian");var cs=class{constructor(e){this.component=e}showCreateGroupModal(){this.showEditGroupModal()}showEditGroupModal(e){var yA,RA,Dt;let{app:A}=this.component.getApp(),t=document.createElement("div");t.className="flashcard-modal-overlay",document.body.appendChild(t);let s=document.createElement("div");s.className="flashcard-modal-container",t.appendChild(s);let o=document.createElement("div");o.className="flashcard-modal-content",s.appendChild(o);let l=document.createElement("div");l.className="flashcard-modal-header",o.appendChild(l);let c=document.createElement("h3");c.textContent=e?f("Edit group"):f("Create group"),l.appendChild(c);let d=document.createElement("div");d.className="flashcard-group-form",o.appendChild(d);let g=e?e.name:"",u=document.createElement("input");u.type="text",u.className="flashcard-modal-input",u.placeholder=f("Enter name"),u.value=g,d.appendChild(u),u.addEventListener("input",FA=>{g=FA.target.value});let m=e?e.filter:"",w=document.createElement("textarea");w.className="flashcard-modal-input",w.placeholder=f(`Support format: 
Folder: folder1, folder1/folder2
Note: [[note1]], [[note2]]`),w.value=m,d.appendChild(w),w.addEventListener("input",FA=>{m=FA.target.value});let F=e&&e.isReversed||!1,Q=document.createElement("div");Q.className="flashcard-modal-option",d.appendChild(Q);let E=document.createElement("input");E.type="checkbox",E.className="flashcard-modal-checkbox",E.checked=F,Q.appendChild(E);let H=document.createElement("label");H.textContent=f("Reverse cards (use comments as questions)"),H.className="flashcard-modal-label",Q.appendChild(H),E.addEventListener("change",FA=>{F=FA.target.checked});let b=document.createElement("div");b.className="flashcard-modal-settings",d.appendChild(b);let K=document.createElement("div");K.className="flashcard-modal-settings-header",b.appendChild(K);let M=document.createElement("h4");M.textContent=f("Learning settings"),M.className="settings-title",K.appendChild(M);let D=e?((yA=e.settings)==null?void 0:yA.useGlobalSettings)!==!1:!0,N=document.createElement("div");N.className="flashcard-modal-option use-global-option",K.appendChild(N);let W=document.createElement("input");W.type="checkbox",W.className="flashcard-modal-checkbox",W.id="use-global-settings",W.checked=D,N.appendChild(W);let sA=document.createElement("label");sA.textContent=f("Use global settings"),sA.className="flashcard-modal-label",sA.htmlFor="use-global-settings",N.appendChild(sA),W.addEventListener("change",FA=>{D=FA.target.checked,ne()});let J=e&&((RA=e.settings)==null?void 0:RA.newCardsPerDay)||20,cA=document.createElement("div");cA.className="flashcard-modal-option slider-option",b.appendChild(cA);let wA=document.createElement("label");wA.textContent=f("New cards per day: "),wA.className="flashcard-modal-label",cA.appendChild(wA);let eA=document.createElement("div");eA.className="slider-with-value",cA.appendChild(eA);let Z=document.createElement("input");Z.className="flashcard-modal-slider",Z.type="range",Z.min="5",Z.max="100",Z.step="5",Z.value=String(J);let TA=parseInt(Z.value);TA<5?Z.value="5":TA%5!==0&&(Z.value=(Math.round(TA/5)*5).toString()),eA.appendChild(Z);let vA=document.createElement("span");vA.className="slider-value",vA.textContent=Z.value,eA.appendChild(vA),Z.addEventListener("input",()=>{J=parseInt(Z.value),vA.textContent=Z.value});let JA={setDisabled:FA=>{Z.disabled=FA,cA.classList.toggle("disabled",FA)}},ZA=e&&((Dt=e.settings)==null?void 0:Dt.reviewsPerDay)||100,YA=document.createElement("div");YA.className="flashcard-modal-option slider-option",b.appendChild(YA);let Ie=document.createElement("label");Ie.textContent=f("Reviews per day: "),Ie.className="flashcard-modal-label",YA.appendChild(Ie);let Pe=document.createElement("div");Pe.className="slider-with-value",YA.appendChild(Pe);let HA=document.createElement("input");HA.className="flashcard-modal-slider",HA.type="range",HA.min="10",HA.max="500",HA.step="10",HA.value=String(ZA);let Ke=parseInt(HA.value);Ke<10?HA.value="10":Ke%10!==0&&(HA.value=(Math.round(Ke/10)*10).toString()),Pe.appendChild(HA);let Re=document.createElement("span");Re.className="slider-value",Re.textContent=HA.value,Pe.appendChild(Re),HA.addEventListener("input",()=>{ZA=parseInt(HA.value),Re.textContent=HA.value});let xA={setDisabled:FA=>{HA.disabled=FA,YA.classList.toggle("disabled",FA)}},ne=()=>{D?(JA.setDisabled(!0),xA.setDisabled(!0)):(JA.setDisabled(!1),xA.setDisabled(!1))};ne();let fA=document.createElement("div");fA.className="button-container",o.appendChild(fA);let KA=document.createElement("button");KA.className="flashcard-cancel-btn",KA.textContent=f("Cancel"),fA.appendChild(KA);let DA=document.createElement("button");DA.className="flashcard-save-group-btn",DA.textContent=e?f("Save"):f("Create"),fA.appendChild(DA),DA.addEventListener("click",async()=>{if(!g){new si.Notice(f("Group name cannot be empty"));return}let FA=this.component.getFsrsManager();if(e){let me=e.name;try{await FA.updateCardGroup(e.id,{name:g,filter:m,isReversed:F,settings:{useGlobalSettings:D,newCardsPerDay:D?void 0:J,reviewsPerDay:D?void 0:ZA},lastUpdated:Date.now()});let bA=FA.storage;bA&&bA.uiState&&(bA.uiState.groupCompletionMessages&&bA.uiState.groupCompletionMessages[me]!==void 0&&(bA.uiState.groupCompletionMessages[g]=bA.uiState.groupCompletionMessages[me],delete bA.uiState.groupCompletionMessages[me]),bA.uiState.groupProgress&&bA.uiState.groupProgress[me]&&(bA.uiState.groupProgress[g]=bA.uiState.groupProgress[me],delete bA.uiState.groupProgress[me]),bA.uiState.currentGroupName===me&&(bA.uiState.currentGroupName=g),await FA.saveStoragePublic()),this.component.getCurrentGroupName()===me&&this.component.setCurrentGroupName(g),this.component.refreshCardList(),this.component.getRenderer().render(),new si.Notice(f("Group update successful"))}catch(bA){console.error("Update group failed:",bA),new si.Notice(f("Update group failed"))}}else await FA.createCardGroup({name:g,filter:m,isReversed:F,createdTime:Date.now(),sortOrder:FA.getCardGroups().length,settings:{useGlobalSettings:D,newCardsPerDay:D?void 0:J,reviewsPerDay:D?void 0:ZA}}),new si.Notice(f("Group created")),this.component.refreshCardList(),this.component.getRenderer().render();document.body.removeChild(t),e&&this.component.getRenderer().render()});let zA=FA=>{FA.key==="Escape"&&(document.body.removeChild(t),document.removeEventListener("keydown",zA))};document.addEventListener("keydown",zA),KA.addEventListener("click",()=>{document.body.removeChild(t),e&&this.component.getRenderer().render()})}};var Bo=require("obsidian"),hs=class{constructor(e){this.component=e}getGroupProgress(){let e=this.component.getCurrentGroupId(),A=[];e?A=this.component.getFsrsManager().getCardsByGroupId(e):A=(()=>{let d=this.component.getFsrsManager(),g=d.getCardGroups(),u=[],m=new Set;return g.forEach(w=>{d.getCardsByGroupId(w.id).forEach(Q=>{m.has(Q.id)||(m.add(Q.id),u.push(Q))})}),u})();let s=A.filter(d=>this.component.getFsrsManager().fsrsService.isDue(d)).length,o=A.filter(d=>d.reviews===0).length,l=A.filter(d=>d.reviews>0).length,c=this.calculateRetention(A);return{due:s,newCards:o,learned:l,retention:c}}calculateRetention(e){let A=e.filter(s=>s.reviews>0);return A.length===0?1:A.reduce((s,o)=>s+o.retrievability,0)/A.length}updateProgress(){let e=this.component.getProgressContainer();if(!e)return;e.empty();let A=this.getGroupProgress(),t=e.createEl("div",{cls:"flashcard-progress-text"});t.createSpan({text:this.component.getCurrentGroupName()||f("Groups"),cls:"group-name"}),t.createSpan({text:"|",cls:"separator"}),[{label:f("Due"),value:A.due},{label:f("New"),value:A.newCards},{label:f("Learned"),value:A.learned},{label:f("Retention"),value:`${(A.retention*100).toFixed(1)}%`}].forEach((H,b)=>{b>0&&t.createSpan({text:"|",cls:"separator"});let K=t.createEl("div",{cls:"stat"});if(K.createSpan({text:H.label+": "}),K.createSpan({text:H.value.toString(),cls:"stat-value"}),H.label===f("Retention")){let M=K.createSpan({cls:"help-icon"});(0,Bo.setIcon)(M,"help-circle"),M.setAttribute("aria-label",f(`Retention = (Total Reviews - Forget Count) / Total Reviews
This metric reflects your learning effectiveness, higher means better memory retention`))}});let l=e.createEl("div",{cls:"flashcard-progress-bar-container"}).createEl("div",{cls:"flashcard-progress-bar"}),c=A.due+A.newCards,d=this.component.getCards().length,g=c>0?Math.round((c-d)/c*100):100;if(l.style.width=`${g}%`,this.component.getCurrentGroupName()){let H=this.component.getFsrsManager().getCardGroups().find(b=>b.id===this.component.getCurrentGroupName());if(H){let b=e.createEl("div",{cls:"flashcard-group-name-container"});b.createEl("div",{cls:"flashcard-group-name",text:H.name}),H.filter&&b.createEl("div",{cls:"flashcard-group-filter",text:f("Filter")+": "+H.filter})}}let u=e.createEl("div",{cls:"flashcard-index-container"}),m=this.component.getCurrentGroupId(),w=this.component.getCards().length,F=this.component.getFsrsManager(),E=(m?F.getCardsForStudy(m):[]).length;if(E>0||w>0){let H=Math.max(E,w),b=H-w+1;w>0?u.textContent=`${b}/${H}`:u.textContent=`${H}/${H}`}else u.textContent="0/0"}saveState(){let e=this.component.getCurrentGroupName(),A=this.component.getFsrsManager().getUIState();A.currentGroupName=e,A.currentIndex=this.component.getCurrentIndex(),A.isFlipped=this.component.isCardFlipped(),A.completionMessage=this.component.getCompletionMessage(),A.groupProgress||(A.groupProgress={}),A.groupProgress[e]={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()},A.groupCompletionMessages||(A.groupCompletionMessages={}),A.groupCompletionMessages[e]=this.component.getGroupCompletionMessage(e),this.component.getFsrsManager().updateUIState(A)}};var ds=class{constructor(e){this.component=e}addPagePreview(e,A){if(!A)return;let t;e.addEventListener("mouseenter",s=>{t=setTimeout(()=>{let o=s.target;this.component.getApp().workspace.trigger("hover-link",{event:s,source:"hi-note",hoverParent:o,targetEl:o,linktext:A})},300)}),e.addEventListener("mouseleave",()=>{t&&clearTimeout(t)})}};var ri=class extends wo.Component{constructor(A,t){super();this.progressContainer=null;this.currentIndex=0;this.isFlipped=!1;this.cards=[];this.isActive=!1;this.currentCard=null;this.currentGroupName="";this.currentGroupId="";this.completionMessage=null;this.groupProgress={};this.ratingButtons=[{label:f("Again"),rating:gA.AGAIN,key:"1",ratingText:"again"},{label:f("Hard"),rating:gA.HARD,key:"2",ratingText:"hard"},{label:f("Good"),rating:gA.GOOD,key:"3",ratingText:"good"},{label:f("Easy"),rating:gA.EASY,key:"4",ratingText:"easy"}];this.container=A,this.app=t.app,this.fsrsManager=t.fsrsManager,this.renderer=new os(this),this.operations=new ls(this),this.groupManager=new cs(this),this.progressManager=new hs(this),this.utils=new ds(this),this.groupProgress={};let s=this.fsrsManager.getUIState()||{};if(this.currentGroupName=s.currentGroupName||"",this.currentGroupName){let o=this.fsrsManager.getCardGroups().find(l=>l.name===this.currentGroupName);o?this.currentGroupId=o.id:this.currentGroupId=""}else this.currentGroupId="";this.completionMessage=s.completionMessage||null,s.groupProgress&&(this.groupProgress={...s.groupProgress}),this.currentGroupName&&this.groupProgress[this.currentGroupName]?(this.currentIndex=this.groupProgress[this.currentGroupName].currentIndex||0,this.isFlipped=this.groupProgress[this.currentGroupName].isFlipped||!1):(this.currentIndex=0,this.isFlipped=!1),(!s||!s.groupProgress||typeof s.groupProgress!="object")&&(this.groupProgress={}),s&&"groupProgress"in s&&s.groupProgress&&typeof s.groupProgress=="object"?this.groupProgress={...s.groupProgress}:this.groupProgress={}}setLicenseManager(A){this.licenseManager=A}setCards(A){this.cards=A}cleanup(){}async activate(){if(this.isActive=!0,this.licenseManager){let A=await this.licenseManager.isActivated(),t=A?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(A&&t){this.operations.refreshCardList(),this.renderer.render();return}}this.renderer.renderActivation()}renderActivation(){this.renderer.renderActivation()}deactivate(){this.isActive=!1,this.container.empty(),this.container.removeClass("flashcard-mode")}destroy(){this.container.removeClass("flashcard-mode"),this.container.empty()}getContainer(){return this.container}getApp(){return this.app}getFsrsManager(){return this.fsrsManager}getLicenseManager(){return this.licenseManager}getCards(){return this.cards}getCurrentIndex(){return this.currentIndex}setCurrentIndex(A){this.currentIndex=A}isCardFlipped(){return this.isFlipped}setCardFlipped(A){this.isFlipped=A}getCurrentGroupName(){return this.currentGroupName}setCurrentGroupName(A){if(this.currentGroupName=A,A){let t=this.fsrsManager.getCardGroups().find(s=>s.name===A);t?this.currentGroupId=t.id:this.currentGroupId=""}else this.currentGroupId=""}getCurrentGroupId(){return this.currentGroupId}setCurrentGroupId(A){if(this.currentGroupId=A,A){let t=this.fsrsManager.getCardGroups().find(s=>s.id===A);this.currentGroupName=t?t.name:""}else this.currentGroupName=""}getCompletionMessage(){return this.completionMessage}setCompletionMessage(A){this.completionMessage=A}getGroupCompletionMessage(A){return this.groupProgress[A]&&this.groupProgress[A].completionMessage||null}setGroupCompletionMessage(A,t){if(this.groupProgress[A]||(this.groupProgress[A]={currentIndex:0,isFlipped:!1,completionMessage:null}),this.groupProgress[A].completionMessage=t,this.fsrsManager){let s=this.fsrsManager.getUIState();s.groupProgress||(s.groupProgress={}),s.groupProgress[A]||(s.groupProgress[A]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0}),s.groupProgress[A].completionMessage=t,t&&(s.groupProgress[A].isFlipped=!1,s.groupProgress[A].currentCardId=void 0),this.fsrsManager.updateUIState(s)}}getGroupProgress(A){let t=A||this.currentGroupName;return this.groupProgress[t]||null}isComponentActive(){return this.isActive}getProgressContainer(){return this.progressContainer}setProgressContainer(A){this.progressContainer=A}getRatingButtons(){return this.ratingButtons}flipCard(){this.operations.flipCard()}nextCard(){this.operations.nextCard()}rateCard(A){this.operations.rateCard(A)}refreshCardList(){this.operations.refreshCardList()}saveState(){let A=this.getCurrentGroupName(),t=this.fsrsManager.getUIState();if(t.currentGroupName=A,t.completionMessage=this.completionMessage,t.groupProgress||(t.groupProgress={}),A){let s=this.cards.length>0&&this.currentIndex<this.cards.length?this.cards[this.currentIndex].id:void 0,o=this.getGroupCompletionMessage(A);t.groupProgress[A]?(t.groupProgress[A].currentIndex=this.currentIndex,t.groupProgress[A].isFlipped=this.isFlipped,t.groupProgress[A].currentCardId=s,t.groupProgress[A].completionMessage=o):t.groupProgress[A]={currentIndex:this.currentIndex,isFlipped:this.isFlipped,currentCardId:s,completionMessage:o}}this.fsrsManager.updateUIState(t)}updateProgress(){this.progressManager.updateProgress()}getRenderer(){return this.renderer}getOperations(){return this.operations}getGroupManager(){return this.groupManager}getProgressManager(){return this.progressManager}getUtils(){return this.utils}};var ni=require("obsidian");var Co={id:"default",name:f("Default Template"),description:f("Modern minimalist knowledge card style"),render:y=>{var F;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-modern";let A=document.createElement("div");A.className="highlight-export-quote-section";let t=document.createElement("div");t.className="highlight-export-quote-decoration";let s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 24 24"),s.setAttribute("width","48"),s.setAttribute("height","48"),s.setAttribute("fill","none"),s.setAttribute("stroke","currentColor"),s.setAttribute("stroke-width","1");let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"),s.appendChild(o),s.appendChild(l),t.appendChild(s),A.appendChild(t);let c=document.createElement("div");c.className="highlight-export-quote",c.textContent=y.text,A.appendChild(c),e.appendChild(A);let d=document.createElement("div");d.className="highlight-export-footer";let g=document.createElement("div");g.className="highlight-export-source",g.textContent=y.fileName||((F=y.filePath)==null?void 0:F.split("/").pop())||"Untitled",d.appendChild(g);let u=document.createElement("div");u.className="highlight-export-date";let m=new Date,w={year:"numeric",month:"long",day:"numeric"};return u.textContent=m.toLocaleDateString(void 0,w),d.appendChild(u),e.appendChild(d),e}},$g={id:"academic",name:f("Academic Template"),description:f("Formal style suitable for academic citations"),render:y=>{var l;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-academic";let A=document.createElement("div");A.className="highlight-export-quote",A.textContent=`"${y.text}"`,e.appendChild(A);let t=document.createElement("div");t.className="highlight-export-footer";let s=document.createElement("div");s.className="highlight-export-source",s.textContent=y.fileName||((l=y.filePath)==null?void 0:l.split("/").pop())||"Untitled",t.appendChild(s);let o=document.createElement("div");return o.className="highlight-export-date",o.textContent=`Retrieved: ${new Date().toLocaleDateString()}`,t.appendChild(o),e.appendChild(t),e}},qg={id:"social",name:f("Social Template"),description:f("Modern style suitable for social media sharing"),render:y=>{var m;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-social";let A=document.createElement("div");A.className="highlight-export-header";let t=document.createElement("div");t.className="highlight-export-logo";let s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("width","24"),s.setAttribute("height","24"),s.setAttribute("viewBox","0 0 100 100"),s.setAttribute("fill","currentColor"),s.setAttribute("stroke","none");let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","M50,9.4L14.8,37.1l12.6,38.8l22.6,14.7l22.6-14.7l12.6-38.8L50,9.4z M50,19.5l25.5,20l-9.4,28.9L50,80.6 L33.9,68.4l-9.4-28.9L50,19.5z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M50,19.5l-25.5,20l9.4,28.9L50,80.6V19.5z"),l.setAttribute("fill-opacity","0.3"),s.appendChild(o),s.appendChild(l),t.appendChild(s),A.appendChild(t);let c=document.createElement("div");c.className="highlight-export-app-name",c.textContent="HiNote",A.appendChild(c),e.appendChild(A);let d=document.createElement("div");d.className="highlight-export-quote",d.textContent=y.text,e.appendChild(d);let g=document.createElement("div");g.className="highlight-export-footer";let u=document.createElement("div");return u.className="highlight-export-source",u.textContent=y.fileName||((m=y.filePath)==null?void 0:m.split("/").pop())||"Untitled",g.appendChild(u),e.appendChild(g),e}},qr=[Co,$g,qg];function Zr(y){return qr.find(e=>e.id===y)||Co}var vo=`
    /* \u5BFC\u51FA\u5361\u7247\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card {
        transition: all 0.3s ease;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        
        /* \u6DFB\u52A0\u66F4\u4E25\u683C\u7684\u6587\u672C\u63A7\u5236 */
        font-size: 16px;
        line-height: 1.6;
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* \u73B0\u4EE3\u98CE\u683C\u6A21\u677F */
    .highlight-export-card-modern {
        padding: 24px;
        position: relative;
        overflow: hidden;
    }

    .highlight-export-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(to bottom right, #5871ef 0%, #4c63e6 100%);
    }

    .highlight-export-card-modern .highlight-export-quote-decoration {
        position: absolute;
        top: 24px;
        right: 24px;
        opacity: 0.06;
        transform: scale(2);
    }

    .highlight-export-card-modern .highlight-export-quote-section {
        position: relative;
        padding: 24px 0;
        /* \u786E\u4FDD\u5F15\u7528\u90E8\u5206\u7684\u6587\u672C\u6837\u5F0F\u4E00\u81F4\u6027 */
        font-size: inherit;
        line-height: inherit;
        letter-spacing: inherit;
        word-spacing: inherit;
    }

    .highlight-export-card-modern .highlight-export-quote {
        font-size: 1em;
        line-height: 1.7;
        color: #333333;
        font-weight: 400;
        margin: 0;
        position: relative;
        z-index: 1;
        /* \u786E\u4FDD\u5F15\u7528\u6587\u672C\u7684\u6837\u5F0F\u4E00\u81F4\u6027 */
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u786E\u4FDD\u6240\u6709\u6587\u672C\u5143\u7D20\u7EE7\u627F\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card * {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u5BFC\u51FA\u9884\u89C8\u5BB9\u5668 */
    .highlight-export-preview {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
    }

    /* \u5BFC\u51FA\u5BB9\u5668 */
    .highlight-export-container {
        padding: 20px;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        width: 480px;
    }
`;var gs=class extends ni.Modal{constructor(A,t,s){super(A);this.selectedTemplateId="default";this.includeComments=!1;this.highlight=t,this.html2canvasInstance=s}async onOpen(){let{contentEl:A}=this;A.empty(),A.addClass("highlight-export-modal");let t=A.createEl("div",{cls:"highlight-export-main-container"}),s=t.createEl("select",{cls:"highlight-template-select"});qr.forEach(l=>{let c=s.createEl("option",{text:l.name,value:l.id});this.selectedTemplateId===l.id&&(c.selected=!0)}),s.addEventListener("change",l=>{let c=l.target;this.selectedTemplateId=c.value,this.updatePreview()}),this.previewContainer=t.createEl("div",{cls:"highlight-export-preview-container"}),this.updatePreview();let o=A.createEl("div",{cls:"highlight-export-modal-buttons"});if(this.highlight.comments&&this.highlight.comments.length>0){let l=o.createEl("div",{cls:"highlight-export-checkbox-container"}),c=l.createEl("input",{attr:{type:"checkbox",id:"include-comments-checkbox"},cls:"highlight-export-checkbox"}),d=l.createEl("label",{text:f("Include Comments"),attr:{for:"include-comments-checkbox"},cls:"highlight-export-checkbox-label"});c.addEventListener("change",g=>{this.includeComments=g.target.checked,this.updatePreview()})}o.createEl("button",{cls:"highlight-btn",text:f("Cancel")}).addEventListener("click",()=>this.close()),o.createEl("button",{cls:"highlight-btn highlight-btn-primary",text:f("Download")}).addEventListener("click",async()=>{try{let l=document.createElement("div");l.className="highlight-export-container";let d=Zr(this.selectedTemplateId).render(this.highlight);l.appendChild(d),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(l),document.body.appendChild(l);let u=(await this.html2canvasInstance(l,{backgroundColor:null,scale:window.devicePixelRatio*2,useCORS:!0,allowTaint:!0,logging:!1,imageTimeout:0,removeContainer:!0,onclone:async w=>{let F=w.createElement("style");F.textContent=this.getExportStyles(),w.head.appendChild(F),await new Promise(Q=>setTimeout(Q,100))}})).toDataURL("image/png",1),m=document.createElement("a");m.download=`highlight-${this.selectedTemplateId}-${Date.now()}.png`,m.href=u,m.click(),this.close(),new ni.Notice(f("Export successful!"))}catch(l){new ni.Notice(f("Export failed, please try again"))}})}updatePreview(){this.previewContainer.empty(),this.previewContainer.className="highlight-export-preview";let t=Zr(this.selectedTemplateId).render(this.highlight);this.previewContainer.appendChild(t),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(this.previewContainer)}addCommentsToContainer(A){let t=A.querySelector(".highlight-export-card");if(!t)return;let s=t.querySelector(".highlight-export-footer");if(!s)return;let o=document.createElement("div");o.className="highlight-export-comments-section";let l=document.createElement("div");l.className="highlight-export-comments-list",o.appendChild(l),this.highlight.comments&&this.highlight.comments.forEach(c=>{let d=document.createElement("div");d.className="highlight-export-comment-item";let g=document.createElement("div");if(g.className="highlight-export-comment-content",g.textContent=c.content,d.appendChild(g),c.createdAt){let u=document.createElement("div");u.className="highlight-export-comment-time",u.textContent=new Date(c.createdAt).toLocaleString(),d.appendChild(u)}l.appendChild(d)}),t.insertBefore(o,s)}getExportStyles(){return`
            body {
                margin: 0;
                background: none;
            }
            ${vo}
        `}onClose(){let{contentEl:A}=this;A.empty()}};var oi=require("obsidian");var ai=class extends oi.Component{constructor(A,t,s,o=window.app){super();this.highlight=t;this.onHighlightClick=s;this.app=o;this.render(A).catch(l=>{console.error("Error rendering highlight content:",l)})}async render(A){this.container=A.createEl("div",{cls:"highlight-content"}),await this.renderText()}async renderText(){this.textContainer=this.container.createEl("div",{cls:"highlight-text-container"});let A=this.textContainer.createEl("div",{cls:"highlight-text-decorator"});this.highlight.backgroundColor&&(A.style.backgroundColor=this.highlight.backgroundColor);let s=this.textContainer.createEl("div",{cls:"highlight-text"}).createEl("div",{cls:`highlight-text-content ${this.highlight.isVirtual?"virtual-highlight":""} markdown-rendered`}),o=(this.highlight.isVirtual?this.highlight.displayText:this.highlight.text)||"";try{await oi.MarkdownRenderer.render(this.app,o,s,this.highlight.filePath||"",new oi.Component),s.querySelectorAll("ul, ol").forEach(c=>{c.addClass("highlight-markdown-list")}),await this.activateInternalLinks(s,this.highlight.filePath||"")}catch(l){console.error("Error rendering markdown in highlight:",l);let c=o.split(`
`);c.forEach((d,g)=>{let u=s.createEl("p",{text:d,cls:"highlight-text-line"});g<c.length-1&&u.addClass("highlight-text-line-spacing")})}this.highlight.isGlobalSearch?(s.addClass("global-search-highlight"),s.removeAttribute("aria-label"),s.style.cursor="default"):(s.setAttribute("aria-label",f("Jump to highlight")),s.addEventListener("mousedown",async l=>{l.target.closest("a")||(l.preventDefault(),l.stopPropagation(),await this.onHighlightClick(this.highlight))}))}async activateInternalLinks(A,t){A.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,t)&&this.app.workspace.openLinkText(c,t,!1)}),l.addEventListener("mouseenter",d=>{this.app.workspace.trigger("hover-link",{event:d,source:"hi-note",hoverParent:A,targetEl:l,linktext:c,sourcePath:t})}))}),A.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}getContainer(){return this.container}};ai.dragPreview=null;var fs=require("obsidian"),Fo=/#[\w\u4e00-\u9fa5]+/g,us=/^\s*(#[\w\u4e00-\u9fa5]+(\s+#[\w\u4e00-\u9fa5]+)*\s*)$/,ps=class extends fs.Component{constructor(A,t,s){super();this.highlight=t;this.onCommentEdit=s;this.app=window.app,this.render(A)}render(A){if((this.highlight.comments||[]).length===0)return;let s=A.createEl("div",{cls:"hi-notes-section"});this.container=s.createEl("div",{cls:"hi-notes-list"}),this.renderComments().catch(o=>{console.error("Error rendering comments:",o)})}async renderComments(){let A=this.highlight.comments||[];for(A.sort((t,s)=>{let o=us.test(t.content),l=us.test(s.content);return o&&!l?-1:!o&&l?1:s.updatedAt-t.updatedAt});this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(let t of A){let s=us.test(t.content),o=this.container.createEl("div",{cls:`hi-note${s?" pure-tags-comment":""}`,attr:{"data-comment-id":t.id}}),l=o.createEl("div",{cls:"hi-note-content markdown-rendered"}),c=t.content;if(us.test(c)){let g=c,u=c.match(Fo)||[];for(;l.firstChild;)l.removeChild(l.firstChild);if(u.length>0){let m=g.split(Fo),w=0;m.forEach((F,Q)=>{if(F&&l.appendChild(document.createTextNode(F)),Q<u.length){let E=document.createElement("span");E.className="highlight-tag",E.textContent=u[Q],l.appendChild(E)}})}else l.textContent=c}else try{await fs.MarkdownRenderer.renderMarkdown(c,l,this.highlight.filePath||"",this),l.querySelectorAll("ul, ol").forEach(u=>{u.addClass("comment-markdown-list")}),await this.activateInternalLinks(l,this.highlight.filePath||"")}catch(g){console.error("Error rendering markdown in comment:",g),l.textContent=c}l.addEventListener("dblclick",g=>{g.target.closest("a")||(g.stopPropagation(),g.preventDefault(),this.onCommentEdit(t))}),l.addEventListener("click",g=>{g.target.closest("a")||g.stopPropagation()});let d=o.createEl("div",{cls:"hi-note-footer"});d.createEl("div",{text:new Date(t.updatedAt).toLocaleString(),cls:"hi-note-time"}),d.createEl("span",{text:"Double click to edit",cls:"hi-note-edit-hint"}),d.createEl("div",{cls:"hi-note-actions"})}}async activateInternalLinks(A,t){A.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,t)&&this.app.workspace.openLinkText(c,t,!1)}),l.addEventListener("mouseenter",d=>{this.app.workspace.trigger("hover-link",{event:d,source:"hi-note",hoverParent:A,targetEl:l,linktext:c,sourcePath:t})}))}),A.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}};var ms=class{constructor(e,A,t){this.parent=e;this.highlight=A;this.onClick=t;this.render()}render(){this.container=this.parent.createEl("div",{cls:"unfocused-comment-input"}),this.container.createEl("div",{cls:"unfocused-input-area",attr:{placeholder:f("Add comment...")}}).addEventListener("click",A=>{A.preventDefault(),A.stopPropagation(),this.onClick()})}remove(){this.container.remove()}hide(){this.container.style.display="none"}};var AA=require("obsidian");var dt=class dt{static start(e,A,t={}){var d;let{showIcon:s=!0,maxLength:o=30}=t;this.clear(),this.instance=document.createElement("div"),this.instance.className="highlight-dragging";let l=document.createElement("div");l.className="highlight-dragging-content";let c=A.length>o?A.slice(0,o)+"...":A;l.textContent=c,this.instance.appendChild(l),document.body.appendChild(this.instance),this.updatePosition(e.clientX,e.clientY),(d=e.dataTransfer)==null||d.setDragImage(this.dragImage,0,0),document.addEventListener("dragover",this.handleDragOver)}static updatePosition(e,A){this.instance&&this.instance.setAttribute("style",`left: ${e+10}px; top: ${A+10}px;`)}static clear(){this.instance&&(this.instance.remove(),this.instance=null),document.removeEventListener("dragover",this.handleDragOver)}};dt.instance=null,dt.dragImage=new Image,dt.dragImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",dt.handleDragOver=e=>{e.preventDefault(),dt.updatePosition(e.clientX,e.clientY)};var li=dt;var yo=require("obsidian"),ci=class{constructor(e,A){this.highlight=e;this.plugin=A}generateSync(){var A,t,s,o;let e=[];if(this.highlight.isVirtual){let l=((t=(A=this.highlight.filePath)==null?void 0:A.split("/").pop())==null?void 0:t.replace(".md",""))||"File";e.push(`> [!note] [[${l}]]`),e.push("> ")}else{e.push("> [!quote] HiNote");let l=!1;if(this.highlight.blockId){let c=this.highlight.filePath;if(!c){let d=this.plugin.app.workspace.getActiveFile();d&&(c=d.path)}if(c){let d=(s=c.split("/").pop())==null?void 0:s.replace(".md","");if(d){let g=`> ![[${d}#^${this.highlight.blockId}]]`;e.push(g),e.push("> "),l=!0}}}else if(this.highlight.filePath&&typeof this.highlight.position=="number"){let c=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(c instanceof yo.TFile){let d=this.plugin.app.metadataCache.getFileCache(c);if(d!=null&&d.sections){let g=this.highlight.position,u=d.sections.find(m=>m.position.start.offset<=g&&m.position.end.offset>=g);if(u!=null&&u.id){let m=(o=this.highlight.filePath.split("/").pop())==null?void 0:o.replace(".md","");if(m){let w=`> ![[${m}#^${u.id}]]`;e.push(w),e.push("> "),l=!0}}}}}!l&&this.highlight.text&&(e.push(`> ${this.highlight.text}`),e.push("> "))}if(this.highlight.comments&&this.highlight.comments.length>0)for(let l of this.highlight.comments)e.push(...this.formatComment(l,!1));return e.join(`
`)}async generate(){return this.generateSync()}formatComment(e,A){let t=[],s=A?">":">>";if(!A){let l=e.updatedAt?window.moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";t.push(`>> [!note]+ ${l}`)}let o=e.content.split(`
`).map(l=>(l=l.trim(),l?`${s} ${l}`:s)).join(`
`);return t.push(o),t.push(">"),t}};var Te=require("obsidian");var Ut=[{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-reasoner",name:"Deepseek Reasoner"}],qe=[{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash"},{id:"gemini-2.0-flash-lite-preview-02-05",name:"Gemini 2.0 Flash Lite"}],Ue=[{id:"deepseek-ai/DeepSeek-V3",name:"DeepSeek V3",isCustom:!1},{id:"Qwen/Qwen2.5-7B-Instruct",name:"Qwen2.5 7B",isCustom:!1},{id:"Qwen/Qwen2.5-14B-Instruct",name:"Qwen2.5 14B",isCustom:!1},{id:"Pro/Qwen/Qwen2-7B-Instruct",name:"Qwen2 7B",isCustom:!1},{id:"Pro/THUDM/glm-4-9b-chat",name:"GLM-4 9B",isCustom:!1},{id:"google/gemma-2-9b-it",name:"Gemma2 9B",isCustom:!1}],oA={excludePatterns:"",useCustomPattern:!1,regexRules:[{id:"default-md",name:"Default Highlight",pattern:"==\\s*([\\s\\S]*?)\\s*==",color:"#ffeb3b",enabled:!0},{id:"default-mark",name:"Mark format",pattern:"<mark[^>]*>([\\s\\S]*?)</mark>",color:"#ffeb3b",enabled:!0},{id:"default-span",name:"Span format",pattern:"<span[^>]*>([\\s\\S]*?)</span>",color:"#ffeb3b",enabled:!0}],ai:{provider:"ollama",ollama:{host:"http://localhost:11434",model:""},gemini:{apiKey:"",model:"gemini-pro",baseUrl:"",isCustomModel:!1},openai:{apiKey:"",model:"gpt-4o",baseUrl:""},anthropic:{apiKey:"",model:"claude-2",apiAddress:"",isCustomModel:!1,lastCustomModel:""},deepseek:{apiKey:"",model:"deepseek-chat",baseUrl:""},prompts:{"\u{1F914} Key Insight":"{{highlight}}.Please reinterpret the above content from a fresh perspective and summarize its core idea within 200 characters."}},export:{exportPath:""},contextOptions:{strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3},showCommentWidget:!0};var St=require("obsidian"),It=class{constructor(e="http://localhost:11434"){this.retryAttempts=3;this.retryDelay=1e3;!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),this.baseUrl=e.replace(/\/$/,"")}async listModels(){try{await this.ensureConnection();let e=await this.makeRequest({endpoint:"/api/tags",method:"GET"});if(!e||!e.models)throw new Error("Invalid API response format");return e.models.map(A=>A.name)}catch(e){throw this.handleError(e)}}async generateCompletion(e,A){try{await this.ensureConnection();let t=await this.makeRequest({endpoint:"/api/generate",method:"POST",body:JSON.stringify({model:e,prompt:A,stream:!1})});if(!t||!t.response)throw new Error("Invalid API response format");return t.response}catch(t){throw this.handleError(t)}}async pullModel(e){try{new St.Notice(`Downloading model ${e}...`);let A=await this.makeRequest({endpoint:"/api/pull",method:"POST",body:JSON.stringify({name:e})});if(!A.ok)throw new Error(`Failed to download model: ${A.status}`);new St.Notice(`Model ${e} downloaded successfully`)}catch(A){throw new Error(`Failed to download model: ${A.message}`)}}async chat(e,A){var t;try{await this.ensureConnection();let s=await this.makeRequest({endpoint:"/api/chat",method:"POST",body:JSON.stringify({model:e,messages:A,stream:!1})});if(!s||!((t=s.message)!=null&&t.content))throw new Error("Invalid API response format");return s.message.content}catch(s){throw this.handleError(s)}}async ensureConnection(){if(!this.baseUrl)throw new Error("Ollama service not configured. Please set the host in settings.");if(!await this.testConnection())throw new Error("Unable to connect to Ollama service. Please ensure the service is running.")}async testConnection(){if(!this.baseUrl)return!1;try{let e=await this.makeRequest({endpoint:"/api/version",method:"GET"});return!!(e!=null&&e.version)}catch(e){return!1}}async makeRequest(e){let A=null;for(let t=1;t<=this.retryAttempts;t++)try{let s=new URL(e.endpoint,this.baseUrl).toString(),o=await(0,St.requestUrl)({url:s,method:e.method,headers:{"Content-Type":"application/json",Accept:"application/json"},body:e.body,throw:!1});if(o.status===200)try{return o.text?JSON.parse(o.text):{}}catch(c){throw new Error("Invalid JSON response from server")}let l=`HTTP error! status: ${o.status}`;try{let c=JSON.parse(o.text);c.error&&(l=c.error)}catch(c){o.text&&(l=o.text)}throw new Error(l)}catch(s){if(A=s,t<this.retryAttempts){await this.delay(this.retryDelay*t);continue}break}throw A}handleError(e){return e.message.includes("ECONNREFUSED")?(new St.Notice("Ollama service is not running. Please start the service."),new Error("Unable to connect to Ollama service. Please ensure the service is running.")):e instanceof TypeError&&e.message.includes("Invalid URL")?new Error(`Invalid Ollama service URL: ${this.baseUrl}`):e}delay(e){return new Promise(A=>setTimeout(A,e))}};var zr=require("obsidian"),Ht=class{constructor(e,A,t){this.apiKey=e,this.apiAddress=A||"https://api.anthropic.com",this.model=t||"claude-3-opus-20240229"}async generateResponse(e){try{let A=await(0,zr.requestUrl)({url:`${this.apiAddress}/v1/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:this.model,max_tokens:4096,messages:[{role:"user",content:e}]})});if(A.status!==200)throw new Error(`Anthropic API error: ${A.text}`);return A.json.content[0].text}catch(A){throw new Error("Failed to generate response from Anthropic API")}}async testConnection(){try{return(await(0,zr.requestUrl)({url:`${this.apiAddress}/v1/messages`,method:"POST",headers:{"x-api-key":this.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:this.model,max_tokens:1,messages:[{role:"user",content:"Hi"}]})})).status===200}catch(e){return!1}}};var Bs=require("obsidian"),ws=class{constructor(e,A="gemini-pro",t){this.apiKey=e,this.model=A,this.baseUrl=t||"https://generativelanguage.googleapis.com"}updateModel(e){this.model=e}async generateResponse(e){var A,t,s,o,l;try{let c=`${this.baseUrl}/v1beta/models/${this.model}:generateContent?key=${this.apiKey}`,g=await(0,Bs.requestUrl)({url:c,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:e}]}],generationConfig:{maxOutputTokens:2048,temperature:.7}})});if(g.status!==200)throw new Error(`Gemini API error (${g.status}): ${g.text}`);let u=g.json;if(!((l=(o=(s=(t=(A=u.candidates)==null?void 0:A[0])==null?void 0:t.content)==null?void 0:s.parts)==null?void 0:o[0])!=null&&l.text))throw new Error("Invalid response format from Gemini API");return u.candidates[0].content.parts[0].text}catch(c){throw c instanceof Error?c:new Error("Failed to generate response from Gemini API")}}async chat(e){var A,t,s,o,l;try{let c=`${this.baseUrl}/v1beta/models/${this.model}:generateContent?key=${this.apiKey}`,g={contents:e.map(w=>({role:w.role==="assistant"?"model":"user",parts:[{text:w.content}]})),generationConfig:{maxOutputTokens:2048,temperature:.7}},u=await(0,Bs.requestUrl)({url:c,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(u.status!==200)throw new Error(`Gemini Chat API error (${u.status}): ${u.text}`);let m=u.json;if(!((l=(o=(s=(t=(A=m.candidates)==null?void 0:A[0])==null?void 0:t.content)==null?void 0:s.parts)==null?void 0:o[0])!=null&&l.text))throw new Error("Invalid response format from Gemini Chat API");return m.candidates[0].content.parts[0].text}catch(c){throw c instanceof Error?c:new Error("Failed to chat with Gemini API")}}async testConnection(){try{let e=`${this.baseUrl}/v1beta/models/${this.model}?key=${this.apiKey}`,A=await(0,Bs.requestUrl)({url:e,method:"GET"});return A.status,A.status===200}catch(e){return!1}}};var jr=require("obsidian"),Cs=class{constructor(e){var A;if(!((A=e.siliconflow)!=null&&A.apiKey))throw new Error("SiliconFlow API key is required");this.settings=e,this.baseUrl=e.siliconflow.baseUrl||"https://api.siliconflow.cn/v1"}async chat(e,A){var t,s;try{let o=((t=this.settings.siliconflow)==null?void 0:t.model)||"deepseek-ai/DeepSeek-V3",l=await(0,jr.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${(s=this.settings.siliconflow)==null?void 0:s.apiKey}`},body:JSON.stringify({model:o,messages:e.map(d=>({role:d.role,content:d.content})),stream:!1})});if(l.status!==200)throw new Error(`SiliconFlow API request failed: ${l.text}`);let c=l.json;if(!c.choices||!c.choices[0]||!c.choices[0].message)throw new Error("Unexpected API response format");return c.choices[0].message.content}catch(o){throw o}}async listModels(){var e;try{let A=await(0,jr.requestUrl)({url:`${this.baseUrl}/models`,method:"GET",headers:{Authorization:`Bearer ${(e=this.settings.siliconflow)==null?void 0:e.apiKey}`}});if(A.status!==200)throw new Error(`Failed to list models: ${A.text}`);return A.json.data.map(t=>({id:t.id,name:t.id.split("/").pop()||t.id,isCustom:!1}))}catch(A){throw A}}};var An=require("obsidian"),vs=class{constructor(e,A="deepseek-chat",t){this.apiKey=e;this.model=A,this.baseUrl=t||"https://api.deepseek.com/v1"}updateModel(e){this.model=e}async generateResponse(e){let A=[{role:"user",content:e}];return await this.chat(A)}async chat(e){var A,t,s;try{let o=await(0,An.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:this.model,messages:e,temperature:.7,max_tokens:4096,frequency_penalty:0,presence_penalty:0})});if(o.status!==200)throw new Error(`Deepseek API error (${o.status}): ${o.text}`);let l=o.json;if(!((s=(t=(A=l.choices)==null?void 0:A[0])==null?void 0:t.message)!=null&&s.content))throw new Error("Invalid response format from Deepseek API");return l.choices[0].message.content}catch(o){throw o instanceof Error?o:new Error("Failed to generate response from Deepseek API")}}async testConnection(){try{return(await(0,An.requestUrl)({url:`${this.baseUrl}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:"test"}],max_tokens:10})})).status===200}catch(e){return!1}}};var Qo=require("obsidian"),Ze=class{constructor(e){this.settings=e;this.anthropicService=null;this.geminiService=null;this.deepseekService=null;this.siliconflowService=null;this.currentState={provider:"",model:""};var A,t,s,o,l,c,d,g;switch((A=e.ollama)!=null&&A.host&&(this.ollamaService=new It(e.ollama.host)),(t=e.anthropic)!=null&&t.apiKey&&(this.anthropicService=new Ht(e.anthropic.apiKey,e.anthropic.apiAddress,e.anthropic.model)),(s=e.gemini)!=null&&s.apiKey&&(this.geminiService=new ws(e.gemini.apiKey,e.gemini.model,e.gemini.baseUrl)),(o=e.deepseek)!=null&&o.apiKey&&(this.deepseekService=new vs(e.deepseek.apiKey,e.deepseek.model,e.deepseek.baseUrl)),(l=e.siliconflow)!=null&&l.apiKey&&(this.siliconflowService=new Cs(this.settings)),this.currentState.provider=e.provider,e.provider){case"gemini":this.currentState.model=((c=e.gemini)==null?void 0:c.model)||"";break;case"deepseek":this.currentState.model=((d=e.deepseek)==null?void 0:d.model)||"deepseek-chat";break;case"siliconflow":this.currentState.model=((g=e.siliconflow)==null?void 0:g.model)||"internlm/internlm2_5-7b-chat";break}}updateModel(e,A){switch(this.currentState.provider=e,this.currentState.model=A,e){case"gemini":this.geminiService&&this.geminiService.updateModel(A);break;case"deepseek":this.deepseekService&&this.deepseekService.updateModel(A);break}}async generateResponse(e,A,t){let s=e.replace("{{highlight}}",A);switch(t&&(s=s.replace("{{comment}}",t)),this.settings.provider){case"openai":return await this.callOpenAI(s);case"anthropic":return await this.callAnthropic(s);case"ollama":return await this.callOllama(s);case"gemini":return await this.callGemini(s);case"deepseek":return await this.callDeepseek(s);case"siliconflow":return await this.callSiliconFlow(s);default:throw new Error("AI service not configured")}}async chat(e){switch(this.settings.provider){case"openai":return await this.chatWithOpenAI(e);case"anthropic":return await this.chatWithAnthropic(e);case"ollama":return await this.chatWithOllama(e);case"gemini":return await this.chatWithGemini(e);case"deepseek":return await this.chatWithDeepseek(e);case"siliconflow":return await this.chatWithSiliconFlow(e);default:throw new Error("AI service not configured")}}async chatWithOpenAI(e){var s;if(!((s=this.settings.openai)!=null&&s.apiKey))throw new Error("OpenAI API Key not configured");let A=await(0,Qo.requestUrl)({url:this.settings.openai.baseUrl||"https://api.openai.com/v1/chat/completions",method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.settings.openai.apiKey}`},body:JSON.stringify({model:this.settings.openai.model,messages:e,temperature:.7})});if(A.status!==200)throw new Error(`OpenAI API request failed: ${A.text}`);return A.json.choices[0].message.content}async chatWithAnthropic(e){if(!this.anthropicService)throw new Error("Anthropic service not configured");let A=e[e.length-1];return await this.anthropicService.generateResponse(A.content)}async chatWithOllama(e){var A;if(!this.ollamaService)throw new Error("Ollama service not configured");if(!((A=this.settings.ollama)!=null&&A.model))throw new Error("Ollama model not configured");return await this.ollamaService.chat(this.settings.ollama.model,e)}async chatWithGemini(e){if(!this.geminiService)throw new Error("Gemini service not configured");return await this.geminiService.chat(e)}async chatWithSiliconFlow(e){if(!this.siliconflowService)throw new Error("SiliconFlow service not configured");try{return await this.siliconflowService.chat(e)}catch(A){throw A}}async chatWithDeepseek(e){if(!this.deepseekService)throw new Error("Deepseek service not configured");return await this.deepseekService.chat(e)}async callOpenAI(e){return await this.chatWithOpenAI([{role:"user",content:e}])}async callAnthropic(e){if(!this.anthropicService)throw new Error("Anthropic service not configured");return await this.anthropicService.generateResponse(e)}async callOllama(e){var A;if(!this.ollamaService)throw new Error("Ollama service not configured");if(!((A=this.settings.ollama)!=null&&A.model))throw new Error("Ollama model not configured");return await this.ollamaService.generateCompletion(this.settings.ollama.model,e)}async callGemini(e){if(!this.geminiService)throw new Error("Gemini service not configured");return await this.geminiService.generateResponse(e)}async callSiliconFlow(e){if(!this.siliconflowService)throw new Error("SiliconFlow service not configured");try{return await this.siliconflowService.chat([{role:"user",content:e}])}catch(A){throw A}}async callDeepseek(e){if(!this.deepseekService)throw new Error("Deepseek service not configured");return await this.deepseekService.generateResponse(e)}async testConnection(){switch(this.settings.provider){case"openai":try{return await this.chatWithOpenAI([{role:"user",content:"test"}]),!0}catch(e){return!1}case"anthropic":return this.anthropicService?await this.anthropicService.testConnection():!1;case"ollama":return this.ollamaService?await this.ollamaService.testConnection():!1;case"gemini":return this.geminiService?await this.geminiService.testConnection():!1;case"deepseek":return this.deepseekService?await this.deepseekService.testConnection():!1;default:return!1}}async listOllamaModels(){if(!this.ollamaService)throw new Error("Ollama service not configured");return await this.ollamaService.listModels()}async listGeminiModels(){if(!this.geminiService)throw new Error("Gemini service not configured");return Promise.resolve(qe)}async listDeepseekModels(){if(!this.deepseekService)throw new Error("Deepseek service not configured");return Promise.resolve([{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-coder",name:"Deepseek Coder"}])}async listSiliconFlowModels(){return Ue}async listOpenAIModels(){var A,t;let e=[{id:"gpt-4",name:"GPT-4",isCustom:!1},{id:"gpt-4-turbo",name:"GPT-4 Turbo",isCustom:!1},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",isCustom:!1}];return(A=this.settings.openai)!=null&&A.isCustomModel&&((t=this.settings.openai)!=null&&t.model)&&e.push({id:this.settings.openai.model,name:this.settings.openai.model,isCustom:!0}),e}};var Fs=class{constructor(e,A,t,s){var c;this.plugin=t,this.container=e,this.contentProvider=A,this.options={...s},this.initButton();let o=(c=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:c.view,l=o instanceof ue?o:null;l!=null&&l.registerAIButton&&l.registerAIButton(this)}destroy(){var t;document.removeEventListener("click",this.boundClickHandler);let e=(t=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:t.view,A=e instanceof ue?e:null;A!=null&&A.unregisterAIButton&&A.unregisterAIButton(this)}initButton(){let e=this.container.createEl("div",{cls:"highlight-ai-container"});this.options.position&&e.addClass(`highlight-ai-container-${this.options.position}`);let A=e.createEl("div",{cls:this.options.buttonClass,attr:{"aria-label":this.options.buttonLabel}});(0,Te.setIcon)(A,this.options.buttonIcon),A.addEventListener("click",t=>{t.stopPropagation(),this.toggleDropdown()}),this.aiButton=A}toggleDropdown(){let e=new Te.Menu,A=Object.entries(this.plugin.settings.ai.prompts||{});A.length>0?A.forEach(([s])=>{e.addItem(o=>o.setTitle(s).onClick(async()=>{await this.handleAIAnalysis(s)}))}):e.addItem(s=>s.setTitle(f("Please add Prompt in the settings first")).setDisabled(!0));let t=this.aiButton.getBoundingClientRect();e.showAtPosition({x:t.left-92,y:t.bottom+8})}async handleAIAnalysis(e){try{this.setLoading(!0);let A=new Ze(this.plugin.settings.ai),t=this.plugin.settings.ai.prompts[e];if(!t)throw new Error(f(`Not found named "${e}" Prompt`));let s=this.contentProvider.getText(),o=this.contentProvider.getComments(),l=await A.generateResponse(t,s,o);await this.options.onResponse(l),new Te.Notice(f("AI comments added"))}catch(A){new Te.Notice(f(`AI comments failed: ${A.message}`))}finally{this.setLoading(!1)}}setLoading(e){e?(this.aiButton.addClass("loading"),(0,Te.setIcon)(this.aiButton,"loader")):(this.aiButton.removeClass("loading"),(0,Te.setIcon)(this.aiButton,this.options.buttonIcon||"bot-message-square"))}getButtonElement(){return this.aiButton}};var en=require("obsidian"),ze=class{constructor(e){this.STORAGE_KEY="flashcard-license";this.VAULT_ID_KEY="vault-id";this.API_URL="https://hi-note-license-server-production.up.railway.app";this.FEATURES=["flashcard"];this.VERIFICATION_INTERVAL_DAYS=7;this.licenseToken=null;this.plugin=e}async generateVaultId(){try{let e=await this.plugin.loadData()||{};if(e[this.VAULT_ID_KEY])return e[this.VAULT_ID_KEY];let A=this.plugin.app.vault.adapter,t=this.plugin.app.vault.getName();A&&"basePath"in A&&(t=A.basePath+"/"+t);let s=navigator.platform||"",o=[t,s].join("|"),c=new TextEncoder().encode(o),d=await crypto.subtle.digest("SHA-256",c),u=Array.from(new Uint8Array(d)).map(m=>m.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(u),u}catch(e){let A=this.plugin.app.vault.getName(),s=new TextEncoder().encode(A),o=await crypto.subtle.digest("SHA-256",s),c=Array.from(new Uint8Array(o)).map(d=>d.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(c),c}}async saveVaultId(e){let A=await this.plugin.loadData()||{};await this.plugin.saveData({...A,[this.VAULT_ID_KEY]:e})}async activateLicense(e){try{let A=await this.generateVaultId(),t=`${this.API_URL}/api/verify`,l=(await(0,en.requestUrl)({url:t,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({licenseKey:e,deviceId:A})})).json;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{key:e,token:l.token,features:l.features,vaultId:A,lastVerified:Date.now()}}),this.licenseToken=l.token,!0}return!1}catch(A){let t=A instanceof Error?A.message:"Unknown error";return!1}}async isFeatureEnabled(e){var s;let A=await this.plugin.loadData(),t=A==null?void 0:A[this.STORAGE_KEY];return((s=t==null?void 0:t.features)==null?void 0:s.includes(e))||!1}async isActivated(){try{let e=await this.plugin.loadData(),A=e==null?void 0:e[this.STORAGE_KEY];return A!=null&&A.token?this.shouldVerifyLicense(A.lastVerified)?this.verifyWithServer(A):(this.licenseToken||(this.licenseToken=A.token),!0):!1}catch(e){return!1}}shouldVerifyLicense(e){return e?(Date.now()-e)/(1e3*60*60*24)>=this.VERIFICATION_INTERVAL_DAYS:!0}async verifyWithServer(e){try{let A=await this.generateVaultId(),t=e.vaultId,s=t&&t!==A,l=(await(0,en.requestUrl)({url:`${this.API_URL}/api/verify`,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e.token}`},body:JSON.stringify({licenseKey:e.key,deviceId:A,isDeviceChanged:s})})).json;if(!l)return!!this.licenseToken;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{...e,token:l.token||e.token,vaultId:A,lastVerified:Date.now()}}),this.licenseToken=l.token||e.token,!0}return!1}catch(A){return!!this.licenseToken}}};var q=class q{constructor(e,A,t,s,o=!1,l){this.container=e;this.highlight=A;this.plugin=t;this.options=s;this.isInMainView=o;this.isEditing=!1;this.aiButtonInstance=null;this.moreActionsDropdown=null;this.unfocusedInput=null;this.hasFlashcard=!1;this.isShowingRealInput=!1;var c;this.fileName=l,this.highlight=A,this.plugin=t,this.options=s,this.fileName=(c=this.highlight.filePath)==null?void 0:c.split("/").pop(),q.cardInstances.add(this),this.setupCommentInputEventListeners(),this.render()}static getSelectedCards(){return q.selectedCards}static clearSelection(){q.selectedCards.forEach(e=>{e.removeClass("selected")}),q.selectedCards.clear(),q.lastSelectedCard=null}static clearAllInstances(){q.cardInstances.forEach(e=>{typeof e.destroy=="function"&&e.destroy()}),q.cardInstances.clear(),q.selectedCards.clear(),q.lastSelectedCard=null}static findCardInstanceByHighlightId(e){for(let A of q.cardInstances)if(A.highlight.id===e)return A;return null}static updateCardUIByHighlightId(e){let A=q.findCardInstanceByHighlightId(e);A&&A.updateIconsAfterCardCreation()}static clearAllUnfocusedInputs(){q.cardInstances.forEach(e=>{e.unfocusedInput&&(e.unfocusedInput.remove(),e.unfocusedInput=null)})}setupCommentInputEventListeners(){let e=t=>{var s;((s=t.detail)==null?void 0:s.highlightId)===this.highlight.id&&(this.isShowingRealInput=!0,this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null))},A=t=>{var s;((s=t.detail)==null?void 0:s.highlightId)===this.highlight.id&&(this.isShowingRealInput=!1)};document.addEventListener("comment-input-shown",e),document.addEventListener("comment-input-closed",A),this.plugin.register(()=>{document.removeEventListener("comment-input-shown",e),document.removeEventListener("comment-input-closed",A)})}render(){this.card=this.container.createEl("div",{cls:`highlight-card ${this.highlight.isVirtual?"virtual-highlight-card":""}`,attr:{"data-highlight":JSON.stringify(this.highlight)}}),this.card.addEventListener("click",c=>{if(this.isEditing||this.isShowingRealInput)return;let d=c.target;d.closest(".hi-note-input")||d.closest(".hi-note-actions-hint")||this.selectCard(c)});let e=this.card.createEl("div",{cls:"highlight-card-title-bar"}),A=e.createEl("div",{cls:"highlight-card-title-left"}),t=e.createEl("div",{cls:"highlight-card-title-right"});if((this.isInMainView||this.highlight.isGlobalSearch)&&this.fileName){let c=A.createEl("div",{cls:"highlight-card-icon",attr:{"aria-label":f("Open (DoubleClick)")}});this.checkHasFlashcard()?((0,AA.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,AA.setIcon)(c,"file-text"),c.addEventListener("dblclick",async m=>{m.stopPropagation();let w=this.highlight.filePath||this.fileName;if(!w)return;let F=this.plugin.app.vault.getAbstractFileByPath(w);if(!F||!(F instanceof AA.TFile))return;let Q=this.plugin.app.workspace.getLeavesOfType("markdown"),E=this.plugin.app.workspace.activeLeaf,H=Q.find(b=>b!==E);if(H||(H=this.plugin.app.workspace.getLeaf("split","vertical")),await H.openFile(F),this.highlight.position!==void 0){let b=H.view;if(b.getViewType()==="markdown"){let K=b.getViewType()==="markdown"?b.editor:null;if(K){let M=K.offsetToPos(this.highlight.position);K.setCursor(M),K.scrollIntoView({from:M,to:M},!0)}}}});let g=this.fileName?this.fileName.replace(/\.md$/,""):"",u=A.createEl("span",{text:g,cls:"highlight-card-title-text"});this.setupDragFunctionality(A),this.addPagePreview(u,this.highlight.filePath||this.fileName)}else{let c=A.createEl("div",{cls:"highlight-card-icon"});if(this.checkHasFlashcard()?((0,AA.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,AA.setIcon)(c,"highlighter"),this.highlight.filePath&&typeof this.highlight.position=="number"){let g=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(g instanceof AA.TFile&&!this.highlight.isGlobalSearch){let u=this.plugin.app.workspace.getLeavesOfType("markdown").find(m=>{let w=m.view;return w instanceof AA.MarkdownView&&w.file&&w.file.path===g.path});if(u){let m=u.view;if(m.editor){let F=m.editor.offsetToPos(this.highlight.position).line+1;A.createEl("div",{cls:"highlight-line-number-badge"}).createEl("span",{text:`L${F}`,cls:"highlight-line-number"})}}}}this.setupDragFunctionality(A)}this.aiButtonInstance=new Fs(t,{getText:()=>this.highlight.text,getComments:()=>(this.highlight.comments||[]).map(c=>c.content||"").join(`
`)},this.plugin,{onResponse:async c=>{await this.options.onAIResponse(c)},buttonClass:"highlight-title-btn highlight-ai-btn",buttonIcon:"sparkles",buttonLabel:f("AI comment"),position:"titlebar"});let o=t.createEl("div",{cls:"highlight-more-actions-container"}).createEl("div",{cls:"highlight-title-btn highlight-more-btn",attr:{"aria-label":f("More")}});(0,AA.setIcon)(o,"ellipsis-vertical"),o.addEventListener("click",c=>{c.stopPropagation(),this.toggleMoreActionsDropdown(o)}),this.isInMainView&&this.fileName&&this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof AA.TFile&&this.generateDragContent().catch(d=>{console.error("[HighlightCard] Error pre-generating block ID:",d)});let l=this.card.createEl("div",{cls:"highlight-content"});new ai(l,this.highlight,this.options.onHighlightClick),new ps(this.card,this.highlight,c=>{this.isEditing=!0,this.selectCard(),this.options.onCommentEdit(this.highlight,c)})}showUnfocusedCommentInput(){if(this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.isEditing||this.isShowingRealInput)return;let e=this.card.querySelector(".highlight-content");e&&(this.unfocusedInput=new ms(e,this.highlight,()=>{this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}))}static findCardInstanceByElement(e){for(let A of q.cardInstances)if(A.card===e||A.card.contains(e))return A;return null}showCommentInput(){q.clearAllUnfocusedInputs(),this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}selectCard(e){if(q.clearAllUnfocusedInputs(),e&&e.shiftKey&&q.lastSelectedCard){this.card.hasClass("selected")?(this.card.removeClass("selected"),q.selectedCards.delete(this.card)):(q.selectedCards.add(q.lastSelectedCard),q.selectedCards.add(this.card),this.card.addClass("selected"));let s=new CustomEvent("highlight-multi-select",{detail:{selectedCards:Array.from(q.selectedCards),lastSelected:this.card},bubbles:!0});this.card.dispatchEvent(s)}else document.querySelectorAll(".highlight-card.selected").forEach(s=>{s!==this.card&&s.removeClass("selected")}),q.selectedCards.forEach(s=>{s!==this.card&&s.removeClass("selected")}),q.selectedCards.clear(),q.selectedCards.add(this.card),this.card.addClass("selected");let A=new CustomEvent("highlight-multi-select",{detail:{selectedCards:Array.from(q.selectedCards),lastSelected:this.card},bubbles:!0});this.card.dispatchEvent(A),e!=null&&e.shiftKey||this.showUnfocusedCommentInput(),q.lastSelectedCard=this.card}getElement(){return this.card}addPagePreview(e,A){if(!A)return;let t=this.plugin.app.vault.getAbstractFileByPath(A);if(!(t instanceof AA.TFile))return;let s;e.addEventListener("mouseenter",o=>{s=setTimeout(async()=>{let l=o.target;this.plugin.app.workspace.trigger("hover-link",{event:o,source:"hi-note",hoverParent:l,targetEl:l,linktext:t.path})},300)}),e.addEventListener("mouseleave",()=>{s&&clearTimeout(s)})}update(e){this.highlight=e,this.isEditing=!1,this.card.empty(),this.render()}generateDragContentSync(){return new ci(this.highlight,this.plugin).generateSync()}async generateDragContent(){return new ci(this.highlight,this.plugin).generate()}setupDragFunctionality(e){e.setAttribute("draggable","true"),this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof AA.TFile&&this.generateDragContent().catch(t=>{console.error("[HighlightCard] Error pre-generating block ID:",t)}),e.addEventListener("dragstart",async A=>{var t,s;try{if(!this.highlight||!this.highlight.text)throw new Error("Invalid highlight data");let o;try{let c=new Promise((d,g)=>{setTimeout(()=>g(new Error("Block ID generation timeout")),300)});o=await Promise.race([this.generateDragContent(),c])}catch(c){console.debug("[HighlightCard] Using sync fallback for drag content:",c),o=this.generateDragContentSync()}(t=A.dataTransfer)==null||t.setData("text/plain",o);let l=JSON.stringify(this.highlight);(s=A.dataTransfer)==null||s.setData("application/highlight",l),e.addClass("dragging"),li.start(A,this.highlight.text)}catch(o){console.error("[HighlightCard] Error during drag start:",o),A.preventDefault(),A.stopPropagation()}}),e.addEventListener("dragend",()=>{e.removeClass("dragging"),li.clear()})}copyHighlightContent(){try{let e=`> [!quote] HiNote
`;if(e+=`> ${this.highlight.text}`,this.highlight.filePath){let A=this.fileName||this.highlight.filePath.split("/").pop()||this.highlight.filePath;e+=`
> 
`,e+=`> From: [[${A}]]`}e+=`

`,navigator.clipboard.writeText(e).then(()=>{new AA.Notice("Copied")}).catch(A=>{console.error("\u590D\u5236\u5185\u5BB9\u5931\u8D25:",A),new AA.Notice("Failed to copy content")})}catch(e){console.error("\u590D\u5236\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519:",e),new AA.Notice("Failed to copy content")}}handleExportAsImage(){this.options.onExport(this.highlight)}toggleMoreActionsDropdown(e){let A=new AA.Menu;this.hasFlashcard=this.checkHasFlashcard(),A.addItem(s=>s.setTitle(this.hasFlashcard?f("Delete HiCard"):f("Create HiCard")).onClick(()=>this.handleCreateHiCard())),A.addItem(s=>s.setTitle(f("Copy Highlight")).onClick(()=>this.copyHighlightContent())),A.addItem(s=>s.setTitle(f("Export as Image")).onClick(()=>this.handleExportAsImage())),A.addItem(s=>s.setTitle(f("Delete")).onClick(()=>this.handleDeleteHighlight()));let t=e.getBoundingClientRect();A.showAtPosition({x:t.left-100,y:t.bottom+8})}hasVisibleMoreDropdown(){return q.visibleDropdowns.size>0}static addVisibleDropdown(e){q.isGlobalListenerAdded||(document.addEventListener("click",q.handleDocumentClick,!0),q.isGlobalListenerAdded=!0),q.visibleDropdowns.add(e)}static removeVisibleDropdown(e){q.visibleDropdowns.delete(e)}checkHasFlashcard(){let e=this.plugin.fsrsManager;if(!e||!this.highlight.id)return!1;let A=e.findCardsBySourceId(this.highlight.id,"highlight");return A&&A.length>0}async handleCreateHiCard(){try{let e=new ze(this.plugin),A=await e.isActivated(),t=A?await e.isFeatureEnabled("flashcard"):!1;if(!A||!t){new AA.Notice(f("Only HiNote Pro"));return}if(!this.plugin.fsrsManager){new AA.Notice(f("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}let o=this.checkHasFlashcard();this.hasFlashcard=o,o?await this.handleDeleteHiCard():await this.handleCreateNewHiCard()}catch(e){console.error("\u5904\u7406\u95EA\u5361\u64CD\u4F5C\u65F6\u51FA\u9519:",e),new AA.Notice(f(`\u64CD\u4F5C\u5931\u8D25: ${e.message}`))}}async deleteHiCardForHighlight(e=!1){try{return await this.handleDeleteHiCard(e),!0}catch(A){return console.error("\u5220\u9664\u95EA\u5361\u65F6\u51FA\u9519:",A),!1}}async handleDeleteHiCard(e=!1){try{let A=this.plugin.fsrsManager;if(!A){e||new AA.Notice(f("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}if(A.deleteCardsBySourceId(this.highlight.id||"","highlight")>0){this.hasFlashcard=!1;let s=A.cleanupInvalidCardReferences();!(this.highlight.comments&&this.highlight.comments.length>0)&&!e?(await this.deleteHighlightCompletely(),e||new AA.Notice(f("Flashcard and highlight deleted"))):e||new AA.Notice(f("Flashcard deleted, highlight and comments preserved")),this.updateIconsAfterCardDeletion(),e||this.plugin.eventManager.emitFlashcardChanged()}else e||new AA.Notice(f("Flashcard not found"))}catch(A){console.error("\u5220\u9664\u95EA\u5361\u65F6\u51FA\u9519:",A),e||new AA.Notice(f(`Failed to delete flashcard: ${A.message}`))}}async deleteHighlightCompletely(){try{if(this.highlight.filePath){let e=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(e instanceof AA.TFile){let A=window.app.plugins.plugins["hi-note"];A&&A.commentStore?await A.commentStore.removeComment(e,this.highlight):console.warn("\u65E0\u6CD5\u8BBF\u95EE commentStore"),this.plugin.eventManager.emitHighlightDelete(this.highlight.filePath,this.highlight.text||"",this.highlight.id||"")}}}catch(e){throw console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",e),e}}async createHiCardForHighlight(e=!1){try{return await this.handleCreateNewHiCard(e),!0}catch(A){return console.error("\u521B\u5EFA\u95EA\u5361\u65F6\u51FA\u9519:",A),!1}}async handleCreateNewHiCard(e=!1){let A=this.plugin.fsrsManager;if(!A){new AA.Notice(f("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}if(this.highlight.id||(console.warn("\u9AD8\u4EAE\u7F3A\u5C11 ID\uFF0C\u6B63\u5728\u751F\u6210..."),this.highlight.id=`highlight-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),this.highlight.filePath)try{let u=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(u instanceof AA.TFile){let m={id:this.highlight.id,text:this.highlight.text||"",position:this.highlight.position||0,comments:this.highlight.comments||[],createdAt:this.highlight.createdAt||Date.now(),updatedAt:this.highlight.updatedAt||Date.now(),isVirtual:this.highlight.isVirtual,filePath:this.highlight.filePath,fileType:this.highlight.fileType,displayText:this.highlight.displayText,paragraphOffset:this.highlight.paragraphOffset,backgroundColor:this.highlight.backgroundColor,isCloze:this.highlight.isCloze},w=window.app.plugins.plugins["hi-note"];w&&w.commentStore?await w.commentStore.addComment(u,m):console.warn("\u65E0\u6CD5\u8BBF\u95EE commentStore")}}catch(u){console.error("\u4FDD\u5B58\u9AD8\u4EAE\u65F6\u51FA\u9519:",u)}else console.warn("\u9AD8\u4EAE\u5BF9\u8C61\u7F3A\u5C11\u6587\u4EF6\u8DEF\u5F84");let t=this.highlight.text||"",s="",o=/\{\{([^{}]+)\}\}/g,l,c=[];for(;(l=o.exec(t))!==null;)c.push(l[1]);let d=[];if(c.length>0&&d.push(c.join(`
`)),this.highlight.comments&&this.highlight.comments.length>0&&d.push(this.highlight.comments.map(u=>u.content||"").join(`
`)),s=d.length>0?d.join(`

`):f("Add answer"),!A.addCard(t,s,this.highlight.filePath||this.fileName,this.highlight.id,"highlight")){new AA.Notice(f("Failed to create flashcard, please check highlight content"));return}this.plugin.eventManager.emitFlashcardChanged(),e||new AA.Notice(f("Flashcard created successfully!")),this.hasFlashcard=!0,this.updateIconsAfterCardCreation()}updateIconsAfterCardDeletion(){this.card.querySelectorAll(".highlight-card-icon").forEach(A=>{(0,AA.setIcon)(A,"file-text"),A.removeClass("has-flashcard")})}updateIconsAfterCardCreation(){this.card.querySelectorAll(".highlight-card-icon").forEach(A=>{(0,AA.setIcon)(A,"book-heart"),A.addClass("has-flashcard")})}updateCreateHiCardButtonText(){let e=this.card.querySelector(".create-hicard-btn");e&&(e.textContent=this.hasFlashcard?f("Delete HiCard"):f("Create HiCard"))}async handleDeleteHighlight(e=!1,A=!1){try{if(!e&&!confirm(f("Delete this highlight and all its data, including Comments and HiCards? Can't undo.")))return;if(this.hasFlashcard&&await this.handleDeleteHiCard(!0),this.highlight.filePath){let t=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(t instanceof AA.TFile){let s=window.app.plugins.plugins["hi-note"];s&&s.commentStore?await s.commentStore.removeComment(t,this.highlight):console.warn("\u65E0\u6CD5\u8BBF\u95EE commentStore"),await this.removeHighlightFormatFromEditor(t),this.plugin.eventManager.emitHighlightDelete(this.highlight.filePath,this.highlight.text||"",this.highlight.id||""),A||new AA.Notice(f("Successfully deleted")),this.card.remove(),q.cardInstances.delete(this)}}else console.warn("\u9AD8\u4EAE\u5BF9\u8C61\u7F3A\u5C11\u6587\u4EF6\u8DEF\u5F84"),new AA.Notice(f("\u5220\u9664\u9AD8\u4EAE\u5931\u8D25\uFF1A\u7F3A\u5C11\u6587\u4EF6\u8DEF\u5F84"))}catch(t){console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",t),new AA.Notice(f(`\u5220\u9664\u9AD8\u4EAE\u5931\u8D25: ${t.message}`))}}async removeHighlightFormatFromEditor(e){let A=null,t="",s=this.plugin.app.workspace.getActiveViewOfType(AA.MarkdownView);if(s&&s.file&&s.file.path===e.path&&(A=s.editor),A?t=A.getValue():t=await this.plugin.app.vault.read(e),typeof this.highlight.position=="number"){let o=this.highlight.position,l=this.highlight.text,c=t.substring(Math.max(0,o-100),o),d=t.substring(o+l.length,Math.min(t.length,o+l.length+100)),g=[new RegExp(`==\\s*(${this.escapeRegExp(l)})\\s*==`,"g"),new RegExp(`<mark[^>]*>(${this.escapeRegExp(l)})</mark>`,"g"),new RegExp(`<span[^>]*>(${this.escapeRegExp(l)})</span>`,"g")],u=t,m=!1,w=t;for(let F of g)if(w.match(F)){u=w.replace(F,l),m=!0;break}if(!m){let F=window.app.plugins.plugins["hi-note"];if(F&&F.settings&&F.settings.customHighlightRegex)try{let Q=new RegExp(F.settings.customHighlightRegex,"g"),E=w.match(Q);if(E)for(let H of E)H.includes(l)&&(u=u||w,u=u.replace(H,l),m=!0)}catch(Q){console.error("\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u9519\u8BEF:",Q)}}if(!m){let F=this.escapeRegExp(l),Q=new RegExp(`==\\s*(${F})\\s*==`,"g");u=t.replace(Q,l);let E=new RegExp(`<mark[^>]*>(${F})</mark>`,"g");u=u.replace(E,l);let H=new RegExp(`<span[^>]*>(${F})</span>`,"g");u=u.replace(H,l)}A?A.setValue(u):await this.plugin.app.vault.modify(e,u)}else{let o=this.highlight.text,l=this.escapeRegExp(o),c=[new RegExp(`==\\s*(${l})\\s*==`,"g"),new RegExp(`<mark[^>]*>(${l})</mark>`,"g"),new RegExp(`<span[^>]*>(${l})</span>`,"g")],d=t,g=!1;for(let u of c){let m=d.replace(u,o);if(m!==d){d=m,g=!0;break}}if(!g){let u=window.app.plugins.plugins["hi-note"];if(u&&u.settings&&u.settings.customHighlightRegex)try{let m=new RegExp(u.settings.customHighlightRegex,"g"),w=d.replace(m,(F,...Q)=>{for(let E of Q)if(typeof E=="string"&&E.includes(o))return o;return F});w!==d&&(d=w,g=!0)}catch(m){console.error("\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u9519\u8BEF:",m)}}if(!g){let u=new RegExp(`==\\s*${l}\\s*==`,"g");d=t.replace(u,o)}A?A.setValue(d):await this.plugin.app.vault.modify(e,d)}}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}destroy(){this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.moreActionsDropdown&&(this.moreActionsDropdown.remove(),this.moreActionsDropdown=null),q.cardInstances.delete(this)}};window.HighlightCard={findCardInstanceByHighlightId:q.findCardInstanceByHighlightId},q.selectedCards=new Set,q.lastSelectedCard=null,q.cardInstances=new Set,q.visibleDropdowns=new Set,q.isGlobalListenerAdded=!1,q.handleDocumentClick=e=>{for(let A of q.visibleDropdowns){let t=A.closest(".highlight-card");t&&!t.contains(e.target)&&!A.contains(e.target)&&(A.classList.add("hi-note-hidden"),q.visibleDropdowns.delete(A))}};var IA=q;var di=require("obsidian");var ys=class{static shouldExclude(e,A){if(!A||A.trim().length===0)return!1;let t=A.split(",").map(l=>l.trim()).filter(l=>l.length>0),s=e.path,o=e.basename;return t.some(l=>{if(l=l.trim(),!l)return!1;if(l.startsWith("[[")&&l.endsWith("]]")){let g=l.slice(2,-2);return o===g}if(l.startsWith("*.")){let g=l.slice(2);return e.extension===g||s.endsWith(g)}let c=l.replace(/^\/+/,""),d=s.replace(/^\/+/,"");return d.startsWith(c+"/")||d===c})}};var hi=class{extractColorFromStyle(e){if(!e)return null;let A=e.match(/background(?:-color)?:\s*((?:rgba?\(.*?\)|#[0-9a-fA-F]{3,8}|var\(--[^)]+\)))/);return A?A[1]:null}extractColorFromElement(e){let A=e.match(/style=["']([^"']*)["']/);return A?this.extractColorFromStyle(A[1]):null}};hi.COLOR_PATTERNS=[/rgba?\(\d+,\s*\d+,\s*\d+(?:,\s*[0-9.]+)?\)/,/#[0-9a-fA-F]{3,8}/,/var\(--[^)]+\)/];var Eo=require("obsidian"),je=class{constructor(e){this.app=e;this.events=new Eo.Events}emitHighlightUpdate(e,A,t,s){this.events.trigger("highlight:update",e,A,t,s)}emitHighlightDelete(e,A,t){this.events.trigger("highlight:delete",e,A,t)}emitCommentUpdate(e,A,t,s){this.events.trigger("comment:update",e,A,t,s)}emitCommentDelete(e,A,t){this.events.trigger("comment:delete",e,A,t)}emitFlashcardChanged(){this.events.trigger("flashcard:changed")}on(e,A){return this.events.on(e,A)}off(e,A){this.events.off(e,A)}};var De=class De{constructor(e){this.app=e}getOrCreateBlockId(e,A){let t=e.getLine(A),s=t.match(De.BLOCK_ID_REGEX);if(s)return s[1];let o="";for(let c=0;c<7;c++)o+=De.BLOCK_ID_CHARS.charAt(Math.floor(Math.random()*De.BLOCK_ID_CHARS.length));let l=t.trimEnd();return e.setLine(A,`${l} ^${o}`),o}extractBlockId(e){let A=e.match(De.BLOCK_ID_REGEX);return A?A[1]:void 0}getParagraphBlockId(e,A){let t=this.app.metadataCache.getFileCache(e);if(!(t!=null&&t.sections))return;let s=t.sections.find(o=>o.position.start.offset<=A&&o.position.end.offset>=A);return s!=null&&s.id?`${e.path}#^${s.id}`:void 0}async createParagraphBlockId(e,A,t){let s=this.getParagraphBlockId(e,A);if(s)return s;let o=this.app.workspace.getLeaf();await o.openFile(e,{active:!1});let c=o.view.editor,g=c.offsetToPos(A).line,u=this.app.metadataCache.getFileCache(e);if(u!=null&&u.sections){let w=t||A,F=u.sections.find(Q=>Q.position.start.offset<=w&&Q.position.end.offset>=w);F&&(g=c.offsetToPos(F.position.end.offset).line,console.debug(`[BlockIdService] \u627E\u5230\u5305\u542B\u9AD8\u4EAE\u7684\u6BB5\u843D\uFF0C\u7ED3\u675F\u884C: ${g}`))}let m=this.getOrCreateBlockId(c,g);return await this.app.vault.modify(e,c.getValue()),`${e.path}#^${m}`}hasValidBlockId(e){return De.BLOCK_ID_REGEX.test(e)}};De.BLOCK_ID_REGEX=/\^([a-zA-Z0-9-]+)$/,De.BLOCK_ID_CHARS="abcdefghijklmnopqrstuvwxyz0123456789";var xt=De;var Qs=class Qs{constructor(e){this.app=e;this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0};this.isIndexing=!1;var s;let A=e.plugins,t=A&&A.plugins?A.plugins["hi-note"]:void 0;this.settings=t==null?void 0:t.settings,this.colorExtractor=new hi,this.eventManager=new je(e),this.blockIdService=new xt(e),console.debug("[HighlightService] Current settings:",this.settings),console.debug("[HighlightService] Exclude patterns:",(s=this.settings)==null?void 0:s.excludePatterns)}async initialize(){this.registerFileEventHandlers(),setTimeout(()=>{this.buildFileIndex().then(()=>{})},3e3)}destroy(){this.unregisterFileEventHandlers(),this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0}}registerFileEventHandlers(){this.fileCreateEventRef=this.app.vault.on("create",e=>{e instanceof di.TFile&&e.extension==="md"&&this.updateFileInIndex(e)}),this.fileModifyEventRef=this.app.vault.on("modify",e=>{e instanceof di.TFile&&e.extension==="md"&&this.updateFileInIndex(e)}),this.fileDeleteEventRef=this.app.vault.on("delete",e=>{e instanceof di.TFile&&e.extension==="md"&&this.removeFileFromIndex(e.path)}),this.fileRenameEventRef=this.app.vault.on("rename",(e,A)=>{e instanceof di.TFile&&e.extension==="md"&&(this.removeFileFromIndex(A),this.updateFileInIndex(e))})}unregisterFileEventHandlers(){this.app.vault.offref(this.fileCreateEventRef),this.app.vault.offref(this.fileModifyEventRef),this.app.vault.offref(this.fileDeleteEventRef),this.app.vault.offref(this.fileRenameEventRef)}shouldProcessFile(e){var A;return!ys.shouldExclude(e,((A=this.settings)==null?void 0:A.excludePatterns)||"")}extractHighlights(e,A){var s;let t=[];if(this.settings.useCustomPattern&&((s=this.settings.regexRules)==null?void 0:s.length)>0)for(let o of this.settings.regexRules.filter(l=>l.enabled))try{let l=new RegExp(o.pattern,"g");this.processRegexMatches(e,l,t,A,o.color)}catch(l){console.error(`[HighlightService] \u6B63\u5219\u89C4\u5219 "${o.name}" \u9519\u8BEF:`,l)}else this.processRegexMatches(e,Qs.DEFAULT_HIGHLIGHT_PATTERN,t,A,"#ffeb3b");return t.sort((o,l)=>{var c,d;return((c=o.position)!=null?c:0)-((d=l.position)!=null?d:0)})}processRegexMatches(e,A,t,s,o){let l=[];if(s){let g=this.app.metadataCache.getFileCache(s);g!=null&&g.sections&&(l=g.sections.filter(m=>["code","codeblock","fenced_code","pre"].includes(m.type)).map(m=>[m.position.start.offset,m.position.end.offset]))}function c(g,u,m){return m.some(([w,F])=>Math.max(g,w)<Math.min(u,F))}let d;for(;(d=A.exec(e))!==null;){let g=d,u=g[0],m=g.index,w=m+u.length;if(c(m,w,l))continue;let F=g.slice(1).find(H=>H!==void 0);F||(F=u);let Q=null;if(u.includes("style=")&&(Q=this.colorExtractor.extractColorFromElement(u)),!t.some(H=>typeof H.position=="number"&&Math.abs(H.position-g.index)<10&&H.text===F)&&F&&s){let H=this.app.metadataCache.getFileCache(s);if(H!=null&&H.sections){let b=H.sections.find(N=>N.position.start.offset<=g.index&&N.position.end.offset>=g.index),K=b==null?void 0:b.id;if(!K){let N=this.blockIdService.getParagraphBlockId(s,g.index);if(N){let W=N.match(/#\^([a-zA-Z0-9-]+)/);W&&W[1]&&(K=W[1])}}let M=/\{\{([^{}]+)\}\}/.test(F),D={text:F,position:g.index,paragraphOffset:this.getParagraphOffset(e,g.index),backgroundColor:Q||o,id:`highlight-${Date.now()}-${g.index}`,comments:[],createdAt:Date.now(),updatedAt:Date.now(),originalLength:u.length,blockId:K,isCloze:M,filePath:s.path};t.push(D)}}}}getParagraphOffset(e,A){let t=e.substring(0,A),s=t.split(/\n\s*\n/);return t.length-s[s.length-1].length}async getFilesWithHighlights(){let e=this.app.vault.getMarkdownFiles(),A=[],t=0;for(let s of e){if(!this.shouldProcessFile(s))continue;let o=await this.app.vault.read(s),l=this.extractHighlights(o,s);l.length>0&&(A.push(s),t+=l.length)}return A}async getAllHighlights(){let e=this.app.vault.getMarkdownFiles(),A=[];for(let t of e){if(!this.shouldProcessFile(t))continue;let s=await this.app.vault.read(t),o=this.extractHighlights(s,t);o.length>0&&A.push({file:t,highlights:o})}return A}async buildFileIndex(){var A,t;if(this.isIndexing)return;this.isIndexing=!0;let e=Date.now();try{let s=await this.getAllHighlights(),o=new Map,l=new Map;for(let{file:c,highlights:d}of s){let g=d.map(m=>({...m,fileName:c.basename,filePath:c.path}));l.set(c.path,g);let u=new Set;for(let m of d){let w=this.tokenizeText(m.text);for(let F of w)u.add(F);if((A=m.comments)!=null&&A.length)for(let F of m.comments){let Q=this.tokenizeText(F.content);for(let E of Q)u.add(E)}}for(let m of u)o.has(m)||o.set(m,new Set),(t=o.get(m))==null||t.add(c.path)}this.fileIndex={wordToFiles:o,fileToHighlights:l,lastUpdated:Date.now()}}catch(s){console.error("\u6784\u5EFA\u7D22\u5F15\u65F6\u51FA\u9519:",s)}finally{this.isIndexing=!1}}tokenizeText(e){return e?e.toLowerCase().split(/\s+/).filter(t=>t.length>=2).map(t=>t.replace(/[.,;:!?()\[\]{}'"`~]/g,"")).filter(t=>t.length>=2):[]}removeFileFromIndex(e){if(!(this.fileIndex.lastUpdated===0||Date.now()-this.fileIndex.lastUpdated>36e5))try{if(this.fileIndex.fileToHighlights.has(e)){for(let[A,t]of this.fileIndex.wordToFiles.entries())t.delete(e),t.size===0&&this.fileIndex.wordToFiles.delete(A);this.fileIndex.fileToHighlights.delete(e)}}catch(A){console.error(`[HighlightService] \u79FB\u9664\u6587\u4EF6 ${e} \u7D22\u5F15\u65F6\u51FA\u9519:`,A)}}async updateFileInIndex(e){var A,t;if(!(this.fileIndex.lastUpdated===0||Date.now()-this.fileIndex.lastUpdated>36e5))try{if(this.removeFileFromIndex(e.path),this.shouldProcessFile(e)){let s=await this.app.vault.read(e),o=this.extractHighlights(s,e);if(o.length>0){let l=o.map(d=>({...d,fileName:e.basename,filePath:e.path}));this.fileIndex.fileToHighlights.set(e.path,l);let c=new Set;for(let d of o){let g=this.tokenizeText(d.text);for(let u of g)c.add(u);if((A=d.comments)!=null&&A.length)for(let u of d.comments){let m=this.tokenizeText(u.content);for(let w of m)c.add(w)}}for(let d of c)this.fileIndex.wordToFiles.has(d)||this.fileIndex.wordToFiles.set(d,new Set),(t=this.fileIndex.wordToFiles.get(d))==null||t.add(e.path)}}}catch(s){console.error(`\u66F4\u65B0\u6587\u4EF6 ${e.path} \u7684\u7D22\u5F15\u65F6\u51FA\u9519:`,s)}}async searchHighlightsFromIndex(e){var c;if((Date.now()-this.fileIndex.lastUpdated>36e5||this.fileIndex.fileToHighlights.size===0)&&await this.buildFileIndex(),!e.trim()){let d=[];for(let g of this.fileIndex.fileToHighlights.values())d.push(...g);return d}let t=this.tokenizeText(e);if(t.length===0){let d=[];for(let g of this.fileIndex.fileToHighlights.values())d.push(...g);return d}let s=[];for(let d of t){let g=new Set;for(let[u,m]of this.fileIndex.wordToFiles.entries())if(u.includes(d))for(let w of m)g.add(w);s.push(g)}let o;if(s.length>0){o=s[0];for(let d=1;d<s.length;d++)o=new Set([...o].filter(g=>s[d].has(g)))}else o=new Set;let l=[];for(let d of o){let g=this.fileIndex.fileToHighlights.get(d)||[];for(let u of g){let m=u.text.toLowerCase(),w=((c=u.comments)==null?void 0:c.map(Q=>Q.content.toLowerCase()))||[];t.every(Q=>m.includes(Q)||w.some(E=>E.includes(Q)))&&l.push(u)}}return l}async createBlockIdForHighlight(e,A,t){try{let s=this.blockIdService.getParagraphBlockId(e,A);if(s)return s;let o=t?A+t:A;return await this.blockIdService.createParagraphBlockId(e,A,o)}catch(s){throw console.error("[HighlightService] Error creating block ID for highlight:",s),s}}};Qs.DEFAULT_HIGHLIGHT_PATTERN=/==\s*([\s\S]*?)\s*==|<mark[^>]*>([\s\S]*?)<\/mark>|<span[^>]*>([\s\S]*?)<\/span>/g;var le=Qs;var gi=require("obsidian");var we=class{constructor(e){this.app=e;this.SIMILARITY_THRESHOLD=.7;this.MAX_SEARCH_RANGE=5e3;this.POSITION_WEIGHT=.3;this.POSITION_TOLERANCE=100}levenshteinDistance(e,A){if(e===A)return 0;if(e.length===0)return A.length;if(A.length===0)return e.length;let t=[];for(let s=0;s<=e.length;s++)t[s]=[s];for(let s=0;s<=A.length;s++)t[0][s]=s;for(let s=1;s<=e.length;s++)for(let o=1;o<=A.length;o++)e[s-1]===A[o-1]?t[s][o]=t[s-1][o-1]:t[s][o]=Math.min(t[s-1][o-1]+1,t[s][o-1]+1,t[s-1][o]+1);return t[e.length][A.length]}calculateSimilarity(e,A){let t=this.levenshteinDistance(e,A),s=Math.max(e.length,A.length);return s===0?1:1-t/s}findBestMatch(e,A,t,s){if(e.length<10){if(t!==void 0&&t>=0){let F=Math.max(0,t-this.POSITION_TOLERANCE),Q=Math.min(A.length,t+this.POSITION_TOLERANCE),H=A.substring(F,Q).indexOf(e);if(H!==-1)return{text:e,position:F+H}}let w=A.indexOf(e);return w!==-1?{text:e,position:w}:null}let o=s||this.SIMILARITY_THRESHOLD,l=A,c=0;if(t!==void 0&&t>=0){let w=this.MAX_SEARCH_RANGE/2,F=Math.max(0,t-w),Q=Math.min(A.length,t+w);l=A.substring(F,Q),c=F}let d=this.extractPossibleMatches(l,e.length),g=null,u=0,m=-1;for(let w of d){let F=this.calculateSimilarity(e,w.text);if(F<o)continue;let Q=1;if(t!==void 0&&t>=0){let b=w.position+c,K=Math.abs(b-t);Q=Math.max(0,1-K/(this.POSITION_TOLERANCE*2))}let E=F*(1-this.POSITION_WEIGHT)+Q*this.POSITION_WEIGHT,H=F===1?F*.5+Q*.5:E;H>u&&(u=H,g=w.text,m=w.position)}return g&&m!==-1?{text:g,position:m+c}:null}extractPossibleMatches(e,A){let t=[],s=new Set,o=Math.max(3,Math.floor(A*.9)),l=Math.ceil(A*1.1);for(let g=o;g<=l;g++){let u=Math.max(1,Math.floor(g/4));for(let m=0;m<e.length-g+1;m+=u){let w=e.substring(m,m+g),F=`${m}:${w.length}`;s.has(F)||(t.push({text:w,position:m}),s.add(F))}}let c=e.split(/[.!?;:\n\r]+/),d=0;for(let g of c){let u=g.trim();if(u.length>=o&&u.length<=l*2&&(d=e.indexOf(u,d),d!==-1)){let m=`${d}:${u.length}`;s.has(m)||(t.push({text:u,position:d}),s.add(m)),d+=u.length}}return t}};var Es=class{constructor(e){this.app=e;this.textSimilarityService=new we(e)}async jumpToHighlight(e,A){let t=await this.openOrActivateFile(A);t&&await this.locateAndHighlightText(t,e.text,e.position)}async openOrActivateFile(e){let t=this.app.workspace.getLeavesOfType("markdown").find(s=>{var l;return((l=s.view.file)==null?void 0:l.path)===e});if(!t)try{let s=this.app.vault.getAbstractFileByPath(e);if(!s)return new gi.Notice("\u672A\u627E\u5230\u6587\u4EF6"),null;t=await this.app.workspace.getLeaf("tab"),await t.openFile(s)}catch(s){return new gi.Notice("\u6253\u5F00\u6587\u4EF6\u5931\u8D25"),null}return await this.app.workspace.setActiveLeaf(t,{focus:!1}),t}async locateAndHighlightText(e,A,t){await new Promise(Q=>setTimeout(Q,300));let o=e.view.editor,l=o.getValue(),c=-1,d=[],g=A,u=0,m=-1;for(;(m=l.indexOf(A,u))!==-1;)d.push(m),u=m+1;if(t!==void 0&&t>=0){if(l.substring(t,t+A.length)===A)c=t;else if(d.length>0){let Q=d[0],E=Math.abs(t-Q);for(let H of d){let b=Math.abs(t-H);b<E&&(E=b,Q=H)}c=Q}}if(c===-1)if(d.length>0)c=d[0];else{let Q=this.textSimilarityService.findBestMatch(A,l,t);if(Q)c=Q.position,g=Q.text,new gi.Notice("\u4F7F\u7528\u6A21\u7CCA\u5339\u914D\u627E\u5230\u4E86\u76F8\u4F3C\u5185\u5BB9");else{new gi.Notice("\u672A\u627E\u5230\u9AD8\u4EAE\u5185\u5BB9");return}}let w=o.offsetToPos(c),F=o.offsetToPos(c+g.length);o.setSelection(w,F),o.scrollIntoView({from:w,to:F},!0),this.app.workspace.setActiveLeaf(e,{focus:!0})}};var tn=require("obsidian");var XA=class{static generateHighlightId(e,A,t){let s=`${e}:${A}:${t}`,o=this.hashCode(s);return`highlight-${Math.abs(o)}-${A}`}static generateCommentId(){let e=Date.now(),A=Math.random().toString(36).substr(2,9);return`comment-${e}-${A}`}static generateCardId(){let e=Date.now(),A=Math.random().toString(36).substr(2,9);return`card-${e}-${A}`}static generateGroupId(){let e=Date.now(),A=Math.random().toString(36).substr(2,7);return`group-${e}-${A}`}static hashCode(e){let A=0;if(e.length===0)return A;for(let t=0;t<e.length;t++){let s=e.charCodeAt(t);A=(A<<5)-A+s,A=A&A}return A}static isValidHighlightId(e){return/^highlight-\d+-\d+$/.test(e)}static isValidCommentId(e){return/^comment-\d+-[a-z0-9]+$/.test(e)}static isValidCardId(e){return/^card-\d+-[a-z0-9]+$/.test(e)}static extractPositionFromHighlightId(e){let A=e.match(/^highlight-\d+-(\d+)$/);return A?parseInt(A[1],10):null}};var Us=class{constructor(e,A){this.app=e;this.commentStore=A;this.highlightService=new le(e)}async exportHighlightsAsMarkdown(e){var m,w,F,Q;if(!e||e.length===0)return null;let A=this.app.plugins,t=A&&A.plugins?A.plugins["hi-note"]:void 0,s={};for(let E of e)E.filePath&&(s[E.filePath]||(s[E.filePath]=[]),s[E.filePath].push(E));let o=[];for(let E in s){let H=this.app.vault.getAbstractFileByPath(E);if(!(H instanceof tn.TFile))continue;o.push(`## ${H.basename}`),o.push("");let b=s[E],K=(w=(m=t==null?void 0:t.settings)==null?void 0:m.export)==null?void 0:w.exportTemplate;if(K&&K.trim()!==""){let M=await this.generateContentFromTemplate(H,b,K);M.trim()!==""&&o.push(M)}else{let M=await this.generateDefaultContent(H,b);o.push(M)}}let l=o.join(`
`),c=((Q=(F=t==null?void 0:t.settings)==null?void 0:F.export)==null?void 0:Q.exportPath)||"",d=`Selected Highlights ${window.moment().format("YYYYMMDDHHmm")}`,g=d;return c&&(this.app.vault.getAbstractFileByPath(c)||await this.app.vault.createFolder(c),g=`${c}/${d}`),await this.app.vault.create(`${g}.md`,l)}async generateContentForMultipleHighlights(e){let A=[];A.push(`# ${f("Selected Highlights")}`),A.push(""),A.push(`*${f("Exported on")} ${window.moment().format("YYYY-MM-DD HH:mm:ss")}*`),A.push("");let t={};for(let s of e)s.filePath&&(t[s.filePath]||(t[s.filePath]=[]),t[s.filePath].push(s));for(let s in t){let o=this.app.vault.getAbstractFileByPath(s);if(!(o instanceof tn.TFile))continue;A.push(`## ${o.basename}`),A.push("");let l=t[s];for(let c of l){if(A.push(`> ${c.text}`),A.push("> "),c.comments&&c.comments.length>0){A.push("> ---"),A.push("> ");for(let d of c.comments){A.push(">> [!note] Comment");let g=d.content.split(`
`).map(u=>(u=u.trim(),u?`>> ${u}`:">>")).join(`
`);if(A.push(g),d.updatedAt){let u=window.moment(d.updatedAt);A.push(`>> *${u.format("YYYY-MM-DD HH:mm:ss")}*`)}A.push(">")}}A.push("")}}return A.join(`
`)}async exportHighlightsToNote(e){var u,m;let A=await this.getFileHighlights(e);if(!A||A.length===0)throw new Error(f("No highlights found in the current file."));let t=await this.generateExportContent(e,A),s=this.app.plugins,o=s&&s.plugins?s.plugins["hi-note"]:void 0,l=((m=(u=o==null?void 0:o.settings)==null?void 0:u.export)==null?void 0:m.exportPath)||"",c=`${e.basename} - HiNote ${window.moment().format("YYYYMMDDHHmm")}`,d=c;return l&&(this.app.vault.getAbstractFileByPath(l)||await this.app.vault.createFolder(l),d=`${l}/${c}`),await this.app.vault.create(`${d}.md`,t)}async getFileHighlights(e){let A=await this.app.vault.read(e),t=this.highlightService.extractHighlights(A,e),s=this.commentStore.getFileComments(e),o=s.filter(d=>d.isVirtual&&d.comments&&d.comments.length>0),l=s.filter(d=>!d.isVirtual),c=t.map(d=>{var u,m,w,F;let g=l.find(Q=>{let E=Q.text===d.text;return E&&typeof Q.position=="number"&&typeof d.position=="number"?Math.abs(Q.position-d.position)<1e3:E});return g?{...g,position:(u=d.position)!=null?u:0,paragraphOffset:(m=d.paragraphOffset)!=null?m:0}:{id:XA.generateHighlightId(e.path,d.position||0,d.text),...d,position:(w=d.position)!=null?w:0,paragraphOffset:(F=d.paragraphOffset)!=null?F:0,comments:[],createdAt:Date.now(),updatedAt:Date.now()}});return[...o,...c]}async generateExportContent(e,A){var l,c;let t=this.app.plugins,s=t&&t.plugins?t.plugins["hi-note"]:void 0,o=(c=(l=s==null?void 0:s.settings)==null?void 0:l.export)==null?void 0:c.exportTemplate;return o&&o.trim()!==""?this.generateContentFromTemplate(e,A,o):this.generateDefaultContent(e,A)}async generateContentFromTemplate(e,A,t){let s=[];for(let o of A){let l=await this.generateStructuredContent(o,e,t);s.push(...l),s.push("")}return s.join(`
`)}replaceVariables(e,A){let t=e;for(let[s,o]of Object.entries(A))t=t.replace(new RegExp(`{{${s}}}`,"g"),o||"");return t}formatComment(e,A=!1){let t=[],s=A?">":">>";if(!A){let l=e.updatedAt?window.moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";t.push(`>> [!note]+ ${l}`)}let o=e.content.split(`
`).map(l=>(l=l.trim(),l?`${s} ${l}`:s)).join(`
`);return t.push(o),t.push(">"),t}async generateStructuredContent(e,A,t){let s=[];if(e.isVirtual)s.push(`> [!note] [[${A.basename}]]`),s.push("> ");else if(t&&(t.includes("{{highlightText}}")||t.includes("{{highlightBlockRef}}"))){let o=this.extractHighlightTemplate(t),l="";if(typeof e.position=="number"&&t.includes("{{highlightBlockRef}}"))try{let d=e.originalLength||e.text.length;l=await this.highlightService.createBlockIdForHighlight(A,e.position,d)||""}catch(d){console.error("[ExportService] Error creating block ID:",d)}let c=this.replaceVariables(o,{sourceFile:A.basename,highlightText:e.text||"",highlightBlockRef:l,highlightType:"HiNote",commentContent:"",commentDate:""});s.push(...c.split(`
`))}else s.push("> [!quote] HiNote"),s.push(`> ${e.text||""}`),s.push("> ");if(e.comments&&e.comments.length>0)for(let o of e.comments)s.push(...this.formatComment(o,e.isVirtual));return s}extractHighlightTemplate(e){let A=e,t=/\n>>\s*\[!note\]\+[\s\S]*?(?=\n>\s*$|\n\s*$|$)/g;return A=A.replace(t,""),A=A.replace(/\{\{commentContent\}\}/g,""),A=A.replace(/\{\{commentDate\}\}/g,""),A=A.replace(/\n{3,}/g,`

`),A=A.replace(/\n>\s*\n\s*$/g,`
`),A.trim()}async generateDefaultContent(e,A){return this.generateContentFromTemplate(e,A,`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`)}getParagraphOffset(e,A){let s=e.substring(0,A).lastIndexOf(`
`);return s===-1?A:A-s}generateHighlightId(e,A){return XA.generateHighlightId(A,e.position||0,e.text)}};var Se=require("obsidian");var Zg=/#[\w\u4e00-\u9fa5]+/g,zg=/^\s*(#[\w\u4e00-\u9fa5]+(\s+#[\w\u4e00-\u9fa5]+)*\s*)$/,Ss=class{constructor(e,A,t,s,o){this.card=e;this.highlight=A;this.existingComment=t;this.plugin=s;this.options=o;this.cancelEdit=()=>{};this.isProcessing=!1;this.isAIProcessing=!1;this.originalContent="";if(this.boundHandleOutsideClick=this.handleOutsideClick.bind(this),document.addEventListener("click",this.boundHandleOutsideClick),this.findHighlightCardInstance()){let c=new CustomEvent("comment-input-shown",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(c)}}findHighlightCardInstance(){var e,A;try{return(A=(e=window.HighlightCard)==null?void 0:e.findCardInstanceByHighlightId)==null?void 0:A.call(e,this.highlight.id)}catch(t){return null}}show(){this.existingComment?this.showEditMode():this.showCreateMode()}showEditMode(){var o;let e=this.card.querySelector(`[data-comment-id="${this.existingComment.id}"]`);if(!e)return;let A=e.querySelector(".hi-note-content");if(!A)return;let t=((o=this.existingComment)==null?void 0:o.content)||"";this.textarea=document.createElement("textarea"),this.textarea.value=t,this.textarea.className="hi-note-input",this.textarea.style.minHeight=`${A.offsetHeight}px`,this.textarea.addEventListener("input",()=>{this.processTagsInInput(),this.autoResizeTextarea()}),this.textarea.addEventListener("click",l=>{l.stopPropagation()}),A.replaceWith(this.textarea);let s=e.querySelector(".hi-note-footer");if(s&&s.addClass("hi-note-hidden"),this.actionHint=e.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",l=>{l.stopPropagation()}),!Se.Platform.isMobile)this.actionHint.createEl("span",{cls:"hi-note-hint",text:f("Tab AI, Shift + Enter Wrap, Enter Save")});else{let l=this.actionHint.createEl("button",{cls:"hi-note-save-button",text:f("Submit")});l.addEventListener("click",async c=>{if(c.stopPropagation(),this.isProcessing)return;let d=this.textarea.value.trim();if(d){this.isProcessing=!0,this.textarea.disabled=!0,l.disabled=!0;try{await this.options.onSave(d),requestAnimationFrame(()=>{document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea.disabled=!1})}catch(g){this.isProcessing=!1,this.textarea.disabled=!1,l.disabled=!1}}})}this.options.onDelete&&this.actionHint.createEl("div",{cls:"hi-note-delete-link",text:f("Delete comment")}).addEventListener("click",async c=>{var d,g;c.stopPropagation(),await((g=(d=this.options).onDelete)==null?void 0:g.call(d))}),this.setupKeyboardEvents(A,s||void 0),setTimeout(()=>{this.textarea.focus(),this.textarea.setSelectionRange(this.textarea.value.length,this.textarea.value.length)},50)}showCreateMode(){let e=document.createElement("div");e.className="hi-note-input",this.textarea=e.createEl("textarea"),this.textarea.addEventListener("input",()=>{this.processTagsInInput(),this.autoResizeTextarea()}),e.addEventListener("click",s=>{s.stopPropagation()}),this.textarea.addEventListener("click",s=>{s.stopPropagation()});let A=this.card.querySelector(".hi-notes-section");A||(A=this.card.createEl("div",{cls:"hi-notes-section"}),A.createEl("div",{cls:"hi-notes-list"}));let t=A.querySelector(".hi-notes-list");if(t&&t.insertBefore(e,t.firstChild),this.actionHint=e.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",s=>{s.stopPropagation()}),!Se.Platform.isMobile)this.actionHint.createEl("span",{cls:"hi-note-hint",text:f("Tab AI, Shift + Enter Wrap, Enter Save")});else{let s=this.actionHint.createEl("button",{cls:"hi-note-save-button",text:f("Submit")});s.addEventListener("click",async o=>{if(o.stopPropagation(),this.isProcessing)return;let l=this.textarea.value.trim();if(l){this.isProcessing=!0,this.textarea.disabled=!0,s.disabled=!0;try{await this.options.onSave(l),requestAnimationFrame(()=>{this.destroy(),this.isProcessing=!1})}catch(c){this.isProcessing=!1,this.textarea.disabled=!1,s.disabled=!1}}})}this.setupKeyboardEvents(),setTimeout(()=>{this.textarea.focus()},50)}setupKeyboardEvents(e,A){this.cancelEdit=()=>{this.existingComment?e&&A&&requestAnimationFrame(()=>{this.textarea.replaceWith(e),this.actionHint.remove(),A.removeClass("hi-note-hidden"),document.removeEventListener("click",this.boundHandleOutsideClick)}):requestAnimationFrame(()=>{var t,s;(t=this.textarea.closest(".hi-note-input"))==null||t.remove(),this.card.querySelector(".hi-note")||(s=this.card.querySelector(".hi-notes-section"))==null||s.remove(),document.removeEventListener("click",this.boundHandleOutsideClick)}),this.options.onCancel()},this.textarea.onkeydown=async t=>{if(t.key==="Tab"){t.preventDefault(),await this.handleInlineAI();return}if(t.key==="Enter"){if(Se.Platform.isMobile)return;if(t.shiftKey||(t.preventDefault(),this.isProcessing))return;let s=this.textarea.value.trim();if(!s)return;this.isProcessing=!0,this.textarea.disabled=!0;try{await this.options.onSave(s),requestAnimationFrame(()=>{document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea.disabled=!1})}catch(o){this.textarea.disabled=!1,this.isProcessing=!1}}}}autoResizeTextarea(){if(!this.textarea)return;let e=window.pageYOffset||document.documentElement.scrollTop;this.textarea.style.height="auto";let A=this.textarea.scrollHeight;this.textarea.style.height=`${A}px`,window.scrollTo(0,e)}processTagsInInput(){var A,t,s,o;let e=this.textarea.value;if(zg.test(e)){let l=e.match(Zg)||[];if(l.length>0){let c=(A=this.textarea.parentElement)==null?void 0:A.querySelector(".highlight-tags-preview");if(c||(c=document.createElement("div"),c.className="highlight-tags-preview",(t=this.textarea.parentElement)==null||t.insertBefore(c,this.textarea)),c){for(;c.firstChild;)c.removeChild(c.firstChild);let d=c;l.forEach(g=>{let u=document.createElement("span");u.className="highlight-tag",u.textContent=g,d.appendChild(u)})}}}else(o=(s=this.textarea.parentElement)==null?void 0:s.querySelector(".highlight-tags-preview"))==null||o.remove()}handleOutsideClick(e){if(!this.textarea||this.isProcessing)return;let A=e.target;if(!this.textarea.contains(A)&&!A.closest(".hi-note-actions-hint")){this.isProcessing=!0;let s=this.textarea.value.trim();if(s){e.preventDefault(),e.stopPropagation();let o=s;this.textarea.disabled=!0,this.options.onSave(o).then(()=>{requestAnimationFrame(()=>{this.destroy(),this.isProcessing=!1})}).catch(()=>{this.textarea.disabled=!1,this.isProcessing=!1})}else requestAnimationFrame(()=>{this.cancelEdit(),this.destroy(),this.isProcessing=!1})}}async handleInlineAI(){var A;let e=this.textarea.value.trim();if(!e){new Se.Notice(f("Please enter AI instruction"));return}if(!this.isAIProcessing){this.originalContent=e;try{this.setAILoading(!0);let t=this.highlight.text||"",s=`${e}

\u9AD8\u4EAE\u6587\u672C\uFF1A${t}`,l=await new Ze(this.plugin.settings.ai).generateResponse(s,t,((A=this.existingComment)==null?void 0:A.content)||"");this.textarea.value=l,this.autoResizeTextarea(),new Se.Notice(f("AI response generated"))}catch(t){console.error("AI\u5185\u8054\u751F\u6210\u5931\u8D25:",t),this.textarea.value=this.originalContent,new Se.Notice(f(`AI generation failed: ${t.message}`))}finally{this.setAILoading(!1)}}}setAILoading(e){if(this.isAIProcessing=e,e){if(this.textarea.disabled=!0,this.textarea.style.opacity="0.6",this.actionHint&&!this.actionHint.querySelector(".ai-loading-hint")){let s=this.actionHint.createEl("span",{cls:"ai-loading-hint"}).createEl("span",{cls:"ai-loading-icon"});(0,Se.setIcon)(s,"loader")}}else if(this.textarea.disabled=!1,this.textarea.style.opacity="1",this.actionHint){let A=this.actionHint.querySelector(".ai-loading-hint");A&&A.remove()}}destroy(){document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1;let e=new CustomEvent("comment-input-closed",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(e)}};var dA=require("obsidian");var Uo=require("obsidian");var Is=class{constructor(e){this.plugin=e;this.aiService=new Ze(this.plugin.settings.ai)}updateModel(e,A){this.aiService&&this.aiService.updateModel(e,A)}async sendMessage(e,A=[]){try{let t=A.map(o=>({role:o.role,content:o.content}));return t.push({role:"user",content:e}),{content:await this.aiService.chat(t),type:"assistant",timestamp:Date.now()}}catch(t){throw new Uo.Notice("\u83B7\u53D6 AI \u54CD\u5E94\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u914D\u7F6E\u548C\u7F51\u7EDC\u8FDE\u63A5"),t}}async testConnection(){return await this.aiService.testConnection()}};var So=require("obsidian"),Hs=class{constructor(e){this.app=e}async getContextForHighlight(e,A={strategy:"paragraph",includeTitle:!0,maxLength:2e3}){if(!e.filePath)return null;let t=this.app.vault.getAbstractFileByPath(e.filePath);if(!t||!(t instanceof So.TFile))return null;let s=await this.app.vault.read(t),o=this.app.metadataCache.getFileCache(t);switch(A.strategy){case"paragraph":return this.getParagraphContext(s,e,t,o,A);case"section":return this.getSectionContext(s,e,t,o,A);case"surrounding":return this.getSurroundingContext(s,e,t,A);case"smart":return this.getSmartContext(s,e,t,o,A);default:return this.getParagraphContext(s,e,t,o,A)}}getParagraphContext(e,A,t,s,o){let l=e.split(`
`),c=A.text,d=-1;for(let E=0;E<l.length;E++)if(l[E].includes(c)){d=E;break}if(d===-1)return this.createContextInfo("","",t,e);let g=d,u=d;for(;g>0&&l[g-1].trim()!=="";)g--;for(;u<l.length-1&&l[u+1].trim()!=="";)u++;let m=l.slice(g,d).join(`
`),w=l.slice(d+1,u+1).join(`
`),F=l.slice(g,u+1).join(`
`),Q=this.findSectionTitle(l,d);return this.createContextInfo(m,w,t,F,Q,o.maxLength)}getSectionContext(e,A,t,s,o){if(!(s!=null&&s.sections))return this.getParagraphContext(e,A,t,s,o);let l=e.split(`
`),c=A.text,d=e.indexOf(c);if(d===-1)return this.createContextInfo("","",t,e);let g=s.sections.find(Q=>Q.position.start.offset<=d&&Q.position.end.offset>=d);if(!g)return this.getParagraphContext(e,A,t,s,o);let u=e.substring(g.position.start.offset,g.position.end.offset),m=e.substring(g.position.start.offset,d),w=e.substring(d+c.length,g.position.end.offset),F=this.findSectionTitle(l,this.getLineFromOffset(e,d));return this.createContextInfo(m,w,t,u,F,o.maxLength)}getSurroundingContext(e,A,t,s){let o=e.split(`
`),l=A.text,c=s.surroundingLines||3,d=-1;for(let E=0;E<o.length;E++)if(o[E].includes(l)){d=E;break}if(d===-1)return this.createContextInfo("","",t,e);let g=Math.max(0,d-c),u=Math.min(o.length-1,d+c),m=o.slice(g,d).join(`
`),w=o.slice(d+1,u+1).join(`
`),F=o.slice(g,u+1).join(`
`),Q=this.findSectionTitle(o,d);return this.createContextInfo(m,w,t,F,Q,s.maxLength)}getSmartContext(e,A,t,s,o){let l=this.getSectionContext(e,A,t,s,o);return l.fullContext.length>(o.maxLength||2e3)?this.getParagraphContext(e,A,t,s,o):l}findSectionTitle(e,A){for(let t=A;t>=0;t--){let s=e[t].trim();if(s.startsWith("#"))return s}}getLineFromOffset(e,A){return e.substring(0,A).split(`
`).length-1}createContextInfo(e,A,t,s,o,l){let c=s;if(l&&s.length>l){let d=Math.floor(l/2),g=s.substring(0,d),u=s.substring(s.length-d);c=`${g}

... [\u5185\u5BB9\u5DF2\u622A\u65AD] ...

${u}`}return{beforeContext:e,afterContext:A,sectionTitle:o,filePath:t.path,fileName:t.name,fullContext:c}}async getContextForMultipleHighlights(e,A={strategy:"paragraph"}){let t=[];for(let s of e){let o=await this.getContextForHighlight(s,A);o&&t.push(o)}return t}};var $A=class $A extends dA.Component{constructor(A,t){var M,D,N,W,sA;super();this.plugin=t;this.isProcessing=!1;this.draggedContents=[];this.chatHistory=[];this.currentPreviewContainer=null;this.textarea=null;this.chatModelState={provider:"",model:""};if($A.instance)return $A.instance;this.app=A,this.chatService=new Is(this.plugin),this.contextService=new Hs(A),this.contextOptions={strategy:((M=this.plugin.settings.contextOptions)==null?void 0:M.strategy)||"smart",includeTitle:(N=(D=this.plugin.settings.contextOptions)==null?void 0:D.includeTitle)!=null?N:!0,maxLength:((W=this.plugin.settings.contextOptions)==null?void 0:W.maxLength)||2e3,surroundingLines:((sA=this.plugin.settings.contextOptions)==null?void 0:sA.surroundingLines)||3},this.floatingButton=document.querySelector(".highlight-floating-button"),this.containerEl=document.createElement("div"),this.containerEl.addClass("highlight-chat-window");let s=this.containerEl.createEl("div",{cls:"highlight-chat-header"}),o=s.createEl("div",{cls:"highlight-chat-title"});o.createEl("span",{text:f("Chat")});let l=o.createEl("div",{cls:"highlight-chat-model",text:this.getCurrentModelName()});l.addEventListener("click",J=>{J.stopPropagation(),this.showModelSelector(l,J)});let c=s.createEl("div",{cls:"highlight-chat-buttons"}),d=c.createEl("div",{cls:"highlight-chat-clear"});(0,dA.setIcon)(d,"eraser"),d.addEventListener("click",()=>this.clearChat());let g=c.createEl("div",{cls:"highlight-chat-close"});(0,dA.setIcon)(g,"x"),g.addEventListener("click",()=>this.close());let u=this.containerEl.createEl("div",{cls:"highlight-chat-history"}),m=this.containerEl.createEl("div",{cls:"highlight-chat-input-container"});this.setupChatInput(m);let w=this.containerEl.createEl("div",{cls:"highlight-chat-resize-handle"});this.setupResizeHandle(w);let F={text:"",position:0,paragraphOffset:0,paragraphId:"chat",createdAt:Date.now(),updatedAt:Date.now()};u.addEventListener("dragenter",J=>{J.preventDefault(),u.addClass("drag-over")}),u.addEventListener("dragover",J=>{J.preventDefault(),J.stopPropagation(),u.addClass("drag-over");let cA=u.getBoundingClientRect(),wA=u.scrollTop,eA=cA.height;u.addClass("highlight-chat-history-drag-guide"),u.style.setProperty("--drag-guide-top",`${wA+12}px`),u.style.setProperty("--drag-guide-height",`${eA-24}px`);let Z=document.querySelector(".highlight-dragging");Z&&(Z.addClass("highlight-chat-preview"),Z.style.left=`${J.clientX+10}px`,Z.style.top=`${J.clientY+10}px`)}),u.addEventListener("dragleave",J=>{u.contains(J.relatedTarget)||u.removeClass("drag-over")}),u.addEventListener("drop",async J=>{var wA;J.preventDefault(),u.removeClass("drag-over");let cA=(wA=J.dataTransfer)==null?void 0:wA.getData("application/highlight");if(cA)try{let eA=JSON.parse(cA);if(!eA.text)return;this.draggedContents.some(TA=>TA.text===eA.text)||(this.draggedContents.push(eA),this.showDraggedPreviewsInChat(u))}catch(eA){}});let Q=!1,E,H,b,K;if(s.addEventListener("mousedown",J=>{J.target===g||J.target===d||(Q=!0,b=J.clientX-this.containerEl.offsetLeft,K=J.clientY-this.containerEl.offsetTop,s.addClass("dragging"))}),document.addEventListener("mousemove",J=>{if(!Q)return;J.preventDefault(),E=J.clientX-b,H=J.clientY-K;let cA=window.innerWidth-this.containerEl.offsetWidth,wA=window.innerHeight-this.containerEl.offsetHeight;E=Math.max(0,Math.min(E,cA)),H=Math.max(0,Math.min(H,wA)),this.containerEl.addClass("highlight-chat-window"),this.containerEl.style.left=`${E}px`,this.containerEl.style.top=`${H}px`}),document.addEventListener("mouseup",()=>{Q=!1,s.removeClass("dragging")}),$A.savedState){this.chatHistory=$A.savedState.chatHistory,this.draggedContents=$A.savedState.draggedContents;let J=this.containerEl.querySelector(".highlight-chat-history");if(J){for(;J.firstChild;)J.removeChild(J.firstChild);this.chatHistory.forEach(cA=>{this.addMessage(J,cA.content,cA.role,!1)}),this.draggedContents.length>0&&this.showDraggedPreviewsInChat(J),$A.savedState.currentPreviewContainer&&(this.currentPreviewContainer=J.querySelector(".highlight-chat-preview-cards"))}}$A.instance=this}async saveContextOptions(){this.plugin.settings.contextOptions||(this.plugin.settings.contextOptions={}),this.plugin.settings.contextOptions.strategy=this.contextOptions.strategy,this.plugin.settings.contextOptions.includeTitle=this.contextOptions.includeTitle,this.plugin.settings.contextOptions.maxLength=this.contextOptions.maxLength,this.plugin.settings.contextOptions.surroundingLines=this.contextOptions.surroundingLines,await this.plugin.saveSettings()}showDraggedPreviewsInChat(A){var c;if(!this.currentPreviewContainer){let g=A.createEl("div",{cls:"highlight-chat-message highlight-chat-message-preview"}).createEl("div",{cls:"highlight-chat-previews"}),u=g.createEl("div",{cls:"highlight-chat-preview-header"}),m=u.createEl("div",{cls:"highlight-chat-preview-header-left"});m.createEl("span",{cls:"highlight-chat-preview-count",text:String(this.draggedContents.length)}),m.createSpan({text:f("highlighted notes")});let F=u.createEl("div",{cls:"highlight-chat-preview-header-right"}).createEl("div",{cls:"highlight-chat-preview-btn",attr:{title:"Preview"}});(0,dA.setIcon)(F,"eye"),F.addEventListener("click",()=>{this.showContextPreviewWithSettings()});let Q=g.createEl("div",{cls:"highlight-chat-preview-cards"});this.currentPreviewContainer=Q}let t=this.currentPreviewContainer.createEl("div",{cls:"highlight-chat-preview-card"}),s=this.draggedContents[this.draggedContents.length-1];t.createEl("div",{cls:"highlight-chat-preview-content",text:s.text});let o=t.createEl("div",{cls:"highlight-chat-preview-delete"});(0,dA.setIcon)(o,"x"),o.addEventListener("click",()=>{var g;let d=this.draggedContents.indexOf(s);if(d>-1)if(this.draggedContents.splice(d,1),t.remove(),this.draggedContents.length===0){let u=(g=this.currentPreviewContainer)==null?void 0:g.closest(".highlight-chat-message-preview");u&&(u.remove(),this.currentPreviewContainer=null)}else this.updatePreviewCount()});let l=(c=this.currentPreviewContainer.closest(".highlight-chat-message-preview"))==null?void 0:c.querySelector(".highlight-chat-preview-count");l&&(l.textContent=String(this.draggedContents.length)),A.scrollTop=A.scrollHeight}show(){document.body.contains(this.containerEl)?this.containerEl.removeClass("highlight-chat-hidden"):(this.containerEl.addClass("highlight-chat-window"),this.containerEl.addClass("highlight-chat-window-position"),document.body.appendChild(this.containerEl)),document.querySelectorAll(".highlight-floating-button").forEach(A=>{A.style.display="none"}),requestAnimationFrame(()=>{var A;(A=this.textarea)==null||A.focus()})}close(){this.containerEl.addClass("highlight-chat-hidden"),document.querySelectorAll(".highlight-floating-button").forEach(A=>{A.style.display=""})}addMessage(A,t,s,o=!0){let l=A.createEl("div",{cls:"highlight-chat-message"}),c=l.createEl("div",{cls:"highlight-chat-message-content markdown-rendered"});l.addClass(`highlight-chat-message-${s}`),c.addClass(`highlight-chat-message-content-${s}`),s==="assistant"&&o?this.typeWriter(c,t):this.renderMarkdownContent(c,t),A.scrollTop=A.scrollHeight}async typeWriter(A,t,s=30){let o=0;A.textContent="";let l=A.createEl("span",{cls:"highlight-chat-cursor"}),c=()=>{o<t.length?(A.insertBefore(document.createTextNode(t.charAt(o)),l),o++,setTimeout(c,s)):(l.remove(),this.renderMarkdownContent(A,t))};c()}static getInstance(A,t){return $A.instance||($A.instance=new $A(A,t)),$A.instance}async renderMarkdownContent(A,t){for(;A.firstChild;)A.removeChild(A.firstChild);try{await dA.MarkdownRenderer.render(this.app,t,A,"",new dA.Component),A.querySelectorAll("ul, ol").forEach(o=>{o.addClass("chat-markdown-list")})}catch(s){console.error("Error rendering markdown in chat:",s),A.textContent=t}}setupResizeHandle(A){let t=!1,s=0,o=0,l=0,c=0;A.addEventListener("mousedown",u=>{u.preventDefault(),u.stopPropagation(),t=!0,s=u.clientX,o=u.clientY;let m=this.containerEl.getBoundingClientRect();l=m.width,c=m.height,document.addEventListener("mousemove",d),document.addEventListener("mouseup",g),this.containerEl.addClass("resizing")});let d=u=>{if(!t)return;let m=u.clientX-s,w=u.clientY-o,F=Math.max(300,l+m),Q=Math.max(300,c+w),E=Math.min(F,window.innerWidth*.9),H=Math.min(Q,window.innerHeight*.9);this.containerEl.style.width=`${E}px`,this.containerEl.style.height=`${H}px`},g=()=>{t=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",g),this.containerEl.removeClass("resizing")}}setupChatInput(A){let t=A.createEl("div",{cls:"highlight-chat-input-wrapper"});this.textarea=t.createEl("textarea",{cls:"highlight-chat-input",attr:{placeholder:f("Input message..."),rows:"1"}});let s=()=>{this.textarea&&(this.textarea.addClass("highlight-chat-input"),this.textarea.style.height=`${Math.min(this.textarea.scrollHeight,150)}px`)};return this.textarea.addEventListener("input",()=>{s()}),this.textarea.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),this.textarea&&this.handleSendMessage(this.textarea))}),this.textarea}async handleSendMessage(A){let t=A.value.trim();if(!(!t||this.isProcessing))try{this.isProcessing=!0;let s=t,o=t;if(this.draggedContents.length>0){let c=this.draggedContents.map(u=>this.contextService.getContextForHighlight(u,this.contextOptions)),g=(await Promise.all(c)).map((u,m)=>{let w=this.draggedContents[m];if(!u)return`**\u9AD8\u4EAE\u5185\u5BB9 ${m+1}:**
${w.text}`;let F=`**Highlight ${m+1}** (from: ${u.fileName}):
`;return u.sectionTitle&&(F+=`**Section:** ${u.sectionTitle}

`),u.beforeContext.trim()&&(F+=`**Before:**
${u.beforeContext.trim()}

`),F+=`**Highlight:**
${w.text}

`,u.afterContext.trim()&&(F+=`**After:**
${u.afterContext.trim()}`),F}).join(`

---

`);if(this.chatHistory.push({role:"user",content:`\u4EE5\u4E0B\u662F\u9700\u8981\u5206\u6790\u7684\u5185\u5BB9\uFF08\u5305\u542B\u4E0A\u4E0B\u6587\uFF09\uFF1A

${g}`}),s=t,o=`\u7528\u6237\u63D0\u793A\uFF1A${t}`,this.currentPreviewContainer){let u=this.currentPreviewContainer.closest(".highlight-chat-message-preview");u&&u.addClass("sent"),this.currentPreviewContainer=null,this.draggedContents=[]}}this.chatHistory.push({role:"user",content:o}),requestAnimationFrame(()=>{A.value="",A.addClass("highlight-chat-input"),A.dispatchEvent(new Event("input"))});let l=this.containerEl.querySelector(".highlight-chat-history");if(l){this.addMessage(l,t,"user",!0);let c=await this.chatService.sendMessage(s,this.chatHistory);this.chatHistory.push({role:"assistant",content:c.content}),this.addMessage(l,c.content,"assistant",!0)}}catch(s){console.error("\u53D1\u9001\u6D88\u606F\u65F6\u51FA\u9519:",s),new dA.Notice("Failed to send message, please try again")}finally{this.isProcessing=!1}}updatePreviewCount(){if(this.currentPreviewContainer){let A=this.currentPreviewContainer.closest(".highlight-chat-message-preview"),t=A==null?void 0:A.querySelector(".highlight-chat-preview-count");t&&(t.textContent=String(this.draggedContents.length),this.draggedContents.length===0&&A&&(A.remove(),this.currentPreviewContainer=null))}}setupContextControls(A){let t=A.createEl("select",{cls:"highlight-chat-context-strategy",attr:{title:"\u9009\u62E9\u4E0A\u4E0B\u6587\u83B7\u53D6\u7B56\u7565"}});[{value:"smart",label:"\u667A\u80FD\u4E0A\u4E0B\u6587"},{value:"paragraph",label:"\u6BB5\u843D\u4E0A\u4E0B\u6587"},{value:"section",label:"\u7AE0\u8282\u4E0A\u4E0B\u6587"},{value:"surrounding",label:"\u90BB\u8FD1\u884C\u6570"}].forEach(m=>{let w=t.createEl("option",{value:m.value,text:m.label});m.value===this.contextOptions.strategy&&(w.selected=!0)}),t.addEventListener("change",()=>{this.contextOptions.strategy=t.value});let o=A.createEl("div",{cls:"highlight-chat-context-length"}),l=o.createEl("span",{cls:"highlight-chat-context-length-label",text:"\u957F\u5EA6:"}),c=o.createEl("input",{type:"range",cls:"highlight-chat-context-length-slider",attr:{min:"500",max:"5000",step:"500",value:String(this.contextOptions.maxLength||2e3),title:"\u8C03\u6574\u4E0A\u4E0B\u6587\u6700\u5927\u957F\u5EA6"}}),d=o.createEl("span",{cls:"highlight-chat-context-length-value",text:String(this.contextOptions.maxLength||2e3)});c.addEventListener("input",()=>{let m=parseInt(c.value);this.contextOptions.maxLength=m,d.textContent=String(m)}),A.createEl("button",{cls:"highlight-chat-context-preview",text:"\u9884\u89C8",attr:{title:"\u9884\u89C8\u5C06\u8981\u53D1\u9001\u7ED9AI\u7684\u5185\u5BB9"}}).addEventListener("click",()=>{this.showContextPreview()});let u=A.createEl("button",{cls:"highlight-chat-context-settings",attr:{title:"\u4E0A\u4E0B\u6587\u8BBE\u7F6E"}});(0,dA.setIcon)(u,"settings"),u.addEventListener("click",m=>{this.showContextSettingsMenu(u,m)})}async showContextPreviewWithSettings(){if(this.draggedContents.length===0){new dA.Notice("\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u53EF\u9884\u89C8");return}let A=this.app.workspace.containerEl.createEl("div",{cls:"highlight-chat-context-modal"}),t=A.createEl("div",{cls:"highlight-chat-context-overlay"}),s=A.createEl("div",{cls:"highlight-chat-context-content"}),o=s.createEl("div",{cls:"highlight-chat-context-header"});o.createEl("h3",{text:"Context Preview & Settings"});let l=o.createEl("div",{cls:"highlight-chat-context-close"});(0,dA.setIcon)(l,"x");let c=s.createEl("div",{cls:"highlight-chat-context-body"}),d,g=()=>{clearTimeout(d),d=setTimeout(()=>{M()},300)},u=c.createEl("div",{cls:"highlight-chat-context-settings-panel"});this.createSettingsPanel(u,g);let m=c.createEl("div",{cls:"highlight-chat-context-preview-panel"});m.createEl("div",{cls:"highlight-chat-context-preview-panel-header"}).createEl("h4",{text:"Preview Content (Auto-update)"});let F=m.createEl("div",{cls:"highlight-chat-context-preview-content"}),Q=s.createEl("div",{cls:"highlight-chat-context-footer"}),E=Q.createEl("div",{cls:"highlight-chat-context-stats"}),H=Q.createEl("div",{cls:"highlight-chat-context-buttons"}),b=H.createEl("button",{cls:"highlight-chat-context-cancel",text:"Cancel"}),K=H.createEl("button",{cls:"highlight-chat-context-confirm",text:"Apply"}),M=async()=>{try{F.empty(),F.createEl("div",{cls:"highlight-chat-context-loading",text:"Generating preview..."});let W=await this.generateContextPreview();F.empty(),this.renderMarkdownContent(F,W.content),E.textContent=`Characters: ${W.content.length} | Highlights: ${this.draggedContents.length}`}catch(W){F.empty(),F.createEl("div",{cls:"highlight-chat-context-error",text:"Preview generation failed"})}},D=()=>{A.remove()};l.addEventListener("click",D),b.addEventListener("click",D),t.addEventListener("click",D),K.addEventListener("click",()=>{D(),new dA.Notice("Context settings applied")});let N=W=>{W.key==="Escape"&&(D(),document.removeEventListener("keydown",N))};document.addEventListener("keydown",N),await M()}createSettingsPanel(A,t){let s=A.createEl("div",{cls:"highlight-chat-settings-section"});s.createEl("h5",{text:"Context Strategy"});let o=s.createEl("select",{cls:"highlight-chat-settings-select"});[{value:"smart",label:"Smart Context - Auto-select best strategy"},{value:"paragraph",label:"Paragraph Context - Get complete paragraphs"},{value:"section",label:"Section Context - Get entire sections"},{value:"surrounding",label:"Surrounding Lines - Specify before/after lines"}].forEach(M=>{let D=o.createEl("option",{value:M.value,text:M.label});M.value===this.contextOptions.strategy&&(D.selected=!0)}),o.addEventListener("change",async()=>{this.contextOptions.strategy=o.value,await this.saveContextOptions(),this.updateSurroundingLinesVisibility(A),t()});let c=A.createEl("div",{cls:"highlight-chat-settings-section"});c.createEl("h5",{text:"Context Length"});let d=c.createEl("div",{cls:"highlight-chat-settings-slider-container"}),g=d.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"500",max:"5000",step:"500",value:String(this.contextOptions.maxLength||2e3)}}),u=d.createEl("span",{cls:"highlight-chat-settings-value",text:`${this.contextOptions.maxLength||2e3} chars`});g.addEventListener("input",async()=>{let M=parseInt(g.value);this.contextOptions.maxLength=M,u.textContent=`${M} chars`,await this.saveContextOptions(),t()});let m=A.createEl("div",{cls:"highlight-chat-settings-section highlight-chat-surrounding-section"});m.createEl("h5",{text:"Surrounding Lines"});let w=m.createEl("div",{cls:"highlight-chat-settings-slider-container"}),F=w.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"1",max:"10",step:"1",value:String(this.contextOptions.surroundingLines||3)}}),Q=w.createEl("span",{cls:"highlight-chat-settings-value",text:`${this.contextOptions.surroundingLines||3} lines`});F.addEventListener("input",async()=>{let M=parseInt(F.value);this.contextOptions.surroundingLines=M,Q.textContent=`${M} lines`,await this.saveContextOptions(),t()});let E=A.createEl("div",{cls:"highlight-chat-settings-section"});E.createEl("h5",{text:"Other Options"});let H=E.createEl("label",{cls:"highlight-chat-settings-checkbox"}),b=H.createEl("input",{type:"checkbox"});b.checked=this.contextOptions.includeTitle||!1,H.createSpan({text:" Include section titles"}),b.addEventListener("change",async()=>{this.contextOptions.includeTitle=b.checked,await this.saveContextOptions(),t()}),this.updateSurroundingLinesVisibility(A),A.createEl("button",{cls:"highlight-chat-settings-reset",text:"Reset to defaults"}).addEventListener("click",async()=>{this.contextOptions={strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3},o.value="smart",g.value="2000",u.textContent="2000 chars",F.value="3",Q.textContent="3 lines",b.checked=!0,await this.saveContextOptions(),this.updateSurroundingLinesVisibility(A),new dA.Notice("Reset to default settings"),t()})}updateSurroundingLinesVisibility(A){let t=A.querySelector(".highlight-chat-surrounding-section");t&&(this.contextOptions.strategy==="surrounding"?t.style.display="block":t.style.display="none")}async generateContextPreview(){let A=this.draggedContents.map(o=>this.contextService.getContextForHighlight(o,this.contextOptions));return{content:(await Promise.all(A)).map((o,l)=>{let c=this.draggedContents[l];if(!o)return`**Highlight ${l+1}:**
${c.text}`;let d=`**Highlight ${l+1}** (from: ${o.fileName}):
`;return o.sectionTitle&&(d+=`**Section:** ${o.sectionTitle}

`),o.beforeContext.trim()&&(d+=`**Before:**
${o.beforeContext.trim()}

`),d+=`**Highlight:**
${c.text}

`,o.afterContext.trim()&&(d+=`**After:**
${o.afterContext.trim()}`),d}).join(`

---

`)}}async showContextPreview(){if(this.draggedContents.length===0){new dA.Notice("\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u53EF\u9884\u89C8");return}try{let A=this.draggedContents.map(H=>this.contextService.getContextForHighlight(H,this.contextOptions)),s=(await Promise.all(A)).map((H,b)=>{let K=this.draggedContents[b];if(!H)return`**\u9AD8\u4EAE\u5185\u5BB9 ${b+1}:**
${K.text}`;let M=`**\u9AD8\u4EAE\u5185\u5BB9 ${b+1}** (\u6765\u81EA: ${H.fileName}):
`;return H.sectionTitle&&(M+=`**\u7AE0\u8282:** ${H.sectionTitle}

`),H.beforeContext.trim()&&(M+=`**\u524D\u6587:**
${H.beforeContext.trim()}

`),M+=`**\u9AD8\u4EAE\u5185\u5BB9:**
${K.text}

`,H.afterContext.trim()&&(M+=`**\u540E\u6587:**
${H.afterContext.trim()}`),M}).join(`

---

`),o=this.app.workspace.containerEl.createEl("div",{cls:"highlight-chat-context-preview-modal"}),l=o.createEl("div",{cls:"highlight-chat-context-preview-overlay"}),c=o.createEl("div",{cls:"highlight-chat-context-preview-content"}),d=c.createEl("div",{cls:"highlight-chat-context-preview-header"});d.createEl("h3",{text:"\u4E0A\u4E0B\u6587\u9884\u89C8"});let g=d.createEl("button",{cls:"highlight-chat-context-preview-close"});(0,dA.setIcon)(g,"x");let m=c.createEl("div",{cls:"highlight-chat-context-preview-body"}).createEl("div",{cls:"highlight-chat-context-preview-text"});this.renderMarkdownContent(m,s);let F=c.createEl("div",{cls:"highlight-chat-context-preview-footer"}).createEl("div",{cls:"highlight-chat-context-preview-stats",text:`\u5B57\u7B26\u6570: ${s.length} | \u9AD8\u4EAE\u6570: ${this.draggedContents.length}`}),Q=()=>{o.remove()};g.addEventListener("click",Q),l.addEventListener("click",Q);let E=H=>{H.key==="Escape"&&(Q(),document.removeEventListener("keydown",E))};document.addEventListener("keydown",E)}catch(A){console.error("\u9884\u89C8\u4E0A\u4E0B\u6587\u65F6\u51FA\u9519:",A),new dA.Notice("\u9884\u89C8\u4E0A\u4E0B\u6587\u5931\u8D25")}}showContextSettingsMenu(A,t){let s=new dA.Menu;s.addItem(l=>{l.setTitle("\u5305\u542B\u7AE0\u8282\u6807\u9898").setChecked(this.contextOptions.includeTitle||!1).onClick(()=>{this.contextOptions.includeTitle=!this.contextOptions.includeTitle})}),s.addSeparator(),this.contextOptions.strategy==="surrounding"&&s.addItem(l=>{l.setTitle(`\u90BB\u8FD1\u884C\u6570: ${this.contextOptions.surroundingLines||3}`).onClick(()=>{let c=prompt("\u8BF7\u8F93\u5165\u90BB\u8FD1\u884C\u6570 (1-10):",String(this.contextOptions.surroundingLines||3));if(c){let d=parseInt(c);d>=1&&d<=10&&(this.contextOptions.surroundingLines=d)}})}),s.addSeparator(),s.addItem(l=>{l.setTitle("\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u8BBE\u7F6E").onClick(()=>{var u,m,w;this.contextOptions={strategy:"smart",includeTitle:!0,maxLength:2e3};let c=(u=A.parentElement)==null?void 0:u.querySelector(".highlight-chat-context-strategy"),d=(m=A.parentElement)==null?void 0:m.querySelector(".highlight-chat-context-length-slider"),g=(w=A.parentElement)==null?void 0:w.querySelector(".highlight-chat-context-length-value");c&&(c.value="smart"),d&&(d.value="2000"),g&&(g.textContent="2000"),new dA.Notice("\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u8BBE\u7F6E")})});let o=A.getBoundingClientRect();s.showAtPosition({x:o.left,y:o.bottom})}clearChat(){if(this.chatHistory=[],this.draggedContents=[],this.currentPreviewContainer){let t=this.currentPreviewContainer.closest(".highlight-chat-message-preview");t&&t.remove(),this.currentPreviewContainer=null}let A=this.containerEl.querySelector(".highlight-chat-history");if(A)for(;A.firstChild;)A.removeChild(A.firstChild);this.textarea&&(this.textarea.value="",this.textarea.addClass("highlight-chat-input"))}getCurrentModelName(){var s,o,l,c,d,g,u,m;let A=this.plugin.settings.ai;switch(this.chatModelState.provider||A.provider){case"openai":return this.chatModelState.model||((s=A.openai)==null?void 0:s.model)||"GPT-4";case"anthropic":return this.chatModelState.model||((o=A.anthropic)==null?void 0:o.model)||"Claude-3";case"ollama":return this.chatModelState.model||((l=A.ollama)==null?void 0:l.model)||"Ollama";case"gemini":return this.chatModelState.model||((c=A.gemini)==null?void 0:c.model)||"Gemini Pro";case"deepseek":return this.chatModelState.model||((d=A.deepseek)==null?void 0:d.model)||"Deepseek Chat";case"siliconflow":return(g=A.siliconflow)!=null&&g.isCustomModel&&((u=A.siliconflow)!=null&&u.model)?A.siliconflow.model:this.chatModelState.model?this.chatModelState.model:((m=A.siliconflow)==null?void 0:m.model)||"SiliconFlow";default:return"Unknown model"}}async showModelSelector(A,t){var c,d,g,u,m,w;let s=new dA.Menu,o=this.plugin.settings.ai;switch(o.provider){case"siliconflow":try{if(Ue.forEach(E=>{s.addItem(H=>{var K,M;let b=!((K=o.siliconflow)!=null&&K.isCustomModel)&&(this.chatModelState.model===E.id||((M=o.siliconflow)==null?void 0:M.model)===E.id);H.setTitle(E.name).setChecked(b).onClick(async()=>{o.siliconflow?(o.siliconflow.model=E.id,o.siliconflow.isCustomModel=!1):o.siliconflow={model:E.id,isCustomModel:!1},this.chatModelState.provider="siliconflow",this.chatModelState.model=E.id,this.chatService.updateModel("siliconflow",E.id),await this.plugin.saveSettings(),A.textContent=E.name})})}),(c=o.siliconflow)!=null&&c.isCustomModel&&((d=o.siliconflow)!=null&&d.model)){s.addSeparator();let E=o.siliconflow.model;s.addItem(H=>{var K,M;let b=((K=o.siliconflow)==null?void 0:K.isCustomModel)&&(this.chatModelState.model===E||((M=o.siliconflow)==null?void 0:M.model)===E);H.setTitle(E).setChecked(b).onClick(async()=>{o.siliconflow?(o.siliconflow.model=E,o.siliconflow.isCustomModel=!0):o.siliconflow={model:E,isCustomModel:!0},this.chatModelState.provider="siliconflow",this.chatModelState.model=E,this.chatService.updateModel("siliconflow",E),await this.plugin.saveSettings(),A.textContent=E})})}}catch(Q){new dA.Notice(f("Unable to get SiliconFlow model list, please check API Key and network connection."))}break;case"openai":try{let Q=await this.chatService.aiService.listOpenAIModels(),E=Q.filter(b=>!b.isCustom),H=Q.filter(b=>b.isCustom);E.forEach(b=>{s.addItem(K=>{K.setTitle(b.name).setChecked(this.chatModelState.model===b.id).onClick(async()=>{this.chatModelState.provider="openai",this.chatModelState.model=b.id,this.chatService.updateModel("openai",b.id),A.textContent=this.getCurrentModelName()})})}),H.length>0&&(s.addSeparator(),H.forEach(b=>{s.addItem(K=>{K.setTitle(b.name).setChecked(this.chatModelState.model===b.id).onClick(async()=>{this.chatModelState.provider="openai",this.chatModelState.model=b.id,this.chatService.updateModel("openai",b.id),A.textContent=this.getCurrentModelName()})})}))}catch(Q){new dA.Notice(f("Unable to get OpenAI model list, please check API Key and network connection."))}break;case"anthropic":["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"].forEach(Q=>{s.addItem(E=>{var H;E.setTitle(Q).setChecked(((H=o.anthropic)==null?void 0:H.model)===Q).onClick(async()=>{o.anthropic||(o.anthropic={apiKey:"",model:Q}),o.anthropic.model=Q,await this.plugin.saveSettings(),A.textContent=this.getCurrentModelName()})})});break;case"ollama":try{(await this.chatService.aiService.listOllamaModels()).forEach(E=>{s.addItem(H=>{var b;H.setTitle(E).setChecked(((b=o.ollama)==null?void 0:b.model)===E).onClick(async()=>{o.ollama||(o.ollama={host:"http://localhost:11434",model:E}),o.ollama.model=E,await this.plugin.saveSettings(),A.textContent=this.getCurrentModelName()})})})}catch(Q){new dA.Notice(f("Unable to access the Ollama model, please check the service."))}break;case"gemini":try{(await this.chatService.aiService.listGeminiModels()).forEach(E=>{s.addItem(H=>{var b;H.setTitle(E.name).setChecked(((b=o.gemini)==null?void 0:b.model)===E.id).onClick(async()=>{this.chatModelState.provider="gemini",this.chatModelState.model=E.id,this.chatService.updateModel("gemini",E.id),A.textContent=this.getCurrentModelName()})})}),(g=o.gemini)!=null&&g.isCustomModel&&((u=o.gemini)!=null&&u.model)&&(s.addSeparator(),s.addItem(E=>{var b,K;let H={id:((b=o.gemini)==null?void 0:b.model)||"",name:(K=o.gemini)==null?void 0:K.model,isCustom:!0};E.setTitle(H.name).setChecked(this.chatModelState.model===H.id).onClick(async()=>{this.chatModelState.provider="gemini",this.chatModelState.model=H.id,this.chatService.updateModel("gemini",H.id),A.textContent=this.getCurrentModelName()})}))}catch(Q){new dA.Notice(f("Unable to get Gemini model list, please check API Key and network connection."))}break;case"deepseek":try{(await this.chatService.aiService.listDeepseekModels()).forEach(E=>{s.addItem(H=>{var b;H.setTitle(E.name).setChecked(((b=o.deepseek)==null?void 0:b.model)===E.id).onClick(async()=>{this.chatModelState.provider="deepseek",this.chatModelState.model=E.id,this.chatService.updateModel("deepseek",E.id),A.textContent=this.getCurrentModelName()})})}),(m=o.deepseek)!=null&&m.isCustomModel&&((w=o.deepseek)!=null&&w.model)&&(s.addSeparator(),s.addItem(E=>{var b,K;let H={id:((b=o.deepseek)==null?void 0:b.model)||"",name:(K=o.deepseek)==null?void 0:K.model,isCustom:!0};E.setTitle(H.name).setChecked(this.chatModelState.model===H.id).onClick(async()=>{this.chatModelState.provider="deepseek",this.chatModelState.model=H.id,this.chatService.updateModel("deepseek",H.id),A.textContent=this.getCurrentModelName()})}))}catch(Q){new dA.Notice(f("Unable to get Deepseek model list, please check API Key and network connection."))}break;default:new dA.Notice(f("Unknown AI provider"));break}let l=A.getBoundingClientRect();s.showAtPosition({x:l.left,y:l.bottom})}};$A.instance=null,$A.savedState=null;var At=$A;var ie="comment-view",ue=class extends X.ItemView{constructor(A,t){super(A);this.searchHintsEventHandlers=null;this.handleGlobalClick=A=>{if(this.isSelectionMode||this.selectedHighlights.size<=1||!this.multiSelectActionsContainer||this.multiSelectActionsContainer.style.display==="none")return;let t=A.target;t.closest(".multi-select-actions")||t.closest(".highlight-card.selected")||t.closest(".highlight-container")||this.clearSelection()};this.handleSelectionStart=A=>{A.target.closest(".highlight-card")||A.target.closest(".flashcard-mode")||A.target.closest(".flashcard-add-group")||A.target.closest(".flashcard-group-action")||A.target.closest(".highlight-floating-button")||(this.selectionStartX=A.clientX,this.selectionStartY=A.clientY,this.mouseMoved=!1,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))};this.handleMouseMove=A=>{let t=A.clientX-this.selectionStartX,s=A.clientY-this.selectionStartY;Math.sqrt(t*t+s*s)>=this.mouseMoveThreshold&&(this.mouseMoved=!0,document.removeEventListener("mousemove",this.handleMouseMove),this.startSelection(A))};this.handleMouseUp=A=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.mouseMoved||this.clearSelection()};this.handleSelectionMove=A=>{if(!this.isSelectionMode||!this.selectionBox)return;let t=A.clientX-this.selectionStartX,s=A.clientY-this.selectionStartY;t<0?(this.selectionBox.style.left=`${A.clientX}px`,this.selectionBox.style.width=`${-t}px`):this.selectionBox.style.width=`${t}px`,s<0?(this.selectionBox.style.top=`${A.clientY}px`,this.selectionBox.style.height=`${-s}px`):this.selectionBox.style.height=`${s}px`,this.selectCardsInBox()};this.handleSelectionEnd=A=>{this.isSelectionMode&&(this.selectionBox&&(this.selectionBox.remove(),this.selectionBox=null),this.isSelectionMode=!1,document.removeEventListener("mousemove",this.handleSelectionMove),document.removeEventListener("mouseup",this.handleSelectionEnd),this.updateSelectedHighlights())};this.selectedHighlights=new Set;this.currentFile=null;this.isFlashcardMode=!1;this.highlights=[];this.highlightsWithFlashcards=new Set;this.searchDebounceTimer=null;this.localSearchDebounceTime=200;this.globalSearchDebounceTime=500;this.isSearching=!1;this.isDraggedToMainView=!1;this.isMobileView=!1;this.isSmallScreen=!1;this.isShowingFileList=!0;this.currentBatch=0;this.isLoading=!1;this.BATCH_SIZE=20;this.floatingButton=null;this.aiButtons=[];this.currentEditingHighlightId=null;this.flashcardComponent=null;this.isSelectionMode=!1;this.selectionBox=null;this.selectionStartX=0;this.selectionStartY=0;this.mouseMoveThreshold=5;this.mouseMoved=!1;this.handleSearchInputWithDebounce=A=>{this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null);let t=this.searchInput.value.toLowerCase().trim(),s=t.startsWith("all:"),o=s?this.globalSearchDebounceTime:this.localSearchDebounceTime;s&&t.length>4&&this.showSearchLoadingIndicator(),this.searchDebounceTimer=window.setTimeout(()=>{this.updateHighlightsList(),this.searchDebounceTimer=null},o)};this.commentStore=t;let s=this.app.plugins;if(s&&s.plugins&&s.plugins["hi-note"])this.plugin=s.plugins["hi-note"];else throw new Error("Hi-Note plugin not found");this.locationService=new Es(this.app),this.exportService=new Us(this.app,this.commentStore),this.highlightService=new le(this.app),this.licenseManager=new ze(this.plugin),this.canvasService=new ns(this.app.vault),this.registerEvent(this.app.workspace.on("file-open",l=>{var c,d,g;if(l&&!this.isDraggedToMainView){this.currentFile=l;let u=this.app.workspace.activeLeaf,m=((d=(c=u==null?void 0:u.getViewState())==null?void 0:c.state)==null?void 0:d.file)!==l.path&&((g=u==null?void 0:u.view)==null?void 0:g.getViewType())==="canvas";this.updateHighlights(m)}})),this.registerEvent(this.app.vault.on("modify",l=>{var c,d,g;if(l===this.currentFile&&!this.isDraggedToMainView){let u=this.app.workspace.activeLeaf,m=((d=(c=u==null?void 0:u.getViewState())==null?void 0:c.state)==null?void 0:d.file)!==l.path&&((g=u==null?void 0:u.view)==null?void 0:g.getViewType())==="canvas";this.updateHighlights(m)}}));let o=l=>{let{highlightId:c,text:d}=l.detail;setTimeout(()=>{this.highlightContainer.querySelectorAll(".highlight-card").forEach(u=>{u.removeClass("selected")});let g=IA.findCardInstanceByHighlightId(c);if(!g){let u=Array.from(this.highlightContainer.querySelectorAll(".highlight-card")).find(m=>{var F;return((F=m.querySelector(".highlight-text-content"))==null?void 0:F.textContent)===d});u&&(u.addClass("selected"),g=IA.findCardInstanceByElement(u),u.scrollIntoView({behavior:"smooth"}))}g&&g.showCommentInput()},100)};window.addEventListener("open-comment-input",o),this.register(()=>window.removeEventListener("open-comment-input",o)),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.checkViewPosition()})),this.loadingIndicator=createEl("div",{cls:"highlight-loading-indicator",text:f("Loading...")}),this.loadingIndicator.addClass("highlight-display-none")}clearSelection(){this.highlightContainer.querySelectorAll(".highlight-card.selected").forEach(A=>{A.removeClass("selected")}),IA&&typeof IA.clearSelection=="function"&&IA.clearSelection(),this.selectedHighlights.clear(),this.hideMultiSelectActions(),this.isSelectionMode=!1}handleMultiSelect(A){let t=A.detail;t&&t.selectedCards&&this.updateSelectedHighlights()}updateSelectedHighlights(){this.selectedHighlights.clear(),Array.from(this.highlightContainer.querySelectorAll(".highlight-card.selected")).forEach(t=>{let s=t.getAttribute("data-highlight");if(s)try{let o=JSON.parse(s);this.selectedHighlights.add(o)}catch(o){console.error("Error parsing highlight data:",o)}}),this.selectedHighlights.size>1?this.showMultiSelectActions():this.hideMultiSelectActions()}async showMultiSelectActions(){this.hideMultiSelectActions(),this.multiSelectActionsContainer||(this.multiSelectActionsContainer=this.containerEl.createEl("div",{cls:"multi-select-actions"})),this.multiSelectActionsContainer.show(),this.multiSelectActionsContainer.empty();let A=this.multiSelectActionsContainer.createEl("div",{cls:"selected-count",text:`selected ${this.selectedHighlights.size}`}),t=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});t.setAttribute("aria-label",f("Export")),(0,X.setIcon)(t,"file-input"),t.addEventListener("click",()=>{this.exportSelectedHighlights()});let s=this.plugin.fsrsManager;if(!s){this.createDefaultFlashcardButton(this.multiSelectActionsContainer);return}let o=0;for(let c of this.selectedHighlights)if(c.id){let d=s.findCardsBySourceId(c.id,"highlight");d&&d.length>0&&o++}if(o===0){let c=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});c.setAttribute("aria-label",f("Create HiCard")),(0,X.setIcon)(c,"book-plus"),(async()=>{let g=await this.licenseManager.isActivated(),u=g?await this.licenseManager.isFeatureEnabled("flashcard"):!1;return g&&u})().then(g=>{g||(c.addClass("disabled-button"),c.setAttribute("aria-label",f("Only HiNote Pro")))}),c.addEventListener("click",async()=>{if(c.hasClass("disabled-button")){new X.Notice(f("Only HiNote Pro"));return}await this.createMissingFlashcards()})}else if(o===this.selectedHighlights.size){let c=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button delete-flashcard-button"});c.setAttribute("aria-label",f("Delete HiCard")),(0,X.setIcon)(c,"book-x"),c.addEventListener("click",()=>{this.deleteFlashcardsFromSelected()})}else{let c=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});c.setAttribute("aria-label",f("Manage HiCard")),(0,X.setIcon)(c,"book-heart"),c.addEventListener("click",d=>{this.showFlashcardManageMenu(d)})}let l=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});l.setAttribute("aria-label",f("Delete")),(0,X.setIcon)(l,"trash"),l.addEventListener("click",()=>{this.deleteSelectedHighlights()})}hideMultiSelectActions(){this.multiSelectActionsContainer&&(this.multiSelectActionsContainer.empty(),this.multiSelectActionsContainer.hide())}createDefaultFlashcardButton(A){let t=A.createEl("div",{cls:"multi-select-action-button"});t.setAttribute("aria-label",f("Create HiCard")),(0,X.setIcon)(t,"plus-circle"),t.addEventListener("click",()=>{new X.Notice(f("HiCard function is not initialized, please enable FSRS function"))})}showFlashcardManageMenu(A){let t=new X.Menu;t.addItem(o=>{o.setTitle(f("Create missing HiCard")).setIcon("plus-circle").onClick(async()=>{await this.createMissingFlashcards()})}),t.addItem(o=>{o.setTitle(f("Delete existing HiCards")).setIcon("trash").onClick(()=>{this.deleteFlashcardsFromSelected()})});let s=A.currentTarget;if(s){let o=s.getBoundingClientRect();t.showAtPosition({x:o.left-85,y:o.top-60})}else t.showAtMouseEvent(A)}async createMissingFlashcards(){let A=await this.licenseManager.isActivated(),t=A?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(!A||!t){new X.Notice(f("Only HiNote Pro"));return}let s=this.plugin.fsrsManager;if(!s){new X.Notice(f("HiCard function is not initialized, please enable FSRS function"));return}let o=0,l=0;for(let c of this.selectedHighlights)try{if(c.id){let d=s.findCardsBySourceId(c.id,"highlight");if(d&&d.length>0)continue;let g=IA.findCardInstanceByHighlightId(c.id),u=!1;if(g)u=await g.createHiCardForHighlight(!0);else{let m=document.createElement("div");g=new IA(m,c,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1),u=await g.createHiCardForHighlight(!0)}u?o++:(l++,console.error(`Create HiCard failed: ${c.text}`))}}catch(d){l++,console.error("Create HiCard failed:",d)}o>0&&this.plugin.eventManager.emitFlashcardChanged(),o>0&&l===0?new X.Notice(f(`Successfully created ${o} HiCard`)):o>0&&l>0?new X.Notice(f(`Successfully created ${o} HiCard, ${l} failed`)):o===0&&l===0?new X.Notice(f("No HiCard to create")):new X.Notice(f("Failed to create HiCard! Please check the selected highlight content")),this.clearSelection(),this.renderHighlights(this.highlights)}async exportSelectedHighlights(){if(this.selectedHighlights.size===0){new X.Notice(f("Please select highlights to export"));return}try{let A=Array.from(this.selectedHighlights),t=await this.exportService.exportHighlightsAsMarkdown(A);t?(new X.Notice(f("Successfully exported selected highlights to: ")+t.path),this.clearSelection()):new X.Notice(f("No highlights to export"))}catch(A){console.error("Failed to export highlights:",A),new X.Notice(f("Failed to export highlights: ")+(A instanceof Error?A.message:String(A)))}}deleteFlashcardsFromSelected(){let A=new X.Modal(this.app);A.titleEl.setText(f("Confirm delete HiCard"));let t=A.contentEl;t.empty(),t.createEl("p",{text:f("Are you sure you want to delete the HiCards of the selected highlights? This action cannot be undone.")});let s=t.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:f("Cancel")}).addEventListener("click",()=>{A.close()}),s.createEl("button",{cls:"mod-warning",text:f("Delete")}).addEventListener("click",async()=>{A.close(),await this.deleteExistingFlashcards()}),A.open()}deleteSelectedHighlights(){if(this.selectedHighlights.size===0){new X.Notice(f("No highlights selected"));return}let A=new X.Modal(this.app);A.titleEl.setText(f("Confirm delete highlights"));let t=A.contentEl;t.empty(),t.createEl("p",{text:f(`Are you sure you want to delete ${this.selectedHighlights.size} highlights and all their data, including Comments and HiCards? This action cannot be undone.`)});let s=t.createEl("div",{cls:"modal-button-container"});s.createEl("button",{text:f("Cancel")}).addEventListener("click",()=>{A.close()}),s.createEl("button",{cls:"mod-warning",text:f("Delete")}).addEventListener("click",async()=>{A.close(),await this.performDeleteSelectedHighlights()}),A.open()}async performDeleteSelectedHighlights(){if(this.selectedHighlights.size===0){new X.Notice(f("No highlights selected"));return}let A=0,t=0,s=Array.from(this.highlightContainer.querySelectorAll(".highlight-card.selected"));for(let o of s)try{let l=o.getAttribute("data-highlight");if(!l)continue;let c=JSON.parse(l);if(!c.id)continue;let d=IA.findCardInstanceByHighlightId(c.id);d?(await d.handleDeleteHighlight(!0,!0),A++):(t++,console.error(`\u65E0\u6CD5\u627E\u5230\u9AD8\u4EAE\u5361\u7247\u5B9E\u4F8B: ${c.id}`))}catch(l){console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",l),t++}this.clearSelection(),A>0&&t===0?new X.Notice(f(`\u6210\u529F\u5220\u9664 ${A} \u4E2A\u9AD8\u4EAE`)):A>0&&t>0?new X.Notice(f(`\u6210\u529F\u5220\u9664 ${A} \u4E2A\u9AD8\u4EAE\uFF0C${t} \u4E2A\u5220\u9664\u5931\u8D25`)):A===0&&t>0&&new X.Notice(f("\u5220\u9664\u9AD8\u4EAE\u5931\u8D25"))}async deleteExistingFlashcards(){let A=this.plugin.fsrsManager;if(!A){new X.Notice(f("HiCard function is not initialized, please enable FSRS function"));return}let t=0,s=0;for(let o of this.selectedHighlights)try{if(o.id){let l=A.findCardsBySourceId(o.id,"highlight");if(!l||l.length===0)continue;let c=IA.findCardInstanceByHighlightId(o.id),d=!1;if(c)d=await c.deleteHiCardForHighlight(!0);else{let g=document.createElement("div");c=new IA(g,o,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1),d=await c.deleteHiCardForHighlight(!0)}d?t++:(s++,console.error(`Failed to delete HiCard: ${o.text}`))}}catch(l){s++,console.error("Failed to delete HiCard:",l)}t>0&&this.plugin.eventManager.emitFlashcardChanged(),t>0&&s===0?new X.Notice(f(`Successfully deleted ${t} HiCard`)):t>0&&s>0?new X.Notice(f(`Successfully deleted ${t} HiCard, ${s} failed`)):t===0&&s===0?new X.Notice(f("No HiCard to delete")):new X.Notice(f("Failed to delete HiCard! Please check the selected highlight content")),this.clearSelection(),this.renderHighlights(this.highlights)}setupSelectionBox(){this.highlightContainer.removeEventListener("mousedown",this.handleSelectionStart),this.highlightContainer.addEventListener("mousedown",this.handleSelectionStart)}startSelection(A){let t=this.highlightContainer.querySelectorAll(".highlight-card.selected").length>0,s=window.HighlightCard,o=s&&s.selectedCards&&s.selectedCards.size>0;(this.selectedHighlights.size>0||t||o)&&this.clearSelection(),this.selectionBox=document.createElement("div"),this.selectionBox.className="selection-box",this.selectionBox.style.left=`${this.selectionStartX}px`,this.selectionBox.style.top=`${this.selectionStartY}px`,document.body.appendChild(this.selectionBox),this.isSelectionMode=!0,document.addEventListener("mousemove",this.handleSelectionMove),document.addEventListener("mouseup",this.handleSelectionEnd)}selectCardsInBox(){if(!this.selectionBox)return;let A=this.selectionBox.getBoundingClientRect(),t=this.highlightContainer.querySelectorAll(".highlight-card"),s=window.HighlightCard;t.forEach(o=>{let l=o.getBoundingClientRect();!(A.right<l.left||A.left>l.right||A.bottom<l.top||A.top>l.bottom)?(o.addClass("selected"),s&&s.selectedCards&&s.selectedCards.add(o)):document.querySelector(".multi-select-mode")||(o.removeClass("selected"),s&&s.selectedCards&&s.selectedCards.delete(o))})}getViewType(){return ie}getDisplayText(){return"HiNote"}getIcon(){return"highlighter"}async onOpen(){let A=this.containerEl.children[1];A.empty(),A.addClass("comment-view-container"),A.addEventListener("highlight-multi-select",w=>{this.handleMultiSelect(w)}),document.addEventListener("click",this.handleGlobalClick);let t=A.createEl("div",{cls:"highlight-main-container"});this.fileListContainer=t.createEl("div",{cls:"highlight-file-list-container"}),this.mainContentContainer=t.createEl("div",{cls:"highlight-content-container"});let o=this.mainContentContainer.createEl("div",{cls:"highlight-back-button-container"}).createEl("div",{cls:"highlight-back-button"});(0,X.setIcon)(o,"arrow-left"),o.createEl("span",{text:f("BACK"),cls:"highlight-back-button-text"}),o.addEventListener("click",()=>{if(this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView){if(this.isFlashcardMode&&this.flashcardComponent){let w=this.flashcardComponent.getRenderer();if(w&&!w.isShowingSidebar()){w.showSidebar();return}}this.isShowingFileList=!0,this.updateViewLayout()}}),this.searchContainer=this.mainContentContainer.createEl("div",{cls:"highlight-search-container"}),this.searchInput=this.searchContainer.createEl("input",{cls:"highlight-search-input",attr:{type:"text",placeholder:f("Search...")}}),this.searchInput.addEventListener("focus",()=>{this.searchContainer.addClass("focused"),this.showSearchPrefixHints()}),this.searchInput.addEventListener("blur",w=>{this.searchContainer.removeClass("focused"),setTimeout(()=>{let F=document.querySelector(".search-prefix-hints");F&&F.remove()},200)}),this.searchLoadingIndicator=this.searchContainer.createEl("div",{cls:"highlight-search-loading"}),this.searchLoadingIndicator.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="loading-spinner"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>',this.searchLoadingIndicator.style.display="none";let l=this.searchContainer.createEl("div",{cls:"highlight-search-icons"}),c=l.createEl("div",{cls:"highlight-icon-button"});(0,X.setIcon)(c,"message-square-plus"),c.setAttribute("aria-label",f("Add File Comment")),c.addEventListener("click",async()=>{if(!this.currentFile){new X.Notice(f("Please open a file first."));return}let w=Date.now(),Q={id:`file-comment-${w}`,text:`__virtual_highlight_${w}__`,filePath:this.currentFile.path,fileType:this.currentFile.extension,displayText:f("File Comment"),isVirtual:!0,position:0,paragraphOffset:0,paragraphId:`${this.currentFile.path}#^virtual-${w}`,createdAt:w,updatedAt:w,comments:[]};await this.commentStore.addComment(this.currentFile,Q),this.highlights.unshift(Q),this.renderHighlights(this.highlights),setTimeout(()=>{let E=this.highlightContainer.querySelector(".highlight-card");E&&(this.showCommentInput(E,Q),this.highlightContainer.scrollTo({top:0,behavior:"smooth"}))},100)});let d=l.createEl("div",{cls:"highlight-icon-button"});(0,X.setIcon)(d,"file-symlink"),d.setAttribute("aria-label",f("Export as notes")),d.addEventListener("click",async()=>{if(!this.currentFile){new X.Notice(f("Please open a file first."));return}try{let w=await this.exportService.exportHighlightsToNote(this.currentFile);new X.Notice(f("Successfully exported highlights to: ")+w.path),await this.app.workspace.getLeaf().openFile(w)}catch(w){new X.Notice(f("Failed to export highlights: ")+w.message)}}),this.searchInput.addEventListener("input",this.handleSearchInputWithDebounce),this.highlightContainer=this.mainContentContainer.createEl("div",{cls:"highlight-container"}),this.registerDomEvent(document,"keydown",w=>{w.key==="Shift"&&this.highlightContainer.addClass("multi-select-mode")}),this.registerDomEvent(document,"keyup",w=>{w.key==="Shift"&&this.highlightContainer.removeClass("multi-select-mode")});let g=this.app.workspace.getActiveFile();g&&(this.currentFile=g,await this.updateHighlights()),this.updateViewLayout(),this.highlightContainer.empty();let u=this.searchInput.value.toLowerCase().trim(),m=this.highlights.filter(w=>{var F,Q;return!!(w.text.toLowerCase().includes(u)||(F=w.comments)!=null&&F.some(E=>E.content.toLowerCase().includes(u))||this.currentFile===null&&((Q=w.fileName)!=null&&Q.toLowerCase().includes(u)))});this.renderHighlights(m)}renderHighlights(A,t=!1){if(t||(typeof IA.clearAllInstances=="function"?IA.clearAllInstances():IA.clearSelection(),this.highlightContainer.empty(),this.currentBatch=0,this.selectedHighlights.clear(),this.isSelectionMode=!1),A.length===0){let o=this.searchInput&&this.searchInput.value.trim()!=="",l=this.highlightContainer.createEl("div",{cls:"highlight-empty-state",text:o?f("No matching highlights found for your search."):f("The current document has no highlighted content.")});return}this.setupSelectionBox();let s=this.highlightContainer.querySelector(".highlight-list");s||(s=this.highlightContainer.createEl("div",{cls:"highlight-list"})),A.forEach(o=>{let l;this.currentFile&&!o.filePath&&(o.filePath=this.currentFile.path),l=new IA(s,o,this.plugin,{onHighlightClick:async d=>await this.jumpToHighlight(d),onCommentAdd:d=>this.showCommentInput(l.getElement(),d),onExport:d=>this.exportHighlightAsImage(d),onCommentEdit:(d,g)=>this.showCommentInput(l.getElement(),d,g),onAIResponse:async d=>{await this.addComment(o,d),await this.updateHighlights()}},this.isDraggedToMainView,this.currentFile===null?o.fileName:this.currentFile.basename),o.id&&this.highlightsWithFlashcards.has(o.id)&&setTimeout(()=>{o.id&&IA.updateCardUIByHighlightId(o.id)},0);let c=l.getElement();if(this.isDraggedToMainView){c.classList.add("in-main-view");let d=c.querySelector(".highlight-text-content");d&&d.removeAttribute("title")}else{c.classList.remove("in-main-view");let d=c.querySelector(".highlight-text-content");d&&d.setAttribute("aria-label","Jump to highlight")}})}async addComment(A,t){var l;let s=await this.getFileForHighlight(A);if(!s){new X.Notice(f("No corresponding file found."));return}A.id||(A.id=XA.generateHighlightId(((l=this.currentFile)==null?void 0:l.path)||"",A.position||0,A.text)),A.comments||(A.comments=[]);let o={id:XA.generateCommentId(),content:t,createdAt:Date.now(),updatedAt:Date.now()};A.comments.push(o),A.updatedAt=Date.now(),await this.commentStore.addComment(s,A),window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:A.text,comments:A.comments}})),await this.refreshView()}async updateComment(A,t,s){let o=await this.getFileForHighlight(A);if(!o||!A.comments)return;let l=A.comments.find(c=>c.id===t);if(l){let c=l.content;l.content=s,l.updatedAt=Date.now(),A.updatedAt=Date.now(),await this.commentStore.addComment(o,A),window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:A.text,comments:A.comments}})),A.id&&this.plugin.eventManager.emitCommentUpdate(o.path,c,s,A.id),await this.refreshView()}}checkHasFlashcard(A){let s=this.plugin.fsrsManager;if(!s||!A)return!1;let o=s.findCardsBySourceId(A,"highlight");return o&&o.length>0}async deleteComment(A,t){let s=await this.getFileForHighlight(A);if(!(!s||!A.comments)){if(A.comments=A.comments.filter(o=>o.id!==t),A.updatedAt=Date.now(),A.comments.length===0){let o=A.id?this.checkHasFlashcard(A.id):!1;A.isVirtual||!o?(await this.commentStore.removeComment(s,A),this.highlights=this.highlights.filter(l=>l.id!==A.id)):await this.commentStore.addComment(s,A)}else await this.commentStore.addComment(s,A);window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:A.text,comments:A.comments}})),await this.refreshView()}}async getFileForHighlight(A){if(this.currentFile)return this.currentFile;if(A.filePath){let t=this.app.vault.getAbstractFileByPath(A.filePath);if(t instanceof X.TFile)return t}if(A.fileName){let s=this.app.vault.getFiles().find(o=>o.basename===A.fileName||o.name===A.fileName);if(s)return s}return null}generateHighlightId(A){var t;return XA.generateHighlightId(((t=this.currentFile)==null?void 0:t.path)||"",A.position||0,A.text)}async jumpToHighlight(A){if(!this.isDraggedToMainView&&!A.isGlobalSearch){if(!this.currentFile){new X.Notice(f("No corresponding file found."));return}await this.locationService.jumpToHighlight(A,this.currentFile.path)}}async exportHighlightAsImage(A){try{let t=(await Promise.resolve().then(()=>go(nn()))).default;new gs(this.app,A,t).open()}catch(t){new X.Notice(f("Export failed: Failed to load necessary components."))}}async showCommentInput(A,t,s){this.currentEditingHighlightId=t.id,new Ss(A,t,s,this.plugin,{onSave:async o=>{s?await this.updateComment(t,s.id,o):await this.addComment(t,o),await this.updateHighlights()},onDelete:s?async()=>{await this.deleteComment(t,s.id)}:void 0,onCancel:async()=>{let o=this.highlights.find(l=>l.id===this.currentEditingHighlightId);if(o!=null&&o.isVirtual&&(!o.comments||o.comments.length===0)){let l=await this.getFileForHighlight(o);l&&(await this.commentStore.removeComment(l,o),this.highlights=this.highlights.filter(c=>c.id!==o.id),await this.refreshView())}}}).show()}async onload(){}async checkViewPosition(){let A=this.app.workspace.rootSplit;if(!A)return;let t=this.isViewInMainArea(this.leaf,A);if(this.isDraggedToMainView!==t){let s=this.isInAllHighlightsView(),o=[...this.highlights];if(this.isDraggedToMainView=t,t){this.checkIfMobile()&&this.checkIfSmallScreen()&&(this.isShowingFileList=!0);let l=this.app.workspace.getActiveFile();l?(this.currentFile=l,await this.updateHighlights()):(this.currentFile=null,await this.updateAllHighlights()),this.updateFileListSelection()}else{this.isFlashcardMode&&(this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.updateFileListSelection());let l=this.app.workspace.getActiveFile();l?s?(this.currentFile=l,this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),setTimeout(()=>{this.updateHighlights()},10)):(this.currentFile=l,this.updateHighlights()):(this.highlights=[],this.renderHighlights([]))}this.updateViewLayout(),this.searchInput&&this.searchInput.value.trim()!==""&&this.updateHighlightsList()}}isViewInMainArea(A,t){return t&&t.children?t.children.some(s=>s===A?!0:this.isViewInMainArea(A,s)):!1}checkIfMobile(){return X.Platform.isMobile}checkIfSmallScreen(){return window.innerWidth<768}async updateViewLayout(){this.isMobileView=this.checkIfMobile(),this.isSmallScreen=this.checkIfSmallScreen(),this.fileListContainer.removeClass("highlight-display-block"),this.fileListContainer.removeClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none");let A=this.containerEl.children[1];if(this.isDraggedToMainView?A.addClass("is-in-main-view"):A.removeClass("is-in-main-view"),this.isSmallScreen?A.addClass("is-small-screen"):A.removeClass("is-small-screen"),this.isDraggedToMainView)await this.updateFileList(),this.createFloatingButton(),this.isMobileView&&this.isSmallScreen?this.isShowingFileList?(this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.addClass("highlight-display-none"),this.fileListContainer.addClass("highlight-full-width")):(this.fileListContainer.addClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width")):(this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width"));else if(this.fileListContainer.addClass("highlight-display-none"),this.removeFloatingButton(),!this.isFlashcardMode){this.searchContainer.removeClass("highlight-display-none");let t=this.searchContainer.querySelector(".highlight-search-icons");t&&t.removeClass("highlight-display-none")}}async updateFileList(){var Q;if(this.fileListContainer.children.length>0){this.updateFileListSelection();return}this.fileListContainer.empty(),this.fileListContainer.createEl("div",{cls:"highlight-file-list-header"}).createEl("div",{text:"HiNote",cls:"highlight-file-list-title"});let t=this.fileListContainer.createEl("div",{cls:"highlight-file-list"}),s=t.createEl("div",{cls:`highlight-file-item highlight-file-item-all ${this.currentFile===null?"is-active":""}`});s.addEventListener("click",()=>{this.currentFile=null,this.isFlashcardMode=!1,this.updateHighlights(),this.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let E=this.searchContainer.querySelector(".highlight-search-icons");E&&E.addClass("highlight-display-none")});let o=s.createEl("div",{cls:"highlight-file-item-left"}),l=o.createEl("span",{cls:"highlight-file-item-icon"});(0,X.setIcon)(l,"square-library"),o.createEl("span",{text:f("All Highlight"),cls:"highlight-file-item-name"});let c=t.createEl("div",{cls:"highlight-file-item highlight-file-item-flashcard"});c.addEventListener("click",async()=>{this.currentFile=null,this.isFlashcardMode=!0,this.updateFileListSelection(),this.searchContainer.addClass("highlight-display-none"),this.highlightContainer.empty(),this.flashcardComponent||(this.flashcardComponent=new ri(this.highlightContainer,this.plugin),this.flashcardComponent.setLicenseManager(this.licenseManager)),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.flashcardComponent.activate()});let d=c.createEl("div",{cls:"highlight-file-item-left"}),g=d.createEl("span",{cls:"highlight-file-item-icon"});(0,X.setIcon)(g,"book-heart"),d.createEl("span",{text:f("HiCard"),cls:"highlight-file-item-name"});let u=c.createEl("span",{cls:"highlight-file-item-count"}),m=async()=>{let E=this.plugin.fsrsManager.getTotalCardsCount();u.textContent=`${E}`};m(),this.registerEvent(this.plugin.eventManager.on("flashcard:changed",()=>{m()})),d.addEventListener("click",async()=>{let E=this.plugin.fsrsManager.getCardGroups(),H=[];if(E&&E.length>0){let b=E[0].id;H=this.plugin.fsrsManager.getCardsForStudy(b),this.highlightContainer.empty(),this.flashcardComponent||(this.flashcardComponent=new ri(this.highlightContainer,this.plugin),this.flashcardComponent.setLicenseManager(this.licenseManager)),await this.flashcardComponent.activate(),this.updateFileListSelection()}});let w=await this.getTotalHighlightsCount();s.createEl("span",{text:`${w}`,cls:"highlight-file-item-count"}),t.createEl("div",{cls:"highlight-file-list-separator"}),s.addEventListener("click",async()=>{this.currentFile=null,this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.updateFileListSelection(),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.updateAllHighlights()});let F=await this.getFilesWithHighlights();for(let E of F){let H=t.createEl("div",{cls:`highlight-file-item ${((Q=this.currentFile)==null?void 0:Q.path)===E.path?"is-active":""}`});H.setAttribute("data-path",E.path);let b=H.createEl("div",{cls:"highlight-file-item-left"}),K=b.createEl("span",{cls:"highlight-file-item-icon",attr:{"aria-label":f("Open (DoubleClick)")}});(0,X.setIcon)(K,"file-text"),K.addEventListener("dblclick",async N=>{N.stopPropagation(),await this.getPreferredLeaf().openFile(E)});let M=b.createEl("span",{text:E.basename,cls:"highlight-file-item-name"});this.addPagePreview(M,E);let D=await this.getFileHighlightsCount(E);H.createEl("span",{text:`${D}`,cls:"highlight-file-item-count"}),H.addEventListener("click",async()=>{this.currentFile=E,this.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let N=this.searchContainer.querySelector(".highlight-search-icons");N&&N.removeClass("highlight-display-none"),this.isMobileView&&this.isSmallScreen&&this.isDraggedToMainView&&(this.isShowingFileList=!1,this.updateViewLayout()),await this.updateHighlights()})}}updateFileListSelection(){let A=this.fileListContainer.querySelector(".highlight-file-item-all");A&&A.classList.toggle("is-active",this.currentFile===null&&!this.isFlashcardMode);let t=this.fileListContainer.querySelector(".highlight-file-item-flashcard");t&&t.classList.toggle("is-active",this.isFlashcardMode),this.fileListContainer.querySelectorAll(".highlight-file-item:not(.highlight-file-item-all):not(.highlight-file-item-flashcard)").forEach(o=>{var c;let l=((c=this.currentFile)==null?void 0:c.path)===o.getAttribute("data-path");o.classList.toggle("is-active",l)})}async getFilesWithHighlights(){let t=(await this.app.vault.getMarkdownFiles()).filter(o=>this.highlightService.shouldProcessFile(o)),s=[];for(let o of t){let l=await this.app.vault.read(o);this.highlightService.extractHighlights(l,o).length>0&&s.push(o)}return s}async updateAllHighlights(A="",t=""){this.currentBatch=0,this.highlights=[],this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);try{if(t==="path"){let d=await this.highlightService.getAllHighlights(),g=new Map,u=this.app.vault.getMarkdownFiles();for(let m of u){let w=this.commentStore.getFileComments(m);w&&w.length>0&&g.set(m.path,w)}this.highlights=[];for(let{file:m,highlights:w}of d){if(A&&!m.path.toLowerCase().includes(A.toLowerCase()))continue;let F=g.get(m.path)||[],Q=new Set,E=w.map(b=>{let K=F.find(M=>!Q.has(M.id)&&M.id===b.id);if(K||(K=F.find(M=>{if(Q.has(M.id))return!1;let D=M.text===b.text;return D&&b.position!==void 0&&M.position!==void 0?Math.abs(M.position-b.position)<1e3:D})),!K&&b.position!==void 0){let M=b.position;K=F.find(D=>!Q.has(D.id)&&D.position!==void 0&&Math.abs(D.position-M)<50)}return K?(Q.add(K.id),{...b,id:K.id,comments:K.comments||[],createdAt:K.createdAt,updatedAt:K.updatedAt,fileName:m.basename,filePath:m.path,fileIcon:"file-text"}):{...b,comments:b.comments||[],fileName:m.basename,filePath:m.path,fileIcon:"file-text"}});this.highlights.push(...E),F.filter(b=>b.isVirtual&&b.comments&&b.comments.length>0&&!Q.has(b.id)).forEach(b=>{Q.add(b.id),this.highlights.push({...b,fileName:m.basename,filePath:m.path,fileIcon:"file-text",position:b.position||0})})}await this.loadMoreHighlights();return}if(A){let d=Date.now(),g=await this.highlightService.searchHighlightsFromIndex(A);this.highlights=g.map(u=>{var m;return{...u,comments:u.comments||[],fileName:u.fileName||(u.filePath?(m=u.filePath.split("/").pop())==null?void 0:m.replace(".md",""):""),filePath:u.filePath||"",fileIcon:"file-text"}}),await this.loadMoreHighlights();return}let s=await this.highlightService.getAllHighlights(),o=new Map,l=this.app.vault.getMarkdownFiles();for(let d of l){let g=this.commentStore.getFileComments(d);g&&g.length>0&&o.set(d.path,g)}this.highlights=[];for(let{file:d,highlights:g}of s){let u=o.get(d.path)||[],m=new Set,w=g.map(Q=>{let E=u.find(H=>!m.has(H.id)&&H.id===Q.id);if(E||(E=u.find(H=>{if(m.has(H.id))return!1;let b=H.text===Q.text;return b&&Q.position!==void 0&&H.position!==void 0?Math.abs(H.position-Q.position)<1e3:b})),!E&&Q.position!==void 0){let H=Q.position;E=u.find(b=>!m.has(b.id)&&b.position!==void 0&&Math.abs(b.position-H)<50)}return E?(m.add(E.id),{...Q,id:E.id,comments:E.comments||[],createdAt:E.createdAt,updatedAt:E.updatedAt,fileName:d.basename,filePath:d.path,fileIcon:"file-text"}):{...Q,comments:Q.comments||[],fileName:d.basename,filePath:d.path,fileIcon:"file-text"}});this.highlights.push(...w),u.filter(Q=>Q.isVirtual&&Q.comments&&Q.comments.length>0&&!m.has(Q.id)).forEach(Q=>{m.add(Q.id),this.highlights.push({...Q,fileName:d.basename,filePath:d.path,fileIcon:"file-text",position:Q.position||0})})}await this.loadMoreHighlights();let c=(0,X.debounce)(async d=>{let g=d.target,{scrollTop:u,scrollHeight:m,clientHeight:w}=g;m-u-w<300&&await this.loadMoreHighlights()},100);this.highlightContainer.addEventListener("scroll",c),this.register(()=>this.highlightContainer.removeEventListener("scroll",c))}catch(s){console.error("[CommentView] Error in updateAllHighlights:",s),new X.Notice(f("Error loading all highlights")),this.highlightContainer.empty(),this.highlightContainer.createEl("div",{cls:"highlight-empty-state",text:f("Error loading highlights. Please try again.")})}finally{this.loadingIndicator.removeClass("highlight-display-block")}}async loadMoreHighlights(){if(!this.isLoading){this.isLoading=!0,this.loadingIndicator.addClass("highlight-display-block");try{let A=this.currentBatch*this.BATCH_SIZE,t=this.highlights.slice(A,A+this.BATCH_SIZE);if(t.length===0){this.loadingIndicator.remove();return}await this.renderHighlights(t,!0),this.currentBatch++}catch(A){new X.Notice("\u52A0\u8F7D\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519")}finally{this.isLoading=!1,this.loadingIndicator.addClass("highlight-display-none")}}}async getFileHighlightsCount(A){let t=await this.app.vault.read(A);return this.highlightService.extractHighlights(t,A).length}async getTotalHighlightsCount(){let A=await this.getFilesWithHighlights(),t=0;for(let s of A)t+=await this.getFileHighlightsCount(s);return t}createFloatingButton(){if(this.floatingButton)return;this.floatingButton=document.createElement("div"),this.floatingButton.className="highlight-floating-button";let A=document.createElement("span");(0,X.setIcon)(A,"bot-message-square"),this.floatingButton.appendChild(A),this.floatingButton.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();try{let s=At.getInstance(this.app,this.plugin);setTimeout(()=>{s.show()},0)}catch(s){console.error("\u521B\u5EFAChatView\u5931\u8D25:",s)}}),document.body.appendChild(this.floatingButton),this.registerActiveLeafChangeHandler()}removeFloatingButton(){this.floatingButton&&(this.floatingButton.remove(),this.floatingButton=null),this.unregisterActiveLeafChangeHandler()}registerActiveLeafChangeHandler(){this.unregisterActiveLeafChangeHandler(),this.activeLeafChangeHandler=()=>{this.updateFloatingButtonVisibility(),typeof IA.clearAllInstances=="function"&&IA.clearAllInstances(),this.updateHighlights()},this.app.workspace.on("active-leaf-change",this.activeLeafChangeHandler),this.updateFloatingButtonVisibility()}unregisterActiveLeafChangeHandler(){this.activeLeafChangeHandler&&(this.app.workspace.off("active-leaf-change",this.activeLeafChangeHandler),this.activeLeafChangeHandler=void 0)}updateFloatingButtonVisibility(){if(!this.floatingButton)return;let A=this.app.workspace.activeLeaf;A&&A.view&&A.view.getViewType()===ie?this.floatingButton.style.display="flex":this.floatingButton.style.display="none"}onunload(){this.removeFloatingButton(),this.unregisterActiveLeafChangeHandler()}updateAIDropdowns(){this.aiButtons.forEach(A=>{}),this.app.workspace.trigger("comment-view:update-ai-dropdowns")}registerAIButton(A){this.aiButtons.push(A)}unregisterAIButton(A){let t=this.aiButtons.indexOf(A);t!==-1&&this.aiButtons.splice(t,1)}isInAllHighlightsView(){return this.currentFile===null}filterHighlightsByTerm(A,t=""){if(t==="path")return this.highlights.forEach(s=>{if(s.filePath&&!s.fileName){let o=s.filePath.split("/");s.fileName=o[o.length-1]}}),!A||A.trim()===""?this.highlights.filter(s=>!!s.filePath):this.highlights.filter(s=>s.filePath?s.filePath.toLowerCase().includes(A.toLowerCase()):!1);if(t==="hicard"){let s=this.plugin.fsrsManager;return s?this.highlights.filter(o=>{var c,d;return(o.id?s.findCardsBySourceId(o.id,"highlight").length>0:!1)?A?!!(o.text.toLowerCase().includes(A)||(c=o.comments)!=null&&c.some(g=>g.content.toLowerCase().includes(A))||this.currentFile===null&&((d=o.fileName)!=null&&d.toLowerCase().includes(A))):!0:!1}):[]}return t==="comment"?this.highlights.filter(s=>{var l;return s.comments&&s.comments.length>0?A?!!(s.text.toLowerCase().includes(A)||s.comments&&s.comments.some(c=>c.content.toLowerCase().includes(A))||this.currentFile===null&&((l=s.fileName)!=null&&l.toLowerCase().includes(A))):!0:!1}):this.highlights.filter(s=>{var o,l;return!!(s.text.toLowerCase().includes(A)||(o=s.comments)!=null&&o.some(c=>c.content.toLowerCase().includes(A))||this.currentFile===null&&((l=s.fileName)!=null&&l.toLowerCase().includes(A)))})}showSearchPrefixHints(){let A=document.querySelector(".search-prefix-hints");A&&A.remove();let t=document.body.createDiv({cls:"search-prefix-hints show"});[{prefix:"all:",description:f("search-prefix-all")},{prefix:"path:",description:f("search-prefix-path")},{prefix:"hicard:",description:f("search-prefix-hicard")},{prefix:"comment:",description:f("search-prefix-comment")}].forEach(({prefix:d,description:g})=>{let u=t.createDiv({cls:"search-prefix-hint-item"}),m=u.createSpan({cls:"search-prefix-tag",text:d}),w=u.createSpan({cls:"search-prefix-description",text:g});u.addEventListener("click",()=>{this.searchInput.value=d+" ",this.searchInput.focus(),t.remove();let F=new Event("input",{bubbles:!0});this.searchInput.dispatchEvent(F)})}),this.positionSearchHints(t);let o=()=>{this.searchInput.value.trim()===""?document.body.contains(t)||(document.body.appendChild(t),this.positionSearchHints(t)):t&&document.body.contains(t)&&t.remove()};this.searchInput.addEventListener("input",o);let l=d=>{t&&!t.contains(d.target)&&d.target!==this.searchInput&&(t.remove(),document.removeEventListener("click",l))},c=()=>{setTimeout(()=>{(!document.activeElement||document.activeElement!==this.searchInput&&!t.contains(document.activeElement))&&t.remove()},200)};this.searchInput.addEventListener("blur",c),setTimeout(()=>{document.addEventListener("click",l)},10),this.searchHintsEventHandlers={input:o,blur:c,click:l}}positionSearchHints(A){let t=this.searchInput.getBoundingClientRect();A.addClass("search-hints-container"),A.style.top=t.bottom+4+"px",A.style.left=t.left+"px",A.style.width=t.width+"px"}showSearchLoadingIndicator(){this.isSearching||(this.isSearching=!0,this.searchLoadingIndicator.style.display="flex")}hideSearchLoadingIndicator(){this.isSearching&&(this.isSearching=!1,this.searchLoadingIndicator.style.display="none")}async updateHighlightsList(){try{let A=this.searchInput.value.toLowerCase().trim(),t=A.startsWith("all:"),s=A.startsWith("hicard:"),o=A.startsWith("comment:"),l=A.startsWith("path:"),c="";t?c="all":s?c="hicard":o?c="comment":l&&(c="path");let d=A;if(t?d=A.substring(4).trim():s?d=A.substring(7).trim():o?d=A.substring(8).trim():l&&(d=A.substring(5).trim()),this.highlights.some(u=>u.isGlobalSearch)&&!t&&this.currentFile){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),await this.updateHighlights(),this.highlights.forEach(m=>{m.isGlobalSearch=!1});let u=this.filterHighlightsByTerm(d,c);this.renderHighlights(u);return}if((t||l)&&this.currentFile!==null){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);let u=this.currentFile;try{this.currentFile=null,await this.updateAllHighlights(d,c),this.highlights.forEach(m=>{m.isGlobalSearch=!0}),this.renderHighlights(this.highlights)}finally{this.currentFile=u,this.hideSearchLoadingIndicator()}}else{this.highlights.forEach(m=>{m.isGlobalSearch=!1});let u=this.filterHighlightsByTerm(d,c);this.renderHighlights(u),this.hideSearchLoadingIndicator()}}catch(A){console.error("[\u9AD8\u4EAE\u641C\u7D22] \u641C\u7D22\u8FC7\u7A0B\u4E2D\u51FA\u9519:",A),this.hideSearchLoadingIndicator()}}async refreshView(){this.isInAllHighlightsView()?await this.updateAllHighlights():await this.updateHighlights()}async updateHighlights(A=!1){if(this.isInAllHighlightsView()){await this.updateAllHighlights();return}if(!this.currentFile){this.renderHighlights([]);return}if(this.currentFile.extension==="canvas"){await this.handleCanvasFile(this.currentFile);return}if(!this.highlightService.shouldProcessFile(this.currentFile)){this.renderHighlights([]);return}let t=await this.app.vault.read(this.currentFile),s=this.highlightService.extractHighlights(t,this.currentFile),o=this.commentStore.getFileComments(this.currentFile),l=new Set;this.highlights=s.map(g=>{var m;let u=o.find(w=>{if(l.has(w.id))return!1;let F=w.text===g.text;return F&&g.position!==void 0&&w.position!==void 0?Math.abs(w.position-g.position)<1e3:F});if(!u&&g.position!==void 0&&(u=o.find(w=>!l.has(w.id)&&w.position!==void 0&&g.position!==void 0&&Math.abs(w.position-g.position)<50)),!u&&this.plugin.highlightMatchingService){let w={id:g.id||XA.generateHighlightId(((m=this.currentFile)==null?void 0:m.path)||"",g.position||0,g.text),text:g.text,position:g.position||0,comments:[],createdAt:g.createdAt||Date.now(),updatedAt:g.updatedAt||Date.now(),blockId:g.blockId,paragraphId:g.paragraphId,paragraphOffset:g.paragraphOffset||0,isVirtual:!1};if(this.currentFile){let F=this.plugin.highlightMatchingService.findMatchingHighlight(this.currentFile,w);F&&!l.has(F.id)&&(u=F)}}return u?(l.add(u.id),{...g,id:u.id,comments:u.comments,createdAt:u.createdAt,updatedAt:u.updatedAt}):g});let d=o.filter(g=>g.isVirtual&&g.comments&&g.comments.length>0&&!l.has(g.id)).filter(g=>!this.highlights.some(u=>u.text===g.text));if(d.forEach(g=>l.add(g.id)),this.highlights.unshift(...d),A&&this.currentFile&&this.highlights.forEach(g=>{var u;g.isFromCanvas=!0,g.isGlobalSearch=!0,g.fileName=(u=this.currentFile)==null?void 0:u.name}),this.highlightsWithFlashcards=new Set,this.plugin&&this.plugin.fsrsManager){let g=this.plugin.fsrsManager;for(let u of this.highlights)if(u.id){let m=g.findCardsBySourceId(u.id,"highlight");m&&m.length>0&&this.highlightsWithFlashcards.add(u.id)}}this.searchInput&&this.searchInput.value.trim()!==""?this.updateHighlightsList():this.renderHighlights(this.highlights)}async handleCanvasFile(A){this.highlightContainer.empty(),this.loadingIndicator&&(this.highlightContainer.appendChild(this.loadingIndicator),this.loadingIndicator.removeClass("highlight-display-none"));try{let t=await this.canvasService.parseCanvasFile(A);if(t.length===0){this.highlightContainer.empty();let s=this.highlightContainer.createDiv({cls:"no-highlights-message",text:"There are no file nodes in the current Canvas."});return}await this.updateAllHighlights("","path"),this.highlights=this.highlights.filter(s=>s.filePath?t.includes(s.filePath):!1),this.highlights.forEach(s=>{s.isFromCanvas=!0,s.canvasSource=A.path,s.isGlobalSearch=!0}),this.renderHighlights(this.highlights)}catch(t){console.error("\u5904\u7406 Canvas \u6587\u4EF6\u5931\u8D25:",t),this.highlightContainer.empty();let s=this.highlightContainer.createDiv({cls:"error-message",text:"\u5904\u7406 Canvas \u6587\u4EF6\u65F6\u51FA\u9519"})}finally{this.loadingIndicator&&this.loadingIndicator.addClass("highlight-display-none")}}addPagePreview(A,t){let s;A.addEventListener("mouseenter",o=>{s=setTimeout(async()=>{let l=o.target;this.app.workspace.trigger("hover-link",{event:o,source:"hi-note",hoverParent:l,targetEl:l,linktext:t.path})},300)}),A.addEventListener("mouseleave",()=>{s&&clearTimeout(s)})}getPreferredLeaf(){let A=this.app.workspace.getLeavesOfType("markdown");if(this.isDraggedToMainView){let t=A.find(s=>s!==this.leaf);if(t)return t}return this.app.workspace.getLeaf("split","vertical")}};var an=require("obsidian");var xs=class{constructor(e){this.data={};this.comments=new Map;this.commentCache=new Map;this.maxCacheSize=100;this.PERFORMANCE_THRESHOLD=100;this.plugin=e,this.eventManager=new je(e.app),this.blockIdService=new xt(e.app),this.highlightService=new le(e.app)}async loadComments(){let e=await this.plugin.loadData();this.data=(e==null?void 0:e.comments)||{},this.migrateDataToBlockId(),this.comments=new Map(Object.entries(this.data).map(([A,t])=>[A,Object.values(t)]))}migrateDataToBlockId(){let e=0;for(let A in this.data){let t=this.data[A];for(let s in t){let o=t[s];if(o.paragraphId&&!o.blockId){let l=o.paragraphId.match(/#\^([a-zA-Z0-9-]+)/);l&&l[1]&&(o.blockId=l[1],e++)}}}}async saveComments(){let A={...await this.plugin.loadData()||{},comments:this.data};await this.plugin.saveData(A);let t=await this.plugin.loadData()}async checkOrphanedDataCount(){let e=0,A=new Set;for(let t in this.data){let s=this.plugin.app.vault.getAbstractFileByPath(t);if(!s||!(s instanceof an.TFile)){A.add(t),e+=Object.keys(this.data[t]||{}).length;continue}try{let o=await this.plugin.app.vault.read(s),l=this.highlightService.extractHighlights(o,s),c=new Set(l.map(u=>u.text)),d=this.data[t]||{},g=!1;for(let u in d){let m=d[u];m.isVirtual||c.has(m.text)||(e++,g=!0)}g&&A.add(t)}catch(o){}}return{orphanedHighlights:e,affectedFiles:A.size}}async cleanOrphanedData(){let e=0,A=new Set;for(let t in this.data){let s=this.plugin.app.vault.getAbstractFileByPath(t);if(!s||!(s instanceof an.TFile)){delete this.data[t],this.comments.delete(t),A.add(t),e+=Object.keys(this.data[t]||{}).length;continue}try{let o=await this.plugin.app.vault.read(s),l=this.highlightService.extractHighlights(o,s),c=new Set(l.map(u=>u.text)),d=this.data[t]||{},g=!1;for(let u in d){let m=d[u];m.isVirtual||c.has(m.text)||(delete d[u],e++,g=!0)}g&&(A.add(t),this.comments.set(t,Object.values(d)),Object.keys(d).length===0&&(delete this.data[t],this.comments.delete(t)))}catch(o){}}return e>0&&await this.saveComments(),{removedHighlights:e,affectedFiles:A.size}}async updateFilePath(e,A){this.data[e]&&(this.data[A]=this.data[e],delete this.data[e]);let t=this.comments.get(e)||[];this.comments.set(A,t),this.comments.delete(e),await this.saveComments()}getHiNotes(e){let A=this.plugin.app.workspace.getActiveFile();if(!A)return[];let t=this.data[A.path]||{};return Object.values(t).filter(s=>{let o=s.text===e.text;return o&&typeof s.position=="number"&&typeof e.position=="number"?Math.abs(s.position-e.position)<1e3:o})}getFileComments(e){if(!e)return[];let A=this.data[e.path]||{};return Object.values(A)}async addComment(e,A){A.id||(A.id=XA.generateHighlightId(e.path,A.position||0,A.text));let t=Date.now();A.createdAt||(A.createdAt=t),A.updatedAt=t;let s=e.path;this.data[s]||(this.data[s]={}),this.data[s][A.id]=A,this.comments.has(s)||this.comments.set(s,[]);let o=this.comments.get(s)||[],l=o.findIndex(c=>c.id===A.id);if(l>=0?o[l]=A:o.push(A),await this.saveComments(),this.eventManager)if(A.comments&&A.comments.length>0){let c=A.comments[A.comments.length-1];this.eventManager.emitCommentUpdate(s,A.text,c.content,A.id)}else this.eventManager.emitHighlightUpdate(s,A.text,A.text,A.id);return A}async removeComment(e,A){let t=e.path;if(!this.data[t]||!this.data[t][A.id])return!1;if(delete this.data[t][A.id],Object.keys(this.data[t]).length===0&&delete this.data[t],this.comments.has(t)){let o=(this.comments.get(t)||[]).filter(l=>l.id!==A.id);o.length>0?this.comments.set(t,o):this.comments.delete(t)}if(await this.saveComments(),this.eventManager)if(A.comments&&A.comments.length>0){let s=A.comments[A.comments.length-1];this.eventManager.emitCommentDelete(t,s.content,A.id)}else this.eventManager.emitHighlightDelete(t,A.text,A.id);return!0}getCommentsByBlockId(e,A){if(!e||!A)return[];let t=e.path;return this.data[t]?Object.values(this.data[t]).filter(o=>o.blockId===A):[]}};var et=require("@codemirror/view"),on=require("obsidian");var Io=require("@codemirror/view"),bt=require("obsidian");var bs=class y extends Io.WidgetType{constructor(A,t,s,o){super();this.plugin=A;this.highlight=t;this.highlightItems=s;this.onClick=o;this.app=this.plugin.app,this.textSimilarityService=new we(this.plugin.app)}eq(A){return!(A instanceof y)||this.highlight.id!==A.highlight.id?!1:(this.textSimilarityService.calculateSimilarity(this.highlight.text,A.highlight.text)>.7||this.highlight.text===A.highlight.text)&&this.highlight.comments.length===A.highlight.comments.length}get estimatedHeight(){return 0}get lineBreaks(){return 0}toDOM(){let A=document.createElement("span");A.addClass("hi-note-widget"),A.setAttribute("data-highlight-id",this.highlight.id);let t=(this.highlight.comments||[]).length>0;return this.createButton(A),A}createButton(A){let t=(this.highlight.comments||[]).length>0,s=A.createEl("button",{cls:`hi-note-button clickable-icon ${t?"":"hi-note-button-hidden"}`}),o=this.createIconContainer(s),l=this.createTooltip(A);this.setupEventListeners(A,s,l)}createIconContainer(A){let t=A.createEl("span",{cls:"hi-note-icon-container"});(0,bt.setIcon)(t,"message-circle");let o=(this.highlight.comments||[]).length;return o>0&&t.createEl("span",{cls:"hi-note-count",text:o.toString()}),t}createTooltip(A){let t=document.createElement("div");t.addClass("hi-note-tooltip","hi-note-tooltip-hidden"),t.setAttribute("data-highlight-id",this.highlight.id);let s=t.createEl("div",{cls:"hi-note-tooltip-list"}),o=this.highlight.comments||[];return this.renderTooltipContent(s,o,t),document.body.appendChild(t),{tooltip:t,updateTooltipPosition:()=>{let c=A.getBoundingClientRect();t.style.position="fixed",t.style.top=`${c.bottom+4}px`,t.style.left=`${c.right-t.offsetWidth}px`}}}renderTooltipContent(A,t,s){t.length!==0&&(t.slice(0,3).forEach(o=>{let l=A.createEl("div",{cls:"hi-note-tooltip-item"}),c=l.createEl("div",{cls:"hi-note-tooltip-content markdown-rendered"});this.renderMarkdownContent(c,o.content),l.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(o.createdAt).toLocaleString()})}),t.length>3&&s.createEl("div",{cls:"hi-note-tooltip-more",text:`\u8FD8\u6709 ${t.length-3} \u6761\u8BC4\u8BBA...`}))}setupEventListeners(A,t,s){let{tooltip:o,updateTooltipPosition:l}=s;(this.highlight.comments||[]).length>0?(t.removeClass("hi-note-button-hidden"),t.addEventListener("mouseenter",()=>{o.removeClass("hi-note-tooltip-hidden"),l()}),t.addEventListener("mouseleave",()=>{o.addClass("hi-note-tooltip-hidden")})):(t.addClass("hi-note-button-hidden"),A.addEventListener("mouseenter",()=>{t.removeClass("hi-note-button-hidden")}),A.addEventListener("mouseleave",()=>{t.addClass("hi-note-button-hidden")})),t.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),this.onClick(),o.addClass("hi-note-tooltip-hidden");let u=new CustomEvent("open-comment-input",{detail:{highlightId:this.highlight.id,text:this.highlight.text}});window.dispatchEvent(u)}),window.addEventListener("resize",l)}async renderMarkdownContent(A,t){try{await bt.MarkdownRenderer.render(this.app,t,A,"",new bt.Component),A.querySelectorAll("ul, ol").forEach(o=>{o.addClass("tooltip-markdown-list")})}catch(s){console.error("Error rendering markdown in tooltip:",s),A.textContent=t}}destroy(A){let t=document.querySelector(`.hi-note-tooltip[data-highlight-id="${this.highlight.id}"]`);t&&t.remove(),A.remove()}updateDOM(A){return!1}ignoreEvent(){return!0}};var Ms=class{constructor(e,A){this.plugin=e,this.commentStore=A,this.highlightService=new le(this.plugin.app),this.textSimilarityService=new we(this.plugin.app)}refreshDecorations(){let e=this.getActiveMarkdownView();if(!(e!=null&&e.editor))return;let A=e.editor.cm;A&&A.dispatch({changes:[],effects:[]})}findMatchingHighlight(e,A,t){if(!t||t.length===0)return null;let s=t.find(o=>o.text===A.text&&(typeof o.position!="number"||typeof A.position!="number"||Math.abs(o.position-A.position)<10))||null;if(!s&&typeof A.position=="number"&&(s=t.find(o=>typeof o.position=="number"&&Math.abs(o.position-A.position)<30)||null),!s){let o=null,l=0;for(let c of t){if(!c.comments||c.comments.length===0)continue;let d=this.textSimilarityService.calculateSimilarity(c.text,A.text);d>l&&d>.6&&(l=d,o=c)}o&&(s=o)}return s}getActiveMarkdownView(){return this.plugin.app.workspace.getActiveViewOfType(on.MarkdownView)}enable(){let e=this.plugin,A=this.commentStore,t=this.highlightService,s=this.textSimilarityService,o=this.findMatchingHighlight.bind(this);this.plugin.registerEvent(this.plugin.eventManager.on("comment:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("comment:delete",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:delete",()=>{this.refreshDecorations()}));let l=et.ViewPlugin.fromClass(class{constructor(c){this.plugin=e,this.commentStore=A,this.highlightService=new le(this.plugin.app),this.textSimilarityService=new we(this.plugin.app),this.decorations=this.buildDecorations(c)}createHiNoteFromHighlight(c){return{...c,id:c.id||`highlight-${Date.now()}-${c.position}`,comments:c.comments||[],position:c.position,paragraphOffset:c.paragraphOffset||0,blockId:c.blockId,paragraphId:c.paragraphId||`p-${c.paragraphOffset||0}`,createdAt:c.createdAt||Date.now(),updatedAt:c.updatedAt||Date.now(),text:c.text}}findExactMatchingHighlight(c,d){return d.find(g=>g.text===c.text&&(typeof g.position!="number"||typeof c.position!="number"||Math.abs(g.position-c.position)<10))||null}handleTextChanges(c,d,g){d.text!==g.text&&e.highlightMatchingService.recoverHighlight(c,d,g.text).then(u=>{u&&e.eventManager.emitHighlightUpdate(c.path,d.text,g.text)})}getCommentsForHighlight(c,d,g=!0){let u=[];if(d.blockId){let m=A.getCommentsByBlockId(c,d.blockId);if(m&&m.length>0){let w=m.find(F=>F.text===d.text);if(w)u=w.comments||[];else{let F=this.findExactMatchingHighlight(d,m);if(F)u=F.comments||[];else if(g){let Q=o(c,d,m);Q&&(this.handleTextChanges(c,Q,d),u=Q.comments||[])}}}}else{let m=A.getHiNotes(d);if(m&&m.length>0){let w=m.find(F=>F.text===d.text);if(w)u=w.comments||[];else{let F=this.findExactMatchingHighlight(d,m);if(F)u=F.comments||[];else if(g){let Q=o(c,d,m);Q&&(this.handleTextChanges(c,Q,d),u=Q.comments||[])}}}}return u}calculateHighlightPosition(c,d){var F;let g=(F=d.originalLength)!=null?F:d.text.length+4,u=c.slice(d.position,d.position+g),m=u.startsWith("<"),w;if(m){let Q=/<[^>]+>/.exec(u),E=/<\/[^>]+>/.exec(u);w=d.position+g}else w=d.position+d.text.length+4;return{highlightEndPos:w,isHtmlTag:m,originalText:u,originalLength:g}}findMatchingHighlight(c,d,g){if(!g||g.length===0)return null;let u=g.find(m=>m.text===d.text&&(typeof m.position!="number"||typeof d.position!="number"||Math.abs(m.position-d.position)<10))||null;if(!u&&typeof d.position=="number"&&(u=g.find(m=>typeof m.position=="number"&&Math.abs(m.position-d.position)<30)||null),!u){let m=null,w=0;for(let F of g){if(!F.comments||F.comments.length===0)continue;let Q=this.textSimilarityService.calculateSimilarity(F.text,d.text);Q>w&&Q>.6&&(w=Q,m=F)}m&&(u=m)}return u}update(c){(c.docChanged||c.viewportChanged||c.transactions.length>0)&&(this.decorations=this.buildDecorations(c.view))}buildDecorations(c){var F,Q;let d=[],u=c.state.doc.toString(),m=this.plugin.app.workspace.getActiveViewOfType(on.MarkdownView);if(!m||!m.file)return et.Decoration.none;if(!this.highlightService.shouldProcessFile(m.file))return et.Decoration.none;let w=this.highlightService.extractHighlights(u,m.file);for(let E of w){if(E.position===void 0)continue;let H=this.createHiNoteFromHighlight(E);if(m.file){let W=this.getCommentsForHighlight(m.file,H,!0);H.comments=W}let{highlightEndPos:b,isHtmlTag:K,originalText:M,originalLength:D}=this.calculateHighlightPosition(u,E),N=this.isAtParagraphEnd(u,b);if(this.plugin.settings.showCommentWidget!==!1){let W=this.createCommentWidget(H,[H]);d.push(W.range(b))}if(K){let W=/<[^>]+>/.exec(M),sA=/<\/[^>]+>/.exec(M);if(W&&sA){let J=E.position+W[0].length,cA=E.position+D-sA[0].length,wA=m.file?this.getCommentsForHighlight(m.file,H,!1):[],eA=wA.length>0?(F=wA[0])==null?void 0:F.content:"",Z=et.Decoration.mark({class:"cm-highlight",attributes:{title:eA||"","data-highlight-type":"html",style:E.backgroundColor?`background-color: ${E.backgroundColor}`:""}});d.push(Z.range(J,cA))}}else{let sA=E.position+E.text.length+4,J=m.file?this.getCommentsForHighlight(m.file,H,!1):[],cA=J.length>0?(Q=J[0])==null?void 0:Q.content:""}}return et.Decoration.set(d.sort((E,H)=>E.from-H.from))}createCommentWidget(c,d){return et.Decoration.widget({widget:new bs(this.plugin,c,d,()=>this.openCommentPanel(c)),side:2,stopEvent:g=>!0})}openCommentPanel(c){let d=this.plugin.app.workspace,g=d.getLeavesOfType("comment-view");if(g.length)d.revealLeaf(g[0]);else{let u=d.getRightLeaf(!1);u&&u.setViewState({type:"comment-view",active:!0})}}isAtParagraphEnd(c,d){if(d>=c.length)return!0;let g=c.charAt(d),u=c.substr(d,2),m=g===`
`||g==="\r"||u===`\r
`,w=m;if(m){let F=d+(u===`\r
`?2:1);if(F>=c.length)w=!0;else{let Q=c.charAt(F),E=c.substr(F,2);w=Q===`
`||Q==="\r"||E===`\r
`}}return w}},{decorations:c=>c.decorations});this.highlightPlugin=l,this.plugin.registerEditorExtension([l])}disable(){if(this.highlightPlugin){let e=this.getActiveMarkdownView();e!=null&&e.editor&&e.editor.refresh()}document.querySelectorAll(".hi-note-widget").forEach(e=>e.remove())}updateTooltipContent(e,A){let t=e.querySelector(".hi-note-tooltip-list");t&&(t.empty(),A.slice(0,3).forEach(s=>{let o=t.createEl("div",{cls:"hi-note-tooltip-item"});o.createEl("div",{cls:"hi-note-tooltip-content",text:s.content}),o.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(s.createdAt).toLocaleString()})}))}};var bo=require("obsidian");var se=require("obsidian");var tt=require("obsidian");var Ls=class{constructor(e,A){this.containerEl=e,this.plugin=A,this.rules=A.settings.regexRules||[],this.rulesContainer=e.createDiv({cls:"regex-rules-container"}),this.display()}display(){this.rulesContainer.empty();let e=this.rulesContainer.createDiv({cls:"regex-rule-warning"});e.innerHTML=f("Use regex with caution. If there are capture groups (), the first capture group will be used as the highlight text; if there are no capture groups, the entire match will be used."),this.rules.length===0?this.rulesContainer.createDiv().setText(f('No custom regex rules. Click "+" to add a new rule.')):this.rules.forEach((s,o)=>{this.createRuleItem(s,o)});let A=this.rulesContainer.createDiv({cls:"regex-rule-add"});A.createSpan({cls:"regex-rule-add-text"}).setText(f("Add new rule")),A.addEventListener("click",()=>{let s={id:`rule-${Date.now()}`,name:"",pattern:"",color:"#ffeb3b",enabled:!0};this.rules.push(s),this.saveRules(),this.display()})}createRuleItem(e,A){let t=this.rulesContainer.createDiv({cls:"regex-rule-item"}),s=new tt.TextComponent(t);s.setPlaceholder(f("Rule name")),s.setValue(e.name),s.onChange(u=>{e.name=u,this.saveRules()});let o=new tt.TextComponent(t);o.setPlaceholder(f("Regular expression with capture groups")),o.setValue(e.pattern),o.onChange(u=>{e.pattern=u,this.saveRules()});let l=t.createDiv(),c=new tt.TextComponent(l);c.setPlaceholder("#ffeb3b"),c.setValue(e.color),c.inputEl.addClass("color-input"),c.onChange(u=>{let m=u.trim();m&&(m.startsWith("#")||m.startsWith("rgb")||m.startsWith("rgba"))&&(e.color=m,this.saveRules())});let d=t.createDiv({cls:"regex-rule-delete"});(0,tt.setIcon)(d,"trash-2"),d.setAttr("aria-label",f("Delete rule")),d.addEventListener("click",()=>{this.rules.splice(A,1),this.saveRules(),this.display()});let g=new tt.ToggleComponent(t);g.setValue(e.enabled),g.onChange(u=>{e.enabled=u,this.saveRules()}),g.toggleEl.addClass("regex-rule-toggle")}async saveRules(){this.plugin.settings.regexRules=this.rules,await this.plugin.saveSettings()}};var Ts=class{constructor(e,A){this.plugin=e,this.containerEl=A}async updateOrphanedDataCount(e){try{let A=e.querySelector(".orphaned-data-count, .no-orphaned-data");A&&A.remove();let t=await this.plugin.commentStore.checkOrphanedDataCount(),s=document.createElement("div");t.orphanedHighlights>0?(s.className="orphaned-data-count",s.textContent=`Found ${t.orphanedHighlights} orphaned highlights in ${t.affectedFiles} files.`):(s.className="no-orphaned-data",s.textContent="No orphaned data found."),e.appendChild(s)}catch(A){console.error("[HiNote] Error updating orphaned data count:",A)}}display(){let e=this.containerEl.createEl("div",{cls:"general-settings-container"});new se.Setting(e).setName(f("Export Path")).setDesc(f("Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.")).addText(d=>d.setPlaceholder("Example: folder 1/folder 2").setValue(this.plugin.settings.export.exportPath||"").onChange(async g=>{g=g.replace(/^\/+/,""),g=g.replace(/\/+$/,""),this.plugin.settings.export.exportPath=g,await this.plugin.saveSettings()})),new se.Setting(e).setName(f("Exclusions")).setDesc(f("Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md")).addTextArea(d=>{d.setPlaceholder("folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md").setValue(this.plugin.settings.excludePatterns||"").onChange(async g=>{let u=g.split(",").map(m=>m.trim()).filter(m=>m.length>0);this.plugin.settings.excludePatterns=g,await this.plugin.saveSettings()}),d.inputEl.rows=4,d.inputEl.cols=40}),new se.Setting(e).setName(f("Export template")).setDesc(f("Customize the format of exported highlights and comments using variables. Available variables: {{highlightText}}, {{highlightBlockRef}}, {{commentContent}}, {{commentDate}}. Leave empty to use default template.")).addTextArea(d=>{d.setPlaceholder(`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`).setValue(this.plugin.settings.export.exportTemplate||"").onChange(async u=>{this.plugin.settings.export.exportTemplate=u,await this.plugin.saveSettings()}),d.inputEl.rows=5,d.inputEl.cols=40}),new se.Setting(e).setName(f("Show Comment Widget")).setDesc(f("Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.")).addToggle(d=>{var g;return d.setValue((g=this.plugin.settings.showCommentWidget)!=null?g:!0).onChange(async u=>{this.plugin.settings.showCommentWidget=u,await this.plugin.saveSettings(),this.plugin.highlightDecorator&&this.plugin.highlightDecorator.refreshDecorations()})}),new se.Setting(e).setName(f("Custom text extraction")).setHeading(),new se.Setting(e).setName(f("Use custom rules")).setDesc(f("Enable to use custom regex rules to extract highlight text.")).addToggle(d=>d.setValue(this.plugin.settings.useCustomPattern).onChange(async g=>{this.plugin.settings.useCustomPattern=g,await this.plugin.saveSettings()}));let A=e.createDiv({cls:"regex-editor-container"});new Ls(A,this.plugin),new se.Setting(e).setName(f("Data management")).setHeading();let t=new se.Setting(e).setName(f("Clean orphaned data")).setDesc(f("Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.")),s=0,o=0,l=!1,c=t.addButton(d=>{d.setButtonText(f("Check")),d.onClick(async()=>{d.setButtonText(f("Checking...")),d.setDisabled(!0);try{let g=await this.plugin.commentStore.checkOrphanedDataCount();s=g.orphanedHighlights,o=g.affectedFiles,l=!0;let u=t.descEl,m=u.querySelector(".orphaned-data-count, .no-orphaned-data");m&&m.remove();let w=document.createElement("div");s>0?(w.className="orphaned-data-count",w.textContent=`Found ${s} orphaned highlights in ${o} files.`,d.setButtonText(f("Clean data")),d.setDisabled(!1),d.onClick(async()=>{d.setButtonText(f("Cleaning...")),d.setDisabled(!0);try{let F=await this.plugin.commentStore.cleanOrphanedData();F.removedHighlights>0?new se.Notice(`Cleaned ${F.removedHighlights} orphaned highlights from ${F.affectedFiles} files.`):new se.Notice("No orphaned data found."),d.setButtonText(f("Check")),l=!1,w&&w.parentElement&&w.parentElement.removeChild(w)}catch(F){console.error("[HiNote] Error cleaning orphaned data:",F),new se.Notice("Error cleaning orphaned data. Check console for details."),d.setButtonText(f("Check"))}finally{d.setDisabled(!1)}})):(w.className="no-orphaned-data",w.textContent="No orphaned data found.",d.setButtonText(f("Check")),d.setDisabled(!1)),u.appendChild(w)}catch(g){console.error("[HiNote] Error checking orphaned data:",g),new se.Notice("Error checking orphaned data. Check console for details."),d.setButtonText(f("Check")),d.setDisabled(!1)}})})}};var xo=require("obsidian");var NA=require("obsidian");var Ho=require("obsidian");var re=class{constructor(e,A){this.plugin=e,this.containerEl=A}createModelDropdown(e,A,t){new Ho.Setting(e).setName(f("Model")).setDesc(f("Select the AI model to use")).addDropdown(s=>{let o=Object.fromEntries(A.map(l=>[l.id,l.name]));return s.addOptions(o).setValue(this.plugin.settings.ai.model||t.id).onChange(async l=>{this.plugin.settings.ai.model=l,await this.plugin.saveSettings()})})}};var ui=[{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo"}],Ds=class extends re{constructor(A,t){super(A,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={apiKey:"",model:ui[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let A=this.plugin.settings.ai.openai,t;if(A.isCustomModel)t={id:A.model,name:A.model,isCustom:!0};else{let s=ui.find(o=>o.id===A.model);t=s||ui[0],s||(A.model=t.id)}return{selectedModel:t,apiKey:A.apiKey||""}}async saveModelState(){this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={});let A=this.plugin.settings.ai.openai,t=this.modelState.selectedModel;A.model=t.id,A.isCustomModel=!!t.isCustom,A.apiKey=this.modelState.apiKey||"",t.isCustom&&t.id&&(A.lastCustomModel=t.id),await this.plugin.saveSettings()}display(A){let t=A.createEl("div",{cls:"ai-service-settings"});new NA.Setting(t).setName(f("OpenAI service")).setHeading(),new NA.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(g=>g.setPlaceholder("sk-...").setValue(this.modelState.apiKey).onChange(async u=>{this.modelState.apiKey=u,await this.saveModelState()})).addButton(g=>g.setButtonText(f("Check")).onClick(async()=>{if(!this.modelState.apiKey){new NA.Notice(f("Please enter an API Key first"));return}g.setDisabled(!0),g.setButtonText(f("Checking..."));try{(await this.fetchAvailableModels(this.modelState.apiKey)).length>0?new NA.Notice(f("API Key is valid!")):new NA.Notice(f("No models available. Please check your API Key."))}catch(u){new NA.Notice(f("Failed to validate API Key. Please check your key and try again."))}finally{g.setDisabled(!1),g.setButtonText(f("Check"))}}));let s=new NA.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(g=>{ui.forEach(m=>{g.addOption(m.id,m.name)}),g.addOption("custom",f("Custom Model"));let u=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(u),this.modelSelectEl=g.selectEl,g.onChange(async m=>{if(m==="custom")await this.showCustomModelInput();else{let w=ui.find(F=>F.id===m);if(w){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.openai;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=w,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=s.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=s.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild));let c=new NA.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async u=>{let m=u.trim();if(m){if(!/^[a-zA-Z0-9-_.]+$/.test(m)){new NA.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:m,name:m,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let d=c.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new NA.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(g=>{var u;return g.setPlaceholder("https://api.openai.com/v1").setValue(((u=this.plugin.settings.ai.openai)==null?void 0:u.apiAddress)||"").onChange(async m=>{this.plugin.settings.ai.openai||(this.plugin.settings.ai.openai={}),this.plugin.settings.ai.openai.apiAddress=m,await this.plugin.saveSettings()})})}async validateModel(A,t,s){try{let o=await(0,NA.requestUrl)({url:`${s}/models/${t}`,method:"GET",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}});if(o.status!==200){let c=await o.json.catch(()=>null);return new NA.Notice(f("Custom model unavailable. Please check the model ID and your access permissions.")),!1}let l=await(0,NA.requestUrl)({url:`${s}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"},body:JSON.stringify({model:t,messages:[{role:"user",content:"Hello"}],max_tokens:1})});if(l.status!==200){let c=await l.json.catch(()=>null);return!1}return!0}catch(o){return!1}}async fetchAvailableModels(A){var t;try{let s=((t=this.plugin.settings.ai.openai)==null?void 0:t.apiAddress)||"https://api.openai.com/v1";if(this.modelState.selectedModel.isCustom){let l=this.modelState.selectedModel.id;if(!await this.validateModel(A,l,s))throw new Error(`Custom model not available: ${l}`);return[this.modelState.selectedModel]}let o=await(0,NA.requestUrl)({url:`${s}/models`,method:"GET",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}});return o.status===200?o.json.data.map(d=>({id:d.id,name:d.id})):[]}catch(s){throw s}}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let A=this.plugin.settings.ai.openai;if(!this.modelState.selectedModel.isCustom){let s=A.lastCustomModel||"";this.modelState.selectedModel={id:s,name:s,isCustom:!0},A.model=s,A.isCustomModel=!0,await this.plugin.saveSettings();let o=this.customModelContainer.querySelector("input");o&&(o.value=s)}}}async hideCustomModelInput(){this.customModelContainer&&this.customModelContainer.removeClass("visible")}};var pe=require("obsidian");var pi=[{id:"claude-3-opus-20240229",name:"Claude 3 Opus"},{id:"claude-3-sonnet-20240229",name:"Claude 3 Sonnet"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku"},{id:"claude-2",name:"Claude 2"},{id:"claude-instant-1",name:"Claude Instant"}],Ps=class extends re{constructor(A,t){super(A,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={apiKey:"",model:pi[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let A=this.plugin.settings.ai.anthropic,t;if(A.isCustomModel)t={id:A.model,name:A.model,isCustom:!0};else{let s=pi.find(o=>o.id===A.model);t=s||pi[0],s||(A.model=t.id)}return{selectedModel:t,apiKey:A.apiKey||""}}async saveModelState(){this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={});let A=this.plugin.settings.ai.anthropic,t=this.modelState.selectedModel;A.model=t.id,A.isCustomModel=!!t.isCustom,A.apiKey=this.modelState.apiKey||"",t.isCustom&&t.id&&(A.lastCustomModel=t.id),await this.plugin.saveSettings()}display(A){let t=A.createEl("div",{cls:"ai-service-settings"});new pe.Setting(t).setName(f("Anthropic service")).setHeading(),new pe.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(g=>g.setPlaceholder("sk-ant-...").setValue(this.modelState.apiKey).onChange(async u=>{this.modelState.apiKey=u,await this.saveModelState()})).addButton(g=>g.setButtonText(f("Check")).onClick(async()=>{var u;try{let m=this.modelState.apiKey;if(!m){new pe.Notice(f("Please enter an API Key first"));return}g.setDisabled(!0),g.setButtonText(f("Checking..."));let w=((u=this.plugin.settings.ai.anthropic)==null?void 0:u.apiAddress)||"https://api.anthropic.com",F=this.modelState.selectedModel.id;await new Ht(m,w,F).testConnection()?new pe.Notice(f("API Key is valid!")):new pe.Notice(f("Failed to validate API Key. Please check your key and try again."))}catch(m){console.error("Anthropic API validation error:",m),new pe.Notice(f("Failed to validate API Key. Please check your key and try again."))}finally{g.setDisabled(!1),g.setButtonText(f("Check"))}}));let s=new pe.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(g=>{pi.forEach(m=>{g.addOption(m.id,m.name)}),g.addOption("custom",f("Custom Model"));let u=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(u),this.modelSelectEl=g.selectEl,g.onChange(async m=>{if(m==="custom")await this.showCustomModelInput();else{let w=pi.find(F=>F.id===m);if(w){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.anthropic;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=w,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=s.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=s.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild));let c=new pe.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async u=>{let m=u.trim();if(m){if(!/^[a-zA-Z0-9-_.]+$/.test(m)){new pe.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:m,name:m,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let d=c.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new pe.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(g=>{var u;return g.setPlaceholder("https://api.anthropic.com").setValue(((u=this.plugin.settings.ai.anthropic)==null?void 0:u.apiAddress)||"").onChange(async m=>{this.plugin.settings.ai.anthropic||(this.plugin.settings.ai.anthropic={}),this.plugin.settings.ai.anthropic.apiAddress=m,await this.plugin.saveSettings()})})}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let A=this.plugin.settings.ai.anthropic;if(!this.modelState.selectedModel.isCustom){let s=A.lastCustomModel||"";this.modelState.selectedModel={id:s,name:s,isCustom:!0},A.model=s,A.isCustomModel=!0,await this.plugin.saveSettings();let o=this.customModelContainer.querySelector("input");o&&(o.value=s)}}}async hideCustomModelInput(){this.customModelContainer&&this.customModelContainer.removeClass("visible")}};var WA=require("obsidian");var Ks=class extends re{constructor(A,t){super(A,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={apiKey:"",model:Ut[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""});let A=this.plugin.settings.ai.deepseek,t;if(A.isCustomModel)t={id:A.model,name:A.model,isCustom:!0};else{let s=Ut.find(o=>o.id===A.model);t=s||Ut[0],s||(A.model=t.id)}return{selectedModel:t,apiKey:A.apiKey||""}}async saveModelState(){this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={});let A=this.plugin.settings.ai.deepseek,t=this.modelState.selectedModel;A.model=t.id,A.isCustomModel=!!t.isCustom,A.apiKey=this.modelState.apiKey||"",A.apiAddress=A.apiAddress||"",t.isCustom&&t.id&&(A.lastCustomModel=t.id),await this.plugin.saveSettings()}async validateApiKey(A){var t;try{let s="https://api.deepseek.com",o=(t=this.plugin.settings.ai.deepseek)==null?void 0:t.apiAddress,l=o&&o.trim()?o:s,c=this.modelState.selectedModel.id,d=`${l}/models/${c}`,g=await(0,WA.requestUrl)({url:d,headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}});if(!g.status||g.status<200||g.status>=300){if(this.modelState.selectedModel.isCustom)return new WA.Notice(f("\u81EA\u5B9A\u4E49\u6A21\u578B\u4E0D\u53EF\u7528\uFF0C\u8BF7\u68C0\u67E5\u6A21\u578B ID \u548C API \u5730\u5740")),!1;if(c!=="deepseek-chat"){let w=`${l}/models/deepseek-chat`,F=await(0,WA.requestUrl)({url:w,headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"}});if(F.status&&F.status>=200&&F.status<300)return new WA.Notice(f("\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\u4E0D\u53EF\u7528\uFF0C\u4F46 API Key \u662F\u6709\u6548\u7684")),!1}return new WA.Notice(f("Failed to validate API Key. Please check your key and try again.")),!1}let u=g.json,m=!!(u&&u.id);return m&&new WA.Notice(f("API Key and model available.")),m}catch(s){return new WA.Notice(f("Failed to validate API Key. Please check your key and try again.")),!1}}display(A){let t=A.createEl("div",{cls:"ai-service-settings"});new WA.Setting(t).setName(f("Deepseek service")).setHeading(),new WA.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(l=>l.setPlaceholder("dsk-...").setValue(this.modelState.apiKey).onChange(async c=>{this.modelState.apiKey=c,await this.saveModelState()})).addButton(l=>l.setButtonText(f("Check")).onClick(async()=>{if(!this.modelState.apiKey){new WA.Notice(f("Please enter an API Key first"));return}l.setDisabled(!0),l.setButtonText(f("Checking..."));try{await this.validateApiKey(this.modelState.apiKey)}finally{l.setDisabled(!1),l.setButtonText(f("Check"))}}));let s=new WA.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(l=>{Ut.forEach(d=>{l.addOption(d.id,d.name)}),l.addOption("custom",f("Custom Model"));let c=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return l.setValue(c),this.modelSelectEl=l.selectEl,l.onChange(async d=>{if(d==="custom")await this.showCustomModelInput();else{let g=Ut.find(u=>u.id===d);if(g){if(this.modelState.selectedModel.isCustom){let u=this.plugin.settings.ai.deepseek;u.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=g,await this.saveModelState(),await this.hideCustomModelInput()}}}),l});this.customModelContainer=s.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=s.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild)),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new WA.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(l=>{var c;return l.setPlaceholder("https://api.deepseek.com/v1").setValue(((c=this.plugin.settings.ai.deepseek)==null?void 0:c.apiAddress)||"").onChange(async d=>{this.plugin.settings.ai.deepseek||(this.plugin.settings.ai.deepseek={}),this.plugin.settings.ai.deepseek.apiAddress=d,await this.plugin.saveSettings()})})}async showCustomModelInput(){if(!this.customModelContainer)return;this.customModelContainer.addClass("visible"),this.customModelContainer.empty();let A=document.createElement("input");A.type="text",A.className="custom-model-input",A.placeholder="model-id",A.value=this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"",A.addEventListener("input",async()=>{let t=A.value.trim();if(t){if(!/^[a-zA-Z0-9-_.]+$/.test(t)){new WA.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),A.value=this.modelState.selectedModel.id;return}this.modelState.selectedModel={id:t,name:t,isCustom:!0},await this.saveModelState()}}),this.customModelContainer.appendChild(A)}hideCustomModelInput(){this.customModelContainer&&(this.customModelContainer.removeClass("visible"),this.customModelContainer.empty())}};var LA=require("obsidian");var Rs=class extends re{constructor(A,t){super(A,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={apiKey:"",model:qe[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""});let A=this.plugin.settings.ai.gemini,t;if(A.isCustomModel)t={id:A.model,name:A.model,isCustom:!0};else{let s=qe.find(o=>o.id===A.model);t=s||qe[0],s||(A.model=t.id)}return{selectedModel:t,apiKey:A.apiKey||""}}async saveModelState(){this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={});let A=this.plugin.settings.ai.gemini,t=this.modelState.selectedModel;A.model=t.id,A.isCustomModel=!!t.isCustom,A.apiKey=this.modelState.apiKey||"",A.baseUrl=A.baseUrl||"",t.isCustom&&t.id&&(A.lastCustomModel=t.id),await this.plugin.saveSettings()}async validateApiKey(A){var t;try{let s="https://generativelanguage.googleapis.com",o=(t=this.plugin.settings.ai.gemini)==null?void 0:t.baseUrl,l=o&&o.trim()?o:s,c=this.modelState.selectedModel.id,d=`${l}/v1/models/${c}?key=${A}`,g=await(0,LA.requestUrl)({url:d});if(!g.status||g.status<200||g.status>=300){let w=g.json||null;if(c.includes("-exp-")){let Q=`${l}/v1/models/gemini-pro?key=${A}`,E=await(0,LA.requestUrl)({url:Q});throw E.status&&E.status>=200&&E.status<300?(new LA.Notice(f("API Key \u6709\u6548\uFF0C\u4F46\u65E0\u6CD5\u8BBF\u95EE\u5B9E\u9A8C\u6027\u6A21\u578B\u3002\u8BF7\u786E\u4FDD\u4F60\u6709\u6743\u9650\u8BBF\u95EE\u6B64\u6A21\u578B\uFF0C\u6216\u7B49\u5F85\u6A21\u578B\u6B63\u5F0F\u53D1\u5E03\u3002")),new Error(`Experimental model not accessible: ${c}`)):(new LA.Notice(f("Invalid API Key or server error. Please verify your API Key.")),new Error("Invalid API Key"))}if(this.modelState.selectedModel.isCustom)throw new LA.Notice(f("Custom model unavailable. Please check the model ID and your access permissions.")),new Error(`Custom model not available: ${c}`);if(c!=="gemini-pro"){let Q=`${l}/v1/models/gemini-pro?key=${A}`,E=await(0,LA.requestUrl)({url:Q});if(E.status&&E.status>=200&&E.status<300)throw new LA.Notice(f("API Key \u6709\u6548\uFF0C\u4F46\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u53EF\u80FD\u662F\u6A21\u578B\u672A\u53D1\u5E03\u6216\u4F60\u6CA1\u6709\u8BBF\u95EE\u6743\u9650\u3002")),new Error(`Selected model not available: ${c}`)}throw new LA.Notice(f("Invalid API Key or server error. Please verify your API Key.")),new Error(`HTTP error! status: ${g.status}`)}let u=await g.json(),m=!!(u&&u.name);return m&&new LA.Notice(f("API Key and the current model are both available\uFF01")),m}catch(s){return!1}}display(A){let t=A.createEl("div",{cls:"ai-service-settings"});new LA.Setting(t).setName(f("Gemini service")).setHeading(),new LA.Setting(t).setName(f("API Key")).setDesc(f("Please enter your API Key.")).addText(g=>g.setPlaceholder("Enter your API key").setValue(this.modelState.apiKey).onChange(async u=>{this.modelState.apiKey=u,await this.saveModelState()})).addButton(g=>g.setButtonText(f("Check")).onClick(async()=>{if(!this.modelState.apiKey){new LA.Notice(f("Please enter an API Key first"));return}g.setDisabled(!0),g.setButtonText(f("Checking..."));try{await this.validateApiKey(this.modelState.apiKey)}finally{g.setDisabled(!1),g.setButtonText(f("Check"))}}));let s=new LA.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(g=>{qe.forEach(m=>{g.addOption(m.id,m.name)}),g.addOption("custom",f("Custom Model"));let u=this.modelState.selectedModel.isCustom?"custom":this.modelState.selectedModel.id;return g.setValue(u),this.modelSelectEl=g.selectEl,g.onChange(async m=>{if(m==="custom")await this.showCustomModelInput();else{let w=qe.find(F=>F.id===m);if(w){if(this.modelState.selectedModel.isCustom){let F=this.plugin.settings.ai.gemini;F.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()}this.modelState.selectedModel=w,await this.saveModelState(),await this.hideCustomModelInput()}}}),g});this.customModelContainer=s.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let o=s.settingEl.querySelector(".setting-item-control");o&&(o.addClass("openai-dropdown-container"),o.insertBefore(this.customModelContainer,o.firstChild));let c=new LA.Setting(this.customModelContainer).addText(g=>g.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async u=>{let m=u.trim();if(m){if(!/^[a-zA-Z0-9-_.]+$/.test(m)){new LA.Notice(f("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),g.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:m,name:m,isCustom:!0},await this.saveModelState()}})).settingEl;c.addClass("openai-setting-no-border");let d=c.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new LA.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(g=>{var w;let u="https://generativelanguage.googleapis.com",m=(w=this.plugin.settings.ai.gemini)==null?void 0:w.baseUrl;return g.setPlaceholder(u).setValue(m||"").onChange(async F=>{this.plugin.settings.ai.gemini||(this.plugin.settings.ai.gemini={}),this.plugin.settings.ai.gemini.baseUrl=F||"",await this.plugin.saveSettings()}),g})}async showCustomModelInput(){if(this.customModelContainer&&this.modelSelectEl){this.customModelContainer.addClass("visible"),this.modelSelectEl.value="custom";let A=this.plugin.settings.ai.gemini;if(!this.modelState.selectedModel.isCustom){let s=A.lastCustomModel||"";this.modelState.selectedModel={id:s,name:s,isCustom:!0},A.model=s,A.isCustomModel=!0,await this.plugin.saveSettings();let o=this.customModelContainer.querySelector("input");o&&(o.value=s)}}}async hideCustomModelInput(){if(this.customModelContainer){this.customModelContainer.removeClass("visible");let A=this.plugin.settings.ai.gemini,t=this.modelState.selectedModel;if(t.isCustom&&t.id){A.lastCustomModel=t.id;let s=this.customModelContainer.querySelector("input");s&&(s.value=t.id)}A.isCustomModel=!1,await this.plugin.saveSettings()}}};var it=require("obsidian");var ks=class extends re{async display(e){var l,c,d;let A=e.createEl("div",{cls:"ai-service-settings"});new it.Setting(A).setName(f("Ollama service")).setHeading();let t="http://localhost:11434";(l=this.plugin.settings.ai.ollama)!=null&&l.host||(this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=t,await this.plugin.saveSettings());let s=new it.Setting(A).setName(f("Server URL")).setDesc(f("Ollama server URL (default: http://localhost:11434)")).addText(g=>{var u;return g.setPlaceholder(t).setValue(((u=this.plugin.settings.ai.ollama)==null?void 0:u.host)||t).onChange(async m=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=m||t,await this.plugin.saveSettings()}),g}),o;s.addButton(g=>(o=g.buttonEl,g.setButtonText(f("Check")).onClick(async()=>{var F;let u=((F=this.plugin.settings.ai.ollama)==null?void 0:F.host)||t;o.disabled=!0;let m=o.textContent;o.textContent=f("Checking...");let w=new It(u);try{let Q=await w.listModels();o.disabled=!1,o.textContent=m,Q&&Q.length>0?(this.plugin.settings.ai.ollama.availableModels=Q,await this.plugin.saveSettings(),this.displayOllamaModelDropdown(A,Q),new it.Notice(f("Successfully connected to Ollama service"))):new it.Notice(f("No models found. Please download models using ollama"))}catch(Q){o.disabled=!1,o.textContent=m,new it.Notice(f("Failed to connect to Ollama service. Please check the server address."))}}))),(d=(c=this.plugin.settings.ai.ollama)==null?void 0:c.availableModels)!=null&&d.length&&this.displayOllamaModelDropdown(A,this.plugin.settings.ai.ollama.availableModels)}displayOllamaModelDropdown(e,A){let t=e.querySelector(".model-setting");t&&t.remove(),new it.Setting(e).setName(f("Model")).setDesc(f("Select a Ollama model.")).addDropdown(o=>{var g;let l=Object.fromEntries(A.map(u=>[u,u])),c=(g=this.plugin.settings.ai.ollama)==null?void 0:g.model,d=A.includes(c)?c:A[0];return o.addOptions(l).setValue(d).onChange(async u=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.model=u,await this.plugin.saveSettings()})}).settingEl.addClass("model-setting")}};var fe=require("obsidian");var Os=class extends re{constructor(A,t){super(A,t);this.modelSelectEl=null;this.customModelContainer=null;this.modelState=this.initializeModelState()}initializeModelState(){this.plugin.settings.ai.siliconflow||(this.plugin.settings.ai.siliconflow={apiKey:"",model:Ue[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""});let A=this.plugin.settings.ai.siliconflow,t;if(A.isCustomModel)t={id:A.model,name:A.model,isCustom:!0};else{let s=Ue.find(o=>o.id===A.model);t=s||Ue[0],s||(A.model=t.id)}return{selectedModel:t,apiKey:A.apiKey||""}}async saveModelState(){if(!this.plugin.settings.ai.siliconflow)this.plugin.settings.ai.siliconflow={apiKey:this.modelState.apiKey||"",model:this.modelState.selectedModel.id,baseUrl:"",isCustomModel:!!this.modelState.selectedModel.isCustom,lastCustomModel:this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:void 0};else{let A=this.plugin.settings.ai.siliconflow,t=this.modelState.selectedModel;A.model=t.id,A.isCustomModel=!!t.isCustom,A.apiKey=this.modelState.apiKey||"",t.isCustom&&t.id&&(A.lastCustomModel=t.id)}await this.plugin.saveSettings()}async validateApiKey(A){var t;try{let s="https://api.siliconflow.cn/v1",o=(t=this.plugin.settings.ai.siliconflow)==null?void 0:t.baseUrl,l=o&&o.trim()?o:s,c=this.modelState.selectedModel.id,d=`${l}/chat/completions`,g=await(0,fe.requestUrl)({url:d,method:"POST",headers:{Authorization:`Bearer ${A}`,"Content-Type":"application/json"},body:JSON.stringify({model:c,messages:[{role:"user",content:"Hello"}],max_tokens:1})});if(!g.status||g.status<200||g.status>=300){let u=g.json||null;return{isValid:!1,message:f("API Key \u65E0\u6548\u6216\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u4F60\u7684 API Key \u548C\u6A21\u578B ID \u662F\u5426\u6B63\u786E\u3002")}}return{isValid:!0,message:f("API Key and model available.")}}catch(s){return{isValid:!1,message:f("API Key \u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\u3002")}}}async showCustomModelInput(){this.customModelContainer&&this.modelSelectEl&&this.customModelContainer.addClass("visible")}async hideCustomModelInput(){this.customModelContainer&&this.modelSelectEl&&this.customModelContainer.removeClass("visible")}display(A){let t=A.createEl("div",{cls:"ai-service-settings"});new fe.Setting(t).setName(f("SiliconFlow service")).setHeading();let s=new fe.Setting(t).setName(f("API key")).setDesc(f("Please enter your API Key.")).addText(u=>u.setPlaceholder("sk-...").setValue(this.modelState.apiKey).onChange(async m=>{this.modelState.apiKey=m,await this.saveModelState()})).addButton(u=>u.setButtonText(f("Check")).onClick(async()=>{let m=this.modelState.apiKey;if(!m){new fe.Notice(f("Please input API Key"));return}u.setButtonText(f("Checking...")),u.setDisabled(!0);let w=await this.validateApiKey(m);u.setButtonText(f("Check")),u.setDisabled(!1),w.message&&new fe.Notice(w.message)})),o=new fe.Setting(t).setName(f("Model")).setDesc(f("Select a model or enter a custom one.")).addDropdown(u=>{Ue.forEach(w=>{u.addOption(w.id,w.name)}),u.addOption("custom","Custom Model");let m=this.modelState.selectedModel;return u.setValue(m.isCustom?"custom":m.id),this.modelSelectEl=u.selectEl,u.onChange(async w=>{var F;if(w==="custom"){let Q=(F=this.plugin.settings.ai.siliconflow)==null?void 0:F.lastCustomModel;this.modelState.selectedModel={id:Q||"",name:Q||"",isCustom:!0},await this.saveModelState(),await this.showCustomModelInput()}else{let Q=Ue.find(E=>E.id===w);Q&&(this.modelState.selectedModel.isCustom&&this.plugin.settings.ai.siliconflow&&(this.plugin.settings.ai.siliconflow.lastCustomModel=this.modelState.selectedModel.id,await this.plugin.saveSettings()),this.modelState.selectedModel=Q,await this.saveModelState(),await this.hideCustomModelInput())}}),u});this.customModelContainer=o.settingEl.createDiv("custom-model-container"),this.customModelContainer.addClass("custom-model-container");let l=o.settingEl.querySelector(".setting-item-control");l&&(l.addClass("openai-dropdown-container"),l.insertBefore(this.customModelContainer,l.firstChild));let d=new fe.Setting(this.customModelContainer).addText(u=>u.setPlaceholder("model-id").setValue(this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:"").onChange(async m=>{let w=m.trim();if(w){if(!/^[a-zA-Z0-9-_./]+$/.test(w)){new fe.Notice("Model ID can only contain letters, numbers, underscores, dots and hyphens."),u.setValue(this.modelState.selectedModel.id);return}this.modelState.selectedModel={id:w,name:w,isCustom:!0},await this.saveModelState()}})).settingEl;d.addClass("openai-setting-no-border");let g=d.querySelector(".setting-item-control");g&&g.addClass("openai-setting-no-margin"),this.modelState.selectedModel.isCustom&&this.showCustomModelInput(),new fe.Setting(t).setName(f("Provider URL")).setDesc(f("Leave it blank, unless you are using a proxy.")).addText(u=>{var F;let m="https://api.siliconflow.cn/v1",w=(F=this.plugin.settings.ai.siliconflow)==null?void 0:F.baseUrl;return u.setPlaceholder(m).setValue(w||"").onChange(async Q=>{this.plugin.settings.ai.siliconflow?this.plugin.settings.ai.siliconflow.baseUrl=Q||"":this.plugin.settings.ai.siliconflow={apiKey:this.modelState.apiKey||"",model:this.modelState.selectedModel.id,baseUrl:Q||"",isCustomModel:!!this.modelState.selectedModel.isCustom,lastCustomModel:this.modelState.selectedModel.isCustom?this.modelState.selectedModel.id:void 0},await this.plugin.saveSettings()}),u})}};var Mt=require("obsidian"),Gs=require("obsidian");var Ns=class{constructor(e,A){this.plugin=e,this.containerEl=A}display(){let e=this.containerEl.createEl("div",{cls:"prompt-settings-container"}),A=e.createEl("div",{cls:"prompt-settings-header setting-item-heading"});A.createEl("h4",{text:f("Prompt settings"),cls:"prompt-settings-title"});let t=A.createEl("button",{cls:"prompt-add-btn",attr:{"aria-label":f("Add prompt")}});(0,Gs.setIcon)(t,"plus"),t.onclick=()=>{if(e.querySelector(".new-prompt-section"))return;let s=e.querySelector(".prompt-list");s&&this.createNewPromptForm(e,s)},this.displayPromptList(e)}createNewPromptForm(e,A){var g;let t=e.createEl("div",{cls:"new-prompt-section"});(g=A.parentElement)==null||g.insertBefore(t,A);let s=t.createEl("input",{cls:"prompt-name-input",attr:{placeholder:f("Input Prompt Name"),type:"text"}}),o=new Mt.TextAreaComponent(t);o.setPlaceholder(f(`Input Prompt Content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`)).setValue(""),o.inputEl.addClass("prompt-textarea");let l=t.createEl("div",{cls:"prompt-buttons"}),c=l.createEl("button",{cls:"prompt-save-btn",text:f("Save")});c.onclick=async()=>{var w;let u=s.value,m=o.getValue();if(u&&m){this.plugin.settings.ai.prompts||(this.plugin.settings.ai.prompts={}),this.plugin.settings.ai.prompts[u]=m,await this.plugin.saveSettings(),t.remove(),this.displayPromptList(e),new Mt.Notice(f("Prompt added"));let F=(w=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:w.view;F&&F.updateAIDropdowns()}};let d=l.createEl("button",{cls:"prompt-cancel-btn",text:f("Cancel")});d.onclick=()=>{t.remove()}}displayPromptList(e){let A=e.querySelector(".prompt-list");A&&A.remove();let t=e.createEl("div",{cls:"prompt-list"}),s=this.plugin.settings.ai.prompts||{};for(let[o,l]of Object.entries(s)){let c=t.createEl("div",{cls:"prompt-item"}),d=c.createEl("div",{cls:"prompt-display-mode"}),g=d.createEl("div",{cls:"prompt-info"});g.createEl("div",{cls:"prompt-name",text:o});let u=l.replace(/\n/g," ");g.createEl("div",{cls:"prompt-content-preview",text:u});let w=d.createEl("div",{cls:"prompt-buttons"}).createEl("button",{cls:"prompt-edit-btn",attr:{"aria-label":f("Edit")}});(0,Gs.setIcon)(w,"square-pen");let F=c.createEl("div",{cls:"prompt-edit-mode hi-note-hidden"}),Q=F.createEl("input",{cls:"prompt-name-input",attr:{value:o,type:"text"}}),E=new Mt.TextAreaComponent(F);E.setValue(l),E.inputEl.classList.add("prompt-content-input"),E.inputEl.addClass("prompt-textarea");let H=F.createEl("div",{cls:"prompt-edit-buttons"}),b=H.createEl("button",{cls:"prompt-save-btn",text:f("Save")}),K=H.createEl("button",{cls:"prompt-cancel-btn",text:f("Cancel")}),M=H.createEl("button",{cls:"prompt-delete-btn",attr:{"aria-label":f("Delete")}});(0,Gs.setIcon)(M,"trash-2"),w.onclick=()=>{d.addClass("hi-note-hidden"),F.removeClass("hi-note-hidden")},M.onclick=async()=>{var N;delete this.plugin.settings.ai.prompts[o],await this.plugin.saveSettings(),c.remove();let D=(N=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:N.view;D&&D.updateAIDropdowns()},b.onclick=async()=>{var W;let D=Q.value,N=E.getValue();if(D&&N){D!==o&&delete this.plugin.settings.ai.prompts[o],this.plugin.settings.ai.prompts[D]=N,await this.plugin.saveSettings(),this.displayPromptList(e),new Mt.Notice(f("Prompt updated"));let sA=(W=this.plugin.app.workspace.getLeavesOfType("comment-view")[0])==null?void 0:W.view;sA&&sA.updateAIDropdowns()}},K.onclick=()=>{d.removeClass("hi-note-hidden"),F.addClass("hi-note-hidden")}}}};var Vs=class{constructor(e,A){this.plugin=e,this.containerEl=A}display(){switch(new xo.Setting(this.containerEl).setName("AI service").setDesc(f("Select the AI service provider")).addDropdown(e=>{let A={openai:"OpenAI",gemini:"Gemini",anthropic:"Anthropic",deepseek:"Deepseek",siliconflow:"SiliconFlow",ollama:"Ollama (Local)"};return e.addOptions(A).setValue(this.plugin.settings.ai.provider).onChange(async t=>{this.plugin.settings.ai.provider=t,await this.plugin.saveSettings(),this.containerEl.empty(),this.display()})}),this.plugin.settings.ai.provider){case"openai":new Ds(this.plugin,this.containerEl).display(this.containerEl);break;case"gemini":new Rs(this.plugin,this.containerEl).display(this.containerEl);break;case"anthropic":new Ps(this.plugin,this.containerEl).display(this.containerEl);break;case"ollama":new ks(this.plugin,this.containerEl).display(this.containerEl);break;case"deepseek":new Ks(this.plugin,this.containerEl).display(this.containerEl);break;case"siliconflow":new Os(this.plugin,this.containerEl).display(this.containerEl);break}new Ns(this.plugin,this.containerEl).display()}};var VA=require("obsidian");var fi=class{constructor(e,A){this.plugin=e,this.containerEl=A,this.fsrsService=e.fsrsManager.fsrsService}display(){let e=this.containerEl.createEl("div",{cls:"flashcard-settings-container"});new VA.Setting(e).setName(f("Flashcard learning")).setHeading(),new VA.Setting(e).setName(f("New cards per day")).setDesc(f("Maximum number of new cards to learn each day")).addSlider(o=>{var d;let l=this.fsrsService.getParameters();o.setLimits(1,200,1).setValue(l.newCardsPerDay).setDynamicTooltip().onChange(async g=>{let u=this.fsrsService.getParameters();u.newCardsPerDay=g,this.fsrsService.setParameters(u),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.newCardsPerDay)});(d=o.sliderEl.parentElement)==null||d.appendChild(c),o.sliderEl.addEventListener("input",()=>{c.textContent=String(o.getValue())})}),new VA.Setting(e).setName(f("Reviews per day")).setDesc(f("Maximum number of cards to review each day")).addSlider(o=>{var d;let l=this.fsrsService.getParameters();o.setLimits(10,500,10).setValue(l.reviewsPerDay).setDynamicTooltip().onChange(async g=>{let u=this.fsrsService.getParameters();u.reviewsPerDay=g,this.fsrsService.setParameters(u),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.reviewsPerDay)});(d=o.sliderEl.parentElement)==null||d.appendChild(c),o.sliderEl.addEventListener("input",()=>{c.textContent=String(o.getValue())})}),new VA.Setting(e).setName(f("Target retention")).setDesc(f("Target memory retention rate (0.8 = 80%)")).addSlider(o=>{var d;let l=this.fsrsService.getParameters();o.setLimits(.7,.95,.01).setValue(l.request_retention).setDynamicTooltip().onChange(async g=>{let u=this.fsrsService.getParameters();u.request_retention=g,this.fsrsService.setParameters(u),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:`${Math.round(l.request_retention*100)}%`});(d=o.sliderEl.parentElement)==null||d.appendChild(c),o.sliderEl.addEventListener("input",()=>{c.textContent=`${Math.round(o.getValue()*100)}%`})}),new VA.Setting(e).setName(f("Maximum interval")).setDesc(f("Maximum interval in days between reviews")).addText(o=>{let l=this.fsrsService.getParameters();o.setValue(l.maximum_interval.toString()).setPlaceholder("365").onChange(async g=>{let u=parseInt(g);if(!isNaN(u)&&u>0){let m=this.fsrsService.getParameters();m.maximum_interval=u,this.fsrsService.setParameters(m),await this.plugin.saveSettings()}});let c=o.inputEl;c.type="number",c.min="1",c.style.width="80px";let d=createEl("span",{text:` ${f("days")}`,cls:"setting-item-suffix"});c.after(d)}),new VA.Setting(e).setName(f("Reset daily stats")).setDesc(f("Reset today's learning statistics")).addButton(o=>o.setButtonText(f("Reset")).onClick(async()=>{let l=new Date;l.setHours(0,0,0,0);let c=this.plugin.fsrsManager.storage.dailyStats,d=c.findIndex(g=>g.date===l.getTime());d>=0?(c.splice(d,1),await this.plugin.fsrsManager.saveStorage(),new VA.Notice(f("Daily statistics have been reset"))):new VA.Notice(f("No statistics to reset for today"))})),new VA.Setting(e).setName(f("Advanced")).setHeading(),e.createEl("p",{text:f("These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm."),cls:"setting-item-description"}),new VA.Setting(e).setName(f("Reset algorithm parameters")).setDesc(f("Reset the FSRS algorithm parameters to default values")).addButton(o=>o.setButtonText(f("Reset to default")).onClick(async()=>{this.fsrsService.resetParameters(),await this.plugin.saveSettings();let l=this.fsrsService.getParameters(),c=this.containerEl.querySelector(".setting-item:nth-child(4) .slider"),d=this.containerEl.querySelector(".setting-item:nth-child(4) .slider-value");c&&d&&(c.value=String(l.request_retention),d.textContent=`${Math.round(l.request_retention*100)}%`);let g=this.containerEl.querySelector('.setting-item:nth-child(5) input[type="number"]');g&&(g.value=String(l.maximum_interval));let u=this.containerEl.querySelector(".setting-item:nth-child(2) .slider"),m=this.containerEl.querySelector(".setting-item:nth-child(2) .slider-value");u&&m&&(u.value=String(l.newCardsPerDay),m.textContent=String(l.newCardsPerDay));let w=this.containerEl.querySelector(".setting-item:nth-child(3) .slider"),F=this.containerEl.querySelector(".setting-item:nth-child(3) .slider-value");w&&F&&(w.value=String(l.reviewsPerDay),F.textContent=String(l.reviewsPerDay));let Q=this.containerEl.querySelector(".fsrs-weights-textarea");Q&&(Q.value=JSON.stringify(l.w)),new VA.Notice(f("FSRS parameters have been reset to default values"))}));let A=e.createEl("div",{cls:"fsrs-params-container"});A.createEl("p",{text:f("FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation."),cls:"setting-item-description"});let t=this.fsrsService.getParameters(),s=JSON.stringify(t.w);new VA.Setting(A).setName(f("FSRS parameters")).setDesc(f("Edit the 17 FSRS algorithm weights. Format: JSON array of numbers.")).addTextArea(o=>{o.setValue(s).setPlaceholder("[0.4872, 1.4003, ...]").onChange(async l=>{try{let c=JSON.parse(l);if(Array.isArray(c)&&c.length===17&&c.every(d=>typeof d=="number")){let d=this.fsrsService.getParameters();d.w=c,this.fsrsService.setParameters(d),await this.plugin.saveSettings(),new VA.Notice(f("FSRS weights updated successfully"))}else new VA.Notice(f("Invalid format. Must be an array of 17 numbers."),5e3)}catch(c){new VA.Notice(f("Invalid JSON format. Please check your input."),5e3)}}),o.inputEl.rows=2,o.inputEl.cols=32,o.inputEl.addClass("fsrs-weights-textarea")})}};var _s=class extends bo.PluginSettingTab{constructor(e,A){super(e,A),this.plugin=A,this.DEFAULT_SETTINGS=A.DEFAULT_SETTINGS,this.licenseManager=new ze(this.plugin)}async display(){let{containerEl:e}=this;e.empty();let A=e.createEl("div",{cls:"setting-tabs"}),t=e.createEl("div",{cls:"setting-tab-content"}),s=A.createEl("div",{text:f("General"),cls:"setting-tab-btn active",attr:{role:"button",tabindex:"0"}}),o=A.createEl("div",{text:f("AI service"),cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),l=null,c=t.createEl("div",{cls:"setting-tab-pane active"}),d=t.createEl("div",{cls:"setting-tab-pane"}),g=null,u=(m,w)=>{A.findAll(".setting-tab-btn").forEach(F=>F.removeClass("active")),t.findAll(".setting-tab-pane").forEach(F=>F.removeClass("active")),m.addClass("active"),w.addClass("active")};s.onclick=()=>u(s,c),o.onclick=()=>u(o,d),new Ts(this.plugin,c).display(),new Vs(this.plugin,d).display(),l=A.createEl("div",{text:"HiCard",cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),g=t.createEl("div",{cls:"setting-tab-pane"}),l.onclick=async()=>{if(u(l,g),g.empty(),await this.licenseManager.isActivated())new fi(this.plugin,g).display();else{let w=g.createEl("div",{cls:"flashcard-activation-container"});w.createEl("div",{cls:"flashcard-activation-header",text:f("Activate HiCard")}),w.createEl("div",{cls:"flashcard-activation-description",text:f("Enter your license key to activate HiCard feature.")});let F=w.createEl("div",{cls:"flashcard-activation-input-container"}),Q=F.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:f("Enter license key")}),E=F.createEl("button",{cls:"flashcard-activation-button",text:f("Activate")}),H=w.createEl("div",{cls:"activation-msg"});E.onclick=async()=>{E.setAttr("disabled","true"),H.textContent=f("Verifying..."),await this.licenseManager.activateLicense(Q.value)?(H.textContent=f("Activation successful!"),g.empty(),new fi(this.plugin,g).display()):(H.textContent=f("Activation failed. Please check your license key."),E.removeAttribute("disabled"))}}}}};var Ko=go(nn());var iA=(y=>(y[y.New=0]="New",y[y.Learning=1]="Learning",y[y.Review=2]="Review",y[y.Relearning=3]="Relearning",y))(iA||{}),T=(y=>(y[y.Manual=0]="Manual",y[y.Again=1]="Again",y[y.Hard=2]="Hard",y[y.Good=3]="Good",y[y.Easy=4]="Easy",y))(T||{}),tA=class y{static card(e){return{...e,state:y.state(e.state),due:y.time(e.due),last_review:e.last_review?y.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){let A=e.charAt(0).toUpperCase(),t=e.slice(1).toLowerCase(),s=T[`${A}${t}`];if(s===void 0)throw new Error(`Invalid rating:[${e}]`);return s}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){let A=e.charAt(0).toUpperCase(),t=e.slice(1).toLowerCase(),s=iA[`${A}${t}`];if(s===void 0)throw new Error(`Invalid state:[${e}]`);return s}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){let A=Date.parse(e);if(isNaN(A))throw new Error(`Invalid date:[${e}]`);return new Date(A)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:y.time(e.due),rating:y.rating(e.rating),state:y.state(e.state),review:y.time(e.review)}}};Date.prototype.scheduler=function(y,e){return Ce(this,y,e)},Date.prototype.diff=function(y,e){return Lt(this,y,e)},Date.prototype.format=function(){return jg(this)},Date.prototype.dueFormat=function(y,e,A){return Au(this,y,e,A)};function Ce(y,e,A){return new Date(A?tA.time(y).getTime()+e*24*60*60*1e3:tA.time(y).getTime()+e*60*1e3)}function Lt(y,e,A){if(!y||!e)throw new Error("Invalid date");let t=tA.time(y).getTime()-tA.time(e).getTime(),s=0;switch(A){case"days":s=Math.floor(t/(24*60*60*1e3));break;case"minutes":s=Math.floor(t/(60*1e3));break}return s}function jg(y){let e=tA.time(y),A=e.getFullYear(),t=e.getMonth()+1,s=e.getDate(),o=e.getHours(),l=e.getMinutes(),c=e.getSeconds();return`${A}-${mi(t)}-${mi(s)} ${mi(o)}:${mi(l)}:${mi(c)}`}function mi(y){return y<10?`0${y}`:`${y}`}var ln=[60,60,24,31,12],cn=["second","min","hour","day","month","year"];function Au(y,e,A,t=cn){y=tA.time(y),e=tA.time(e),t.length!==cn.length&&(t=cn);let s=y.getTime()-e.getTime(),o;for(s/=1e3,o=0;o<ln.length&&!(s<ln[o]);o++)s/=ln[o];return`${Math.floor(s)}${A?t[o]:""}`}var eu=Object.freeze([T.Again,T.Hard,T.Good,T.Easy]),tu=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function iu(y,e,A){let t=1;for(let l of tu)t+=l.factor*Math.max(Math.min(y,l.end)-l.start,0);y=Math.min(y,A);let s=Math.max(2,Math.round(y-t)),o=Math.min(Math.round(y+t),A);return y>e&&(s=Math.max(s,e+1)),s=Math.min(s,o),{min_ivl:s,max_ivl:o}}function qA(y,e,A){return Math.min(Math.max(y,e),A)}function su(y,e){let A=Date.UTC(y.getUTCFullYear(),y.getUTCMonth(),y.getUTCDate()),t=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((t-A)/864e5)}var ru="5.2.0",nu=.9,au=36500,ou=!1,lu=!0,cu=Object.freeze(["1m","10m"]),hu=Object.freeze(["10m"]),qB=`v${ru} using FSRS-6.0`,ve=.001;var Xs=100,Mo=.5,du=.1542,Lo=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,du]),gu=2,uu=y=>[[ve,Xs],[ve,Xs],[ve,Xs],[ve,Xs],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,y],[0,y],[0,.8],[.1,.8]],fn=(y,e)=>{let A=gu;if(Math.max(0,e)>1){let t=-(Math.log(y[11])+Math.log(Math.pow(2,y[13])-1)+y[14]*.3)/e;A=qA(+t.toFixed(8),.01,2)}return uu(A).map(([t,s],o)=>qA(y[o],t,s))};var mn=y=>{if(y===void 0)return[...Lo];switch(y.length){case 21:return[...y];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...y,0,Mo];case 17:{let e=[...y];return e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),e.concat([0,0,0,Mo])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...Lo]}},Ws=y=>{var s,o;let e=Array.isArray(y==null?void 0:y.learning_steps)?y.learning_steps:cu,A=Array.isArray(y==null?void 0:y.relearning_steps)?y.relearning_steps:hu,t=fn(mn(y==null?void 0:y.w),A.length);return{request_retention:(y==null?void 0:y.request_retention)||nu,maximum_interval:(y==null?void 0:y.maximum_interval)||au,w:t,enable_fuzz:(s=y==null?void 0:y.enable_fuzz)!=null?s:ou,enable_short_term:(o=y==null?void 0:y.enable_short_term)!=null?o:lu,learning_steps:e,relearning_steps:A}};function Tt(y,e){let A={due:y?tA.time(y):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:iA.New,last_review:void 0};return e&&typeof e=="function"?e(A):A}var hn=class{constructor(e){SA(this,"c");SA(this,"s0");SA(this,"s1");SA(this,"s2");let A=pu();this.c=1,this.s0=A(" "),this.s1=A(" "),this.s2=A(" "),e==null&&(e=+new Date),this.s0-=A(e),this.s0<0&&(this.s0+=1),this.s1-=A(e),this.s1<0&&(this.s1+=1),this.s2-=A(e),this.s2<0&&(this.s2+=1)}next(){let e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function pu(){let y=4022871197;return function(e){e=String(e);for(let A=0;A<e.length;A++){y+=e.charCodeAt(A);let t=.02519603282416938*y;y=t>>>0,t-=y,t*=y,y=t>>>0,t-=y,y+=t*4294967296}return(y>>>0)*23283064365386963e-26}}function fu(y){let e=new hn(y),A=()=>e.next();return A.int32=()=>e.next()*4294967296|0,A.double=()=>A()+(A()*2097152|0)*11102230246251565e-32,A.state=()=>e.state,A.importState=t=>(e.state=t,A),A}var To=y=>{let e=typeof y=="number"?-y:-y[20],A=Math.exp(Math.pow(e,-1)*Math.log(.9))-1;return{decay:e,factor:+A.toFixed(8)}};function dn(y,e,A){let{decay:t,factor:s}=To(y);return+Math.pow(1+s*e/A,t).toFixed(8)}var gn=class{constructor(e){SA(this,"param");SA(this,"intervalModifier");SA(this,"_seed");SA(this,"forgetting_curve");this.param=new Proxy(Ws(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=dn.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");let{decay:A,factor:t}=To(this.param.w);return+((Math.pow(e,1/A)-1)/t).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){let e=this;return{set:function(A,t,s){return t==="request_retention"&&Number.isFinite(s)?e.intervalModifier=e.calculate_interval_modifier(Number(s)):t==="w"&&(s=fn(mn(s),A.relearning_steps.length),e.forgetting_curve=dn.bind(this,s),e.intervalModifier=e.calculate_interval_modifier(Number(A.request_retention))),Reflect.set(A,t,s),!0}}}update_parameters(e){let A=Ws(e);for(let t in A)if(t in this.param){let s=t;this.param[s]=A[s]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return+(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(e,A){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);let t=fu(this._seed)(),{min_ivl:s,max_ivl:o}=iu(e,A,this.param.maximum_interval);return Math.floor(t*(o-s+1)+s)}next_interval(e,A){let t=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(t,A)}linear_damping(e,A){return+(e*(10-A)/9).toFixed(8)}next_difficulty(e,A){let t=-this.param.w[6]*(A-3),s=e+this.linear_damping(t,e);return qA(this.mean_reversion(this.init_difficulty(T.Easy),s),1,10)}mean_reversion(e,A){return+(this.param.w[7]*e+(1-this.param.w[7])*A).toFixed(8)}next_recall_stability(e,A,t,s){let o=T.Hard===s?this.param.w[15]:1,l=T.Easy===s?this.param.w[16]:1;return+qA(A*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(A,-this.param.w[9])*(Math.exp((1-t)*this.param.w[10])-1)*o*l),ve,36500).toFixed(8)}next_forget_stability(e,A,t){return+qA(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(A+1,this.param.w[13])-1)*Math.exp((1-t)*this.param.w[14]),ve,36500).toFixed(8)}next_short_term_stability(e,A){let t=Math.pow(e,-this.param.w[19])*Math.exp(this.param.w[17]*(A-3+this.param.w[18])),s=A>=3?Math.max(t,1):t;return+qA(e*s,ve,36500).toFixed(8)}next_state(e,A,t){let{difficulty:s,stability:o}=e!=null?e:{difficulty:0,stability:0};if(A<0)throw new Error(`Invalid delta_t "${A}"`);if(t<0||t>4)throw new Error(`Invalid grade "${t}"`);if(s===0&&o===0)return{difficulty:qA(this.init_difficulty(t),1,10),stability:this.init_stability(t)};if(t===0)return{difficulty:s,stability:o};if(s<1||o<ve)throw new Error(`Invalid memory state { difficulty: ${s}, stability: ${o} }`);let l=this.forgetting_curve(A,o),c=this.next_recall_stability(s,o,l,t),d=this.next_forget_stability(s,o,l),g=this.next_short_term_stability(o,t),u=c;if(t===1){let[m,w]=[0,0];this.param.enable_short_term&&(m=this.param.w[17],w=this.param.w[18]);let F=o/Math.exp(m*w);u=qA(+F.toFixed(8),ve,d)}return A===0&&this.param.enable_short_term&&(u=g),{difficulty:this.next_difficulty(s,t),stability:u}}};function mu(){let y=this.review_time.getTime(),e=this.current.reps,A=this.current.difficulty*this.current.stability;return`${y}_${e}_${A}`}var Bu=y=>{let e=y.slice(-1),A=parseInt(y.slice(0,-1),10);if(isNaN(A)||!Number.isFinite(A)||A<0)throw new Error(`Invalid step value: ${y}`);switch(e){case"m":return A;case"h":return A*60;case"d":return A*1440;default:throw new Error(`Invalid step unit: ${y}, expected m/h/d`)}},wu=(y,e,A)=>{let t=e===iA.Relearning||e===iA.Review?y.relearning_steps:y.learning_steps,s=t.length;if(s===0||A>=s)return{};let o=t[0],l=Bu,c=()=>l(o),d=()=>{if(s===1)return Math.round(l(o)*1.5);let F=t[1];return Math.round((l(o)+l(F))/2)},g=F=>F<0||F>=s?null:t[F],u=F=>l(F),m={},w=g(Math.max(0,A));if(e===iA.Review)return m[T.Again]={scheduled_minutes:l(w),next_step:0},m;{m[T.Again]={scheduled_minutes:c(),next_step:0},m[T.Hard]={scheduled_minutes:d(),next_step:A};let F=g(A+1);if(F){let Q=u(F);Q&&(m[T.Good]={scheduled_minutes:Math.round(Q),next_step:A+1})}}return m},qs=(y=>(y.SCHEDULER="Scheduler",y.LEARNING_STEPS="LearningSteps",y.SEED="Seed",y))(qs||{}),Js=class{constructor(e,A,t,s){SA(this,"last");SA(this,"current");SA(this,"review_time");SA(this,"next",new Map);SA(this,"algorithm");SA(this,"strategies");SA(this,"elapsed_days",0);this.algorithm=t,this.last=tA.card(e),this.current=tA.card(e),this.review_time=tA.time(A),this.strategies=s,this.init()}checkGrade(e){if(!Number.isFinite(e)||e<0||e>4)throw new Error(`Invalid grade "${e}",expected 1-4`)}init(){let{state:e,last_review:A}=this.current,t=0;e!==iA.New&&A&&(t=su(A,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=t,this.current.elapsed_days=t,this.current.reps+=1;let s=mu;if(this.strategies){let o=this.strategies.get(qs.SEED);o&&(s=o)}this.algorithm.seed=s.call(this)}preview(){return{[T.Again]:this.review(T.Again),[T.Hard]:this.review(T.Hard),[T.Good]:this.review(T.Good),[T.Easy]:this.review(T.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let e of eu)yield this.review(e)}review(e){let{state:A}=this.last,t;switch(this.checkGrade(e),A){case iA.New:t=this.newState(e);break;case iA.Learning:case iA.Relearning:t=this.learningState(e);break;case iA.Review:t=this.reviewState(e);break}return t}buildLog(e){let{last_review:A,due:t,elapsed_days:s}=this.last;return{rating:e,state:this.current.state,due:A||t,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:s,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}},Ys=class extends Js{constructor(A,t,s,o){super(A,t,s,o);SA(this,"learningStepsStrategy");let l=wu;if(this.strategies){let c=this.strategies.get(qs.LEARNING_STEPS);c&&(l=c)}this.learningStepsStrategy=l}getLearningInfo(A,t){var d,g,u,m;let s=this.algorithm.parameters;A.learning_steps=A.learning_steps||0;let o=this.learningStepsStrategy(s,A.state,this.current.state===iA.Learning?A.learning_steps+1:A.learning_steps),l=Math.max(0,(g=(d=o[t])==null?void 0:d.scheduled_minutes)!=null?g:0),c=Math.max(0,(m=(u=o[t])==null?void 0:u.next_step)!=null?m:0);return{scheduled_minutes:l,next_steps:c}}applyLearningSteps(A,t,s){let{scheduled_minutes:o,next_steps:l}=this.getLearningInfo(this.current,t);if(o>0&&o<1440)A.learning_steps=l,A.scheduled_days=0,A.state=s,A.due=Ce(this.review_time,Math.round(o),!1);else if(A.state=iA.Review,o>=1440)A.learning_steps=l,A.due=Ce(this.review_time,Math.round(o),!1),A.scheduled_days=Math.floor(o/1440);else{A.learning_steps=0;let c=this.algorithm.next_interval(A.stability,this.elapsed_days);A.scheduled_days=c,A.due=Ce(this.review_time,c,!0)}}newState(A){let t=this.next.get(A);if(t)return t;let s=tA.card(this.current);s.difficulty=qA(this.algorithm.init_difficulty(A),1,10),s.stability=this.algorithm.init_stability(A),this.applyLearningSteps(s,A,iA.Learning);let o={card:s,log:this.buildLog(A)};return this.next.set(A,o),o}learningState(A){let t=this.next.get(A);if(t)return t;let{state:s,difficulty:o,stability:l}=this.last,c=tA.card(this.current);c.difficulty=this.algorithm.next_difficulty(o,A),c.stability=this.algorithm.next_short_term_stability(l,A),this.applyLearningSteps(c,A,s);let d={card:c,log:this.buildLog(A)};return this.next.set(A,d),d}reviewState(A){let t=this.next.get(A);if(t)return t;let s=this.elapsed_days,{difficulty:o,stability:l}=this.last,c=this.algorithm.forgetting_curve(s,l),d=tA.card(this.current),g=tA.card(this.current),u=tA.card(this.current),m=tA.card(this.current);this.next_ds(d,g,u,m,o,l,c),this.next_interval(g,u,m,s),this.next_state(g,u,m),this.applyLearningSteps(d,T.Again,iA.Relearning),d.lapses+=1;let w={card:d,log:this.buildLog(T.Again)},F={card:g,log:super.buildLog(T.Hard)},Q={card:u,log:super.buildLog(T.Good)},E={card:m,log:super.buildLog(T.Easy)};return this.next.set(T.Again,w),this.next.set(T.Hard,F),this.next.set(T.Good,Q),this.next.set(T.Easy,E),this.next.get(A)}next_ds(A,t,s,o,l,c,d){A.difficulty=this.algorithm.next_difficulty(l,T.Again);let g=c/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),u=this.algorithm.next_forget_stability(l,c,d);A.stability=qA(+g.toFixed(8),ve,u),t.difficulty=this.algorithm.next_difficulty(l,T.Hard),t.stability=this.algorithm.next_recall_stability(l,c,d,T.Hard),s.difficulty=this.algorithm.next_difficulty(l,T.Good),s.stability=this.algorithm.next_recall_stability(l,c,d,T.Good),o.difficulty=this.algorithm.next_difficulty(l,T.Easy),o.stability=this.algorithm.next_recall_stability(l,c,d,T.Easy)}next_interval(A,t,s,o){let l,c;l=this.algorithm.next_interval(A.stability,o),c=this.algorithm.next_interval(t.stability,o),l=Math.min(l,c),c=Math.max(c,l+1);let d=Math.max(this.algorithm.next_interval(s.stability,o),c+1);A.scheduled_days=l,A.due=Ce(this.review_time,l,!0),t.scheduled_days=c,t.due=Ce(this.review_time,c,!0),s.scheduled_days=d,s.due=Ce(this.review_time,d,!0)}next_state(A,t,s){A.state=iA.Review,A.learning_steps=0,t.state=iA.Review,t.learning_steps=0,s.state=iA.Review,s.learning_steps=0}},$s=class extends Js{newState(e){let A=this.next.get(e);if(A)return A;this.current.scheduled_days=0,this.current.elapsed_days=0;let t=tA.card(this.current),s=tA.card(this.current),o=tA.card(this.current),l=tA.card(this.current);return this.init_ds(t,s,o,l),this.next_interval(t,s,o,l,0),this.next_state(t,s,o,l),this.update_next(t,s,o,l),this.next.get(e)}init_ds(e,A,t,s){e.difficulty=qA(this.algorithm.init_difficulty(T.Again),1,10),e.stability=this.algorithm.init_stability(T.Again),A.difficulty=qA(this.algorithm.init_difficulty(T.Hard),1,10),A.stability=this.algorithm.init_stability(T.Hard),t.difficulty=qA(this.algorithm.init_difficulty(T.Good),1,10),t.stability=this.algorithm.init_stability(T.Good),s.difficulty=qA(this.algorithm.init_difficulty(T.Easy),1,10),s.stability=this.algorithm.init_stability(T.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){let A=this.next.get(e);if(A)return A;let t=this.elapsed_days,{difficulty:s,stability:o}=this.last,l=this.algorithm.forgetting_curve(t,o),c=tA.card(this.current),d=tA.card(this.current),g=tA.card(this.current),u=tA.card(this.current);return this.next_ds(c,d,g,u,s,o,l),this.next_interval(c,d,g,u,t),this.next_state(c,d,g,u),c.lapses+=1,this.update_next(c,d,g,u),this.next.get(e)}next_ds(e,A,t,s,o,l,c){e.difficulty=this.algorithm.next_difficulty(o,T.Again);let d=this.algorithm.next_forget_stability(o,l,c);e.stability=qA(l,ve,d),A.difficulty=this.algorithm.next_difficulty(o,T.Hard),A.stability=this.algorithm.next_recall_stability(o,l,c,T.Hard),t.difficulty=this.algorithm.next_difficulty(o,T.Good),t.stability=this.algorithm.next_recall_stability(o,l,c,T.Good),s.difficulty=this.algorithm.next_difficulty(o,T.Easy),s.stability=this.algorithm.next_recall_stability(o,l,c,T.Easy)}next_interval(e,A,t,s,o){let l,c,d,g;l=this.algorithm.next_interval(e.stability,o),c=this.algorithm.next_interval(A.stability,o),d=this.algorithm.next_interval(t.stability,o),g=this.algorithm.next_interval(s.stability,o),l=Math.min(l,c),c=Math.max(c,l+1),d=Math.max(d,c+1),g=Math.max(g,d+1),e.scheduled_days=l,e.due=Ce(this.review_time,l,!0),A.scheduled_days=c,A.due=Ce(this.review_time,c,!0),t.scheduled_days=d,t.due=Ce(this.review_time,d,!0),s.scheduled_days=g,s.due=Ce(this.review_time,g,!0)}next_state(e,A,t,s){e.state=iA.Review,e.learning_steps=0,A.state=iA.Review,A.learning_steps=0,t.state=iA.Review,t.learning_steps=0,s.state=iA.Review,s.learning_steps=0}update_next(e,A,t,s){let o={card:e,log:this.buildLog(T.Again)},l={card:A,log:super.buildLog(T.Hard)},c={card:t,log:super.buildLog(T.Good)},d={card:s,log:super.buildLog(T.Easy)};this.next.set(T.Again,o),this.next.set(T.Hard,l),this.next.set(T.Good,c),this.next.set(T.Easy,d)}},un=class{constructor(e){SA(this,"fsrs");this.fsrs=e}replay(e,A,t){return this.fsrs.next(e,A,t)}handleManualRating(e,A,t,s,o,l,c){if(typeof A>"u")throw new Error("reschedule: state is required for manual rating");let d,g;if(A===iA.New)d={rating:T.Manual,state:A,due:c!=null?c:t,stability:e.stability,difficulty:e.difficulty,elapsed_days:s,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:t},g=Tt(t),g.last_review=t;else{if(typeof c>"u")throw new Error("reschedule: due is required for manual rating");let u=Lt(c,t,"days");d={rating:T.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:s,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:t},g={...e,state:A,due:c,last_review:t,stability:o||e.stability,difficulty:l||e.difficulty,elapsed_days:s,scheduled_days:u,reps:e.reps+1}}return{card:g,log:d}}reschedule(e,A){let t=[],s=Tt(e.due);for(let o of A){let l;if(o.review=tA.time(o.review),o.rating===T.Manual){let c=0;s.state!==iA.New&&s.last_review&&(c=Lt(o.review,s.last_review,"days")),l=this.handleManualRating(s,o.state,o.review,c,o.stability,o.difficulty,o.due?tA.time(o.due):void 0)}else l=this.replay(s,o.review,o.rating);t.push(l),s=l.card}return t}calculateManualRecord(e,A,t,s){if(!t)return null;let{card:o,log:l}=t,c=tA.card(e);return c.due.getTime()===o.due.getTime()?null:(c.scheduled_days=Lt(o.due,c.due,"days"),this.handleManualRating(c,o.state,tA.time(A),l.elapsed_days,s?o.stability:void 0,s?o.difficulty:void 0,o.due))}},pn=class extends gn{constructor(A){super(A);SA(this,"strategyHandler",new Map);SA(this,"Scheduler");let{enable_short_term:t}=this.parameters;this.Scheduler=t?Ys:$s}params_handler_proxy(){let A=this;return{set:function(t,s,o){return s==="request_retention"&&Number.isFinite(o)?A.intervalModifier=A.calculate_interval_modifier(Number(o)):s==="enable_short_term"?A.Scheduler=o===!0?Ys:$s:s==="w"&&(o=fn(mn(o),t.relearning_steps.length),A.forgetting_curve=dn.bind(this,o),A.intervalModifier=A.calculate_interval_modifier(Number(t.request_retention))),Reflect.set(t,s,o),!0}}}useStrategy(A,t){return this.strategyHandler.set(A,t),this}clearStrategy(A){return A?this.strategyHandler.delete(A):this.strategyHandler.clear(),this}getScheduler(A,t){let s=this.strategyHandler.get(qs.SCHEDULER)||this.Scheduler;return new s(A,t,this,this.strategyHandler)}repeat(A,t,s){let o=this.getScheduler(A,t).preview();return s&&typeof s=="function"?s(o):o}next(A,t,s,o){let l=this.getScheduler(A,t),c=tA.rating(s);if(c===T.Manual)throw new Error("Cannot review a manual rating");let d=l.review(c);return o&&typeof o=="function"?o(d):d}get_retrievability(A,t,s=!0){let o=tA.card(A);t=t?tA.time(t):new Date;let l=o.state!==iA.New?Math.max(Lt(t,o.last_review,"days"),0):0,c=o.state!==iA.New?this.forgetting_curve(l,+o.stability.toFixed(8)):0;return s?`${(c*100).toFixed(2)}%`:c}rollback(A,t,s){let o=tA.card(A),l=tA.review_log(t);if(l.rating===T.Manual)throw new Error("Cannot rollback a manual rating");let c,d,g;switch(l.state){case iA.New:c=l.due,d=void 0,g=0;break;case iA.Learning:case iA.Relearning:case iA.Review:c=l.review,d=l.due,g=o.lapses-(l.rating===T.Again&&l.state===iA.Review?1:0);break}let u={...o,due:c,stability:l.stability,difficulty:l.difficulty,elapsed_days:l.last_elapsed_days,scheduled_days:l.scheduled_days,reps:Math.max(0,o.reps-1),lapses:Math.max(0,g),learning_steps:l.learning_steps,state:l.state,last_review:d};return s&&typeof s=="function"?s(u):u}forget(A,t,s=!1,o){let l=tA.card(A);t=tA.time(t);let c=l.state===iA.New?0:Lt(t,l.due,"days"),d={rating:T.Manual,state:l.state,due:l.due,stability:l.stability,difficulty:l.difficulty,elapsed_days:0,last_elapsed_days:l.elapsed_days,scheduled_days:c,learning_steps:l.learning_steps,review:t},g={card:{...l,due:t,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:s?0:l.reps,lapses:s?0:l.lapses,learning_steps:0,state:iA.New,last_review:l.last_review},log:d};return o&&typeof o=="function"?o(g):g}reschedule(A,t=[],s={}){let{recordLogHandler:o,reviewsOrderBy:l,skipManual:c=!0,now:d=new Date,update_memory_state:g=!1}=s;l&&typeof l=="function"&&t.sort(l),c&&(t=t.filter(E=>E.rating!==T.Manual));let u=new un(this),m=u.reschedule(s.first_card||Tt(),t),w=m.length,F=tA.card(A),Q=u.calculateManualRecord(F,d,w?m[w-1]:void 0,g);return o&&typeof o=="function"?{collections:m.map(o),reschedule_item:Q?o(Q):null}:{collections:m,reschedule_item:Q}}},Bn=y=>new pn(y||{});var Zs=class{constructor(e={}){this.params=this.convertToTsFSRSParams(e),this.fsrsInstance=Bn(this.params)}convertToTsFSRSParams(e){let{request_retention:A=.9,maximum_interval:t=36500,w:s=[]}=e;return Ws({request_retention:A,maximum_interval:t,enable_fuzz:!0,enable_short_term:!0,w:e.w||[]})}toTsFSRSCard(e){if(e.lastReview===0)return Tt(new Date(e.createdAt));let A=iA.New;return e.reviews>0&&(e.lapses>0?A=iA.Relearning:A=iA.Review),{due:new Date(e.nextReview),stability:e.stability,difficulty:e.difficulty,elapsed_days:e.lastReview?(Date.now()-e.lastReview)/(24*60*60*1e3):0,scheduled_days:e.lastReview?(e.nextReview-e.lastReview)/(24*60*60*1e3):0,reps:e.reviews,lapses:e.lapses,state:A,last_review:e.lastReview?new Date(e.lastReview):void 0,learning_steps:0}}convertRating(e){switch(e){case gA.AGAIN:return T.Again;case gA.HARD:return T.Hard;case gA.GOOD:return T.Good;case gA.EASY:return T.Easy;default:return T.Good}}fromTsFSRSCard(e,A){let{card:t,log:s}=A;return{...e,difficulty:t.difficulty,stability:t.stability,retrievability:Math.exp(Math.log(.9)*t.elapsed_days/t.stability),lastReview:s.review.getTime(),nextReview:t.due.getTime(),reviews:t.reps,lapses:t.lapses,reviewHistory:[...e.reviewHistory,{timestamp:s.review.getTime(),rating:this.convertTsFSRSRatingToFSRSRating(s.rating),elapsed:s.elapsed_days}]}}convertTsFSRSRatingToFSRSRating(e){switch(e){case T.Again:return gA.AGAIN;case T.Hard:return gA.HARD;case T.Good:return gA.GOOD;case T.Easy:return gA.EASY;default:return gA.GOOD}}initializeCard(e,A,t){let s=Date.now(),o=Tt(new Date(s));return{id:XA.generateCardId(),difficulty:o.difficulty,stability:o.stability,retrievability:1,lastReview:0,nextReview:s,reviews:0,lapses:0,reviewHistory:[],text:e,answer:A,filePath:t,createdAt:s}}reviewCard(e,A){let t=this.toTsFSRSCard(e),s=this.convertRating(A),o=new Date;if(s!==T.Manual){let l=this.fsrsInstance.next(t,o,s);return this.fromTsFSRSCard(e,l)}else return e}getSchedulingCards(e){let A=this.toTsFSRSCard(e),t=new Date,s=this.fsrsInstance.repeat(A,t);return{[gA.AGAIN]:this.fromTsFSRSCard(e,s[T.Again]),[gA.HARD]:this.fromTsFSRSCard(e,s[T.Hard]),[gA.GOOD]:this.fromTsFSRSCard(e,s[T.Good]),[gA.EASY]:this.fromTsFSRSCard(e,s[T.Easy])}}isDue(e){return Date.now()>=e.nextReview}getParameters(){return{...this.params}}setParameters(e){this.params=this.convertToTsFSRSParams(e),this.fsrsInstance=Bn(this.params)}};var zs=class{constructor(e={}){this.params={...$r,...e},this.adapter=new Zs(this.params)}initializeCard(e,A,t){return this.adapter.initializeCard(e,A,t)}reviewCard(e,A){return this.adapter.reviewCard(e,A)}isDue(e){return this.adapter.isDue(e)}getReviewableCards(e){return e.filter(A=>this.isDue(A)).sort((A,t)=>A.nextReview-t.nextReview)}getParameters(){return{...this.params}}setParameters(e){this.params={...this.params,...e},this.adapter.setParameters(this.params)}resetParameters(){this.params={...$r},this.adapter.setParameters(this.params)}getSchedulingCards(e){return this.adapter.getSchedulingCards(e)}};var js=class{constructor(e,A){this.plugin=e,this.fsrsService=A}get storage(){return this.plugin.fsrsManager.storage}createCard(e,A,t){try{return this.fsrsService.initializeCard(e,A,t)}catch(s){console.error("\u521B\u5EFA\u5361\u7247\u65F6\u51FA\u9519:",s);try{return this.fsrsService.initializeCard(e,A,t)}catch(o){console.error("\u7B2C\u4E8C\u6B21\u5C1D\u8BD5\u521B\u5EFA\u5361\u7247\u5931\u8D25:",o);let l=new Date;return this.fsrsService.initializeCard(e,A,t)}}}addCard(e,A,t){let s=this.createCard(e,A,t);this.storage.cards||(this.storage.cards={}),this.storage.cards[s.id]=s;try{this.plugin.eventManager.emitFlashcardChanged()}catch(o){console.error("\u4FDD\u5B58\u5361\u7247\u65F6\u51FA\u9519:",o)}return s}getCardsByFile(e){return this.storage.cards?Object.values(this.storage.cards).filter(A=>A.filePath===e):[]}deleteCard(e){try{return!this.storage.cards||!this.storage.cards[e]?!1:(delete this.storage.cards[e],this.plugin.eventManager.emitFlashcardChanged(),!0)}catch(A){return console.error("\u5220\u9664\u5361\u7247\u65F6\u51FA\u9519:",A),!1}}};var Bi=class{constructor(e,A){this.plugin=e,this.storage=A}getCardGroups(){return this.storage.cardGroups||[]}getGroupById(e){return this.storage.cardGroups.find(A=>A.id===e)||null}async createCardGroup(e){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let t={id:XA.generateGroupId(),name:e.name,filter:e.filter,createdTime:e.createdTime||Date.now(),sortOrder:e.sortOrder||this.storage.cardGroups.length,isReversed:e.isReversed||!1,settings:e.settings||{useGlobalSettings:!0},cardIds:[]};this.storage.cardGroups.push(t),e.filter&&e.filter.trim().length>0&&this.updateGroupCardIds(t.id);try{await this.plugin.fsrsManager.saveStoragePublic()}catch(s){console.error("\u4FDD\u5B58\u5206\u7EC4\u6570\u636E\u65F6\u51FA\u9519:",s)}return this.plugin.eventManager.emitFlashcardChanged(),t}async updateCardGroup(e,A){let t=this.storage.cardGroups.findIndex(s=>s.id===e);return t===-1?!1:(this.storage.cardGroups[t]={...this.storage.cardGroups[t],...A},A.filter&&this.updateGroupCardIds(e),this.plugin.eventManager.emitFlashcardChanged(),!0)}async deleteCardGroup(e,A=!1){let t=this.storage.cardGroups.findIndex(c=>c.id===e);if(t===-1)return!1;let s=this.storage.cardGroups[t],o=this.storage.uiState;o.currentGroupId===e&&(o.currentGroupId="",o.currentGroupName="",o.currentIndex=0,o.isFlipped=!1,o.completionMessage=null),o.groupCompletionMessages&&e in o.groupCompletionMessages&&delete o.groupCompletionMessages[e],o.groupProgress&&e in o.groupProgress&&delete o.groupProgress[e];let l=[...s.cardIds||[]];for(let c of l)this.removeCardFromGroup(c,e);return this.storage.cardGroups.splice(t,1),this.plugin.eventManager.emitFlashcardChanged(),!0}addCardToGroup(e,A){let t=this.storage.cardGroups.find(o=>o.id===A);if(!t)return!1;let s=this.storage.cards[e];return s?(t.cardIds||(t.cardIds=[]),s.groupIds||(s.groupIds=[]),t.cardIds.includes(e)||(t.cardIds.push(e),s.groupIds.includes(A)||s.groupIds.push(A)),!0):!1}removeCardFromGroup(e,A){let t=this.storage.cardGroups.find(o=>o.id===A);if(!t||!t.cardIds)return!1;let s=this.storage.cards[e];return s?(t.cardIds=t.cardIds.filter(o=>o!==e),s.groupIds&&(s.groupIds=s.groupIds.filter(o=>o!==A)),!0):!1}getCardsByGroupId(e){let A=this.getGroupById(e);if(!A)return console.error(`[getCardsByGroupId] \u9519\u8BEF: \u672A\u627E\u5230\u5206\u7EC4: ${e}`),[];let t=Object.keys(this.storage.cards||{});if(A.cardIds&&A.cardIds.length>0)return A.cardIds.filter(o=>{let l=!!this.storage.cards[o];return l||console.warn(`[getCardsByGroupId] \u5361\u7247\u4E0D\u5B58\u5728: ${o}`),l}).map(o=>this.storage.cards[o]);if(A.filter&&A.filter.trim().length>0){let s=Object.values(this.storage.cards),o=A.filter.split(",").map(d=>d.trim()).filter(d=>d.length>0),l=/\[\[([^\]]+)\]\]/;return s.filter(d=>{if(!d.filePath)return!1;let g=d.filePath.toLowerCase(),u=g.split("/").pop()||"",m=u.replace(/\.md$/i,"");for(let w of o){let F=w.toLowerCase(),Q=F.match(l);if(Q){let E=Q[1].toLowerCase();if(m===E||u===E)return!0}else if(g.includes(F)||d.text&&d.text.toLowerCase().includes(F)||d.answer&&d.answer.toLowerCase().includes(F))return!0}return!1})}return[]}getGroupProgress(e){if(!this.getGroupById(e))return null;let t=this.getCardsByGroupId(e),s=Date.now();return{due:t.filter(o=>o.nextReview<=s).length,newCards:t.filter(o=>o.lastReview===0).length,learned:t.filter(o=>o.lastReview>0).length,retention:this.calculateGroupRetention(t)}}calculateGroupRetention(e){let A=e.filter(s=>s.lastReview>0);return A.length===0?1:A.reduce((s,o)=>s+o.retrievability,0)/A.length}deleteCardReference(e){for(let A of this.storage.cardGroups)A.cardIds&&(A.cardIds=A.cardIds.filter(t=>t!==e))}getGroupsByCardId(e){let A=this.storage.cards[e];return!A||!A.groupIds?[]:A.groupIds.map(t=>this.storage.cardGroups.find(s=>s.id===t)).filter(t=>t!==void 0)}updateGroupCardIds(e){let A=this.getGroupById(e);if(!A||!A.filter||A.filter.trim().length===0)return!1;let t=Object.values(this.storage.cards||{}),s=A.filter.split(",").map(g=>g.trim()).filter(g=>g.length>0),o=/\[\[([^\]]+)\]\]/,c=t.filter(g=>{if(!g.filePath)return!1;let u=g.filePath.toLowerCase(),m=u.split("/").pop()||"",w=m.replace(/\.md$/i,"");for(let F of s){let Q=F.toLowerCase(),E=Q.match(o);if(E){let H=E[1].toLowerCase();if(w===H||m===H)return!0}else if(u.includes(Q)||g.text&&g.text.toLowerCase().includes(Q)||g.answer&&g.answer.toLowerCase().includes(Q))return!0}return!1}).map(g=>g.id);A.cardIds||(A.cardIds=[]);let d=!1;for(let g of c)A.cardIds.includes(g)||(A.cardIds.push(g),d=!0);return d&&this.plugin.fsrsManager.saveStorageDebounced(),d}};var Do=require("obsidian"),Ar=class{constructor(e){this.plugin=e,this.fsrsService=new zs,this.cardFactory=new js(e,this.fsrsService),this.storage={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]},this.saveStorageDebounced=(0,Do.debounce)(this.saveStorage.bind(this),1e3,!0),this.loadStorage().then(A=>{this.storage=A,this.groupRepository=new Bi(e,this.storage),this.registerEventListeners()}).catch(A=>{console.error("Loading storage data failed:",A),this.groupRepository=new Bi(e,this.storage),this.registerEventListeners()})}async loadStorage(){let e={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]};try{let A=await this.plugin.loadData();if(!(A!=null&&A.fsrs))return e;A.fsrs.cardGroups&&Array.isArray(A.fsrs.cardGroups)&&A.fsrs.cardGroups.length>0;let t=Array.isArray(A.fsrs.cardGroups)?A.fsrs.cardGroups:[];return{version:A.fsrs.version||e.version,cards:A.fsrs.cards||{},globalStats:A.fsrs.globalStats||e.globalStats,cardGroups:t,uiState:A.fsrs.uiState||e.uiState,dailyStats:A.fsrs.dailyStats||[]}}catch(A){return console.error("Loading storage data failed:",A),e}}async saveStorage(){try{let e=await this.plugin.loadData()||{};Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]),this.storage.cards||(this.storage.cards={});let A={...e,fsrs:this.storage};await this.plugin.saveData(A)}catch(e){throw console.error("Saving data failed:",e),e}}updateGlobalStats(e,A){let t=this.storage.globalStats,s=Date.now(),o=new Date(s).setHours(0,0,0,0);if(t.totalReviews++,t.averageRetention=(t.averageRetention*(t.totalReviews-1)+A)/t.totalReviews,t.lastReviewDate===0)t.streakDays=1;else{let l=new Date(t.lastReviewDate).setHours(0,0,0,0),c=(o-l)/(24*60*60*1e3);c===1?t.streakDays++:c>1&&(t.streakDays=1)}t.lastReviewDate=s}addCard(e,A,t,s,o){let l=this.cardFactory.createCard(e,A,t);return s&&o&&(l.sourceId=s,l.sourceType=o),this.storage.cards[l.id]=l,this.checkAndAddCardToGroups(l),this.saveStorageDebounced(),l}getCardsForStudy(e){if(!e)return console.warn("No group ID specified, returning empty card list"),[];let A=this.groupRepository.getCardsByGroupId(e);if(A.length===0)return[];let t=Date.now(),s=A.filter(F=>F.reviews===0&&F.lastReview===0),o=A.filter(F=>!(F.reviews===0&&F.lastReview===0)&&F.nextReview<=t),l=this.getRemainingNewCardsToday(e),c=this.getRemainingReviewsToday(e),d=this.storage.cardGroups.find(F=>F.id===e),g=20,u=100;if(d&&d.settings)if(!d.settings.useGlobalSettings)g=d.settings.newCardsPerDay!==void 0?d.settings.newCardsPerDay:g,u=d.settings.reviewsPerDay!==void 0?d.settings.reviewsPerDay:u;else{let F=this.fsrsService.getParameters();g=F.newCardsPerDay,u=F.reviewsPerDay}let m=s.slice(0,l),w=o.slice(0,c);return[...m,...w]}trackStudyProgress(e,A){let t=this.storage.cards[e];if(!t)return console.error(`Tracking study progress failed: Card ${e} does not exist`),null;let s=t.lastReview===0,o=this.fsrsService.reviewCard(t,A);return this.storage.cards[e]=o,this.updateGlobalStats(A,o.retrievability),this.updateDailyStats(s,A),t.groupIds&&t.groupIds.length>0&&t.groupIds.forEach(l=>{let c=this.groupRepository.getGroupById(l)}),this.saveStorage(),this.plugin.eventManager.emitFlashcardChanged(),this.storage.cards[e]}getCardPredictions(e){let A=this.storage.cards[e];return A?this.fsrsService.getSchedulingCards(A):null}async generateCardsForGroup(e){return 0}checkAndAddCardToGroups(e){if(!e||!e.id)return 0;let A=this.groupRepository.getCardGroups();if(!A||A.length===0)return 0;let t=0;for(let s of A){if(!s.filter||s.filter.trim().length===0)continue;let o=[e];this.checkCardMatchesGroupFilter(e,s.filter)&&this.addCardToGroup(e.id,s.id)&&t++}return t>0,t}checkCardMatchesGroupFilter(e,A){if(!e||!e.filePath||!A||A.trim().length===0)return!1;let t=A.split(",").map(d=>d.trim()).filter(d=>d.length>0);if(t.length===0)return!1;let s=/\[\[([^\]]+)\]\]/,o=e.filePath.toLowerCase(),l=o.split("/").pop()||"",c=l.replace(/\.md$/i,"");for(let d of t){let g=d.toLowerCase(),u=g.match(s);if(u){let m=u[1].toLowerCase();if(c===m||l===m)return!0}else if(o.includes(g)||e.text&&e.text.toLowerCase().includes(g)||e.answer&&e.answer.toLowerCase().includes(g))return!0}return!1}findCardsBySourceId(e,A){return!this.storage.cards||!e?[]:Object.values(this.storage.cards).filter(t=>t.sourceId===e&&(!A||t.sourceType===A))}deleteCardsBySourceId(e,A){let t=this.findCardsBySourceId(e,A),s=0;for(let o of t){if(o.groupIds)for(let l of o.groupIds)this.removeCardFromGroup(o.id,l);delete this.storage.cards[o.id],s++}return s>0&&this.saveStorageDebounced(),s}updateCardsBySourceId(e,A,t,s){let o=this.findCardsBySourceId(e,A),l=0;for(let c of o)t!==void 0&&(c.text=t),s!==void 0&&(c.answer=s),c.updatedAt=Date.now(),l++;return l>0&&this.saveStorageDebounced(),l}getTotalCardsCount(){let e=this.getCardGroups()||[];if(e.length===0)return 0;if(e.length===1&&e[0].cardIds)return e[0].cardIds.length;let A=new Set;return e.forEach(t=>{t.cardIds&&t.cardIds.forEach(s=>{this.storage.cards[s]&&A.add(s)})}),A.size}getProgress(){let e=this.getAllGroupCards(),A=Date.now();return e.length===0?{due:0,newCards:0,learned:0,retention:this.storage.globalStats.averageRetention}:{due:e.filter(t=>t.nextReview<=A).length,newCards:e.filter(t=>t.lastReview===0).length,learned:e.filter(t=>t.lastReview>0).length,retention:this.storage.globalStats.averageRetention}}getAllGroupCards(){let e=this.groupRepository.getCardGroups();if(!e||e.length===0)return[];let A=new Set,t=[];for(let s of e){let o=this.groupRepository.getCardsByGroupId(s.id);for(let l of o)A.has(l.id)||(A.add(l.id),t.push(l))}return t}getStats(){return{...this.storage.globalStats}}getUIState(){return{...this.storage.uiState}}updateUIState(e){this.storage.uiState={...this.storage.uiState,...e},this.saveStorageDebounced()}deleteCard(e){let A=this.storage.cards[e];if(!A)return!1;if(A.groupIds)for(let t of A.groupIds)this.removeCardFromGroup(e,t);return delete this.storage.cards[e],this.saveStorageDebounced(),this.plugin.eventManager.emitFlashcardChanged(),!0}getCardsByFile(e){return this.cardFactory.getCardsByFile(e)}getPlugin(){return this.plugin}async saveStoragePublic(){return this.saveStorage()}getTodayTimestamp(){let e=new Date;return e.setHours(0,0,0,0),e.getTime()}getTodayStats(){let e=new Date;e.setHours(0,0,0,0);let A=e.getTime(),t=e.toDateString(),s=this.storage.dailyStats.find(o=>new Date(o.date).toDateString()===t);return s||(s={date:A,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(s),this.saveStorageDebounced()),s}updateTodayStats(e){let A=this.getTodayStats();e?A.newCardsLearned++:A.cardsReviewed++,this.saveStorageDebounced()}canLearnNewCardsToday(e){let A=this.getTodayStats(),t=this.fsrsService.getParameters();if(e){let s=this.storage.cardGroups.find(o=>o.id===e);if(s&&s.settings&&!s.settings.useGlobalSettings&&s.settings.newCardsPerDay!==void 0)return A.newCardsLearned<s.settings.newCardsPerDay}return A.newCardsLearned<t.newCardsPerDay}canReviewCardsToday(e){let A=this.getTodayStats(),t=this.fsrsService.getParameters();if(e){let s=this.storage.cardGroups.find(o=>o.id===e);if(s&&s.settings&&!s.settings.useGlobalSettings&&s.settings.reviewsPerDay!==void 0)return A.cardsReviewed<s.settings.reviewsPerDay}return A.cardsReviewed<t.reviewsPerDay}getRemainingNewCardsToday(e){let A=this.getTodayStats(),t=this.fsrsService.getParameters();if(e){let s=this.storage.cardGroups.find(o=>o.id===e);if(s&&s.settings&&!s.settings.useGlobalSettings&&s.settings.newCardsPerDay!==void 0)return Math.max(0,s.settings.newCardsPerDay-A.newCardsLearned)}return Math.max(0,t.newCardsPerDay-A.newCardsLearned)}getRemainingReviewsToday(e){let A=this.getTodayStats(),t=this.fsrsService.getParameters();if(e){let s=this.storage.cardGroups.find(o=>o.id===e);if(s&&s.settings&&!s.settings.useGlobalSettings&&s.settings.reviewsPerDay!==void 0)return Math.max(0,s.settings.reviewsPerDay-A.cardsReviewed)}return Math.max(0,t.reviewsPerDay-A.cardsReviewed)}async createCardGroup(e){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let A=await this.groupRepository.createCardGroup(e),t=await this.generateCardsForGroup(A.id);return this.storage.cardGroups.some(s=>s.id===A.id)||this.storage.cardGroups.push(A),await this.saveStorage(),A}async updateCardGroup(e,A){let t=this.groupRepository.getGroupById(e),s=t==null?void 0:t.filter;if(!await this.groupRepository.updateCardGroup(e,A))return!1;if(A.filter!==void 0&&A.filter!==s){let l=this.groupRepository.getGroupById(e);if(l&&l.cardIds)for(let d of[...l.cardIds])this.removeCardFromGroup(d,e);let c=await this.generateCardsForGroup(e)}return await this.saveStorage(),!0}async deleteCardGroup(e,A=!1){if(!await this.groupRepository.deleteCardGroup(e,!1))return!1;try{return await this.saveStorage(),!0}catch(s){return!1}}getCardsInGroup(e){return e.cardIds&&e.cardIds.length>0?this.getCardsByGroupId(e.id):Object.values(this.storage.cards).filter(t=>{let s=e.filter.split(",").map(g=>g.trim().toLowerCase()),o=t.text.toLowerCase(),l=t.answer.toLowerCase(),c=(t.filePath||"").toLowerCase();return s.some(g=>{if(g.startsWith("#"))return o.includes(g)||l.includes(g);if(g.startsWith("path:")){let u=g.substring(5);return c.includes(u)}return o.includes(g)||l.includes(g)})})}addCardToGroup(e,A){let t=this.groupRepository.addCardToGroup(e,A);return t&&this.saveStorageDebounced(),t}removeCardFromGroup(e,A){let t=this.groupRepository.removeCardFromGroup(e,A);return t&&this.saveStorageDebounced(),t}getGroupProgress(e){return this.groupRepository.getGroupProgress(e)}getCardsByGroupId(e){return this.groupRepository.getCardsByGroupId(e)}getAllCards(){return Object.values(this.storage.cards)}getCardGroups(){return this.groupRepository.getCardGroups()}registerEventListeners(){if(!this.plugin.eventManager){console.error("\u4E8B\u4EF6\u7BA1\u7406\u5668\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u6CE8\u518C\u4E8B\u4EF6\u76D1\u542C\u5668");return}this.plugin.eventManager.on("highlight:update",(e,A,t,s)=>{this.handleHighlightUpdate(e,A,t,s)}),this.plugin.eventManager.on("highlight:delete",(e,A,t)=>{this.handleHighlightDelete(e,A,t)}),this.plugin.eventManager.on("comment:update",(e,A,t,s)=>{this.handleCommentUpdate(e,A,t,s)}),this.plugin.eventManager.on("comment:delete",(e,A,t)=>{this.handleCommentDelete(e,A,t)})}handleHighlightUpdate(e,A,t,s){let o=this.updateCardsBySourceId(s,"highlight",t)}handleHighlightDelete(e,A,t){let s=this.deleteCardsBySourceId(t,"highlight")}handleCommentUpdate(e,A,t,s){let o=this.findCardsBySourceId(s,"highlight");if(!o||o.length===0)return;let l=0;for(let c of o){let d=c.answer||"",g=/\{\{([^{}]+)\}\}/g,u=[],m;for(;(m=g.exec(c.text))!==null;)u.push(m[1]);let F=d.split(`
`).filter(H=>H.trim()!==""&&H.trim()!==A.trim()&&!u.includes(H.trim())),Q=[];u.length>0&&Q.push(u.join(`
`)),F.length>0&&Q.push(F.join(`
`)),t&&t.trim()!==""&&Q.push(t);let E=Q.length>0?Q.join(`

`):"";E!==d&&(c.answer=E,c.updatedAt=Date.now(),l++)}l>0&&(this.saveStorageDebounced(),this.plugin.eventManager&&this.plugin.eventManager.emitFlashcardChanged())}handleCommentDelete(e,A,t){let s=this.deleteCardsBySourceId(t,"highlight")}checkAndMaintainDailyStats(){this.storage.dailyStats||(this.storage.dailyStats=[]),this.storage.dailyStats.sort((A,t)=>t.date-A.date);let e=new Map;return this.storage.dailyStats.forEach(A=>{let t=new Date(A.date),s=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`;e.has(s)||e.set(s,A)}),this.storage.dailyStats=Array.from(e.values()),this.storage.dailyStats.sort((A,t)=>t.date-A.date),this.storage.dailyStats.length>84&&(this.storage.dailyStats=this.storage.dailyStats.slice(0,84)),this.storage.dailyStats.length}updateDailyStats(e,A){let t=new Date;t.setHours(0,0,0,0);let s=t.getTime();this.storage.globalStats.lastReviewDate?this.storage.globalStats.lastReviewDate===s||(this.storage.globalStats.lastReviewDate===s-864e5?(this.storage.globalStats.lastReviewDate=s,this.storage.globalStats.streakDays++):this.storage.globalStats.lastReviewDate<s&&(this.storage.globalStats.lastReviewDate=s,this.storage.globalStats.streakDays=1)):(this.storage.globalStats.lastReviewDate=s,this.storage.globalStats.streakDays=1);let o=t.toDateString(),l=this.storage.dailyStats.find(c=>new Date(c.date).toDateString()===o);switch(l||(l={date:s,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(l),this.checkAndMaintainDailyStats()),l.reviewCount++,e?(l.newCount++,l.newCardsLearned++):l.cardsReviewed++,A){case gA.AGAIN:l.againCount++;break;case gA.HARD:l.hardCount++;break;case gA.GOOD:l.goodCount++;break;case gA.EASY:l.easyCount++;break}this.saveStorageDebounced()}cleanupInvalidCardReferences(){let e=0;if(!this.storage.cardGroups)return e;for(let A of this.storage.cardGroups)if(A.cardIds&&A.cardIds.length>0){let t=A.cardIds.length;A.cardIds=A.cardIds.filter(o=>this.storage.cards&&this.storage.cards[o]);let s=t-A.cardIds.length;s>0&&(e+=s,A.lastUpdated=Date.now())}return e>0&&this.saveStorageDebounced(),e}resetGroupCompletionMessage(e){if(!e)return;let A=this.groupRepository.getGroupById(e);A&&(this.storage.uiState||(this.storage.uiState={currentGroupName:"",completionMessage:null,groupProgress:{}}),this.storage.uiState.groupProgress||(this.storage.uiState.groupProgress={}),this.storage.uiState.groupProgress[A.name]&&(this.storage.uiState.groupProgress[A.name].completionMessage=null,this.saveStorageDebounced()))}};var er=class{constructor(e,A){this.app=e;this.commentStore=A;this.textSimilarityService=new we(e)}findMatchingHighlight(e,A){let t=this.commentStore.getFileComments(e);if(!t||t.length===0)return null;let s=t.find(c=>c.text!==A.text?!1:typeof c.position=="number"&&typeof A.position=="number"?Math.abs(c.position-A.position)<10:c.blockId&&A.blockId?c.blockId===A.blockId:!1);if(s||A.position!==void 0&&(s=t.find(c=>typeof c.position=="number"&&Math.abs(c.position-A.position)<30),s))return s;let o=null,l=0;for(let c of t){if(!c.comments||c.comments.length===0)continue;let d=this.textSimilarityService.calculateSimilarity(c.text,A.text);d>l&&d>.6&&(l=d,o=c)}if(o)return o;if(A.blockId){let c=t.filter(d=>d.blockId===A.blockId);if(c.length>0)return c[0]}return null}async recoverHighlight(e,A,t){let s={...A,text:t,updatedAt:Date.now()};return await this.commentStore.addComment(e,s),s}};var tr=class extends Po.Plugin{constructor(){super(...arguments);this.DEFAULT_SETTINGS={...oA,anthropic:{apiKey:"",model:"claude-2",apiAddress:"",isCustomModel:!1,lastCustomModel:""}}}async onload(){let A=await this.loadData();this.settings=Object.assign({},oA,A),window.html2canvas=Ko.default,this.commentStore=new xs(this),await this.commentStore.loadComments(),this.eventManager=new je(this.app),this.fsrsManager=new Ar(this),this.highlightMatchingService=new er(this.app,this.commentStore),this.highlightService=new le(this.app),this.highlightDecorator=new Ms(this,this.commentStore),this.highlightDecorator.enable(),this.registerView(ie,s=>new ue(s,this.commentStore)),this.addRibbonIcon("highlighter","HiNote",async()=>{let{workspace:s}=this.app,o=s.getLeavesOfType(ie);if(o.length){s.revealLeaf(o[0]);return}let l=s.getRightLeaf(!1);l&&await l.setViewState({type:ie,active:!0})}),this.addCommand({id:"open-comment-window",name:f("Open in right sidebar"),callback:async()=>{let{workspace:s}=this.app,o=s.getLeavesOfType(ie);if(o.length){let c=o[0],d=c.view;if(d&&d instanceof ue&&d.isDraggedToMainView){s.detachLeavesOfType(ie);let g=s.getRightLeaf(!1);if(g){await g.setViewState({type:ie,active:!0});let u=g.view;u&&u instanceof ue&&(u.isDraggedToMainView=!1,u.updateViewLayout(),u.updateHighlights())}}else s.revealLeaf(c);return}let l=s.getRightLeaf(!1);if(l){await l.setViewState({type:ie,active:!0});let c=l.view;c&&c instanceof ue&&(c.isDraggedToMainView=!1,c.updateViewLayout())}}}),this.addSettingTab(new _s(this.app,this));let t=()=>{let s=performance.now(),o=performance.now()};this.registerEvent(this.app.vault.on("rename",(s,o)=>{this.commentStore.updateFilePath(o,s.path)})),this.addCommand({id:"open-chat-window",name:f("Open AI chat window"),callback:()=>{At.getInstance(this.app,this).show()}}),this.addCommand({id:"open-comment-main-window",name:f("Open in main window"),callback:async()=>{let{workspace:s}=this.app,o=s.getLeavesOfType(ie);if(o.length){let c=o[0];s.setActiveLeaf(c,{focus:!0}),s.detachLeavesOfType(ie);let d=s.getLeaf("tab");await d.setViewState({type:ie,active:!0});let g=d.view;g&&g instanceof ue&&(g.isDraggedToMainView=!0,g.updateViewLayout(),g.updateHighlights());return}let l=s.getLeaf("tab");l&&(await l.setViewState({type:ie,active:!0}),setTimeout(()=>{let c=l.view;c&&c instanceof ue&&(c.isDraggedToMainView=!0,c.updateViewLayout(),c.updateHighlights())},100))}})}async onunload(){try{await this.commentStore.saveComments();let A=await this.loadData()}catch(A){}this.highlightDecorator&&this.highlightDecorator.disable(),At.instance&&At.instance.close()}async loadSettings(){let A=await this.loadData();this.settings||(this.settings={excludePatterns:oA.excludePatterns,useCustomPattern:oA.useCustomPattern,regexRules:[...oA.regexRules],ai:{provider:oA.ai.provider,openai:oA.ai.openai?{...oA.ai.openai}:void 0,anthropic:oA.ai.anthropic?{...oA.ai.anthropic}:void 0,gemini:oA.ai.gemini?{...oA.ai.gemini}:void 0,ollama:oA.ai.ollama?{...oA.ai.ollama}:void 0,deepseek:oA.ai.deepseek?{...oA.ai.deepseek}:void 0,prompts:{...oA.ai.prompts}},export:{exportPath:oA.export.exportPath}}),(A==null?void 0:A.excludePatterns)!==void 0&&(this.settings.excludePatterns=A.excludePatterns),A!=null&&A.ai&&(A.ai.provider&&(this.settings.ai.provider=A.ai.provider),A.ai.openai&&this.settings.ai.openai&&(this.settings.ai.openai={apiKey:A.ai.openai.apiKey||this.settings.ai.openai.apiKey,model:A.ai.openai.model||this.settings.ai.openai.model,baseUrl:A.ai.openai.baseUrl}),A.ai.anthropic&&this.settings.ai.anthropic&&(this.settings.ai.anthropic={apiKey:A.ai.anthropic.apiKey||this.settings.ai.anthropic.apiKey,model:A.ai.anthropic.model||this.settings.ai.anthropic.model,availableModels:A.ai.anthropic.availableModels,apiAddress:A.ai.anthropic.apiAddress||A.ai.anthropic.baseUrl,isCustomModel:A.ai.anthropic.isCustomModel||!1,lastCustomModel:A.ai.anthropic.lastCustomModel||""}),A.ai.gemini&&this.settings.ai.gemini&&(this.settings.ai.gemini={apiKey:A.ai.gemini.apiKey||this.settings.ai.gemini.apiKey,model:A.ai.gemini.model||this.settings.ai.gemini.model,baseUrl:A.ai.gemini.baseUrl,isCustomModel:A.ai.gemini.isCustomModel||!1}),A.ai.ollama&&this.settings.ai.ollama&&(this.settings.ai.ollama={host:A.ai.ollama.host||this.settings.ai.ollama.host,model:A.ai.ollama.model||this.settings.ai.ollama.model,availableModels:A.ai.ollama.availableModels}),A.ai.deepseek&&this.settings.ai.deepseek&&(this.settings.ai.deepseek={apiKey:A.ai.deepseek.apiKey||this.settings.ai.deepseek.apiKey,model:A.ai.deepseek.model||this.settings.ai.deepseek.model,baseUrl:A.ai.deepseek.baseUrl}),A.ai.prompts&&(this.settings.ai.prompts={...this.settings.ai.prompts,...A.ai.prompts})),A!=null&&A.export&&A.export.exportPath&&(this.settings.export.exportPath=A.export.exportPath),A!=null&&A.comments&&(this.settings.comments=A.comments),A!=null&&A.comments&&(this.settings.comments=A.comments),await this.saveSettings()}async saveSettings(){var t,s,o,l,c,d,g,u,m;this.settings||(this.settings={...oA});let A=await this.loadData();A!=null&&A["flashcard-license"]&&(this.settings["flashcard-license"]=A["flashcard-license"]),this.settings.excludePatterns=(t=this.settings.excludePatterns)!=null?t:oA.excludePatterns,this.settings.useCustomPattern=(s=this.settings.useCustomPattern)!=null?s:oA.useCustomPattern,(!this.settings.regexRules||!Array.isArray(this.settings.regexRules))&&(this.settings.regexRules=[...oA.regexRules]),this.settings.ai||(this.settings.ai={...oA.ai}),this.settings.export||(this.settings.export={...oA.export}),this.settings.ai.openai||(this.settings.ai.openai={apiKey:"",model:((o=oA.ai.openai)==null?void 0:o.model)||"gpt-4o",baseUrl:(l=oA.ai.openai)==null?void 0:l.baseUrl}),this.settings.ai.anthropic||(this.settings.ai.anthropic={apiKey:"",model:"claude-2",availableModels:(c=oA.ai.anthropic)==null?void 0:c.availableModels,apiAddress:(d=oA.ai.anthropic)==null?void 0:d.apiAddress,isCustomModel:!1,lastCustomModel:""}),this.settings.ai.gemini||(this.settings.ai.gemini={apiKey:"",model:"gemini-1.5-flash",isCustomModel:!1,baseUrl:(g=oA.ai.gemini)==null?void 0:g.baseUrl}),this.settings.ai.ollama||(this.settings.ai.ollama={host:"http://localhost:11434",model:"",availableModels:(u=oA.ai.ollama)==null?void 0:u.availableModels}),this.settings.ai.deepseek||(this.settings.ai.deepseek={apiKey:"",model:"deepseek-chat",baseUrl:(m=oA.ai.deepseek)==null?void 0:m.baseUrl}),this.settings.ai.prompts||(this.settings.ai.prompts={...oA.ai.prompts}),this.settings.export||(this.settings.export={exportPath:oA.export.exportPath}),await this.saveData(this.settings)}};
/*! Bundled license information:

html2canvas/dist/html2canvas.js:
  (*!
   * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
   * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
   * Released under MIT License
   *)
  (*! *****************************************************************************
      Copyright (c) Microsoft Corporation.
  
      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.
  
      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** *)
*/
